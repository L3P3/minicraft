function m(a){function b(e){return a.next(e)}function c(e){return a.throw(e)}return new Promise(function(e,d){function g(h){h.done?e(h.value):Promise.resolve(h.value).then(b,c).then(g,d)}g(a.next())})}
const v=lui,aa=v.defer,ba=v.defer_end,ca=v.hook_async,y=v.hook_dom,z=v.hook_effect,fa=v.hook_memo,ha=v.hook_model,ia=v.hook_prev,ja=v.hook_rerender,ka=v.hook_state,A=v.hook_static,na=v.init,B=v.node,C=v.node_dom,oa=v.node_map,pa=v.now,qa=window,ra=document,sa=navigator,D=Math,ta=D.PI,ua=ta*.5,va=180/ta,wa=D.random,E=D.floor,za=D.ceil,Aa=D.round,G=D.min,J=D.max,Ba=D.cos,Ca=D.sin,Da=D.sqrt,Ea=D.log2,Fa=String.fromCharCode,Ja=qa.BroadcastChannel,Ka=Date,La=JSON,K=Promise,Ma=La.stringify,Na=La.parse,
L=localStorage,M=L.setItem.bind(L),Oa=L.removeItem.bind(L),Pa=qa.indexedDB||null,N=fetch,Qa=Array,Ra=Uint8Array,Sa=Uint32Array,$a=Set,ab=Map,S=Number,bb=Object,cb=bb.keys,db=bb.entries,eb=setTimeout,fb=setInterval,gb=clearTimeout,hb=clearInterval,ib=addEventListener,jb=removeEventListener,pb=alert,qb=confirm,rb=prompt,sb=sa.userAgent.includes("WebKit"),tb={method:"POST",headers:{"Content-Type":"application/json"}},ub=(a,b)=>(a=E(a).toString(),a.length<2?b+a:a),vb=a=>a*a,wb=()=>!1,xb=(a,b)=>{if(a<
2)return"...";const c=new Ka;a=new Ka(a);var e=c-a;if(e<59E3)return Aa(e/1E3)+"s";if(e<3E6)return Aa(e/6E4)+"m";e=a.getFullYear();const d=a.getMonth(),g=a.getDate();let h="";e<c.getFullYear()&&(h=e+"/");if(h||d<c.getMonth())h+=d+1+"/";if(h||g<c.getDate())h+=g;if(b)return h||"today";h&&(h+="/");return h+a.getHours()+":"+ub(a.getMinutes(),"0")},yb=a=>{if(!a.ok)throw Error(a.status===403?"Missing permission. Logged in?":"Connection error.");return a.json()},Eb="air stone grass dirt cobble planks bedrock log leaves bricks wool sand gravel glass bookshelf obsidian stone_bricks sandstone lapis_block iron_block gold_block diamond_block emerald_block redstone_block quartz_block".split(" "),
Fb=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813];let Gb=null;
const Hb=Pa?new K(a=>{var b;let c;(b=sa.storage)==null||(c=b.persist)==null||c.call(b);b=Pa.open("minicraft",1);b.onupgradeneeded=e=>{e=e.target.result.createObjectStore("chunks",{keyPath:["world","coords"]});for(const d of cb(L))if(d.startsWith("minicraft.world.")){const [g,h]=d.slice(16).split(":",2);h!=="meta"&&(e.add({world:S(g),coords:h,data:L.getItem(d)}),Oa(d))}};b.onsuccess=e=>{Gb=e.target.result;a()}}):K.resolve(void 0),Ib=Pa?(a,b)=>new K(c=>{const e=Gb.transaction("chunks","readonly").objectStore("chunks").get([a,
b]);e.onsuccess=()=>{let d;return c((d=e.result)==null?void 0:d.data)}}):(a,b)=>{a=L.getItem(`minicraft.world.${a}:${b}`);return K.resolve(a)},Jb=Pa?(a,b,c)=>new K((e,d)=>{const g=Gb.transaction("chunks","readwrite").objectStore("chunks").put({world:a,coords:b,data:c});g.onsuccess=()=>e();g.onerror=()=>d(g.error)}):(a,b,c)=>(M(`minicraft.world.${a}:${b}`,c),K.resolve(void 0)),Kb=Pa?(a,b)=>new K((c,e)=>{const d=Gb.transaction("chunks","readwrite").objectStore("chunks").delete([a,b]);d.onsuccess=()=>
c();d.onerror=()=>e(d.error)}):(a,b)=>(Oa(`minicraft.world.${a}:${b}`),K.resolve(void 0)),Lb=Pa?a=>new K(b=>{const c=L.getItem(`minicraft.world.${a}:meta`);if(!c)return b({});const e=Gb.transaction("chunks","readonly").objectStore("chunks").openCursor(),d={meta:c};e.onsuccess=()=>{const g=e.result;g?(g.value.world===a&&(d[g.value.coords]=g.value.data),g.continue()):b(d)}}):a=>{a=`minicraft.world.${a}:`;const b=a.length,c={};for(const e of cb(L))e.startsWith(a)&&(c[e.slice(b)]=L.getItem(e));return K.resolve(c)},
Mb=Pa?(a,b)=>new K((c,e)=>{const d=Gb.transaction("chunks","readwrite"),g=d.objectStore("chunks");for(const [h,l]of db(b))h!=="meta"?g.put({world:a,coords:h,data:l}):M(`minicraft.world.${a}:meta`,l);d.oncomplete=()=>c();d.onerror=()=>e(d.error)}):(a,b)=>m(function*(){for(const [c,e]of db(b))M(`minicraft.world.${a}:${c}`,e);M("__margin",Qa(257).join("x"));Oa("__margin")}()),Nb=Pa?a=>{const b=Gb.transaction("chunks","readwrite").objectStore("chunks").openCursor();b.onsuccess=()=>{const c=b.result;c&&
(c.value.world===a&&c.delete(),c.continue())};Oa(`minicraft.world.${a}:meta`)}:a=>{a=`minicraft.world.${a}:`;for(const b of cb(L))b.startsWith(a)&&Oa(b)},Ob=Pa?(a,b)=>new K(c=>{const e=Gb.transaction("chunks","readwrite").objectStore("chunks"),d=e.openCursor();d.onsuccess=()=>{const g=d.result;g?(g.value.world===a&&(g.delete(),g.value.world=b,e.put(g.value)),g.continue()):c()};M(`minicraft.world.${b}:meta`,L.getItem(`minicraft.world.${a}:meta`));Oa(`minicraft.world.${a}:meta`)}):(a,b)=>{a=`minicraft.world.${a}:`;
const c=a.length;for(const e of cb(L))if(e.startsWith(a)){const d=L.getItem(e);Oa(e);M(`minicraft.world.${b}:${e.slice(c)}`,d)}return K.resolve(void 0)};let T=null,Pb=0,Qb=null,Rb=0;
const Tb=()=>{U.za||U.ia!==null||(gb(Pb),V.o({xb:!0,za:!0}),Sb(!1))},Sb=a=>{m(function*(){Pb=eb(V.o,5E3,{xb:!1});try{const b=yield N(`${"/api/minicraft/"}world?what=${a?"initia":"meta_al"}l`),c=yield yb(b);a?c.version_latest!=="0.11.15"?location.reload(!0):(T=c.worlds,V.o(Object.assign({},{account:c.account,za:!1},Ub(U.config)))):(T=c,V.o(Object.assign({},{za:!1},Ub(U.config))))}catch(b){V.o({fa:"Error while loading world list: "+b.message,za:!1})}}())},Vb=(a,b)=>J(b.local,b.remote)-J(a.local,a.remote),
Ub=a=>{const b=T?T.map(c=>({account_name:c.account_name,hash:c.hash,id:c.id,label:c.label,local:0,public:c.public,remote:c.modified,writable:c.writable})):[];for(const c of a.worlds){const e=b.find(d=>d.id===c.id);if(e){const d=e.local=c.mod_l,g=e.remote,h=c.mod_r;d>h&&g>h&&(qb('Conflict! The world "'+c.label+'" was modified here and somewhere else.\nOK: Take variant from server ('+xb(g,!1)+") | Cancel: Keep local variant ("+xb(d,!1)+")")?a=Object.assign({},a,{worlds:a.worlds.map(l=>l.id===c.id?Object.assign({},
l,{mod_l:e.local=h}):l)}):e.remote=h)}else c.mod_r>1&&T&&(pb('The world "'+c.label+'" was not found on the server, so it is a local world now.'),a=Object.assign({},a,{worlds:a.worlds.map(d=>d.id===c.id?Object.assign({},d,{mod_r:0}):d)})),b.push({account_name:"",hash:0,id:c.id,label:c.label,local:c.mod_l,public:!1,remote:c.mod_r===1?1:0,writable:!0})}return{config:a,Ra:b.sort(Vb)}},Xb=()=>m(function*(){if(U.ia===null){var a;try{for(;a=U.Ra.find(b=>b.local>0&&b.remote>0&&b.local!==b.remote);)yield Wb(a);
V.o({ia:null})}catch(b){V.o({fa:b.message,ia:null})}}}()),Wb=a=>m(function*(){const b=a.id;V.o({ia:b});if(a.local<a.remote)try{yield Mb(b,yield yb(yield N(`${"/static/minicraft/"}worlds/${a.hash}.json`))),V.ha(b,{mod_l:a.remote,mod_r:a.remote})}catch(c){if(c.name==="QuotaExceededError")pb("Insufficient storage!"),Nb(b),V.Rb(b);else throw Error("Error while downloading world: "+c.message);}else if(a.writable){let c=b,e=null;try{const d=Lb(b);if(a.remote===1){const h=yield yb(yield N("/api/minicraft/world",
Object.assign({},tb,{body:Ma({what:"meta",label:a.label})})));e=Ob(Qb=b,Rb=c=h.id);V.ha(b,{id:c})}const g=yield yb(yield N("/api/minicraft/world",Object.assign({},tb,{body:Ma({what:"data",world:c,data:yield d})})));a.remote===1?T.push(g):Object.assign(T.find(h=>h.id===b),g);V.ha(c,{mod_l:g.modified,mod_r:g.modified})}catch(d){throw V.ha(b,{mod_r:0}),Error("Error while uploading world: "+d.message);}yield e}else V.ha(b,{mod_l:a.remote})}());let Y=Na(L.getItem("minicraft.config")||null);
if(Y&&Y.worlds&&Y.version.startsWith("0.9.")){const a=new $a(Y.worlds.map(b=>"minicraft.world."+b.id));for(const b of cb(L))b.startsWith("minicraft.world.")&&!a.has(b.split(":",1)[0])&&Oa(b)}
const Yb={init:()=>{let a=!1;var b={ta:!1,Ja:1,Ga:3,aa:4,O:1,Pa:120,pa:64,ya:0,worlds:[]};if(Y){let c=Y.pixel_grouping;c!=null&&(b.Ja=c);(c=Y.mouse_sensitivity)!=null&&(b.Ga=c);b.aa=Y.resolution_scaling;(c=Y.textures)!=null?b.O=c:b.O=Y.flag_textures?1:0;b.Pa=Y.view_angle;b.pa=Y.view_distance;(c=Y.world_last)!=null&&(b.ya=c);(c=Y.worlds)?b.worlds=c:L.getItem("minicraft.world.0:meta")&&(b.worlds[0]={id:0,label:(rb("There was an unnamed world found. How should it be called?","")||"Unknown world").substring(0,
16),mod_l:Ka.now(),mod_r:0},a=!0);Y=null}b=Object.assign({},{account:{label:"",rank:0},config:b,ob:b,fa:null,cursor:null,la:qa.innerHeight,ba:qa.innerWidth,ca:b.O,G:[{id:0,Lb:0,type:1}],xb:!0,za:!0,ia:null,yb:[]},Ub(b));return a?(b.ob=null,Yb.nb(b)):b},nb:a=>{const b=a.config;if(b===a.ob)return a;M("minicraft.config",Ma({version:"0.11.15",pixel_grouping:b.Ja,mouse_sensitivity:b.Ga,resolution_scaling:b.aa,textures:b.O,view_angle:b.Pa,view_distance:b.pa,world_last:b.ya,worlds:b.worlds}));return Object.assign({},
a,{ob:b})},dc:(a,b)=>Yb.T(a,b(a.config)),T:(a,b)=>Object.assign({},a,{config:Object.assign({},a.config,b)}),Wa:(a,b)=>a.config.ta===b?a:Yb.T(a,{ta:b}),o:(a,b)=>Object.assign({},a,b),Yb:(a,b)=>(ra.activeElement.blur(),Object.assign({},a,{G:[...a.G,Object.assign({},{id:J(-1,...a.G.map(c=>c.id))+1,Lb:1,type:0},b)]})),$b:(a,b)=>Object.assign({},a,{G:a.G.filter(c=>c.id!==b)}),Zb:(a,b)=>a.G[a.G.length-1].id===b?a:Object.assign({},a,{G:[...a.G.filter(c=>c.id!==b),a.G.find(c=>c.id===b)]}),Qb:(a,b)=>Object.assign({},
a,Ub(Object.assign({},a.config,{worlds:[...a.config.worlds,b]}))),Rb:(a,b)=>Object.assign({},a,Ub(Object.assign({},a.config,{worlds:a.config.worlds.filter(c=>c.id!==b)}))),ha:(a,b,c)=>Object.assign({},a,Ub(Object.assign({},a.config,{worlds:a.config.worlds.map(e=>e.id===b?Object.assign({},e,c):e)})))};let U,V;
const Zb=(a,b=1,c=null)=>({amount:b,data:c,id:a}),$b=(a,b,c=a.content.amount)=>{if(b.content)a.content.id===b.content.id?(c=G(c,b.Y-b.content.amount),a.content.amount-=c,b.content.amount+=c,a.content.amount<=0&&(a.content=null)):!(a.content.amount<=c&&a.content.amount<=b.Y&&b.content.amount<=a.Y)||a.filter&&!a.filter(b.content.id)||b.filter&&!b.filter(a.content.id)||([b.content,a.content]=[a.content,b.content]);else if(!b.filter||b.filter(a.content.id))a.content.amount<=c&&a.content.amount<=b.Y?[b.content,
a.content]=[a.content,b.content]:(c=G(c,b.Y),a.content.amount-=c,b.content=Zb(a.content.id,c),a.content.amount<=0&&(a.content=null))},ac=(a,b)=>{for(const c of a)if(c.content&&c.content.id===b.id){const e=G(b.amount,c.Y-c.content.amount);c.content.amount+=e;if((b.amount-=e)<=0)return null}for(const c of a)if(!c.content&&(!c.filter||c.filter(b.id)))if(a=G(b.amount,c.Y),a<=b.amount){if(c.content=Zb(b.id,a),(b.amount-=a)<=0)return null}else return c.content=b,null;return b},bc=(a,b)=>({kb:0,zb:0,lb:0,
W:0,qa:0,Aa:0,ja:0,X:-1,ka:0,Ba:null,Ca:null,l:1,Jb:20,H:Qa(36).fill(null).map(()=>({content:null,filter:null,Y:64})),bb:0,name:b.label||"Player",J:a.Ma,K:a.Na,L:a.Oa,Ob:0,Pb:0,N:0,va:0,ma:0,na:0,oa:0}),dc=(a,b)=>{b=G(5,b*.01);a.ma-=a.ma*.1*b;a.na-=a.na*.1*b;a.oa-=a.oa*.1*b;a.ma+=(Ba(a.W)*a.kb+Ca(a.W)*a.lb)*b;a.na+=a.zb*b;a.oa+=(-Ca(a.W)*a.kb+Ba(a.W)*a.lb)*b;cc(a,a.Ob*b*1.5,a.Pb*b*1.5);a.J+=a.ma*b;a.K+=a.na*b;a.L+=a.oa*b},cc=(a,b,c)=>{a.W=(a.W+b+ta*100)%(ta*2);a.qa=J(-ua,G(ua,a.qa+c))},ec=a=>{a+=
32;a>33&&a<39?a++:a>38&&a<44?a+=2:a>43&&a<127?a+=3:a>126&&a<55258?a+=37:a>55295&&(a+=8485);return Fa(a)},fc=a=>a-(a>63743?8517:a>159?69:a>46&&a<130?35:a>40&&a<46?34:a>34&&a<40?33:32),ic=()=>{var a=hc;const b=a.length,c=new ab,e=p=>{n=n<<1|p&1;++q===15&&(r+=ec(n),n=q=0)},d=()=>{for(let p=0;p<k;++p)e(0)},g=p=>{e(p);e(p>>1);e(p>>2);e(p>>3);e(p>>4);e(p>>5);e(p>>6);e(p>>7)},h=()=>{--w===0&&(w=1<<k++)},l=()=>{if(x)x=!1;else{let p=t.id;for(let F=0;F<k;F++)e(p>>F)}};let f=a[0],r="",n=0,q=2,k=2,w=2,u=2,t=
{id:u++,Ua:new ab},x=!0;g(f);c.set(f,t);for(let p=1;p<b;++p){const F=t.Ua.get(f=a[p]);F?t=F:(l(),c.has(f)||(h(),d(),g(f),c.set(f,{id:u++,Ua:new ab}),x=!0),t.Ua.set(f,{id:u++,Ua:new ab}),t=c.get(f),h())}l();c.has(f)||(h(),d(),g(f));h();e(1);--k;d();return r+=ec(n<<15-q)},jc=a=>{var b=hc;if(!a)return null;const c=a.length,e=()=>{q+=(u>>--t&1)<<k++;t===0&&(t=15,u=fc(a.charCodeAt(w++)))};let d=[0,1],g=1,h=3,l=2,f=null;var r=null;let n=0,q=0;r=2;let k=0,w=0,u=fc(a.charCodeAt(w++)),t=15;for(;k<r;)e();if(q===
1)return null;for(q=k=0;k<8;)e();f=[q];d[2]=f;for(b[n++]=q;w<=c;){r=l;for(q=k=0;k<r;)e();if(q===0){for(q=k=0;k<8;)e();d[h]=[q];q=h++;--g===0&&(g=1<<l++)}else if(q===1)return b;r=q<d.length?d[q]:f.concat(f[0]);for(let x=0;x<r.length;x++)b[n++]=r[x];d[h++]=f.concat(r[0]);f=r;--g===0&&(g=1<<l++)}return null},kc=new ab,lc=new Sa(1024),hc=new Ra(lc.buffer),mc=new ab,nc=a=>{const b={da:null,Ta:null,busy:!1,ea:null,Va:null,Da:0,B:!1,sa:!U.Ra.find(c=>c.id===a).writable,Za:0,$a:0,ab:0,id:a,Ha:0,Ia:0,M:0,Ma:.5,
Na:8.5,Oa:.5,time:0,ub:0};kc.set(a,b);V.o({yb:[...kc.keys()]});return b},zc=(a,b,c,e)=>c<0||c>63?0:a.da[(b<<a.M+4|e)<<6|c],Ac=(a,b,c,e)=>{const d=a.M;a.da[(b<<d+4|e)<<6|c]=0;a.ea[(b>>4<<d|e>>4)<<2|c>>4].ra=!0},Bc=(a,b,c,e,d)=>{const g=a.M,h=(b<<g+4|e)<<6|c;if(a.da[h]>0)return!1;a.da[h]=d;return a.ea[(b>>4<<g|e>>4)<<2|c>>4].ra=!0},Ec=(a,b,c)=>{m(function*(){a.ea&&(yield Cc(a,b));var e=1<<(a.M=c);const d=a.ea=[];for(let g=0;g<e;++g)for(let h=0;h<e;++h)for(let l=0;l<4;++l)d.push({ra:!1,loaded:!1,x:g,
y:l,z:h,Sa:0,jb:0});e<<=c+12+2;a.da===null||a.da.length<e?a.Ta=new Sa((a.da=new Ra(e)).buffer):a.Ta.fill(0);Dc(a,b,!0)}())},Dc=(a,b,c)=>{const e=J(G(b.K,63),0)>>4,d=E(b.J)>>4;b=E(b.L)>>4;if(c||a.$a!==e||a.Ha+a.Za!==d||a.Ia+a.ab!==b)c=1<<a.M,a.$a=e,a.Ha=d-(a.Za=(65536+d)%c),a.Ia=b-(a.ab=(65536+b)%c),Fc(a);a.busy||Gc(a,!1)},Fc=a=>{const b=a.Za,c=a.$a,e=a.ab,d=a.M,g=`${d} ${b} ${e} ${c}`;let h=mc.get(g);if(h==null){const l=1<<d,f=vb(l*.5);mc.set(g,h=a.ea.map(({x:r,y:n,z:q},k)=>{let w=vb(r-b),u=vb(q-
e),t=vb(r-b-l),x=0,p=0;t<w&&(w=t,x=-l);(t=vb(r-b+l))<w&&(w=t,x=l);(t=vb(q-e-l))<u&&(u=t,p=-l);(t=vb(q-e+l))<u&&(u=t,p=l);return{pb:w+u+vb(n-c),Cb:k,Ha:x,Ia:p}}).filter(({pb:r})=>r<=f).sort((r,n)=>r.pb-n.pb))}a.Va=h;a.Da=0},Cc=(a,b)=>m(function*(){if(!a.sa&&a.B){a.B=!1;for(var c=Ka.now(),e=b.H.map(({content:d})=>d&&[d.id,d.amount,d.data]);e.length>0&&e[e.length-1]===null;)e.pop();M(`minicraft.world.${a.id}:meta`,Ma({p:{h:b.Jb,i:e,m:b.l,p:[b.J,b.K,b.L,b.W,b.qa]},s:[a.Ma,a.Na,a.Oa],t:a.time,v:1}));yield K.all(a.ea.filter(d=>
d.ra).map(d=>Hc(a,d)));V.ha(a.id,{mod_l:c})}}()),Jc=(a,b)=>{const c=Na(L.getItem(`minicraft.world.${a.id}:meta`));if(c){const e=c.p,d=c.s,g=c.t;c.v!=null&&(e.i.forEach((h,l)=>{h&&(b.H[l].content=Zb(h[0],h[1],h[2]))}),b.Jb=e.h,b.l=e.m,b.J=e.p[0],b.K=e.p[1],b.L=e.p[2],b.W=e.p[3],b.qa=e.p[4],a.Ma=d[0],a.Na=d[1],a.Oa=d[2],g!=null&&Ic(a,g))}},Ic=(a,b)=>{a.time=b%24E3;a.ub=(b+6E3)/24E3%1},Kc=a=>m(function*(){const b=a.ea[a.Va[a.Da=0].Cb];var c=b.y;yield Kb(a.id,`${b.Sa}/${b.jb}`+(c>0?"/"+c:""));b.ra=!1;
++b.Sa;return Gc(a,!1)}()),Hc=(a,b)=>{const c=a.Ta;var e=a.M;const d=b.y,g=(256<<e)-256;for(let h=0,l=-1,f=((b.x<<e+4|b.z)<<6|d)<<2;h<16;++h){for(e=0;e<16;++e)lc[++l]=c[f],lc[++l]=c[++f],lc[++l]=c[++f],lc[++l]=c[++f],f+=13;f+=g}b.ra=!1;return Jb(a.id,`${b.Sa}/${b.jb}`+(d>0?"/"+d:""),ic())},Gc=(a,b)=>m(function*(){const c=a.ea,e=a.Va,d=a.Ha,g=a.Ia,h=e.length;for(;a.Da<h;){var l=e[a.Da++],f=c[l.Cb],r=f.loaded,n=f.x;const u=f.y;var q=f.z,k=d+l.Ha+n;const t=g+l.Ia+q;if(!r||k!==f.Sa||t!==f.jb){f.loaded=
a.busy=!0;l=f.ra&&Hc(a,f);var w=a.id;k=f.Sa=k;f=f.jb=t;f=jc(yield Ib(w,`${k}/${f}`+(u>0?"/"+u:"")));yield l;a.busy=!1;if(r||u===0||f){l=a.Ta;k=a.M;w=(256<<k)-256;n=((n<<k+4|q)<<6|u)<<2;if(f)for(let x=0,p=-1;x<16;++x){for(r=0;r<16;++r)l[n]=lc[++p],l[++n]=lc[++p],l[++n]=lc[++p],l[++n]=lc[++p],n+=13;n+=w}else for(q=0;q<16;++q){for(f=0;f<16;++f)l[n]=u>0?0:50397446,l[++n]=u>0?0:131843,r?(l[++n]=0,l[++n]=0,n+=13):n+=15;n+=w}if(!b)break}}}}());let Lc=null,Mc=0;
const Nc=new $a,Oc=a=>{if(a){const b=new Image;b.onload=()=>{if(U.ca===a){var c=ra.createElement("canvas");c.width=16;c.height=416;c=c.getContext("2d");c.scale(1,-1);for(let e=0;e<26;++e)c.drawImage(b,0,e<<4,16,16,0,-(e<<4)-16,16,16);Lc=new Sa(c.getImageData(0,0,16,416).data.buffer);for(const e of Nc)e.B=!0;Mc=a;V.o({ca:0})}};b.onerror=()=>{U.ca===a&&(alert("Error while loading surface!"),aa(),V.T({O:Mc}),V.o({ca:0}),ba())};b.src=`${"/static/minicraft/"}textures/${a}.png`}else Lc=null},Qc=(a,b)=>
{const c={Sb:b,mb:b.getContext("2d",{alpha:!1,desynchronized:!0}),Ab:null,Bb:null,Fb:"",B:!1,Gb:0,qb:0,Tb:fb(()=>(c.Gb=c.qb,c.qb=0),1E3),U:a};Nc.add(c);Pc(c);return c},Rc=(a,b)=>{++a.qb;const c=a.mb;var e=a.Ab;const d=a.Bb,g=a.U,h=g.config,l=g.Fa,f=g.g,r=g.Ka,n=g.La,q=g.world;var k=0;if(!g.A||a.B){a.B=!1;var w=h.Ja;const md=h.pa;var u=f.W,t=f.qa;const nd=f.ja,od=f.ka,Ta=f.l;var x=f.J;k=f.K;var p=f.L;const pd=l?f.X:-1,qd=q.da;var F=q.M;const rd=Lc!==null;var kb=1/r,xa=1/n;const da=r>>1,la=n>>1,oc=
G(r,n),pc=oc>32,qc=Ba(u);u=Ca(u);const rc=Ba(-t);t=Ca(-t);var Ga=h.Pa/45;const sd=kb*(r<n?Ga*r*xa:Ga);kb=xa*(n<r?Ga*n*kb:Ga);x+=65536;xa=k+65536;p+=65536;Ga=x%1;const td=xa%1,ud=p%1;F=4+F;const Ha=(1<<F)-1;w=w<r?w:1;const vd=r-w;let sc=f.l===1?6:4,Ua=f.ja=f.ka=f.Aa=0,tc=0;f.X=-1;k=k<0||k>=64?0:zc(q,x&Ha,xa&63,p&Ha);if(Ta!==2&&k>0)f.ja=x&Ha,f.X=xa&63,f.ka=p&Ha,f.Aa=6,d.fill(Fb[k]|4278190080);else{for(let Va=0;Va<n;++Va){var lb=(la-Va)*kb;const uc=lb*rc-t;var zb=lb*t+rc;lb=zb*u;zb*=qc;let ea=0,Ia=!1;
var Wa=!1;a:for(let O=0;O<r;O+=w)for(let W=Wa?1:0;W<w;++W){if(w<2)var H=O;else if(O===0)H=W===0?0:W===1?w:W-1,Ia=W===1;else if(O<vd)H=(Ia=W===1)?O+w:O+W-1;else{if((H=W===0?O-1:O+W)>=r)break a;Ia=!1}var P=(H-da)*sd;Wa=lb+qc*P;const vc=zb-u*P,wd=tc;P=16757124;let mb=1,wc=md,nb=0;Ta===2&&k>0&&(nb=wa()*10);for(let Ab=0;Ab<3;++Ab){const Q=(wd+Ab)%3;let X=vc;var I=ud;Q===0&&(X=Wa,I=Ga);Q===1&&(X=uc,I=td);var ma=-1/X;X>0&&(I=1-I,ma*=-1);const ob=Wa*ma,ya=uc*ma;ma*=vc;const xc=Da(ob*ob+ya*ya+ma*ma);let Xa=
x+ob*I-(Q===0&X<0|0),Ya=xa+ya*I-(Q===1&X<0|0),Za=p+ma*I-(Q===2&X<0|0);I*=xc;for(let Bb,Cb,Db,R;I<wc;Xa+=ob,Ya+=ya,Za+=ma,I+=xc)if(!(Ta===2&&I<nb))if(Ya<65536){if(ya<0)break}else if(Ya>=65600){if(ya>0)break}else if((R=qd[((Bb=Xa&Ha)<<F|(Db=Za&Ha))<<6|(Cb=Ya&63)])!==0){Ta!==2&&Va===la&&H===da&&I<=sc&&(f.ja=Bb,f.X=Cb,f.ka=Db,f.Aa=X<0|Q<<1,sc=I);if(rd){--R;Q===1?R===6?R=25:R===13?R=4:R===1&&ya>0&&(R=2):R===1&&(R=24);const yc=Lc[R<<8|((Q===1?Za:Ya)*16&15)<<4|(Q===1?Xa:(X>0?Xa-Za:Za-Xa)+65536)*16&15];if(yc>>>
24===0)continue;P=yc&16777215}else P=Fb[R];wc=I;mb=(Q===0?.8:Q===2?.6:X>0?.4:1)+(Cb!==pd||Bb!==nd||Db!==od?0:.2);tc=Q;break}else Ta===2&&I<nb&&(nb=I)}P=4278190080|G((P>>16)*mb,255)<<16|G((P>>8&255)*mb,255)<<8|G((P&255)*mb,255);if(Wa=(Ia=Ia&&(Va!==la||H<da||H>da+w))&&ea===P){if(w>6){d.fill(ea,Ua+O+1,Ua+O+w+1);break}H=Ua+O+1;d[H]=ea;d[++H]=ea;if(w<3)break;d[++H]=ea;if(w<4)break;d[++H]=ea;if(w<5)break;d[++H]=ea;if(w<6)break;d[++H]=ea;break}if(Ia||H===0)ea=P;d[Ua+H]=P}Ua+=r}l&&!pc&&(d[r*la+da]^=16777215)}c.putImageData(e,
0,0);l&&pc&&(e=G(za(oc*.05),8),c.fillRect(da-e,la-1,e<<1,2),c.fillRect(da-1,la-e,2,e-1),c.fillRect(da-1,la+1,2,e-1))}a.Fb=g.Ya?`minicraft ${"0.11.15"} ${ub(a.Gb,"\u00a0")} fps, T: ${ub(q.ub*24,"0")}:${ub(q.ub*24%1*60,"0")}; ${g.A&&b%1E3<500?"":q.time}
R: ${r}x${n} (x${h.aa}), D: ${h.pa}, C: ${q.Da}/${q.Va.length}, M: ${vb(1<<4+q.M)*64>>10}k
E: 0/0, M: ${f.l}, I: ${k}

Position: ${f.J.toFixed(2)} ${f.K.toFixed(2)} ${f.L.toFixed(2)}
Angle: ${(f.W*va).toFixed(2)} ${(f.qa*va).toFixed(2)}
Focus: ${f.X<0?"":f.ja+" "+f.X+" "+f.ka+" "+"WEBTSNI"[f.Aa]+": "+Eb[zc(q,f.ja,f.X,f.ka)]}
Chunk abs: ${E(f.J)>>4} ${E(f.L)>>4} ${E(f.K)>>4} rel: ${q.Za} ${q.ab} ${q.$a}`:""},Pc=a=>{const b=a.Sb,c=a.U;a.Bb=new Sa((a.Ab=a.mb.createImageData(b.width=c.Ka,b.height=c.La)).data.buffer);const e=c.Ka*c.config.aa/c.ua,d=c.La*c.config.aa/c.ua;b.style.width=e+"px";b.style.height=d+"px";b.style.left=Aa((c.eb-e)/2)+"px";b.style.top=Aa((c.fb-d)/2)+"px";a.mb.fillStyle="rgba(255,255,255,.5)"};let Sc=0;
const Vc=(a,b,{config:c,account:e})=>{const d=nc(c.ya),g=bc(d,e);Jc(d,g);const h={config:c,Db:0,Eb:0,Ya:!1,Fa:!0,A:!0,Hb:a,ga:0,$:new $a,rb:"",j:0,V:[],g,sb:null,u:null,ua:1,eb:1,fb:1,Ka:0,La:0,gb:0,Nb:0,hb:0,Wb:fb(()=>{var l;(l=h.A)||(d.B=!0,Ic(d,d.time+1),Dc(d,g,!1),l=void 0);return l},50),Qa:b,world:d};Tc(h,null);Uc(h);return h},Uc=a=>{m(function*(){if(!a.config.ta)return a.Hb.requestPointerLock().catch(()=>{})}())},Wc=(a,b)=>a===b?0:.1-a*.2,Xc=a=>{a.g.kb=Wc((a=a.$).has(-12)||a.has(65),a.has(-13)||
a.has(68))},Yc=a=>{a.g.zb=Wc((a=a.$).has(-15)||a.has(16),a.has(-14)||a.has(32))},Zc=a=>{a.g.lb=Wc((a=a.$).has(-11)||a.has(83),a.has(-10)||a.has(87))},$c=a=>{a.g.Ob=Wc(a.$.has(-18),a.$.has(-19))},ad=a=>{a.g.Pb=Wc(a.$.has(-17),a.$.has(-16))},cd=(a,b,c)=>{if(!a.world)return!1;const e=a.$;var d=a.g;if(c){if(e.has(b))return!1;e.add(b);var g=d.ja,h=d.X;c=d.ka;switch(b){case -18:case -19:$c(a);break;case -17:case -16:ad(a);break;case -1:!a.world.sa&&d.l!==2&&h>=0&&(d.bb===0?d.l===0&&(b=zc(a.world,g,h,c),
b===2?b=3:b===1&&(b=4),b===6||b!==8&&b!==13&&ac(d.H,Zb(b,1))!==null)||(Ac(a.world,g,h,c),d.X=-1):bd(a,[g,h,c],!1));break;case -2:case 71:if(h>=0){const l=zc(a.world,g,h,c);c=d.H.slice(0,9);h=c.findIndex(f=>f.content!==null&&f.content.id===l);h>=0?d.N=h:d.l===1&&(c[d.N].content&&(c=c.findIndex(f=>f.content===null),c>=0&&(d.N=c)),d.H[d.N].content=Zb(l));d.va=a.ga}break;case -3:if(!a.world.sa&&d.l!==2&&h>=0)if(d.bb===0){if(b=d.H[d.N],b.content){switch(d.Aa){case 0:--g;break;case 1:++g;break;case 2:--h;
break;case 3:++h;break;case 4:--c;break;case 5:++c}h>=0&&h<64&&Bc(a.world,g&(1<<4+a.world.M)-1,h,c&(1<<4+a.world.M)-1,b.content.id)&&d.l!==1&&--b.content.amount<=0&&(b.content=null)}}else bd(a,[g,h,c],!0);break;case -4:d.N=(d.N+9-1)%9;d.va=a.ga;break;case -5:d.N=(d.N+1)%9;d.va=a.ga;break;case 27:a.j===0&&(a.A=!0,a.j=1);break;case -15:case -14:case 16:case 32:Yc(a);break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:d.N=b-49;d.va=a.ga;break;case -12:case -13:case 65:case 68:Xc(a);
break;case 69:if(a.j===0){a.j=3;for(const l of e)cd(a,l,!1)}break;case 70:a.Qa.Ib();break;case 80:a.world&&(a.A=!0);break;case 81:d=d.H[d.N];if(e.has(17)||d.content&&--d.content.amount<=0)d.content=null;break;case -11:case -10:case 83:case 87:Zc(a);break;case 84:if(a.j===0){a.j=2;for(const l of e)cd(a,l,!1)}break;case 112:a.Fa=!a.Fa;break;case 114:a.Ya=!a.Ya;case 116:case 122:case 123:break;default:return!1}}else{if(!e.delete(b))return!1;switch(b){case -15:case -14:case 16:case 32:Yc(a);break;case -12:case -13:case 65:case 68:Xc(a);
break;case -11:case -10:case 83:case 87:Zc(a);break;case -18:case -19:$c(a);break;case -17:case -16:ad(a)}}a.rb=[...e].join();return!0},dd=(a,b)=>(b=b.startsWith("~")?a+S(b.slice(1)):S(b),isNaN(b)?a:b),fd=(a,b)=>{var c=a.g,e=a.world;if(b)if(b.charAt(0)==="/"){b=b.slice(1).split(" ");const d=b.shift();switch(d){case "clear":a.V=[];break;case "clearinv":for(const g of c.H)g.content=null;Z(a,"Inventory cleared.",!0);break;case "gamemode":case "gm":b=S(b[0]);!isNaN(b)&&b>=0&&b<3&&b%1===0?(c.l=b,Z(a,"Game mode set to: "+
b,!0)):Z(a,"Game mode must be in 0..2!");break;case "give":if(b.length===0){Z(a,"/give <id> [Amount]\n"+Eb.join(" "));break}e=Eb.indexOf((b[0]||"").toLowerCase());e=e>=0?e:S(b[0]);b=S(b[1]||1);!isNaN(e)&&e>0&&e<25&&e%1===0?!isNaN(b)&&b>0&&b%1===0?Z(a,ac(c.H,Zb(e,b))?"Inventory is full!":`${"Gave items"} ${b} ${Eb[e]}`,!0):Z(a,"Amount must be at least 1!"):Z(a,"Invalid block type!");break;case "help":Z(a,"Commands: clear, clearinv, gamemode, give, help, load, me, save, spawn, teleport, time, version");
break;case "load":Gc(e,!0).then(()=>{a.u.B=!0;Z(a,"Chunks loaded.",!0)});break;case "me":Z(a,c.name+" "+b.join(" "),!0);break;case "save":if(a.world.sa){Z(a,"No permission!");break}Cc(a.world,a.g);Z(a,"Game saved.",!0);break;case "spawn":if(a.world.sa){Z(a,"No permission!");break}e.Ma=c.J;e.Na=c.K;e.Oa=c.L;Z(a,"Spawn updated.",!0);break;case "teleport":case "tp":b.length===0?(c.J=e.Ma,c.K=e.Na,c.L=e.Oa,a.u.B=!0,Z(a,"Teleported to spawn.",!0)):b.length===3?(Z(a,"Teleported to"+` ${c.J=dd(c.J,b[0])} ${c.K=
dd(c.K,b[1])} ${c.L=dd(c.L,b[2])}`,!0),a.u.B=!0):Z(a,"Pitch!");c.ma=0;c.na=0;c.oa=0;break;case "time":c=b[1];if(!c){Z(a,"Parameter missing!");break}if(c==="day")c=1E3;else if(c==="night")c=13E3;else if(isNaN(c=E(S(c))))break;switch(b[0]){case "add":c+=e.time;case "set":Ic(e,c);Z(a,"Time set to: "+e.time,!0);break;default:Z(a,"Unknown command: time "+b[0])}break;case "version":Z(a,"minicraft 0.11.15");break;case "_w":V.Yb({type:b[0]==="m"?1:0});break;case "/exit":c.bb=0;Z(a,"Normal mouse mode.",!0);
break;case "/expand":a.g.Ba&&a.g.Ca?e=!0:(Z(a,"Selection required!"),e=!1);e&&(b[0]==="vert"?(c.Ba[1]=0,c.Ca[1]=63,Z(a,"Expanded selection.",!0)):Z(a,'Only "vert" supported!'));break;case "/pos1":case "/pos2":bd(a,[E(c.J),E(c.K),E(c.L)],d==="/pos2");break;case "/regen":if(a.world.sa){Z(a,"No permission!");break}Kc(e).then(()=>{a.u.B=!0;Z(a,"Chunk regenerated.",!0)});break;case "/show":Z(a,`${"Primary"}: ${c.Ba?c.Ba.join(" "):"none"}, ${"Secondary"}: ${c.Ca?c.Ca.join(" "):"none"}`);break;case "/wand":c.bb=
1;Z(a,"Select using mouse buttons.",!0);break;default:Z(a,"Unknown command: "+d)}}else{const d=Z(a,`<${c.name}> `+b);Tc(a,b).then(g=>{g&&ed(a,d)})}},Z=(a,b,c=!1)=>{const e=++Sc;(a.V=a.V.slice(-49)).push({id:e,Kb:c,time:pa(),value:b});return e},ed=(a,b)=>{const c=a.V.findIndex(e=>e.id===b);c>=0&&a.V.splice(c,1)},bd=(a,b,c)=>{c?a.g.Ca=b:a.g.Ba=b;Z(a,`${c?"Secondary point":"Primary point"}: ${b.join(" ")}`,!0)},Tc=(a,b)=>(gb(a.sb),a.sb=eb(Tc,5E3,a,null),(b?N("/api/chat",Object.assign({},tb,{body:Ma({msg:b})})):
N("/api/chat")).then(c=>c.ok&&c.text()).then(c=>{if(c){c=c.split("\n").filter(Boolean);for(const e of c)e.startsWith("<")&&Z(a,e);return c.length>0}return!1}).catch(()=>!1)),gd=({id:a,P:b})=>(y("div[className=bitmap]",{S:{backgroundImage:`url(${"/static/minicraft/"}textures/${b}.png)`,backgroundPositionY:100-a*100+"%"}}),null);function hd({amount:a,l:b,id:c,P:e}){y("div[className=stack]",{title:Eb[c]+(b===1?` (${c})`:"")});return[B(gd,{id:c,P:e}),a!==1&&C("div[className=amount]",{innerText:a})]}
function id({g:a,P:b,wa:c}){y("div[className=bar]",{ontouchstart:A(d=>{a.N=Number(d.target.closest("[data-slot]").dataset.slot);a.va=d.timeStamp}),S:{opacity:J(.5,G(1,1-(c-a.va-5E3)*5E-4))}});const e=a.l;return a.H.slice(0,9).map(({content:d},g)=>C("div",{D:{slot:g},F:{active:g===a.N}},[d&&B(hd,{amount:d.amount,data:d.data,l:e,id:d.id,P:b})]))}
function jd({Vb:a,P:b}){y("div[className=grid]",{onclick:({target:c})=>{(c=c.closest("[data-id]"))&&$b({content:Zb(S(c.dataset.id)),filter:null,Y:64},a)}});return Eb.map((c,e)=>e>0&&C("div",{D:{id:e}},[B(hd,{amount:1,data:null,l:1,id:e,P:b})]))}
function kd({U:a,P:b}){const c=fa(()=>({content:null,filter:null,Y:64})),e=a.g.l;y("div[className=menu overlay inventory]",fa(()=>({onclick:({target:d})=>{if(d.className==="menu overlay inventory")c.content?c.content=null:(a.j=0,a.A=!1,Uc(a));else if(d=d.closest("[data-slot]"))d=a.g.H[S(d.dataset.slot)],c.content?$b(c,d):d.content&&$b(d,c)},oncontextmenu:({target:d})=>{if(d.className==="menu overlay inventory")c.content?--c.content.amount<=0&&(c.content=null):(a.j=0,a.A=!1,Uc(a));else if(d=d.closest("[data-slot]"))d=
a.g.H[S(d.dataset.slot)],c.content?$b(c,d,1):d.content&&$b(d,c,za(d.content.amount/2))}})));return[C("div[className=window]",null,[C("h2[innerText=Inventory]"),e===1&&B(jd,{Vb:c,P:b}),C("div[className=grid]",null,a.g.H.map(({content:d},g)=>C("div",{D:{slot:g},F:{first:g<9}},[d&&B(hd,{amount:d.amount,data:d.data,l:e,id:d.id,P:b})])))]),c.content&&C("div[className=hand]",{S:{transform:`translate(${a.Db}px, ${a.Eb}px)`}},[B(hd,{amount:c.content.amount,data:c.content.data,l:0,id:c.content.id,P:b})])]}
const ld=({I:{Kb:a,time:b,value:c},wa:e})=>(y(a?"div[className=minor]":"div",{innerText:c,S:{opacity:G(1,1-(e-b-4500)*.001)}}),null);function xd({V:a,wa:b}){y("div[className=messages]");const c=b-5E3;return[oa(ld,a.slice(-10).filter(e=>e.time>c),{wa:b})]}function yd({I:a,current:b,ca:c}){y("button",{disabled:a.id===b||c>0,innerText:`${a.label} (${a.owner})`,onclick:()=>{aa();V.T({O:a.id});V.o({ca:a.id});ba()}});return null}
function zd({U:a,state:{config:b,ca:c},xa:e}){a&&z(()=>{Cc(a.world,a.g)});const [d,g]=ka(!1),h=ca(()=>d?N("/static/minicraft/textures.json").then(yb).catch(()=>null):K.resolve(null),[d],null);y("div[className=menu overlay]");return[C("h1",{innerText:d?"Surfaces":"Settings"}),C("center",null,[C("button",{innerText:a&&!d?"Back to game":"Back",onclick:()=>{d?g(!1):a?(a.j=0,a.A=!1,Uc(a)):e(2)}})]),!d&&C("div[className=settings]",null,[C("button[innerText=Surfaces...]",{onclick:()=>{g(!0)}}),C("label[innerText=Resolution:]",
null,[C("input[type=range][min=1][max=100][step=1]",{value:101-b.aa,onchange:l=>V.T({aa:101-Number(l.target.value)})})]),C("label[innerText=View angle:]",null,[C("input[type=range][min=1][max=180][step=1]",{value:b.Pa,onchange:l=>V.T({Pa:Number(l.target.value)})})]),C("label[innerText=View distance:]",null,[C("input[type=range][min=1][max=128][step=1]",{value:b.pa,onchange:l=>V.T({pa:Number(l.target.value)})})]),C("label[innerText=Pixel grouping:]",null,[C("input[type=range][min=1][max=8][step=1]",
{value:b.Ja,onchange:l=>V.T({Ja:Number(l.target.value)})})]),C("label[innerText=Mouse sensitivity:]",null,[C("input[type=range][min=1][max=15][step=1]",{value:b.Ga,onchange:l=>V.T({Ga:Number(l.target.value)})})]),C("button[innerText=Project page]",{onclick:()=>{open("//github.com/L3P3/minicraft")}})]),a&&!d&&C("center",null,[C("button[innerText=Leave world]",{onclick:()=>{e(2)}})]),d&&C("div[className=settings]",null,[C("button[innerText=Plain]",{disabled:b.O===0,onclick:()=>{aa();V.T({O:0});V.o({ca:0});
ba()}}),h&&oa(yd,h,{current:b.O,ca:c})]),d&&C("center",null,[C("button[innerText=Add surface]",{onclick:()=>{open("//l3p3.de/svr/minicraft/textures.html")}})])]}const Ad=({I:{Kb:a,value:b}})=>(y(a?"div[className=minor]":"div",{innerText:b}),null);
function Bd({U:a,V:b}){const c=A({history:null,input:null});y("div[className=menu overlay terminal]",{onclick:e=>{e.target!==c.input&&c.input.focus()}});z(e=>{e&&eb(()=>c.history.scrollTop=1E9,0)},[b.length&&b[b.length-1].id]);return[A(C("div[className=toolbar]",null,[C("button[innerText=\u274c]",{onclick:()=>{a.j=0;a.A=!1;Uc(a)}})])),C("div[className=history]",{R:A(e=>{c.history=e})},[oa(Ad,b)]),A(C("input[autocomplete=off][enterkeyhint=send][mozactionhint=send][name=message][required]",{onkeydown:e=>
{const d=e.keyCode;e=e.target;d===13?(fd(a,e.value),e.value=""):d===27&&(a.j=0,a.A=!1,Uc(a))},R:e=>{c.input=e;eb(()=>e.focus(),0)}}))]}const Cd=[["pick",-2],["up",-14],["down",-15],["E",69],["T",84],["F1",112],["F3",114],["...",27]],Dd=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]],Ed=[["up",-16],["down",-17],["left",-18],["right",-19],["center",-3]];
function Fd({U:a}){const b=a.$,c=([e,d])=>C("div",{D:{code:d},F:{button:!0,[e]:!0,active:b.has(d)}});y("div[className=touch]",A({ontouchstart:e=>{let {code:d}=e.target.dataset;if(d!=null&&cd(a,d=S(d),!0)){const g=e.changedTouches[0].identifier,h=l=>{l.changedTouches[0].identifier===g&&(jb("touchend",h),cd(a,d,!1))};ib("touchend",h)}return!1}}));return[C("div[className=top]",null,Cd.map(([e,d])=>C(`div[innerText=${e}]`,{D:{code:d},F:{button:!0,active:b.has(d)}}))),C("div[className=move]",null,Dd.map(c)),
C("div[className=move sec]",null,Ed.map(c))]}
function Gd({frame:a,Z:b,state:c,xa:e,Qa:d}){const g=c.config,h=pa(),l=ra.pointerLockElement===a,f=fa(()=>Vc(a,d,c));z(()=>{Hd.add(f);const n=u=>{if(f.j!==0)return!0;ra.pointerLockElement===a?cd(f,-1-u.button,u.type==="mousedown"):Uc(f);return!1},q=u=>{if(ra.pointerLockElement===a){var t=f.config.Ga*ta/(J(f.eb,f.fb)*f.ua);sb&&(f.Nb=u.timeStamp);cc(f.g,f.gb=u.movementX*t,f.hb=-u.movementY*t)}else t=f.Hb.getBoundingClientRect(),f.Db=u.clientX-t.left,f.Eb=u.clientY-t.top},k=u=>{V.Wa(!1);if(f.j===0&&
!f.A&&D.abs(u.deltaY)>5)return u=u.deltaY>0?-5:-4,cd(f,u,!0),cd(f,u,!1),!1},w={passive:!0};a.addEventListener("mousedown",n);a.addEventListener("mouseup",n);a.addEventListener("mousemove",q,w);a.addEventListener("wheel",k,w);return()=>{a.removeEventListener("mousedown",n);a.removeEventListener("mouseup",n);a.removeEventListener("mousemove",q,w);a.removeEventListener("wheel",k,w);gb(f.sb);hb(f.Wb);Cc(f.world,f.g);kc.delete(f.world.id);V.o({yb:[...kc.keys()]});var u=f.u;Nc.delete(u);hb(u.Tb);return Hd.delete(f)}});
z(()=>{f.config=g;f.u&&(f.u.B=!0);const n=f.world,q=za(Ea(f.config.pa/16*2+2));n.M!==q&&Ec(n,f.g,q)},[g]);z((n,q,k)=>{f.ua=k||1;f.eb=J(1,n);f.fb=J(1,q);q=f.config.aa;n=za(f.eb*f.ua/q);q=za(f.fb*f.ua/q);if(n!==f.Ka||q!==f.La)f.Ka=n,f.La=q,f.u&&(f.u.B=!0,Pc(f.u))},[a.offsetWidth,a.offsetHeight,qa.devicePixelRatio,g.aa]);z(()=>{b&&cd(f,b.code,b.state)},[b]);z(n=>{n||f.A||f.j!==0||(f.j=1,sb&&f.gb|f.hb&&f.Nb>h-100&&(cc(f.g,-f.gb,-f.hb),f.gb=f.hb=0,f.u.B=!0));f.A=!n},[g.ta&&f.j===0||l]);z(n=>l&&n&&ra.exitPointerLock(),
[f.A||f.j!==0]);h===f.ga||Id||(f.world&&(f.ga&&!f.A&&dc(f.g,h-f.ga),f.u&&Rc(f.u,h)),f.ga=h);ja();const r=A({wb:1});g.O&&(r.wb=g.O);return[C("canvas",{R:A(n=>f.u=Qc(f,n))}),f.Fa&&f.j!==2&&B(xd,{V:f.V,wa:h}),f.u&&f.Ya&&C("div[className=diagnostics]",{innerText:f.u.Fb}),g.ta&&B(Fd,{U:f,rb:f.rb}),f.Fa&&f.j!==3&&f.g.l!==2&&B(id,{g:f.g,P:r.wb,wa:h}),f.j===3&&B(kd,{U:f,P:r.wb,wa:h}),f.j===1&&B(zd,{U:f,state:c,xa:e}),f.j===2&&B(Bd,{U:f,V:f.V})]}
function Jd({I:a,ac:b,bc:c,ia:e}){y("div",{F:{selected:a===b},onclick:()=>{c(a.id)}});b=`${a.local?"L":"_"}${a.local&&a.remote?a.local>a.remote?">":a.local<a.remote?"<":"=":"_"}${a.remote?a.public?"R":"r":"_"}`;e===a.id&&(b=`[${b}]`);return[C("span",{innerText:`${b} ${a.label}`,title:a.account_name?"Owner: "+a.account_name:"Just a local world"}),C("span",{innerText:xb(J(a.local,a.remote),!0)})]}
function Kd({state:{account:a,config:b,fa:c,xb:e,za:d,ia:g,Ra:h,yb:l},xa:f}){y("div[className=menu]");const [r,n]=ka(b.ya),q=r!==Qb?r:n(Rb),k=fa(()=>h.find(p=>p.id===q)||null,[q,h]),[w,u]=ka(!1);k||u(!1);const [t,x]=ka(!1);l=!!k&&l.includes(q);return[C("h1[innerText=Worlds]"),C("button[innerText=Refresh][style=position:absolute;left:0;top:0;height:2rem][title=Reload list]",{disabled:e||d||c!==null,onclick:Tb}),C("button[style=position:absolute;right:0;top:0;height:2rem]",{disabled:a.rank>0,innerText:a.rank?
a.label:"Login",onclick:()=>{location.href="/account?redir=minicraft"}}),C("div[className=worlds]",null,[oa(Jd,h,{cc:Ka.now(),ac:k,bc:n,ia:g})]),C("center",null,[C("button[innerText=Enter]",{disabled:!k||l||k.local<2||k.remote>k.local,onclick:()=>{aa();V.T({ya:k.id});f(0);ba()},title:k?l?"The world is already opened!":k.local<2?"The world is not downloaded yet!":k.local<k.remote?"The world is still loading!":"Enter selected world":"No world selected!"}),C("button[innerText=World...]",{disabled:!k||
w,onclick:()=>{u(!0)},title:k?l?"The world is already opened!":"Show world settings":"No world selected!"})]),C("hr"),C("center",null,[C("button[innerText=New world]",{onclick:()=>{const p=rb("New world's label:\n(max. 16 characters)","New world");p&&(p.length>16?pb("Name is too long!"):V.Qb({id:G(0,...b.worlds.map(F=>F.id))-1,label:p,mod_l:Ka.now(),mod_r:0}))}}),C("button[innerText=Settings]",{onclick:()=>{f(1)}})]),C("center",null,[C("small[innerText=Version 0.11.15 by L3P3]")]),w&&k&&C("div",{F:{"menu overlay advanced":!0,
busy:t},onclick:p=>{p.target.className==="menu overlay advanced"&&u(!1)}},[C("div[className=window]",null,[C("h2",{innerText:`"${k.label}"`,title:k.id}),C("table",null,[!!k.account_name&&C("tr",null,[C("td[innerText=Owner:]"),C("td",{innerText:k.account_name})]),C("tr",null,[C("td[innerText=Modified:]"),C("td",{innerText:xb(J(k.local,k.remote),!1)})])]),C("center",null,[C("button[innerText=Rename]",{disabled:t||l||!k.writable,onclick:()=>{const p=rb("World's new label:\n(max. 16 characters)",k.label);
!p||p===k.label||p.length>16||(k.local&&V.ha(k.id,{label:p}),k.remote&&(x(!0),N("/api/minicraft/world",Object.assign({},tb,{body:Ma({what:"meta",world:k.id,label:p})})).then(yb).catch(F=>{pb("Error while editing world: "+F.message)}).then(()=>{x(!1)})))},title:k.writable?l?"The world is already opened!":"Change world name":"No permission!"}),C("button",{disabled:t||l||!k.local&&!k.writable,innerText:k.local?"Delete (local)":"Delete",onclick:()=>{qb('Really delete world "'+k.label+'"?')&&(k.local?
(Nb(k.id),V.Rb(k.id)):(x(!0),N("/api/minicraft/world",{method:"DELETE",headers:{"Content-Type":"application/json"},body:Ma({what:"world",world:k.id})}).then(p=>(yb(p),aa(),n(null),u(!1),Tb(),x(!1),ba())).catch(p=>{pb("Error while deleting world: "+p.message);x(!1)})))},title:l?"The world is already opened!":k.local||k.writable?"Delete world":"No permission!"})]),C("center",null,[C("button",{disabled:t||!k.remote||!k.writable,innerText:`${"Public"}: ${k.public?"Yes":"No"}`,onclick:()=>{x(!0);N("/api/minicraft/world",
Object.assign({},tb,{body:Ma({what:"meta",world:k.id,public:!k.public})})).then(p=>(p=yb(p),aa(),Tb(),x(!1),ba(),p)).catch(p=>{pb("Error while editing world: "+p.message);x(!1)})},title:k.remote?k.writable?k.public?"Unpublish world":"Publish world":"No permission!":"The world is not uploaded!"}),C("button",{disabled:t||!T||l||k.local>0&&k.remote>0||!k.remote&&!a.rank,innerText:k.local?T&&k&&!k.remote?"Upload":"Transfer":"Download",onclick:()=>{k.local?k.remote||V.ha(k.id,{mod_r:1}):V.Qb({id:k.id,
label:k.label,mod_l:1,mod_r:k.remote})},title:T?k.local?k.remote?"The world is present on both sides!":l?"The world is already opened!":a.rank?"Upload world to server":"Not logged in!":"Download world from server":"List is loading!"})])])])]}
function Ld({Z:a,state:b,Qa:c,ib:e}){const [d,g]=ka(2);z(()=>{c.Xb(d===0?b.Ra.find(l=>l.id===b.config.ya).label+" \u2013 minicraft":"minicraft")},[d]);const h=y("div[className=game]");return[(d===2||d===1)&&B(Kd,{state:b,xa:g}),d===1&&B(zd,{U:null,state:b,xa:g}),d===0&&B(Gd,{frame:h,Z:a,state:b,xa:g,Qa:c,ib:e}),d===2&&b.fa&&C("div[style=position:absolute;bottom:0;left:0;color:yellow]",{title:b.fa},[C("span[innerText=Connection error. ]"),C("button[innerText=Retry]",{onclick:()=>{V.o({fa:null})}})])]}
const Md="nwse-resize ns-resize nesw-resize ew-resize move ew-resize nesw-resize ns-resize nwse-resize".split(" ");let Nd=0;
const Od={init:()=>Od.tb({Xa:0,Ea:0,height:0,Z:null,left:0,mode:Nd,title:"...",top:0,width:0},600,400),Ib:a=>Object.assign({},a,{mode:a.mode===0?1:0}),Ub:(a,b)=>a.Z&&a.Z.code===b.code&&a.Z.state===b.state?a:Object.assign({},a,{Z:b}),Mb:(a,b,c)=>Object.assign({},a,{left:J(0,G(b,U.ba-a.width)),top:J(0,G(c,U.la-a.height))}),cb:(a,b)=>Object.assign({},a,b),tb:(a,b,c)=>Object.assign({},a,{Ea:b=J(100,G(b,U.ba-a.left)),Xa:c=J(50,G(c,U.la-a.top)),width:b,height:c}),Xb:(a,b)=>Object.assign({},a,{title:b})},
Pd=(a,b,c)=>{V.Zb(b);const e=c.target;if(e.className==="window borders"&&c.button===0){c.preventDefault();ra.activeElement.blur();var d,g;[d,g]=a;var h=c.clientX,l=c.clientY,f=h-d.left,r=l-d.top,n=f<8?0:f<d.width-8?1:2,q=r<8?0:r<d.height-8?1:2,k=n+q*3;e.style.willChange=k===4?"transform":"contents";V.o({cursor:Md[k]});var w=t=>{Id=!0;aa();let x=t.clientX,p=t.clientY;a:if(k===4){if(t.type==="mouseup"){if(p<4){g.cb({left:0,top:0,width:U.ba,height:U.la});break a}if(x<4){g.cb({left:0,top:0,width:za(U.ba/
2),height:U.la});break a}if(x>U.ba-3){g.cb({left:za(U.ba/2),top:0,width:E(U.ba/2),height:U.la});break a}}else if([t]=a,t.Ea!==t.width||t.Xa!==t.height){g.tb(t.Ea,t.Xa);const [F]=a;f=Aa(f*F.Ea/t.width)}g.Mb(x-f,p-r)}else n!==0&&q!==0||g.Mb(n===0?(x=J(f,G(x,d.left+d.width-100+f)))-f:d.left,q===0?(p=J(r,G(p,d.top+d.height-50+r)))-r:d.top),g.tb(n===0?d.width+d.left+f-x:n===1?d.width:d.width-h+x,q===0?d.height+d.top+r-p:q===1?d.height:d.height-l+p);ba();Id=!1},u=t=>{jb("mousemove",w,!0);jb("mouseup",u);
t.clientX===h&&t.clientY===l||w(t);V.o({cursor:null});e.style.willChange="auto"};ib("mousemove",w,!0);ib("mouseup",u)}},Qd=({height:a,left:b,mode:c,top:e,width:d},g)=>({F:{window:!0,borders:c===1},S:{display:c===2?"none":"block",height:c===0?"100%":a+"px",transform:c===0?"":`translate(${b}px, ${e}px)`,width:c===0?"100%":d+"px"},onmousedown:g}),Rd=({title:a,ib:b})=>[C("div[className=window_title]",{innerText:a}),C("div[className=window_button]",{onclick:()=>V.$b(b)})];
function Sd({I:{id:a,Lb:b,type:c},state:e}){Nd=b;const d=ha(Od),[g,h]=d;z(()=>(Td.set(a,h),()=>Td.delete(a)));b=fa(()=>Pd.bind(null,d,a));y("div",fa(Qd,[g,b]));const l=ia(!0,!1);z((f,r)=>{l&&h.cb({left:J(0,G(g.left,f-g.width)),top:J(0,G(g.top,r-g.height)),width:G(f,J(100,g.Ea,g.width)),height:G(r,J(50,g.Xa,g.height))})},[e.ba,e.la]);return[c===1&&B(Ld,{Z:g.Z,state:e,Qa:h,ib:a}),g.mode!==0&&B(Rd,{title:g.title,ib:a})]}const Hd=new $a,Td=new ab;let Id=!1,Ud=0,Vd=0;
function Wd(){[U,V]=ha(Yb);z(()=>{Sb(!0);let d=!1;onbeforeunload=onunload=onpagehide=onblur=()=>{if(!d){d=!0;for(const g of Hd)Cc(g.world,g.g);V.nb()}};onpageshow=onfocus=()=>{d=!1};onresize=()=>{Id=!0;V.o({la:qa.innerHeight,ba:qa.innerWidth});Id=!1};fb(()=>(V.nb(),!Ja&&M("minicraft.lock",Ka.now())),500);ib("touchend",g=>{Ud=g.timeStamp},!0)});const a=A(d=>{if(d.target.tagName==="INPUT")return!0;Id=!0;V.Wa(!1);if(U.G.length>0){const g=Td.get(U.G[U.G.length-1].id),h=d.type==="keydown";d.key!=="f"?
g.Ub({code:d.keyCode,state:h}):h&&g.Ib()}return Id=!1}),b=A(()=>{V.Wa(!0)}),c=A(d=>{d.timeStamp-Ud>999&&V.Wa(!1)}),e=U.config.ta;z(()=>{e?(ib("mousedown",c,!0),ib("mouseup",c,!0),jb("touchstart",b,!0)):(jb("mousedown",c,!0),jb("mouseup",c,!0),ib("touchstart",b,!0))},[e]);z(Oc,[U.config.O]);z(()=>{gb(Vd);U.fa||(Vd=eb(Xb))},[U.fa,U.Ra]);y("",{onkeydown:a,onkeyup:a,oncontextmenu:wb,ondragstart:wb});return[oa(Sd,U.G,{state:U}),U.cursor&&C("div[className=cursormask]",{S:{cursor:U.cursor}})]}
function Xd(){close();return[C("h1[innerText=minicraft already running!]")]}if(window.SSR)na(Wd);else if(Ja){const a=new Ja("minicraft.lock"),b=eb(()=>Hb.then(()=>na(Wd)),100);a.addEventListener("message",c=>{c.data==="yes"?(gb(b),a.close(),na(Xd)):(a.postMessage("yes"),focus())});a.postMessage("anyone there?")}else{const a=S(L.getItem("minicraft.lock")),b=Ka.now()-1500;a>b?eb(()=>{na(S(L.getItem("minicraft.lock"))===a?Wd:Xd)},a-b):Hb.then(()=>na(Wd))};

//# sourceMappingURL=app-en.js.map
