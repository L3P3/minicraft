const u=lui,v=u.hook_dom,A=u.hook_effect,ca=u.hook_memo,da=u.hook_model,ea=u.hook_rerender,D=u.hook_static,G=u.node,I=u.node_dom,fa=u.node_map,ha=u.now,oa=window,pa=document,J=Math,qa=J.PI,ra=.5*qa,sa=180/qa,K=J.floor,ya=J.ceil,za=J.round,L=J.min,M=J.max,Aa=J.cos,Ba=J.sin,Ca=J.sqrt,Da=String.fromCharCode,Ea=JSON,Fa=Ea.stringify,Ga=Ea.parse,P=localStorage,La=P.setItem.bind(P),Ma=Uint8Array,Na=Uint32Array,Oa=Map,Pa=Number,Qa=setTimeout,Ra=setInterval,Sa=clearTimeout,Ta=clearInterval,Q=a=>a*a,Ua=()=>
!1,Va=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813],Wa=Va.length,Xa="WEBTSN".split(""),Ya=a=>{a+=32;33<a&&39>a?a++:38<a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Da(a)},Za=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),ab=()=>{var a=$a;const c=a.length,e=new Oa,b=r=>{t=t<<1|r&1;15===++n&&
(k+=Ya(t),t=n=0)},d=()=>{for(let r=0;r<m;++r)b(0)},h=r=>{b(r);b(r>>1);b(r>>2);b(r>>3);b(r>>4);b(r>>5);b(r>>6);b(r>>7)},l=()=>{0===--w&&(w=1<<m++)},f=()=>{if(y)y=!1;else{let r=q.id;for(let B=0;B<m;B++)b(r>>B)}};let g=a[0],k="",t=0,n=2,m=2,w=2,x=2,q={id:x++,ta:new Oa},y=!0;h(g);e.set(g,q);for(let r=1;r<c;++r){const B=q.ta.get(g=a[r]);B?q=B:(f(),e.has(g)||(l(),d(),h(g),e.set(g,{id:x++,ta:new Oa}),y=!0),q.ta.set(g,{id:x++,ta:new Oa}),q=e.get(g),l())}f();e.has(g)||(l(),d(),h(g));l();b(1);--m;d();return k+=
Ya(t<<15-n)},bb=a=>{var c=$a;if(!a)return null;const e=a.length,b=()=>{n+=(x>>--q&1)<<m++;0===q&&(q=15,x=Za(a.charCodeAt(w++)))};let d=[0,1],h=1,l=3,f=2,g=null;var k=null;let t=0,n=0;k=2;let m=0,w=0,x=Za(a.charCodeAt(w++)),q=15;for(;m<k;)b();if(1===n)return null;for(n=m=0;8>m;)b();g=[n];d[2]=g;for(c[t++]=n;w<=e;){k=f;for(n=m=0;m<k;)b();if(0===n){for(n=m=0;8>m;)b();d[l]=[n];n=l++;0===--h&&(h=1<<f++)}else if(1===n)return c;k=n<d.length?d[n]:g.concat(g[0]);for(let y=0;y<k.length;y++)c[t++]=k[y];d[l++]=
g.concat(k[0]);g=k;0===--h&&(h=1<<f++)}return null},S=new Na(1024),$a=new Ma(S.buffer),cb=new Oa,db=(a,c,e,b)=>0>e||63<e?0:a.aa[(c<<a.G+4|b)<<6|e],eb=(a,c,e,b,d)=>{const h=a.G;a.aa[(c<<h+4|b)<<6|e]=d;a.O[(c>>4<<h|b>>4)<<2|e>>4].ba=!0},hb=(a,c,e)=>{const b=M(L(c.v,63),0)>>4,d=K(c.u)>>4;c=K(c.A)>>4;if(e||a.xa!==b||a.ja+a.wa!==d||a.ka+a.ya!==c)e=1<<a.G,a.xa=b,a.ja=d-(a.wa=(65536+d)%e),a.ka=c-(a.ya=(65536+c)%e),fb(a);gb(a)},fb=a=>{const c=a.wa,e=a.xa,b=a.ya,d=a.G,h=`${d} ${c} ${b} ${e}`;let l=cb.get(h);
if(null==l){const f=1<<d,g=Q(.5*f);cb.set(h,l=a.O.map(({x:k,y:t,z:n},m)=>{let w=Q(k-c),x=Q(n-b),q=Q(k-c-f),y=0,r=0;q<w&&(w=q,y=-f);(q=Q(k-c+f))<w&&(w=q,y=f);(q=Q(n-b-f))<x&&(x=q,r=-f);(q=Q(n-b+f))<x&&(x=q,r=f);return{Ha:w+x+Q(t-e),Qa:m,ja:y,ka:r}}).filter(({Ha:k})=>k<=g).sort((k,t)=>k.Ha-t.Ha))}a.ua=l;a.ga=0},jb=(a,c)=>{for(const e of a.O)e.ba&&ib(a,e);La(`minicraft.world.${a.id}:meta`,Fa({p:{cb:c.Wa,eb:c.B.map(e=>e&&[e.id,e.amount,e.data]),fb:c.H,p:[c.u,c.v,c.A,c.J,c.Y]},hb:[a.la,a.ma,a.na],ib:1}))},
kb=(a,c)=>{const e=P.getItem(`minicraft.world.${a.id}:meta`);if(e){const {p:b,hb:d}=Ga(e);c.Wa=b.cb;c.B=b.eb.map(h=>h&&{id:h[0],amount:h[1],data:h[2]});c.H=b.fb;c.u=b.p[0];c.v=b.p[1];c.A=b.p[2];c.J=b.p[3];c.Y=b.p[4];a.la=d[0];a.ma=d[1];a.na=d[2]}},lb=(a,c,e,b)=>`minicraft.world.${a.id}:${c}/${e}`+(0<b?"/"+b:""),ib=(a,c)=>{const e=a.sa;var b=a.G;const d=c.y,h=(256<<b)-256;for(let l=0,f=-1,g=((c.x<<b+4|c.z)<<6|d)<<2;16>l;++l){for(b=0;16>b;++b)S[++f]=e[g],S[++f]=e[++g],S[++f]=e[++g],S[++f]=e[++g],g+=
13;g+=h}La(lb(a,c.qa,c.Ca,d),ab());c.ba=!1},gb=a=>{var c=a.O,e=a.ua,b=a.ja;const d=a.ka,h=e.length;for(;a.ga<h;){var l=e[a.ga++];const m=c[l.Qa];var f=m.loaded,g=m.x,k=m.y,t=m.z;const w=b+l.ja+g;l=d+l.ka+t;if(!f||w!==m.qa||l!==m.Ca){m.ba&&ib(a,m);m.loaded=!0;var n=bb(P.getItem(lb(a,m.qa=w,m.Ca=l,k)));if(f||0===k||n){c=a.sa;b=a.G;e=(256<<b)-256;g=((g<<b+4|t)<<6|k)<<2;if(n)for(let x=0,q=-1;16>x;++x){for(f=0;16>f;++f)c[g]=S[++q],c[++g]=S[++q],c[++g]=S[++q],c[++g]=S[++q],g+=13;g+=e}else for(t=0;16>t;++t){for(n=
0;16>n;++n)c[g]=0<k?0:50397446,c[++g]=0<k?0:131843,f?(c[++g]=0,c[++g]=0,g+=13):g+=15;g+=e}if(0===(w|l|k)){for(k=1;k<Wa;++k)eb(a,k%9,7,K(k/9),k);m.ba=!1}break}}}};let T=null,mb=null,nb=new Image;nb.crossOrigin="anonymous";nb.onload=()=>{var a=pa.createElement("canvas");a.width=256;a.height=26;a=a.getContext("2d");a.drawImage(nb,0,0);T=new Na(a.getImageData(0,0,256,26).data.buffer);mb&&mb();nb=mb=null};nb.src=ASSETS+"blocks.png";
const Ab=(a,c)=>{const e={Oa:c,Fa:c.getContext("2d",{alpha:!1,desynchronized:!0}),Pa:null,Ta:"",M:!1,Ua:0,Ia:0,bb:Ra(()=>(e.Ua=e.Ia,e.Ia=0),1E3),l:a};null===T&&(mb=()=>e.M=!0);zb(e);return e},zb=a=>{(a.Pa=a.Fa.createImageData(a.Oa.width=a.l.Aa,a.Oa.height=a.l.Ba)).data.fill(255);a.Fa.fillStyle="rgba(255,255,255,.5)"},Bb=Array(16).fill(0),Cb=({id:a})=>(v("div[className=bitmap]"),--a,Bb.map((c,e)=>I("div",null,Bb.map((b,d)=>{b=T[a<<8|15-e<<4|d];return I("div",{style:0<b>>>24?`background-color:rgb(${b&
255},${b>>>8&255},${b>>>16&255})`:""})}))));function Db({amount:a,id:c}){v("div[className=stack]");return[G(Cb,{id:c}),1<a&&I("div[className=amount]",{innerText:a})]}function Eb({g:a,oa:c}){v("div[className=bar]",{ontouchstart:D(e=>{a.m=Number(e.target.closest("[data-slot]").dataset.slot);a.da=e.timeStamp}),S:{opacity:M(.5,L(1,1-5E-4*(c-a.da-5E3)))}});return T&&a.B.map((e,b)=>I("div",{D:{slot:b},F:{active:b===a.m}},[null!==e&&G(Db,{id:e.id,amount:e.amount,data:e.data})]))}
const Fb=({I:{Xa:a,time:c,value:e},oa:b})=>(v(a?"div[className=minor]":"div",{innerText:e,S:{opacity:L(1,1-.001*(b-c-4500))}}),null);function Gb({L:a,oa:c}){v("div[className=messages]");const e=c-5E3;return[fa(Fb,a.slice(-10).filter(b=>b.time>e),{oa:c})]}
const Hb=(a,c,e)=>{a.J=(a.J+c+100*qa)%(2*qa);a.Y=M(-ra,L(ra,a.Y+e))},Ib=({B:a},c)=>{for(var e of a)if(null!==e&&e.id===c.id){const b=L(e.amount+c.amount,64);c.amount-=b-e.amount;e.amount=b;if(0===c.amount)return null}for(e=0;9>e;++e)if(null===a[e])return a[e]=c,null;return c},Jb=(a,c=1)=>({amount:c,data:null,id:a});let Kb=0;
const Lb=()=>{const a={aa:null,sa:null,O:null,ua:null,ga:0,wa:0,xa:0,ya:0,id:0,ja:0,ka:0,G:0,la:.5,ma:8.5,na:.5};var c={Da:0,Na:0,Ea:0,J:0,Y:0,ra:0,Z:0,N:-1,$:0,ea:null,fa:null,H:1,Wa:20,B:Array(9).fill(null),za:0,name:"Gast",u:a.la,v:a.ma,A:a.na,Ya:0,Za:0,m:0,da:0,U:0,V:0,W:0};kb(a,c);return{actions:null,o:null,va:!1,i:!0,ha:!1,Va:null,P:0,K:new Set,Ja:"",j:0,L:[],g:c,s:null,Ka:1,La:1,Aa:0,Ba:0,$a:null,time:0,Ma:0,h:a}},Mb=(a,c)=>{a.s=Ab(a,c);a.$a=Ra(()=>{a.i||(a.time=(a.time+1)%24E3,a.Ma=1/24E3*
(a.time+6E3)%1,hb(a.h,a.g,!1))},50)},Nb=(a,c)=>a===c?0:.1-.2*a,Ob=a=>{a.g.Da=Nb((a=a.K).has(-12)||a.has(65),a.has(-13)||a.has(68))},Pb=a=>{a.g.Na=Nb((a=a.K).has(-15)||a.has(16),a.has(-14)||a.has(32))},Qb=a=>{a.g.Ea=Nb((a=a.K).has(-11)||a.has(83),a.has(-10)||a.has(87))},Rb=a=>{a.g.Ya=Nb(a.K.has(-18),a.K.has(-19))},Sb=a=>{a.g.Za=Nb(a.K.has(-17),a.K.has(-16))},X=(a,c,e)=>{const b=a.K,d=a.g;if(e){if(b.has(c))return!1;b.add(c);var h=d.Z,l=d.N;e=d.$;switch(c){case -18:case -19:Rb(a);break;case -17:case -16:Sb(a);
break;case -1:2!==d.H&&0<=l&&(0===d.za?0===d.H&&(c=db(a.h,h,l,e),2===c?c=3:1===c&&(c=4),6===c||8!==c&&13!==c&&null!==Ib(d,Jb(c,1)))||eb(a.h,h,l,e,0):Tb(a,[h,l,e],!1));break;case -2:case 71:if(0<=l){const f=db(a.h,h,l,e);e=d.B.slice(0,9);l=e.findIndex(g=>null!==g&&g.id===f);0<=l?d.m=l:1===d.H&&(null!==e[d.m]&&(e=e.indexOf(null),0<=e&&(d.m=e)),d.B[d.m]=Jb(f));d.da=a.P}break;case -3:if(2!==d.H&&0<=l)if(0===d.za){if(c=d.B[d.m],null!==c){switch(d.ra){case 0:--h;break;case 1:++h;break;case 2:--l;break;
case 3:++l;break;case 4:--e;break;default:++e}0<=l&&64>l&&(eb(a.h,h&(1<<4+a.h.G)-1,l,e&(1<<4+a.h.G)-1,c.id),1!==d.H&&0>=--c.amount&&(d.B[d.m]=null))}}else Tb(a,[h,l,e],!0);break;case -4:d.m=(d.m+9-1)%9;d.da=a.P;break;case -5:d.m=(d.m+1)%9;d.da=a.P;break;case 27:a.j?(a.i=!1,a.j=0):(a.i=!0,a.j=1);break;case -15:case -14:case 16:case 32:Pb(a);break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:d.m=c-49;d.da=a.P;break;case -12:case -13:case 65:case 68:Ob(a);break;case 80:a.i=
!a.i;break;case 81:if(b.has(17)||null!==d.B[d.m]&&0>=--d.B[d.m].amount)d.B[d.m]=null;break;case -11:case -10:case 83:case 87:Qb(a);break;case 84:if(!a.j){a.j=2;for(const f of b)X(a,f,!1)}break;case 114:a.va=!a.va;break;default:return!1}}else{if(!b.delete(c))return!1;switch(c){case -15:case -14:case 16:case 32:Pb(a);break;case -12:case -13:case 65:case 68:Ob(a);break;case -11:case -10:case 83:case 87:Qb(a);break;case -18:case -19:Rb(a);break;case -17:case -16:Sb(a)}}a.Ja=[...b].join();return!0},Ub=
(a,c)=>(c=c.startsWith("~")?a+Pa(c.substr(1)):Pa(c),isNaN(c)?a:c),Y=(a,c,e=!1)=>{(a.L=a.L.slice(-49)).push({id:++Kb,Xa:e,time:ha(),value:c})},Tb=(a,c,e)=>{e?a.g.fa=c:a.g.ea=c;Y(a,`${e?"second":"first"} position: ${c.join(" ")}`,!0)};
function Vb({actions:{ab:a,Ga:c,Sa:e},o:b,l:d}){A(()=>{jb(d.h,d.g);return c});A(()=>{const h=Qa(c,1E3);return()=>Sa(h)},[b]);v("div[className=menu]");return[I("h1[innerText=Men\u00fc]"),I("div[className=settings]",null,[I("button",{innerText:"Oberfl\u00e4chen: "+(b.ca?"Texturiert":"Einfarbig"),onclick:D(()=>a(h=>({ca:!h.ca})))}),I("label[innerText=Aufl\u00f6sung:]",null,[I("input[type=range][min=1][max=100][step=1]",{value:101-b.T,onchange:D(h=>e({T:101-Number(h.target.value)}))})]),I("label[innerText=Blickwinkel:]",
null,[I("input[type=range][min=1][max=180][step=1]",{value:b.pa,onchange:D(h=>e({pa:Number(h.target.value)}))})]),I("label[innerText=Sichtweite:]",null,[I("input[type=range][min=1][max=128][step=1]",{value:b.X,onchange:D(h=>e({X:Number(h.target.value)}))})]),I("label[innerText=Mausempfindlichkeit:]",null,[I("input[type=range][min=1][max=15][step=1]",{value:b.ia,onchange:D(h=>e({ia:Number(h.target.value)}))})])]),I("center",null,[I("button[innerText=Zur\u00fcck]",{onclick:D(h=>(d.j=0,"mouse"===h.pointerType?
d.Va.requestPointerLock():d.i=!1))})])]}const Wb=({I:{Xa:a,value:c}})=>(v(a?"div[className=minor]":"div",{innerText:c}),null);
function Xb({l:a,L:c}){v("div[className=menu terminal]");const e=D({history:null});A(b=>{b&&Qa(()=>e.history.scrollTop=1E9,0)},[c.length&&c[c.length-1].id]);return[I("div[className=history]",{R:D(b=>{e.history=b})},[fa(Wb,c)]),I("input[enterkeyhint=send][mozactionhint=send][name=message][required]",D({onkeydown:b=>{var d=b.keyCode;b=b.target;if(13===d){var h=b.value;d=a.g;if(h)if("/"===h.charAt(0)){h=h.substr(1).split(" ");var l=h.shift();switch(l){case "clear":a.L=[];break;case "clearinv":d.B.fill(null);
Y(a,"inventory cleared",!0);break;case "exit":a.i=!1;a.j=0;break;case "gamemode":case "gm":h=Pa(h[0]);!isNaN(h)&&0<=h&&3>h&&0===h%1?(d.H=h,Y(a,`gamemode set to ${h}`,!0)):Y(a,"gamemode must be in 0..2");break;case "give":l=Pa(h[0]);h=Pa(h[1]||1);!isNaN(l)&&0<l&&25>l&&0===l%1?!isNaN(h)&&0<h&&65>h&&0===h%1?Y(a,Ib(d,Jb(l,h))?"inventory full":"items given",!0):Y(a,"amount must be in 1..64"):Y(a,"invalid block type");break;case "help":Y(a,"commands: clear, clearinv, exit, gamemode, give, help, me, save, spawn, teleport, version");
break;case "me":Y(a,d.name+" "+h.join(" "),!0);break;case "save":jb(a.h,a.g);a.actions.Ga();Y(a,"world+config saved",!0);break;case "smart":d.name="LFF5644";Y(a,"lff.smart: true",!0);break;case "spawn":a.h.la=d.u;a.h.ma=d.v;a.h.na=d.A;Y(a,"spawn updated",!0);break;case "teleport":case "tp":0===h.length?(d.u=a.h.la,d.v=a.h.ma,d.A=a.h.na,a.s.M=!0,Y(a,"teleported to spawn",!0)):3===h.length?(Y(a,`teleported to ${d.u=Ub(d.u,h[0])} ${d.v=Ub(d.v,h[1])} ${d.A=Ub(d.A,h[2])}`,!0),a.s.M=!0):Y(a,"PITCH");d.U=
0;d.V=0;d.W=0;break;case "version":Y(a,"Minicraft 0.5.15");break;case "/exit":d.za=0;Y(a,"normal mouse mode",!0);break;case "/expand":a.g.ea&&a.g.fa?l=!0:(Y(a,"selection required"),l=!1);l&&("vert"===h[0]?(d.ea[1]=0,d.fa[1]=63,Y(a,"selection expanded",!0)):Y(a,"only vert supported"));break;case "/pos1":case "/pos2":Tb(a,[K(d.u),K(d.v),K(d.A)],"/pos2"===l);break;case "/regen":d=a.h;h=d.O[d.ua[d.ga=0].Qa];P.removeItem(lb(d,h.qa,h.Ca,h.y));h.ba=!1;++h.qa;gb(d);Y(a,"regenerate chunk",!0);a.s.M=!0;break;
case "/show":Y(a,`first: ${d.ea?d.ea.join(" "):"none"}, second: ${d.fa?d.fa.join(" "):"none"}`);break;case "/wand":d.za=1;Y(a,"primary+secondary button for selection",!0);break;default:Y(a,"unknown command: "+l)}}else Y(a,`<${d.name}> `+h);b.value=""}else 27===d&&(a.i=!1,a.j=0)},R:b=>Qa(()=>b.focus(),0)}))]}
const Yb=[["pick",-2],["up",-14],["down",-15],["T",84],["F3",114],["...",27]],Zb=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]],$b=[["up",-16],["down",-17],["left",-18],["right",-19],["center",-3]];
function ac({l:a}){const c=a.K,e=([b,d])=>I("div",{D:{code:d},F:{button:!0,[b]:!0,active:c.has(d)}});v("div[className=touch]",D({ontouchstart:b=>{b.preventDefault();const d=Number(b.target.dataset.code);if(null!=d&&X(a,d,!0)){const h=b.changedTouches[0].identifier,l=f=>{f.changedTouches[0].identifier===h&&(removeEventListener("touchend",l),X(a,d,!1))};addEventListener("touchend",l)}}}));return[I("div[className=top]",null,Yb.map(([b,d])=>I(`div[innerText=${b}]`,{D:{code:d},F:{button:!0,active:c.has(d)}}))),
I("div[className=move]",null,Zb.map(e)),I("div[className=move sec]",null,$b.map(e))]}
function bc({actions:a,o:c,gb:e}){const b=ca(Lb),d=ha(),h=v("div[className=game]",ca(()=>{const f=g=>0!==b.j||(b.ha=!1,pa.pointerLockElement===h?b.i||X(b,-1-g.button,"mousedown"===g.type):b.Va.requestPointerLock(),g.preventDefault(),!1);return{onmousedown:f,onmousemove:g=>{if(!b.i&&!b.j){const k=b.o.ia*qa/M(b.Ka,b.La);Hb(b.g,g.movementX*k,-g.movementY*k)}},onmouseup:f,ontouchstart:g=>{b.ha=!0;b.j||(b.i=!1,g.preventDefault())},onwheel:g=>{b.ha=!1;if(!b.j&&!b.i&&5<Math.abs(g.deltaY)){const k=0<g.deltaY?
-5:-4;X(b,k,!0);X(b,k,!1);g.preventDefault()}}}})),l=pa.pointerLockElement===h;A(()=>(b.actions=a,b.Va=h,e.l=b,()=>{Ta(b.$a);Ta(b.s.bb);return e.l=null}));A(()=>{b.o=c;b.s&&(b.s.M=!0);const f=b.g,g=b.h;var k=b.o.X;k=17>k?2:49>k?3:113>k?4:241>k?5:497>k?6:1009>k?7:2033>k?8:4081>k?9:8177>k?10:16369>k?11:32753>k?12:13;if(g.G!==k){g.O&&jb(g,f);const t=1<<(g.G=k),n=g.O=[];for(let m=0;m<t;++m)for(let w=0;w<t;++w)for(let x=0;4>x;++x)n.push({ba:!1,loaded:!1,x:m,y:x,z:w,qa:0,Ca:0});k=t<<k+12+2;null===g.aa||
g.aa.length<k?g.sa=new Na((g.aa=new Ma(k)).buffer):g.sa.fill(0);hb(g,f,!0)}},[c]);A((f,g,k)=>{b.Ka=M(1,f*k);b.La=M(1,g*k);g=b.o.T;f=M(1,za(b.Ka/g));g=M(1,za(b.La/g));if(f!==b.Aa||g!==b.Ba)b.Aa=f,b.Ba=g,b.s&&(b.s.M=!0,zb(b.s))},[h.offsetWidth,h.offsetHeight,oa.devicePixelRatio||1,c.T]);A(()=>{l||b.i||b.j||(b.j=1);b.i=!l},[l]);A(f=>l&&f&&pa.exitPointerLock(),[b.i||b.j]);A(()=>{if(b.P&&!b.i){var f=b.g,g=L(5,.01*(d-b.P));f.U-=.1*f.U*g;f.V-=.1*f.V*g;f.W-=.1*f.W*g;f.U+=(Aa(f.J)*f.Da+Ba(f.J)*f.Ea)*g;f.V+=
f.Na*g;f.W+=(-Ba(f.J)*f.Da+Aa(f.J)*f.Ea)*g;Hb(f,f.Ya*g,f.Za*g);f.u+=f.U*g;f.v+=f.V*g;f.A+=f.W*g}if(b.s){f=b.s;++f.Ia;g=f.Fa;var k=f.Pa;const H=f.l,ia=H.o,p=H.g,N=H.Aa,R=H.Ba,O=H.h;if(!H.i||f.M){f.M=!1;const Z=k.data,dc=ia.X;var t=p.J,n=p.Y;const ec=p.Z,fc=p.N,gc=p.$;var m=p.u,w=p.v,x=p.A;const hc=O.aa;var q=O.G;const ic=ia.ca&&null!==T;var y=1/N,r=1/R;const aa=N>>1,ba=R>>1,ob=L(N,R),pb=32<ob,qb=Aa(t);t=Ba(t);const rb=Aa(-n);n=Ba(-n);var B=ia.pa/45;const jc=y*(N<R?B*N*r:B);y=r*(R<N?B*R*y:B);m+=65536;
w+=65536;x+=65536;r=m%1;B=w%1;const kc=x%1;q=4+q;const sb=(1<<q)-1;let tb=1===p.H?6:4,U=p.Z=p.$=p.ra=0;p.N=-1;for(let ta=0;ta<R;++ta){var ua=(ba-ta)*y;const ub=ua*rb-n;var Ha=ua*n+rb;ua=Ha*t;Ha*=qb;for(let va=0;va<N;++va){var ja=(va-aa)*jc;const vb=ua+qb*ja;ja=Ha-t*ja;let ka=16757124,wa=1,wb=dc;for(let z=0;3>z;++z){let E=ja;0===z&&(E=vb);1===z&&(E=ub);var V=1/(0>E?-E:E);const xa=vb*V,W=ub*V;V*=ja;const xb=Ca(xa*xa+W*W+V*V);var C=kc;0===z&&(C=r);1===z&&(C=B);0<E&&(C=1-C);let la=m+xa*C-(0===z&0>E|0),
ma=w+W*C-(1===z&0>E|0),na=x+V*C-(2===z&0>E|0);C*=xb;for(let Ia,Ja,Ka,F;C<wb;la+=xa,ma+=W,na+=V,C+=xb)if(65536>ma){if(0>W)break}else if(65600<=ma){if(0<W)break}else if(0!==(F=hc[((Ia=la&sb)<<q|(Ka=na&sb))<<6|(Ja=ma&63)])){ta===ba&&va===aa&&C<=tb&&(p.Z=Ia,p.N=Ja,p.$=Ka,p.ra=0>E|z<<1,tb=C);if(ic){--F;1===z?6===F?F=25:13===F?F=4:1===F&&0<W&&(F=2):1===F&&(F=24);const yb=T[F<<8|(16*(1===z?na:ma)&15)<<4|16*(1===z?la:(0<E?la-na:na-la)+65536)&15];if(0===yb>>>24)continue;ka=yb&16777215}else ka=Va[F];wb=C;wa=
(0===z?.8:2===z?.6:0<E?.4:1)+(Ja!==fc||Ia!==ec||Ka!==gc?0:.2);break}}Z[U]=(ka&255)*wa;Z[++U]=(ka>>8&255)*wa;Z[++U]=(ka>>16)*wa;U+=2}}pb||(Z[U=N*ba+aa<<2]+=128,Z[++U]+=128,Z[++U]+=128);g.putImageData(k,0,0);pb&&(k=ya(.05*ob),g.fillRect(aa-k,ba-1,k<<1,2),g.fillRect(aa-1,ba-k,2,k-1),g.fillRect(aa-1,ba+1,2,k-1))}f.Ta=H.va?"Minicraft 0.5.15 "+K(f.Ua).toString().padStart(2,"\u00a0")+" fps, T: "+K(24*H.Ma).toString().padStart(2,"0")+":"+K(24*H.Ma%1*60).toString().padStart(2,"0")+"; "+(H.i&&500>d%1E3?"":
H.time)+"\nR: "+N+"x"+R+" (x"+ia.T+"), D: "+ia.X+", C: "+O.ga+"/"+O.ua.length+", M: "+(64*Q(1<<4+O.G)>>10)+"k\nE: 0/0 M: "+p.H+"\n\nPosition: "+p.u.toFixed(2)+" "+p.v.toFixed(2)+" "+p.A.toFixed(2)+"\nAngle: "+(p.J*sa).toFixed(2)+" "+(p.Y*sa).toFixed(2)+"\nBlock: "+(0>p.N?0:p.Z+" "+p.N+" "+p.$+" "+Xa[p.ra]+": "+db(O,p.Z,p.N,p.$))+"\nChunk abs: "+(K(p.u)>>4)+" "+(K(p.A)>>4)+" "+(K(p.v)>>4)+" rel: "+O.wa+" "+O.ya+" "+O.xa:""}b.P=d},[d]);ea();return[I("canvas",{R:D(f=>Mb(b,f))}),2!==b.j&&G(Gb,{L:b.L,
oa:d}),b.s&&b.va&&I("div[className=diagnostics]",{innerText:b.s.Ta}),b.ha&&G(ac,{l:b,Ja:b.Ja}),2!==b.g.H&&G(Eb,{g:b.g,oa:d}),1===b.j&&G(Vb,{actions:a,o:c,l:b}),2===b.j&&G(Xb,{l:b,L:b.L})]}
const cc={init:()=>{const a={ca:!0,ia:3,T:10,pa:80,X:64};var c=P.getItem("minicraft.config");if(c){c=Ga(c);let e=c.flag_textures;null!=e&&(a.ca=e);null!=(e=c.mouse_sensitivity)&&(a.ia=e);a.T=c.resolution_scaling;a.pa=c.view_angle;a.X=c.view_distance}return{o:a,Ra:a}},Ga:a=>{const c=a.o;if(c===a.Ra)return a;La("minicraft.config",Fa({version:"0.5.15",flag_textures:c.ca,mouse_sensitivity:c.ia,resolution_scaling:c.T,view_angle:c.pa,view_distance:c.X}));return Object.assign({},a,{Ra:c})},ab:(a,c)=>cc.Sa(a,
c(a.o)),Sa:(a,c)=>Object.assign({},a,{o:Object.assign({},a.o,c)})};u.init(()=>{const [a,c]=da(cc),e=D({l:null});A(()=>{let d=!1;onbeforeunload=onunload=()=>{if(!d&&(d=!0,c.Ga(),e.l)){var h=e.l;jb(h.h,h.g)}}});const b=D(d=>"INPUT"===d.target.tagName||!e.l||(d.preventDefault(),X(e.l,d.keyCode,"keydown"===d.type),e.l.ha=!1));return[{onkeydown:b,onkeyup:b,oncontextmenu:Ua,ondragstart:Ua},[G(bc,{actions:c,o:a.o,gb:e})]]});
