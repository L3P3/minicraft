const t=lui,aa=t.hook_callback,A=t.hook_dom,B=t.hook_effect,ba=t.hook_memo,ca=t.hook_reducer,ha=t.hook_rerender,G=t.hook_static,ia=t.node,I=t.node_dom,ja=t.node_map,ka=t.now,la=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813],ra=la.length,sa="WEBTSN".split(""),ta=[6,1,1,3,3,3,2],ua=ta.length,va=window,wa=document,J=Math,P=J.PI,xa=.5*P,ya=180/P,W=J.floor,
Da=J.ceil,Ea=J.round,Fa=J.min,X=J.max,Ga=J.cos,Ha=J.sin,Ia=J.sqrt,Ja=String.fromCharCode,Ka=JSON,Y=localStorage,La=Uint8Array,Ma=Uint32Array,Z=Map,Na=setTimeout,Oa=setInterval,Pa=clearInterval,Qa=()=>!1,Ra=[()=>{const a={N:!0,Z:3,L:10,ca:80,M:64};var c=Y.getItem("minicraft.config");if(c){c=Ka.parse(c);let e=c.flag_textures;null!=e&&(a.N=e);null!=(e=c.mouse_sensitivity)&&(a.Z=e);a.L=c.resolution_scaling;a.ca=c.view_angle;a.M=c.view_distance}return{m:a}},a=>{const c=a.m;Y.setItem("minicraft.config",
Ka.stringify({version:"0.4.12",flag_textures:c.N,mouse_sensitivity:c.Z,resolution_scaling:c.L,view_angle:c.ca,view_distance:c.M}));return a},(a,c)=>Object.assign({},a,{m:Object.assign({},a.m,c)})],Sa=a=>{a+=32;33<a&&39>a?a++:38<a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Ja(a)},Ta=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),Va=()=>{var a=Ua;const c=a.length,e=new Z,b=r=>{n=n<<1|r&1;15===++l&&(k+=Sa(n),n=l=0)},g=()=>{for(let r=0;r<q;++r)b(0)},
m=r=>{b(r);b(r>>1);b(r>>2);b(r>>3);b(r>>4);b(r>>5);b(r>>6);b(r>>7)},h=()=>{0===--u&&(u=1<<q++)},d=()=>{if(C)C=!1;else{let r=w.id;for(let F=0;F<q;F++)b(r>>F)}};let f=a[0],k="",n=0,l=2,q=2,u=2,x=2,w={id:x++,fa:new Z},C=!0;m(f);e.set(f,w);for(let r=1;r<c;++r){const F=w.fa.get(f=a[r]);F?w=F:(d(),e.has(f)||(h(),g(),m(f),e.set(f,{id:x++,fa:new Z}),C=!0),w.fa.set(f,{id:x++,fa:new Z}),w=e.get(f),h())}d();e.has(f)||(h(),g(),m(f));h();b(1);--q;g();return k+=Sa(n<<15-l)},Wa=a=>{var c=Ua;if(!a)return null;const e=
a.length,b=()=>{l+=(x>>--w&1)<<q++;0===w&&(w=15,x=Ta(a.charCodeAt(u++)))};let g=[0,1],m=1,h=3,d=2,f=null;var k=null;let n=0,l=0;k=2;let q=0,u=0,x=Ta(a.charCodeAt(u++)),w=15;for(;q<k;)b();if(1===l)return null;for(l=q=0;8>q;)b();f=[l];g[2]=f;for(c[n++]=l;u<=e;){k=d;for(l=q=0;q<k;)b();if(0===l){for(l=q=0;8>q;)b();g[h]=[l];l=h++;0===--m&&(m=1<<d++)}else if(1===l)return c;k=l<g.length?g[l]:f.concat(f[0]);for(let C=0;C<k.length;C++)c[n++]=k[C];g[h++]=f.concat(k[0]);f=k;0===--m&&(m=1<<d++)}return null},
Xa=new Ma(4);for(let a=0;a<ua;++a)Xa[a>>2]|=ta[a]<<(a<<3);
const Ya=new Ma(1024),Ua=new La(Ya.buffer),Za=new Z,kb=(a,c,e,b,g)=>{const m=a.G[c>>4<<a.l|b>>4];a.V[(c<<a.l+4|b)<<4|e]=g;m.H=!0},nb=(a,c,e)=>{const b=W(c.J)>>4;c=W(c.K)>>4;if(e||a.$+a.ra!==b||a.aa+a.sa!==c)e=1<<a.l,a.$=b-(a.ra=(65536+b)%e),a.aa=c-(a.sa=(65536+c)%e),lb(a);mb(a)},lb=a=>{const c=a.ra,e=a.sa,b=a.l,g=`${b} ${c} ${e}`;let m=Za.get(g);if(null==m){const h=1<<b;Za.set(g,m=a.G.map(({x:d,z:f},k)=>{var n=d-c;n*=n;var l=f-e;l*=l;var q=d-c-h;let u=q*q,x=q=0;u<n&&(n=u,q=-h);d=d-c+h;(u=d*d)<n&&
(n=u,q=h);d=f-e-h;(u=d*d)<l&&(l=u,x=-h);f=f-e+h;(u=f*f)<l&&(l=u,x=h);return{Fa:n+l,Da:k,$:q,aa:x}}).sort((d,f)=>d.Fa-f.Fa))}a.ga=m;a.W=0},ob=(a,c)=>`minicraft.world.${a.id}:${c.za}/${c.Aa}`,pb=(a,c)=>{const e=a.na,b=c.x<<4,g=c.z<<4;for(let m=0,h=0;16>m;++m){const d=(b+m<<a.l+4|g)<<2;Ya.set(e.subarray(d,d+64),h);h+=64}Y.setItem(ob(a,c),Va());c.H=!1},mb=a=>{var c=a.G,e=a.ga,b=a.$,g=a.aa;const m=e.length;for(;a.W<m;){var h=e[a.W++];const k=c[h.Da];var d=k.x,f=k.z;const n=b+h.$+d;h=g+h.aa+f;if(!k.loaded||
n!==k.za||h!==k.Aa){k.H&&pb(a,k);k.za=n;k.Aa=h;k.loaded=!0;e=Wa(Y.getItem(ob(a,k)));c=a.na;d<<=4;f<<=4;if(e)for(let l=0,q=0;16>l;++l)c.set(Ya.subarray(q,q+=64),(d+l<<a.l+4|f)<<2);else for(e=0;16>e;++e)for(b=(d+e<<a.l+4|f)<<2,g=0;16>g;++g)c.set(Xa,b),b+=4;if(0===(k.x|k.z)){for(f=1;f<ra;++f)kb(a,f%9,ua,W(f/9),f);k.H=!1}break}}};let qb=null,rb=new Image;rb.crossOrigin="anonymous";
rb.onload=()=>{var a=wa.createElement("canvas");a.width=256;a.height=26;a=a.getContext("2d");a.drawImage(rb,0,0);rb=null;qb=new Ma(a.getImageData(0,0,256,26).data.buffer)};rb.src=ASSETS+"blocks.png";
const tb=(a,c)=>{const e={pa:c,oa:null,Ca:null,Ea:"",X:!1,Ga:0,ta:0,Na:Oa(()=>(e.Ga=e.ta,e.ta=0),1E3),i:a};sb(e);return e},sb=a=>{var c=a.pa.width=a.i.ja,e=a.pa.height=a.i.ka;c=(a.Ca=(a.oa=a.pa.getContext("2d")).createImageData(c,e)).data;a.oa.fillStyle="rgba(255,255,255,.5)";a=c.length;for(e=3;e<a;e+=4)c[e]=255};let ub=0;
const vb=()=>{const a={V:null,na:null,G:null,ga:null,W:0,ra:0,sa:0,id:0,$:0,aa:0,l:0,Ja:.5,Ka:ua+1.5,La:.5};return{m:null,ha:!1,h:!0,ia:!1,Ha:null,ua:0,Y:new Set,va:"",j:0,O:[],g:{la:0,Ba:0,ma:0,v:0,da:0,ea:0,A:0,s:-1,B:0,Ia:9,J:a.Ja,ba:a.Ka,K:a.La,P:0,T:0,U:0},u:null,wa:1,xa:1,ja:0,ka:0,Ma:null,time:0,ya:0,o:a}},wb=(a,c)=>{a.u=tb(a,c);a.Ma=Oa(()=>{a.h||(a.time=(a.time+1)%24E3,a.ya=1/24E3*(a.time+6E3)%1,nb(a.o,a.g,!1))},50)},xb=a=>{var c=a.g,e=(a=a.Y).has(-12)||a.has(65);a=a.has(-13)||a.has(68);c.la=
e===a?0:.1-.2*e},yb=a=>{var c=a.g,e=(a=a.Y).has(-15)||a.has(16);a=a.has(-14)||a.has(32);c.Ba=e===a?0:.1-.2*e},zb=a=>{var c=a.g,e=(a=a.Y).has(-11)||a.has(83);a=a.has(-10)||a.has(87);c.ma=e===a?0:.1-.2*e},Ab=(a,c,e)=>{const b=a.Y;if(e){if(b.has(c))return!1;b.add(c);switch(c){case -1:0<=a.g.s&&kb(a.o,a.g.A,a.g.s,a.g.B,0);break;case -2:case 71:0<=a.g.s&&(c=a.o,e=a.g.s,a.g.Ia=0>e||15<e?0:c.V[(a.g.A<<c.l+4|a.g.B)<<4|e]);break;case -3:if(0<=a.g.s){c=a.g.A;e=a.g.s;var g=a.g.B;switch(a.g.ea){case 0:--c;break;
case 1:++c;break;case 2:--e;break;case 3:++e;break;case 4:--g;break;default:++g}0<=e&&16>e&&kb(a.o,c&(1<<4+a.o.l)-1,e,g&(1<<4+a.o.l)-1,a.g.Ia)}break;case 27:a.j?(a.h=!1,a.j=0):(a.h=!0,a.j=1);break;case -15:case -14:case 16:case 32:yb(a);break;case -12:case -13:case 65:case 68:xb(a);break;case 80:a.h=!a.h;break;case 82:a.g.J=a.o.Ja;a.g.ba=a.o.Ka;a.g.K=a.o.La;break;case -11:case -10:case 83:case 87:zb(a);break;case 84:if(!a.j){a.j=2;for(g of b)Ab(a,g,!1)}break;case 114:a.ha=!a.ha;break;default:return!1}}else{if(!b.delete(c))return!1;
switch(c){case -15:case -14:case 16:case 32:yb(a);break;case -12:case -13:case 65:case 68:xb(a);break;case -11:case -10:case 83:case 87:zb(a)}}a.va=[...b].join();return!0},Bb=(a,c)=>{a.O=[...a.O.slice(-30),{id:++ub,time:ka(),value:c}]};
function Cb({m:a,qa:c,i:e}){A("div[className=menu]");return[I("h1[innerText=Men\u00fc]"),I("div[className=settings]",null,[I("button",{innerText:"Oberfl\u00e4chen: "+(a.N?"Texturiert":"Einfarbig"),onclick:aa(b=>{c(2,{N:!b})},[a.N])}),I("label[innerText=Aufl\u00f6sung:]",null,[I("input[type=range][min=1][max=100][step=1]",{value:101-a.L,onchange:G(b=>c(2,{L:101-Number(b.target.value)}))})]),I("label[innerText=Blickwinkel:]",null,[I("input[type=range][min=1][max=180][step=1]",{value:a.ca,onchange:G(b=>
c(2,{ca:Number(b.target.value)}))})]),I("label[innerText=Sichtweite:]",null,[I("input[type=range][min=1][max=128][step=1]",{value:a.M,onchange:G(b=>c(2,{M:Number(b.target.value)}))})]),I("label[innerText=Mausempfindlichkeit:]",null,[I("input[type=range][min=1][max=15][step=1]",{value:a.Z,onchange:G(b=>c(2,{Z:Number(b.target.value)}))})])]),I("center",null,[I("button[innerText=Zur\u00fcck]",{onclick:G(b=>(e.j=0,"mouse"===b.pointerType?e.Ha.requestPointerLock():e.h=!1))})])]}
const Db=({I:{value:a}})=>(A("div",{innerText:a}),null);
function Eb({i:a,O:c}){A("div[className=menu terminal]");const e=G({history:null});B(b=>{b&&Na(()=>e.history.scrollTop=1E9,0)},[c.length&&c[c.length-1].id]);return[I("div[className=history]",{R:G(b=>{e.history=b})},[ja(Db,c)]),I("input[enterkeyhint=send][mozactionhint=send][name=message][required]",G({onkeydown:b=>{var g=b.keyCode;b=b.target;if(13===g){if(g=b.value)if("/"===g.charAt(0))switch(g=g.substr(1).split(" ").shift(),g){case "clear":a.O=[];break;case "exit":a.h=!1;a.j=0;break;case "help":Bb(a,
"commands: clear, exit, help, version");break;case "version":Bb(a,"Minicraft 0.4.12");break;case "/regen":g=a.o;const m=g.G[g.ga[g.W=0].Da];Y.removeItem(ob(g,m));m.H=m.loaded=!1;mb(g);Bb(a,"regenerate chunk");a.u.X=!0;break;default:Bb(a,"unknown command: "+g)}else Bb(a,"<me> "+g);b.value=""}else 27===g&&(a.h=!1,a.j=0)},R:b=>Na(()=>b.focus(),0)}))]}
const Fb=[["place",-3],["pick",-2],["up",-14],["down",-15],["R",82],["T",84],["F3",114],["...",27]],Gb=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]];
function Hb({i:a}){const c=a.Y;A("div[className=touch]",G({ontouchstart:e=>{e.preventDefault();const b=Number(e.target.dataset.code);if(null!=b&&Ab(a,b,!0)){const g=e.changedTouches[0].identifier,m=h=>{h.changedTouches[0].identifier===g&&(removeEventListener("touchend",m),Ab(a,b,!1))};addEventListener("touchend",m)}}}));return[I("div[className=top]",null,Fb.map(([e,b])=>I(`div[innerText=${e}]`,{D:{code:b},F:{button:!0,active:c.has(b)}}))),I("div[className=move]",null,Gb.map(([e,b])=>I("div",{D:{code:b},
F:{button:!0,[e]:!0,active:c.has(b)}})))]}
function Ib({m:a,qa:c,Oa:e}){const b=ba(vb),g=A("div[className=game]",ba(()=>{const h=d=>0!==b.j||(b.ia=!1,wa.pointerLockElement===g?b.h||Ab(b,-1-d.button,"mousedown"===d.type):b.Ha.requestPointerLock(),d.preventDefault(),!1);return{onmousedown:h,onmousemove:d=>{if(!b.h&&!b.j){const f=b.m.Z*P/X(b.wa,b.xa);b.g.v=(b.g.v+d.movementX*f+100*P)%(2*P);b.g.da=X(-xa,Fa(xa,b.g.da-d.movementY*f))}},onmouseup:h,ontouchstart:d=>{b.ia=!0;b.j||(b.h=!1,d.preventDefault())}}})),m=wa.pointerLockElement===g;B(()=>(b.Ha=
g,e.i=b,()=>{Pa(b.Ma);Pa(b.u.Na);return e.i=null}));B(()=>{b.m=a;b.u&&(b.u.X=!0);const h=b.g,d=b.o;var f=b.m.M;f=17>f?2:49>f?3:113>f?4:241>f?5:497>f?6:1009>f?7:2033>f?8:4081>f?9:8177>f?10:16369>f?11:32753>f?12:13;if(d.l!==f){if(d.G)for(var k of d.G)k.H&&pb(d,k);d.V=new La((d.na=new Ma(1<<10+2*f)).buffer);k=1<<(d.l=f);f=d.G=[];for(let n=0;n<k;++n)for(let l=0;l<k;++l)f.push({H:!1,loaded:!1,x:n,z:l,za:0,Aa:0});nb(d,h,!0)}},[a]);B((h,d,f)=>{b.wa=X(1,h*f);b.xa=X(1,d*f);d=b.m.L;h=X(1,Ea(b.wa/d));d=X(1,
Ea(b.xa/d));if(h!==b.ja||d!==b.ka)b.ja=h,b.ka=d,b.u&&(b.u.X=!0,sb(b.u))},[g.offsetWidth,g.offsetHeight,va.devicePixelRatio||1,a.L]);B(()=>{m||b.h||b.j||(b.j=1);b.h=!m},[m]);B(h=>m&&h&&wa.exitPointerLock(),[b.h||b.j]);B(h=>{if(b.ua&&!b.h){var d=b.g,f=Fa(5,.01*(h-b.ua));d.P-=.1*d.P*f;d.T-=.1*d.T*f;d.U-=.1*d.U*f;d.P+=(Ga(d.v)*d.la+Ha(d.v)*d.ma)*f;d.T+=d.Ba*f;d.U+=(-Ha(d.v)*d.la+Ga(d.v)*d.ma)*f;d.J+=d.P*f;d.ba+=d.T*f;d.K+=d.U*f}if(b.u){d=b.u;++d.ta;var k=d.oa,n=d.Ca;f=d.i;const da=f.m,p=f.g,H=f.ja,K=
f.ka,L=f.o;if(!f.h||d.X){d.X=!1;const Q=n.data,Jb=da.M;var l=p.v,q=p.da;const Kb=p.A,Lb=p.s,Mb=p.B;var u=p.J,x=p.ba,w=p.K;const Nb=L.V;var C=L.l;const Ob=da.N&&null!==qb;var r=1/H,F=1/K,y=H>>1;const R=K>>1,$a=Fa(H,K),ab=32<$a,bb=Ga(l);l=Ha(l);const cb=Ga(-q);q=Ha(-q);var S=da.ca/45;const Pb=r*(H<K?S*H*F:S);r=F*(K<H?S*K*r:S);u+=65536;x+=65536;w+=65536;F=u%1;S=x%1;const Qb=w%1;C=4+C;const db=(1<<C)-1;let eb=5,M=p.A=p.B=p.ea=0;p.s=-1;for(let ma=0;ma<K;++ma){var na=(R-ma)*r;const fb=na*cb-q;var za=na*
q+cb;na=za*l;za*=bb;for(let oa=0;oa<H;++oa){var ea=(oa-y)*Pb;const gb=na+bb*ea;ea=za-l*ea;let fa=16757124,pa=1,hb=Jb;for(let v=0;3>v;++v){let D=ea;0===v&&(D=gb);1===v&&(D=fb);var N=1/(0>D?-D:D);const qa=gb*N,O=fb*N;N*=ea;const ib=Ia(qa*qa+O*O+N*N);var z=Qb;0===v&&(z=F);1===v&&(z=S);0<D&&(z=1-z);let T=u+qa*z,U=x+O*z,V=w+N*z;z*=ib;0===v&&(T+=.5-(0>D|0));1===v&&(U+=.5-(0>D|0));2===v&&(V+=.5-(0>D|0));for(let Aa,Ba,Ca,E;z<hb;T+=qa,U+=O,V+=N,z+=ib)if(65536>U){if(0>O)break}else if(65552<=U){if(0<O)break}else if(0!==
(E=Nb[((Aa=T&db)<<C|(Ca=V&db))<<4|(Ba=U&15)])){ma===R&&oa===y&&z<=eb&&(p.A=Aa,p.s=Ba,p.B=Ca,p.ea=0>D|v<<1,eb=z);if(Ob){--E;1===v?6===E?E=25:13===E?E=4:1===E&&0<O&&(E=2):1===E&&(E=24);const jb=qb[E<<8|(16*(1===v?V:U)&15)<<4|16*(1===v?T:(0<D?T-V:V-T)+65536.5)&15];if(0===jb>>>24)continue;fa=jb&16777215}else fa=la[E];hb=z;pa=(0===v?.8:2===v?.6:0<D?.4:1)+(Ba!==Lb||Aa!==Kb||Ca!==Mb?0:.2);break}}Q[M]=(fa&255)*pa;Q[++M]=(fa>>8&255)*pa;Q[++M]=(fa>>16)*pa;M+=2}}ab||(Q[M=H*R+y<<2]+=128,Q[++M]+=128,Q[++M]+=128);
k.putImageData(n,0,0);ab&&(n=Da(.05*$a),k.fillRect(y-n,R-1,n<<1,2),k.fillRect(y-1,R-n,2,n-1),k.fillRect(y-1,R+1,2,n-1))}f.ha?(k=1<<4+L.l,0>p.s?y=0:(y=p.s,y=p.A+" "+p.s+" "+p.B+" "+sa[p.ea]+": "+(0>y||15<y?0:L.V[(p.A<<L.l+4|p.B)<<4|y])),f="Minicraft 0.4.12 "+W(d.Ga).toString().padStart(2,"\u00a0")+" fps, T: "+W(24*f.ya).toString().padStart(2,"0")+":"+W(24*f.ya%1*60).toString().padStart(2,"0")+"; "+(f.h&&500>h%1E3?"":f.time)+"\nR: "+H+"x"+K+" (x"+da.L+"), D: "+da.M+", C: "+L.W+"/"+L.ga.length+", M: "+
(k*k*16>>10)+"k\nE: 0/0\n\nPosition: "+p.J.toFixed(2)+" "+p.ba.toFixed(2)+" "+p.K.toFixed(2)+"\nAngle: "+(p.v*ya).toFixed(2)+" "+(p.da*ya).toFixed(2)+"\nBlock: "+y+"\nChunk: "+(W(p.J)>>4)+" "+(W(p.K)>>4)):f="";d.Ea=f}b.ua=h},[ka()]);ha();return[I("canvas",{R:G(h=>wb(b,h))}),b.u&&b.ha&&I("div[className=diagnostics]",{innerText:b.u.Ea}),b.ia&&ia(Hb,{i:b,va:b.va}),1===b.j&&ia(Cb,{m:a,qa:c,i:b}),2===b.j&&ia(Eb,{i:b,O:b.O})]}
t.init(()=>{const [a,c]=ca(Ra),e=G({i:null});B(()=>{onbeforeunload=()=>{c(1);if(e.i){var g=e.i.o;for(const m of g.G)m.H&&pb(g,m)}}});const b=G(g=>"INPUT"===g.target.tagName||!e.i||(g.preventDefault(),Ab(e.i,g.keyCode,"keydown"===g.type),e.i.ia=!1));return[{onkeydown:b,onkeyup:b,oncontextmenu:Qa,ondragstart:Qa},[ia(Ib,{m:a.m,qa:c,Oa:e})]]});
