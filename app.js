const r=lui,v=r.hook_dom,A=r.hook_effect,ca=r.hook_memo,da=r.hook_model,ea=r.hook_rerender,D=r.hook_static,G=r.node,H=r.node_dom,fa=r.node_map,ha=r.now,oa="air stone grass dirt cobble planks bedrock log leaves bricks wool sand gravel glass bookshelf obsidian stone_bricks sandstone lapis_block iron_block gold_block diamond_block emerald_block redstone_block quartz_block".split(" "),pa=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,
1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813],qa=pa.length,ra="WEBTSN".split(""),sa=window,ya=document,J=Math,za=J.PI,Aa=.5*za,Ba=180/za,K=J.floor,Ca=J.ceil,Da=J.round,L=J.min,M=J.max,Ea=J.cos,Fa=J.sin,Ga=J.sqrt,Ha=String.fromCharCode,Ma=JSON,Na=Ma.stringify,Oa=Ma.parse,N=localStorage,Pa=N.setItem.bind(N),Qa=Uint8Array,Ra=Uint32Array,Sa=Map,Ta=Number,Ua=setTimeout,Va=setInterval,Wa=clearTimeout,Xa=clearInterval,Q=a=>a*a,Ya=()=>!1,Za=a=>{a+=32;33<a&&39>a?a++:38<
a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Ha(a)},$a=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),bb=()=>{var a=ab;const c=a.length,e=new Sa,b=t=>{u=u<<1|t&1;15===++n&&(k+=Za(u),u=n=0)},d=()=>{for(let t=0;t<m;++t)b(0)},h=t=>{b(t);b(t>>1);b(t>>2);b(t>>3);b(t>>4);b(t>>5);b(t>>6);b(t>>7)},l=()=>{0===--w&&(w=1<<m++)},f=()=>{if(y)y=!1;else{let t=q.id;for(let B=0;B<m;B++)b(t>>B)}};let g=a[0],k="",u=0,n=2,m=2,w=2,x=2,q={id:x++,ta:new Sa},y=
!0;h(g);e.set(g,q);for(let t=1;t<c;++t){const B=q.ta.get(g=a[t]);B?q=B:(f(),e.has(g)||(l(),d(),h(g),e.set(g,{id:x++,ta:new Sa}),y=!0),q.ta.set(g,{id:x++,ta:new Sa}),q=e.get(g),l())}f();e.has(g)||(l(),d(),h(g));l();b(1);--m;d();return k+=Za(u<<15-n)},cb=a=>{var c=ab;if(!a)return null;const e=a.length,b=()=>{n+=(x>>--q&1)<<m++;0===q&&(q=15,x=$a(a.charCodeAt(w++)))};let d=[0,1],h=1,l=3,f=2,g=null;var k=null;let u=0,n=0;k=2;let m=0,w=0,x=$a(a.charCodeAt(w++)),q=15;for(;m<k;)b();if(1===n)return null;for(n=
m=0;8>m;)b();g=[n];d[2]=g;for(c[u++]=n;w<=e;){k=f;for(n=m=0;m<k;)b();if(0===n){for(n=m=0;8>m;)b();d[l]=[n];n=l++;0===--h&&(h=1<<f++)}else if(1===n)return c;k=n<d.length?d[n]:g.concat(g[0]);for(let y=0;y<k.length;y++)c[u++]=k[y];d[l++]=g.concat(k[0]);g=k;0===--h&&(h=1<<f++)}return null},R=new Ra(1024),ab=new Qa(R.buffer),db=new Sa,eb=(a,c,e,b)=>0>e||63<e?0:a.aa[(c<<a.H+4|b)<<6|e],fb=(a,c,e,b,d)=>{const h=a.H;a.aa[(c<<h+4|b)<<6|e]=d;a.O[(c>>4<<h|b>>4)<<2|e>>4].ba=!0},ib=(a,c,e)=>{const b=M(L(c.A,63),
0)>>4,d=K(c.v)>>4;c=K(c.B)>>4;if(e||a.xa!==b||a.ka+a.wa!==d||a.la+a.ya!==c)e=1<<a.H,a.xa=b,a.ka=d-(a.wa=(65536+d)%e),a.la=c-(a.ya=(65536+c)%e),gb(a);hb(a)},gb=a=>{const c=a.wa,e=a.xa,b=a.ya,d=a.H,h=`${d} ${c} ${b} ${e}`;let l=db.get(h);if(null==l){const f=1<<d,g=Q(.5*f);db.set(h,l=a.O.map(({x:k,y:u,z:n},m)=>{let w=Q(k-c),x=Q(n-b),q=Q(k-c-f),y=0,t=0;q<w&&(w=q,y=-f);(q=Q(k-c+f))<w&&(w=q,y=f);(q=Q(n-b-f))<x&&(x=q,t=-f);(q=Q(n-b+f))<x&&(x=q,t=f);return{Ha:w+x+Q(u-e),Qa:m,ka:y,la:t}}).filter(({Ha:k})=>
k<=g).sort((k,u)=>k.Ha-u.Ha))}a.ua=l;a.ha=0},kb=(a,c)=>{for(var e of a.O)e.ba&&jb(a,e);for(e=c.s.map(b=>b&&[b.id,b.amount,b.data]);0<e.length&&null===e[e.length-1];)e.pop();Pa(`minicraft.world.${a.id}:meta`,Na({p:{cb:c.Wa,eb:e,fb:c.G,p:[c.v,c.A,c.B,c.J,c.Y]},hb:[a.ma,a.na,a.oa],ib:1}))},lb=(a,c)=>{const e=N.getItem(`minicraft.world.${a.id}:meta`);if(e){const {p:b,hb:d}=Oa(e);b.eb.forEach((h,l)=>{h&&(c.s[l]={id:h[0],amount:h[1],data:h[2]})});c.Wa=b.cb;c.G=b.fb;c.v=b.p[0];c.A=b.p[1];c.B=b.p[2];c.J=
b.p[3];c.Y=b.p[4];a.ma=d[0];a.na=d[1];a.oa=d[2]}},mb=(a,c,e,b)=>`minicraft.world.${a.id}:${c}/${e}`+(0<b?"/"+b:""),jb=(a,c)=>{const e=a.sa;var b=a.H;const d=c.y,h=(256<<b)-256;for(let l=0,f=-1,g=((c.x<<b+4|c.z)<<6|d)<<2;16>l;++l){for(b=0;16>b;++b)R[++f]=e[g],R[++f]=e[++g],R[++f]=e[++g],R[++f]=e[++g],g+=13;g+=h}Pa(mb(a,c.qa,c.Ca,d),bb());c.ba=!1},hb=a=>{var c=a.O,e=a.ua,b=a.ka;const d=a.la,h=e.length;for(;a.ha<h;){var l=e[a.ha++];const m=c[l.Qa];var f=m.loaded,g=m.x,k=m.y,u=m.z;const w=b+l.ka+g;l=
d+l.la+u;if(!f||w!==m.qa||l!==m.Ca){m.ba&&jb(a,m);m.loaded=!0;var n=cb(N.getItem(mb(a,m.qa=w,m.Ca=l,k)));if(f||0===k||n){c=a.sa;b=a.H;e=(256<<b)-256;g=((g<<b+4|u)<<6|k)<<2;if(n)for(let x=0,q=-1;16>x;++x){for(f=0;16>f;++f)c[g]=R[++q],c[++g]=R[++q],c[++g]=R[++q],c[++g]=R[++q],g+=13;g+=e}else for(u=0;16>u;++u){for(n=0;16>n;++n)c[g]=0<k?0:50397446,c[++g]=0<k?0:131843,f?(c[++g]=0,c[++g]=0,g+=13):g+=15;g+=e}if(0===(w|l|k)){for(k=1;k<qa;++k)fb(a,k%9,7,K(k/9),k);m.ba=!1}break}}}};let T=null,nb=null,ob=new Image;
ob.crossOrigin="anonymous";ob.onload=()=>{var a=ya.createElement("canvas");a.width=256;a.height=26;a=a.getContext("2d");a.drawImage(ob,0,0);T=new Ra(a.getImageData(0,0,256,26).data.buffer);nb&&nb();ob=nb=null};ob.src=ASSETS+"blocks.png";
const Bb=(a,c)=>{const e={Oa:c,Fa:c.getContext("2d",{alpha:!1,desynchronized:!0}),Pa:null,Ta:"",M:!1,Ua:0,Ia:0,bb:Va(()=>(e.Ua=e.Ia,e.Ia=0),1E3),i:a};null===T&&(nb=()=>e.M=!0);pb(e);return e},pb=a=>{(a.Pa=a.Fa.createImageData(a.Oa.width=a.i.Aa,a.Oa.height=a.i.Ba)).data.fill(255);a.Fa.fillStyle="rgba(255,255,255,.5)"},Cb=Array(16).fill(0),Db=({id:a})=>(v("div[className=bitmap]"),a=a-1<<8,Cb.map((c,e)=>(e=a|15-e<<4,H("div",null,Cb.map((b,d)=>(d=T[e|d],H("div",{style:0<d>>>24?`background-color:rgb(${d&
255},${d>>>8&255},${d>>>16&255})`:""})))))));function Eb({amount:a,id:c}){v("div[className=stack]");return[G(Db,{id:c}),1<a&&H("div[className=amount]",{innerText:a})]}function Fb({g:a,ea:c}){v("div[className=bar]",{ontouchstart:D(e=>{a.m=Number(e.target.closest("[data-slot]").dataset.slot);a.da=e.timeStamp}),S:{opacity:M(.5,L(1,1-5E-4*(c-a.da-5E3)))}});return T&&a.s.slice(0,9).map((e,b)=>H("div",{D:{slot:b},F:{active:b===a.m}},[null!==e&&G(Eb,{id:e.id,amount:e.amount,data:e.data})]))}
function Gb({i:a}){v("div[className=menu inventory]");return[T&&H("div",null,[...a.g.s.slice(9),...a.g.s.slice(0,9)].map(c=>H("div",{title:null!==c?oa[c.id]:""},[null!==c&&G(Eb,{id:c.id,amount:c.amount,data:c.data})])))]}const Hb=({I:{Xa:a,time:c,value:e},ea:b})=>(v(a?"div[className=minor]":"div",{innerText:e,S:{opacity:L(1,1-.001*(b-c-4500))}}),null);function Ib({L:a,ea:c}){v("div[className=messages]");const e=c-5E3;return[fa(Hb,a.slice(-10).filter(b=>b.time>e),{ea:c})]}
const Jb=(a,c,e)=>{a.J=(a.J+c+100*za)%(2*za);a.Y=M(-Aa,L(Aa,a.Y+e))},Kb=({s:a},c)=>{for(var e of a)if(null!==e&&e.id===c.id){const b=L(e.amount+c.amount,64);c.amount-=b-e.amount;e.amount=b;if(0===c.amount)return null}for(e=0;36>e;++e)if(null===a[e])return a[e]=c,null;return c},Lb=(a,c=1)=>({amount:c,data:null,id:a});let Mb=0;
const Nb=()=>{const a={aa:null,sa:null,O:null,ua:null,ha:0,wa:0,xa:0,ya:0,id:0,ka:0,la:0,H:0,ma:.5,na:8.5,oa:.5};var c={Da:0,Na:0,Ea:0,J:0,Y:0,ra:0,Z:0,N:-1,$:0,fa:null,ga:null,G:1,Wa:20,s:Array(36).fill(null),za:0,name:"Gast",v:a.ma,A:a.na,B:a.oa,Ya:0,Za:0,m:0,da:0,U:0,V:0,W:0};lb(a,c);return{actions:null,o:null,va:!1,l:!0,ia:!1,Va:null,P:0,K:new Set,Ja:"",h:0,L:[],g:c,u:null,Ka:1,La:1,Aa:0,Ba:0,$a:null,time:0,Ma:0,j:a}},Ob=(a,c)=>{a.u=Bb(a,c);a.$a=Va(()=>{a.l||(a.time=(a.time+1)%24E3,a.Ma=1/24E3*
(a.time+6E3)%1,ib(a.j,a.g,!1))},50)},Pb=(a,c)=>a===c?0:.1-.2*a,Qb=a=>{a.g.Da=Pb((a=a.K).has(-12)||a.has(65),a.has(-13)||a.has(68))},Rb=a=>{a.g.Na=Pb((a=a.K).has(-15)||a.has(16),a.has(-14)||a.has(32))},Sb=a=>{a.g.Ea=Pb((a=a.K).has(-11)||a.has(83),a.has(-10)||a.has(87))},Tb=a=>{a.g.Ya=Pb(a.K.has(-18),a.K.has(-19))},Ub=a=>{a.g.Za=Pb(a.K.has(-17),a.K.has(-16))},U=(a,c,e)=>{const b=a.K,d=a.g;if(e){if(b.has(c))return!1;b.add(c);var h=d.Z,l=d.N;e=d.$;switch(c){case -18:case -19:Tb(a);break;case -17:case -16:Ub(a);
break;case -1:2!==d.G&&0<=l&&(0===d.za?0===d.G&&(c=eb(a.j,h,l,e),2===c?c=3:1===c&&(c=4),6===c||8!==c&&13!==c&&null!==Kb(d,Lb(c,1)))||fb(a.j,h,l,e,0):Vb(a,[h,l,e],!1));break;case -2:case 71:if(0<=l){const f=eb(a.j,h,l,e);e=d.s.slice(0,9);l=e.findIndex(g=>null!==g&&g.id===f);0<=l?d.m=l:1===d.G&&(null!==e[d.m]&&(e=e.indexOf(null),0<=e&&(d.m=e)),d.s[d.m]=Lb(f));d.da=a.P}break;case -3:if(2!==d.G&&0<=l)if(0===d.za){if(c=d.s[d.m],null!==c){switch(d.ra){case 0:--h;break;case 1:++h;break;case 2:--l;break;
case 3:++l;break;case 4:--e;break;default:++e}0<=l&&64>l&&(fb(a.j,h&(1<<4+a.j.H)-1,l,e&(1<<4+a.j.H)-1,c.id),1!==d.G&&0>=--c.amount&&(d.s[d.m]=null))}}else Vb(a,[h,l,e],!0);break;case -4:d.m=(d.m+9-1)%9;d.da=a.P;break;case -5:d.m=(d.m+1)%9;d.da=a.P;break;case 27:a.h?(a.l=!1,a.h=0):(a.l=!0,a.h=1);break;case -15:case -14:case 16:case 32:Rb(a);break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:d.m=c-49;d.da=a.P;break;case -12:case -13:case 65:case 68:Qb(a);break;case 69:if(2!==
d.G&&!a.h){a.h=3;for(const f of b)U(a,f,!1)}break;case 80:a.l=!a.l;break;case 81:if(b.has(17)||null!==d.s[d.m]&&0>=--d.s[d.m].amount)d.s[d.m]=null;break;case -11:case -10:case 83:case 87:Sb(a);break;case 84:if(!a.h){a.h=2;for(const f of b)U(a,f,!1)}break;case 114:a.va=!a.va;break;default:return!1}}else{if(!b.delete(c))return!1;switch(c){case -15:case -14:case 16:case 32:Rb(a);break;case -12:case -13:case 65:case 68:Qb(a);break;case -11:case -10:case 83:case 87:Sb(a);break;case -18:case -19:Tb(a);
break;case -17:case -16:Ub(a)}}a.Ja=[...b].join();return!0},Wb=(a,c)=>(c=c.startsWith("~")?a+Ta(c.substr(1)):Ta(c),isNaN(c)?a:c),Y=(a,c,e=!1)=>{(a.L=a.L.slice(-49)).push({id:++Mb,Xa:e,time:ha(),value:c})},Vb=(a,c,e)=>{e?a.g.ga=c:a.g.fa=c;Y(a,`${e?"second":"first"} position: ${c.join(" ")}`,!0)};
function Xb({actions:{ab:a,Ga:c,Sa:e},o:b,i:d}){A(()=>{kb(d.j,d.g);return c});A(()=>{const h=Ua(c,1E3);return()=>Wa(h)},[b]);v("div[className=menu]");return[H("h1[innerText=Men\u00fc]"),H("div[className=settings]",null,[H("button",{innerText:"Oberfl\u00e4chen: "+(b.ca?"Texturiert":"Einfarbig"),onclick:D(()=>a(h=>({ca:!h.ca})))}),H("label[innerText=Aufl\u00f6sung:]",null,[H("input[type=range][min=1][max=100][step=1]",{value:101-b.T,onchange:D(h=>e({T:101-Number(h.target.value)}))})]),H("label[innerText=Blickwinkel:]",
null,[H("input[type=range][min=1][max=180][step=1]",{value:b.pa,onchange:D(h=>e({pa:Number(h.target.value)}))})]),H("label[innerText=Sichtweite:]",null,[H("input[type=range][min=1][max=128][step=1]",{value:b.X,onchange:D(h=>e({X:Number(h.target.value)}))})]),H("label[innerText=Mausempfindlichkeit:]",null,[H("input[type=range][min=1][max=15][step=1]",{value:b.ja,onchange:D(h=>e({ja:Number(h.target.value)}))})])]),H("center",null,[H("button[innerText=Zur\u00fcck]",{onclick:D(h=>(d.h=0,"mouse"===h.pointerType?
d.Va.requestPointerLock():d.l=!1))})])]}const Yb=({I:{Xa:a,value:c}})=>(v(a?"div[className=minor]":"div",{innerText:c}),null);
function Zb({i:a,L:c}){v("div[className=menu terminal]");const e=D({history:null});A(b=>{b&&Ua(()=>e.history.scrollTop=1E9,0)},[c.length&&c[c.length-1].id]);return[H("div[className=history]",{R:D(b=>{e.history=b})},[fa(Yb,c)]),H("input[enterkeyhint=send][mozactionhint=send][name=message][required]",D({onkeydown:b=>{var d=b.keyCode;b=b.target;if(13===d){var h=b.value;d=a.g;if(h)if("/"===h.charAt(0)){h=h.substr(1).split(" ");var l=h.shift();switch(l){case "clear":a.L=[];break;case "clearinv":d.s.fill(null);
Y(a,"inventory cleared",!0);break;case "exit":a.l=!1;a.h=0;break;case "gamemode":case "gm":h=Ta(h[0]);!isNaN(h)&&0<=h&&3>h&&0===h%1?(d.G=h,Y(a,`gamemode set to ${h}`,!0)):Y(a,"gamemode must be in 0..2");break;case "give":l=oa.indexOf((h[0]||"").toLowerCase());l=0<=l?l:Ta(h[0]);h=Ta(h[1]||1);!isNaN(l)&&0<l&&25>l&&0===l%1?!isNaN(h)&&0<h&&65>h&&0===h%1?Y(a,Kb(d,Lb(l,h))?"inventory full":`gave ${h} ${oa[l]}`,!0):Y(a,"amount must be in 1..64"):Y(a,"invalid block type");break;case "help":Y(a,"commands: clear, clearinv, exit, gamemode, give, help, me, save, spawn, teleport, version");
break;case "me":Y(a,d.name+" "+h.join(" "),!0);break;case "save":kb(a.j,a.g);a.actions.Ga();Y(a,"world+config saved",!0);break;case "smart":d.name="LFF5644";Y(a,"lff.smart: true",!0);break;case "spawn":a.j.ma=d.v;a.j.na=d.A;a.j.oa=d.B;Y(a,"spawn updated",!0);break;case "teleport":case "tp":0===h.length?(d.v=a.j.ma,d.A=a.j.na,d.B=a.j.oa,a.u.M=!0,Y(a,"teleported to spawn",!0)):3===h.length?(Y(a,`teleported to ${d.v=Wb(d.v,h[0])} ${d.A=Wb(d.A,h[1])} ${d.B=Wb(d.B,h[2])}`,!0),a.u.M=!0):Y(a,"PITCH");d.U=
0;d.V=0;d.W=0;break;case "version":Y(a,"Minicraft 0.5.16");break;case "/exit":d.za=0;Y(a,"normal mouse mode",!0);break;case "/expand":a.g.fa&&a.g.ga?l=!0:(Y(a,"selection required"),l=!1);l&&("vert"===h[0]?(d.fa[1]=0,d.ga[1]=63,Y(a,"selection expanded",!0)):Y(a,"only vert supported"));break;case "/pos1":case "/pos2":Vb(a,[K(d.v),K(d.A),K(d.B)],"/pos2"===l);break;case "/regen":d=a.j;h=d.O[d.ua[d.ha=0].Qa];N.removeItem(mb(d,h.qa,h.Ca,h.y));h.ba=!1;++h.qa;hb(d);Y(a,"regenerate chunk",!0);a.u.M=!0;break;
case "/show":Y(a,`first: ${d.fa?d.fa.join(" "):"none"}, second: ${d.ga?d.ga.join(" "):"none"}`);break;case "/wand":d.za=1;Y(a,"primary+secondary button for selection",!0);break;default:Y(a,"unknown command: "+l)}}else Y(a,`<${d.name}> `+h);b.value=""}else 27===d&&(a.l=!1,a.h=0)},R:b=>Ua(()=>b.focus(),0)}))]}
const $b=[["pick",-2],["up",-14],["down",-15],["E",69],["T",84],["F3",114],["...",27]],ac=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]],bc=[["up",-16],["down",-17],["left",-18],["right",-19],["center",-3]];
function cc({i:a}){const c=a.K,e=([b,d])=>H("div",{D:{code:d},F:{button:!0,[b]:!0,active:c.has(d)}});v("div[className=touch]",D({ontouchstart:b=>{b.preventDefault();const d=Number(b.target.dataset.code);if(null!=d&&U(a,d,!0)){const h=b.changedTouches[0].identifier,l=f=>{f.changedTouches[0].identifier===h&&(removeEventListener("touchend",l),U(a,d,!1))};addEventListener("touchend",l)}}}));return[H("div[className=top]",null,$b.map(([b,d])=>H(`div[innerText=${b}]`,{D:{code:d},F:{button:!0,active:c.has(d)}}))),
H("div[className=move]",null,ac.map(e)),H("div[className=move sec]",null,bc.map(e))]}
function dc({actions:a,o:c,gb:e}){const b=ca(Nb),d=ha(),h=v("div[className=game]",ca(()=>{const f=g=>0!==b.h||(b.ia=!1,ya.pointerLockElement===h?b.l||U(b,-1-g.button,"mousedown"===g.type):b.Va.requestPointerLock(),g.preventDefault(),!1);return{onmousedown:f,onmousemove:g=>{if(!b.l&&!b.h){const k=b.o.ja*za/M(b.Ka,b.La);Jb(b.g,g.movementX*k,-g.movementY*k)}},onmouseup:f,ontouchstart:g=>{b.ia=!0;b.h||(b.l=!1,g.preventDefault())},onwheel:g=>{b.ia=!1;if(!b.h&&!b.l&&5<Math.abs(g.deltaY)){const k=0<g.deltaY?
-5:-4;U(b,k,!0);U(b,k,!1);g.preventDefault()}}}})),l=ya.pointerLockElement===h;A(()=>(b.actions=a,b.Va=h,e.i=b,()=>{Xa(b.$a);Xa(b.u.bb);return e.i=null}));A(()=>{b.o=c;b.u&&(b.u.M=!0);const f=b.g,g=b.j;var k=b.o.X;k=17>k?2:49>k?3:113>k?4:241>k?5:497>k?6:1009>k?7:2033>k?8:4081>k?9:8177>k?10:16369>k?11:32753>k?12:13;if(g.H!==k){g.O&&kb(g,f);const u=1<<(g.H=k),n=g.O=[];for(let m=0;m<u;++m)for(let w=0;w<u;++w)for(let x=0;4>x;++x)n.push({ba:!1,loaded:!1,x:m,y:x,z:w,qa:0,Ca:0});k=u<<k+12+2;null===g.aa||
g.aa.length<k?g.sa=new Ra((g.aa=new Qa(k)).buffer):g.sa.fill(0);ib(g,f,!0)}},[c]);A((f,g,k)=>{b.Ka=M(1,f*k);b.La=M(1,g*k);g=b.o.T;f=M(1,Da(b.Ka/g));g=M(1,Da(b.La/g));if(f!==b.Aa||g!==b.Ba)b.Aa=f,b.Ba=g,b.u&&(b.u.M=!0,pb(b.u))},[h.offsetWidth,h.offsetHeight,sa.devicePixelRatio||1,c.T]);A(()=>{l||b.l||b.h||(b.h=1);b.l=!l},[l]);A(f=>l&&f&&ya.exitPointerLock(),[b.l||b.h]);A(()=>{if(b.P&&!b.l){var f=b.g,g=L(5,.01*(d-b.P));f.U-=.1*f.U*g;f.V-=.1*f.V*g;f.W-=.1*f.W*g;f.U+=(Ea(f.J)*f.Da+Fa(f.J)*f.Ea)*g;f.V+=
f.Na*g;f.W+=(-Fa(f.J)*f.Da+Ea(f.J)*f.Ea)*g;Jb(f,f.Ya*g,f.Za*g);f.v+=f.U*g;f.A+=f.V*g;f.B+=f.W*g}if(b.u){f=b.u;++f.Ia;g=f.Fa;var k=f.Pa;const I=f.i,ia=I.o,p=I.g,O=I.Aa,S=I.Ba,P=I.j;if(!I.l||f.M){f.M=!1;const Z=k.data,fc=ia.X;var u=p.J,n=p.Y;const gc=p.Z,hc=p.N,ic=p.$;var m=p.v,w=p.A,x=p.B;const jc=P.aa;var q=P.H;const kc=ia.ca&&null!==T;var y=1/O,t=1/S;const aa=O>>1,ba=S>>1,qb=L(O,S),rb=32<qb,sb=Ea(u);u=Fa(u);const tb=Ea(-n);n=Fa(-n);var B=ia.pa/45;const lc=y*(O<S?B*O*t:B);y=t*(S<O?B*S*y:B);m+=65536;
w+=65536;x+=65536;t=m%1;B=w%1;const mc=x%1;q=4+q;const ub=(1<<q)-1;let vb=1===p.G?6:4,V=p.Z=p.$=p.ra=0;p.N=-1;for(let ta=0;ta<S;++ta){var ua=(ba-ta)*y;const wb=ua*tb-n;var Ia=ua*n+tb;ua=Ia*u;Ia*=sb;for(let va=0;va<O;++va){var ja=(va-aa)*lc;const xb=ua+sb*ja;ja=Ia-u*ja;let ka=16757124,wa=1,yb=fc;for(let z=0;3>z;++z){let E=ja;0===z&&(E=xb);1===z&&(E=wb);var W=1/(0>E?-E:E);const xa=xb*W,X=wb*W;W*=ja;const zb=Ga(xa*xa+X*X+W*W);var C=mc;0===z&&(C=t);1===z&&(C=B);0<E&&(C=1-C);let la=m+xa*C-(0===z&0>E|0),
ma=w+X*C-(1===z&0>E|0),na=x+W*C-(2===z&0>E|0);C*=zb;for(let Ja,Ka,La,F;C<yb;la+=xa,ma+=X,na+=W,C+=zb)if(65536>ma){if(0>X)break}else if(65600<=ma){if(0<X)break}else if(0!==(F=jc[((Ja=la&ub)<<q|(La=na&ub))<<6|(Ka=ma&63)])){ta===ba&&va===aa&&C<=vb&&(p.Z=Ja,p.N=Ka,p.$=La,p.ra=0>E|z<<1,vb=C);if(kc){--F;1===z?6===F?F=25:13===F?F=4:1===F&&0<X&&(F=2):1===F&&(F=24);const Ab=T[F<<8|(16*(1===z?na:ma)&15)<<4|16*(1===z?la:(0<E?la-na:na-la)+65536)&15];if(0===Ab>>>24)continue;ka=Ab&16777215}else ka=pa[F];yb=C;wa=
(0===z?.8:2===z?.6:0<E?.4:1)+(Ka!==hc||Ja!==gc||La!==ic?0:.2);break}}Z[V]=(ka&255)*wa;Z[++V]=(ka>>8&255)*wa;Z[++V]=(ka>>16)*wa;V+=2}}rb||(Z[V=O*ba+aa<<2]+=128,Z[++V]+=128,Z[++V]+=128);g.putImageData(k,0,0);rb&&(k=Ca(.05*qb),g.fillRect(aa-k,ba-1,k<<1,2),g.fillRect(aa-1,ba-k,2,k-1),g.fillRect(aa-1,ba+1,2,k-1))}f.Ta=I.va?"Minicraft 0.5.16 "+K(f.Ua).toString().padStart(2,"\u00a0")+" fps, T: "+K(24*I.Ma).toString().padStart(2,"0")+":"+K(24*I.Ma%1*60).toString().padStart(2,"0")+"; "+(I.l&&500>d%1E3?"":
I.time)+"\nR: "+O+"x"+S+" (x"+ia.T+"), D: "+ia.X+", C: "+P.ha+"/"+P.ua.length+", M: "+(64*Q(1<<4+P.H)>>10)+"k\nE: 0/0 M: "+p.G+"\n\nPosition: "+p.v.toFixed(2)+" "+p.A.toFixed(2)+" "+p.B.toFixed(2)+"\nAngle: "+(p.J*Ba).toFixed(2)+" "+(p.Y*Ba).toFixed(2)+"\nBlock: "+(0>p.N?0:p.Z+" "+p.N+" "+p.$+" "+ra[p.ra]+": "+eb(P,p.Z,p.N,p.$))+"\nChunk abs: "+(K(p.v)>>4)+" "+(K(p.B)>>4)+" "+(K(p.A)>>4)+" rel: "+P.wa+" "+P.ya+" "+P.xa:""}b.P=d},[d]);ea();return[H("canvas",{R:D(f=>Ob(b,f))}),2!==b.h&&G(Ib,{L:b.L,
ea:d}),b.u&&b.va&&H("div[className=diagnostics]",{innerText:b.u.Ta}),b.ia&&G(cc,{i:b,Ja:b.Ja}),3!==b.h&&2!==b.g.G&&G(Fb,{g:b.g,ea:d}),3===b.h&&G(Gb,{i:b,ea:d}),1===b.h&&G(Xb,{actions:a,o:c,i:b}),2===b.h&&G(Zb,{i:b,L:b.L})]}
const ec={init:()=>{const a={ca:!0,ja:3,T:10,pa:80,X:64};var c=N.getItem("minicraft.config");if(c){c=Oa(c);let e=c.flag_textures;null!=e&&(a.ca=e);null!=(e=c.mouse_sensitivity)&&(a.ja=e);a.T=c.resolution_scaling;a.pa=c.view_angle;a.X=c.view_distance}return{o:a,Ra:a}},Ga:a=>{const c=a.o;if(c===a.Ra)return a;Pa("minicraft.config",Na({version:"0.5.16",flag_textures:c.ca,mouse_sensitivity:c.ja,resolution_scaling:c.T,view_angle:c.pa,view_distance:c.X}));return Object.assign({},a,{Ra:c})},ab:(a,c)=>ec.Sa(a,
c(a.o)),Sa:(a,c)=>Object.assign({},a,{o:Object.assign({},a.o,c)})};r.init(()=>{const [a,c]=da(ec),e=D({i:null});A(()=>{let d=!1;onbeforeunload=onunload=()=>{if(!d&&(d=!0,c.Ga(),e.i)){var h=e.i;kb(h.j,h.g)}}});const b=D(d=>"INPUT"===d.target.tagName||!e.i||(d.preventDefault(),U(e.i,d.keyCode,"keydown"===d.type),e.i.ia=!1));return[{onkeydown:b,onkeyup:b,oncontextmenu:Ya,ondragstart:Ya},[G(dc,{actions:c,o:a.o,gb:e})]]});
