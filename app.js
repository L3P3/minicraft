function aa(a){function b(e){return a.next(e)}function c(e){return a.throw(e)}return new Promise(function(e,d){function h(k){k.done?e(k.value):Promise.resolve(k.value).then(b,c).then(h,d)}h(a.next())})}
const p=lui,ba=p.defer,ha=p.defer_end,ia=p.dom_define,ja=p.hook_async,w=p.hook_dom,z=p.hook_effect,ka=p.hook_memo,la=p.hook_model,ma=p.hook_rerender,na=p.hook_state,A=p.hook_static,B=p.node,D=p.node_dom,oa=p.node_map,va=p.now,wa=window,xa=document,G=Math,ya=G.PI,za=.5*ya,Aa=180/ya,K=G.floor,Ga=G.ceil,Ha=G.round,L=G.min,M=G.max,Ia=G.cos,Ja=G.sin,Ka=G.sqrt,La=G.log2,Ma=String.fromCharCode,Na=Date,Oa=JSON,Pa=Oa.stringify,Qa=Oa.parse,N=localStorage,Wa=N.setItem.bind(N),Xa=Uint8Array,Ya=Uint32Array,Za=
Map,O=Number,$a=setTimeout,ab=setInterval,bb=clearTimeout,cb=clearInterval,Q=a=>a*a,db=()=>!1,eb=a=>{var b=new Na;a=new Na(a);var c=b-a;if(59E3>c)return Ha(c/1E3)+"s";if(3E6>c)return Ha(c/6E4)+"m";c=a.getFullYear();const e=a.getMonth(),d=a.getDate();let h="";c<b.getFullYear()&&(h=c+"/");if(h||e<b.getMonth())h+=e+1+"/";if(h||d<b.getDate())h+=d+"/";b=h+a.getHours()+":";a=a.getMinutes();a=K(a).toString().padStart(2,"0");return b+a},fb={init:()=>{const a={ia:!0,qa:3,$:4,wa:120,da:64,La:0};var b=N.getItem("minicraft.config");
if(b){b=Qa(b);let c=b.flag_textures;null!=c&&(a.ia=c);null!=(c=b.mouse_sensitivity)&&(a.qa=c);a.$=b.resolution_scaling;a.wa=b.view_angle;a.da=b.view_distance;null!=(c=b.world_last)&&(a.La=c)}return{u:a,bb:a}},Qa:a=>{const b=a.u;if(b===a.bb)return a;Wa("minicraft.config",Pa({version:"0.8.1",flag_textures:b.ia,mouse_sensitivity:b.qa,resolution_scaling:b.$,view_angle:b.wa,view_distance:b.da,world_last:b.La}));return Object.assign({},a,{bb:b})},lb:(a,b)=>fb.Ra(a,b(a.u)),Ra:(a,b)=>Object.assign({},a,{u:Object.assign({},
a.u,b)})},gb="air stone grass dirt cobble planks bedrock log leaves bricks wool sand gravel glass bookshelf obsidian stone_bricks sandstone lapis_block iron_block gold_block diamond_block emerald_block redstone_block quartz_block".split(" "),hb=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813],ib="WEBTSN".split(""),R=(a,b=1,c=null)=>({amount:b,data:c,
id:a}),jb=(a,b,c=a.content.amount)=>{if(b.content)a.content.id===b.content.id?(c=L(c,b.P-b.content.amount),a.content.amount-=c,b.content.amount+=c,0>=a.content.amount&&(a.content=null)):!(a.content.amount<=c&&a.content.amount<=b.P&&b.content.amount<=a.P)||a.filter&&!a.filter(b.content.id)||b.filter&&!b.filter(a.content.id)||([b.content,a.content]=[a.content,b.content]);else if(!b.filter||b.filter(a.content.id))a.content.amount<=c&&a.content.amount<=b.P?[b.content,a.content]=[a.content,b.content]:
(c=L(c,b.P),a.content.amount-=c,b.content=R(a.content.id,c),0>=a.content.amount&&(a.content=null))},kb=(a,b)=>{for(const c of a)if(c.content&&c.content.id===b.id){const e=L(b.amount,c.P-c.content.amount);c.content.amount+=e;if(0>=(b.amount-=e))return null}for(const c of a)if(!c.content&&(!c.filter||c.filter(b.id)))if(a=L(b.amount,c.P),a<=b.amount){if(c.content=R(b.id,a),0>=(b.amount-=a))return null}else return c.content=b,null;return b},lb=a=>({Na:0,Ya:0,Oa:0,O:0,ea:0,za:0,fa:0,W:-1,ga:0,la:null,
ma:null,G:1,hb:20,H:Array(36).fill(null).map(()=>({content:null,filter:null,P:64})),Ha:0,name:"Gast",J:a.ta,K:a.ua,L:a.va,jb:0,kb:0,N:0,ja:0,aa:0,ba:0,ca:0}),mb=(a,b,c)=>{a.O=(a.O+b+100*ya)%(2*ya);a.ea=M(-za,L(za,a.ea+c))},nb=a=>{a+=32;33<a&&39>a?a++:38<a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Ma(a)},ob=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),qb=()=>{var a=pb;const b=a.length,c=new Za,e=v=>{m=m<<1|v&1;15===++n&&(l+=nb(m),m=n=0)},
d=()=>{for(let v=0;v<q;++v)e(0)},h=v=>{e(v);e(v>>1);e(v>>2);e(v>>3);e(v>>4);e(v>>5);e(v>>6);e(v>>7)},k=()=>{0===--t&&(t=1<<q++)},f=()=>{if(y)y=!1;else{let v=u.id;for(let J=0;J<q;J++)e(v>>J)}};let g=a[0],l="",m=0,n=2,q=2,t=2,x=2,u={id:x++,Ba:new Za},y=!0;h(g);c.set(g,u);for(let v=1;v<b;++v){const J=u.Ba.get(g=a[v]);J?u=J:(f(),c.has(g)||(k(),d(),h(g),c.set(g,{id:x++,Ba:new Za}),y=!0),u.Ba.set(g,{id:x++,Ba:new Za}),u=c.get(g),k())}f();c.has(g)||(k(),d(),h(g));k();e(1);--q;d();return l+=nb(m<<15-n)},
rb=a=>{var b=pb;if(!a)return null;const c=a.length,e=()=>{n+=(x>>--u&1)<<q++;0===u&&(u=15,x=ob(a.charCodeAt(t++)))};let d=[0,1],h=1,k=3,f=2,g=null;var l=null;let m=0,n=0;l=2;let q=0,t=0,x=ob(a.charCodeAt(t++)),u=15;for(;q<l;)e();if(1===n)return null;for(n=q=0;8>q;)e();g=[n];d[2]=g;for(b[m++]=n;t<=c;){l=f;for(n=q=0;q<l;)e();if(0===n){for(n=q=0;8>q;)e();d[k]=[n];n=k++;0===--h&&(h=1<<f++)}else if(1===n)return b;l=n<d.length?d[n]:g.concat(g[0]);for(let y=0;y<l.length;y++)b[m++]=l[y];d[k++]=g.concat(l[0]);
g=l;0===--h&&(h=1<<f++)}return null},S=new Ya(1024),pb=new Xa(S.buffer),sb=new Za,tb=(a,b,c,e)=>0>c||63<c?0:a.X[(b<<a.M+4|e)<<6|c],ub=(a,b,c,e)=>{const d=a.M;a.X[(b<<d+4|e)<<6|c]=0;a.Y[(b>>4<<d|e>>4)<<2|c>>4].ha=!0},vb=(a,b,c,e,d)=>{const h=a.M,k=(b<<h+4|e)<<6|c;if(0<a.X[k])return!1;a.X[k]=d;return a.Y[(b>>4<<h|e>>4)<<2|c>>4].ha=!0},Jb=(a,b,c)=>{const e=M(L(b.K,63),0)>>4,d=K(b.J)>>4;b=K(b.L)>>4;if(c||a.Fa!==e||a.ra+a.Ea!==d||a.sa+a.Ga!==b)c=1<<a.M,a.Fa=e,a.ra=d-(a.Ea=(65536+d)%c),a.sa=b-(a.Ga=(65536+
b)%c),wb(a);xb(a,!1)},wb=a=>{const b=a.Ea,c=a.Fa,e=a.Ga,d=a.M,h=`${d} ${b} ${e} ${c}`;let k=sb.get(h);if(null==k){const f=1<<d,g=Q(.5*f);sb.set(h,k=a.Y.map(({x:l,y:m,z:n},q)=>{let t=Q(l-b),x=Q(n-e),u=Q(l-b-f),y=0,v=0;u<t&&(t=u,y=-f);(u=Q(l-b+f))<t&&(t=u,y=f);(u=Q(n-e-f))<x&&(x=u,v=-f);(u=Q(n-e+f))<x&&(x=u,v=f);return{Sa:t+x+Q(m-c),ab:q,ra:y,sa:v}}).filter(({Sa:l})=>l<=g).sort((l,m)=>l.Sa-m.Sa))}a.Ca=k;a.na=0},Lb=(a,b)=>{for(var c of a.Y)c.ha&&Kb(a,c);for(c=b.H.map(({content:e})=>e&&[e.id,e.amount,
e.data]);0<c.length&&null===c[c.length-1];)c.pop();Wa(`minicraft.world.${a.id}:meta`,Pa({p:{h:b.hb,i:c,m:b.G,p:[b.J,b.K,b.L,b.O,b.ea]},s:[a.ta,a.ua,a.va],v:1}))},Mb=(a,b)=>{const c=N.getItem(`minicraft.world.${a.id}:meta`);if(c){const {p:e,s:d,v:h}=Qa(c);null!=h&&(e.i.forEach((k,f)=>{k&&(b.H[f].content=R(k[0],k[1],k[2]))}),b.hb=e.h,b.G=e.m,b.J=e.p[0],b.K=e.p[1],b.L=e.p[2],b.O=e.p[3],b.ea=e.p[4],a.ta=d[0],a.ua=d[1],a.va=d[2])}},Nb=(a,b,c,e)=>`minicraft.world.${a.id}:${b}/${c}`+(0<e?"/"+e:""),Kb=(a,
b)=>{const c=a.Aa;var e=a.M;const d=b.y,h=(256<<e)-256;for(let k=0,f=-1,g=((b.x<<e+4|b.z)<<6|d)<<2;16>k;++k){for(e=0;16>e;++e)S[++f]=c[g],S[++f]=c[++g],S[++f]=c[++g],S[++f]=c[++g],g+=13;g+=h}Wa(Nb(a,b.ya,b.Ma,d),qb());b.ha=!1},xb=(a,b)=>{const c=a.Y,e=a.Ca,d=a.ra,h=a.sa,k=e.length;for(;a.na<k;){var f=e[a.na++],g=c[f.ab],l=g.loaded,m=g.x;const t=g.y;var n=g.z,q=d+f.ra+m;f=h+f.sa+n;if(!l||q!==g.ya||f!==g.Ma)if(g.ha&&Kb(a,g),g.loaded=!0,f=rb(N.getItem(Nb(a,g.ya=q,g.Ma=f,t))),l||0===t||f){g=a.Aa;const x=
a.M;q=(256<<x)-256;m=((m<<x+4|n)<<6|t)<<2;if(f)for(let u=0,y=-1;16>u;++u){for(l=0;16>l;++l)g[m]=S[++y],g[++m]=S[++y],g[++m]=S[++y],g[++m]=S[++y],m+=13;m+=q}else for(n=0;16>n;++n){for(f=0;16>f;++f)g[m]=0<t?0:50397446,g[++m]=0<t?0:131843,l?(g[++m]=0,g[++m]=0,m+=13):m+=15;m+=q}if(!b)break}}};let Ob=null,Pb=null,Qb=new Image;Qb.crossOrigin="anonymous";
Qb.onload=()=>{const a=xa.createElement("canvas");a.width=16;a.height=416;const b=a.getContext("2d");b.drawImage(Qb,0,0);ia("tile","div[className=bitmap]",{S:{backgroundImage:`url(${a.toDataURL()})`}});Ob=new Ya(b.getImageData(0,0,16,416).data.buffer);Pb&&Pb();Qb=Pb=null};Qb.src=ASSETS+"blocks.webp";
const Sb=(a,b)=>{const c={Za:b,Pa:b.getContext("2d",{alpha:!1,desynchronized:!0}),$a:null,fb:"",T:!1,gb:0,Ta:0,mb:ab(()=>(c.gb=c.Ta,c.Ta=0),1E3),o:a};null===Ob&&(Pb=()=>c.T=!0);Rb(c);return c},Rb=a=>{(a.$a=a.Pa.createImageData(a.Za.width=a.o.Ia,a.Za.height=a.o.Ja)).data.fill(255);a.Pa.fillStyle="rgba(255,255,255,.5)"};let Tb=0;
const Vb=(a,b,c)=>{const e={X:null,Aa:null,Y:null,Ca:null,na:0,A:!0,Ea:0,Fa:0,Ga:0,id:0,ra:0,sa:0,M:0,ta:.5,ua:8.5,va:.5,time:0,Ka:0},d=lb(e);Mb(e,d);a={actions:a,u:c,cb:0,eb:0,Da:!1,oa:!0,pa:!1,nb:b,Z:0,U:new Set,Ua:"",l:0,V:[],j:d,B:null,Wa:1,Xa:1,Ia:0,Ja:0,pb:ab(()=>{e.A||(e.time=(e.time+1)%24E3,e.Ka=1/24E3*(e.Ka+6E3)%1,Jb(e,d,!1))},50),g:e};Ub(a);return a},Ub=a=>{aa(function*(){try{yield a.nb.requestPointerLock()}catch(b){}}())},Wb=(a,b)=>a===b?0:.1-.2*a,Xb=a=>{a.j.Na=Wb((a=a.U).has(-12)||a.has(65),
a.has(-13)||a.has(68))},Yb=a=>{a.j.Ya=Wb((a=a.U).has(-15)||a.has(16),a.has(-14)||a.has(32))},Zb=a=>{a.j.Oa=Wb((a=a.U).has(-11)||a.has(83),a.has(-10)||a.has(87))},$b=a=>{a.j.jb=Wb(a.U.has(-18),a.U.has(-19))},ac=a=>{a.j.kb=Wb(a.U.has(-17),a.U.has(-16))},U=(a,b,c)=>{if(!a.g)return!1;const e=a.U;var d=a.j;if(c){if(e.has(b))return!1;e.add(b);var h=d.fa,k=d.W;c=d.ga;switch(b){case -18:case -19:$b(a);break;case -17:case -16:ac(a);break;case -1:2!==d.G&&0<=k&&(0===d.Ha?0===d.G&&(b=tb(a.g,h,k,c),2===b?b=3:
1===b&&(b=4),6===b||8!==b&&13!==b&&null!==kb(d.H,R(b,1)))||(ub(a.g,h,k,c),d.W=-1):bc(a,[h,k,c],!1));break;case -2:case 71:if(0<=k){const f=tb(a.g,h,k,c);c=d.H.slice(0,9);k=c.findIndex(g=>null!==g.content&&g.content.id===f);0<=k?d.N=k:1===d.G&&(c[d.N].content&&(c=c.findIndex(g=>null===g.content),0<=c&&(d.N=c)),d.H[d.N].content=R(f));d.ja=a.Z}break;case -3:if(2!==d.G&&0<=k)if(0===d.Ha){if(b=d.H[d.N],b.content){switch(d.za){case 0:--h;break;case 1:++h;break;case 2:--k;break;case 3:++k;break;case 4:--c;
break;default:++c}0<=k&&64>k&&vb(a.g,h&(1<<4+a.g.M)-1,k,c&(1<<4+a.g.M)-1,b.content.id)&&1!==d.G&&0>=--b.content.amount&&(b.content=null)}}else bc(a,[h,k,c],!0);break;case -4:d.N=(d.N+9-1)%9;d.ja=a.Z;break;case -5:d.N=(d.N+1)%9;d.ja=a.Z;break;case 27:0===a.l&&(a.g.A=!0,a.l=1);break;case -15:case -14:case 16:case 32:Yb(a);break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:d.N=b-49;d.ja=a.Z;break;case -12:case -13:case 65:case 68:Xb(a);break;case 69:if(2!==d.G&&0===a.l){a.l=
3;for(const f of e)U(a,f,!1)}break;case 80:a.g&&(a.g.A=!a.g.A);break;case 81:d=d.H[d.N];if(e.has(17)||d.content&&0>=--d.content.amount)d.content=null;break;case -11:case -10:case 83:case 87:Zb(a);break;case 84:if(0===a.l){a.l=2;for(const f of e)U(a,f,!1)}break;case 112:a.oa=!a.oa;break;case 114:a.Da=!a.Da;break;default:return!1}}else{if(!e.delete(b))return!1;switch(b){case -15:case -14:case 16:case 32:Yb(a);break;case -12:case -13:case 65:case 68:Xb(a);break;case -11:case -10:case 83:case 87:Zb(a);
break;case -18:case -19:$b(a);break;case -17:case -16:ac(a)}}a.Ua=[...e].join();return!0},cc=(a,b)=>(b=b.startsWith("~")?a+O(b.substr(1)):O(b),isNaN(b)?a:b),Z=(a,b,c=!1)=>{(a.V=a.V.slice(-49)).push({id:++Tb,ib:c,time:va(),value:b})},bc=(a,b,c)=>{c?a.j.ma=b:a.j.la=b;Z(a,`${c?"second":"first"} position: ${b.join(" ")}`,!0)},dc=({id:a})=>(w("#tile",{S:{backgroundPositionY:`-${2*(a-1)}rem`}}),null);
function ec({amount:a,id:b}){w("div[className=stack]",{title:gb[b]});return[B(dc,{id:b}),1!==a&&D("div[className=amount]",{innerText:a})]}function fc({j:a,ka:b}){w("div[className=bar]",{ontouchstart:A(c=>{a.N=Number(c.target.closest("[data-slot]").dataset.slot);a.ja=c.timeStamp}),S:{opacity:M(.5,L(1,1-5E-4*(b-a.ja-5E3)))}});return Ob&&a.H.slice(0,9).map(({content:c},e)=>D("div",{D:{slot:e},F:{active:e===a.N}},[c&&B(ec,{amount:c.amount,data:c.data,id:c.id})]))}
function gc({ob:a}){w("div[className=grid]",{onclick:({target:b})=>{(b=b.closest("[data-id]"))&&jb({content:R(O(b.dataset.id)),filter:null,P:64},a)}});return gb.map((b,c)=>0<c&&D("div",{D:{id:c}},[B(ec,{id:c,amount:1,data:null})]))}
function hc({o:a}){const b=ka(()=>({content:null,filter:null,P:64}));w("div[className=menu overlay inventory]",ka(()=>({onclick:({target:c})=>{if("menu overlay inventory"===c.className)b.content?b.content=null:(a.l=0,a.g.A=!1,Ub(a));else if(c=c.closest("[data-slot]"))c=a.j.H[O(c.dataset.slot)],b.content?jb(b,c):c.content&&jb(c,b)},oncontextmenu:({target:c})=>{if("menu overlay inventory"===c.className)b.content?0>=--b.content.amount&&(b.content=null):(a.l=0,Ub(a));else if(c=c.closest("[data-slot]"))c=
a.j.H[O(c.dataset.slot)],b.content?jb(b,c,1):c.content&&jb(c,b,Ga(c.content.amount/2))}})));return Ob&&[D("div[className=window]",null,[D("div[innerText=Inventory]"),1===a.j.G&&B(gc,{ob:b}),D("div[className=grid]",null,a.j.H.map(({content:c},e)=>D("div",{D:{slot:e},F:{first:9>e}},[c&&B(ec,{id:c.id,amount:c.amount,data:c.data})])))]),b.content&&D("div[className=hand]",{S:{transform:`translate(${a.cb}px, ${a.eb}px)`}},[B(ec,{id:b.content.id,amount:b.content.amount,data:b.content.data})])]}
const ic=({I:{ib:a,time:b,value:c},ka:e})=>(w(a?"div[className=minor]":"div",{innerText:c,S:{opacity:L(1,1-.001*(e-b-4500))}}),null);function jc({V:a,ka:b}){w("div[className=messages]");const c=b-5E3;return[oa(ic,a.slice(-10).filter(e=>e.time>c),{ka:b})]}
function kc({actions:{lb:a,Qa:b,Ra:c},u:e,o:d,xa:h}){z(()=>{Lb(d.g,d.j);return b});z(()=>{const k=$a(b,1E3);return()=>bb(k)},[e]);w("div[className=menu overlay]");return[D("h1[innerText=Einstellungen]"),A(D("center",null,[D("button[innerText=Zur\u00fcck zum Spiel]",{onclick:()=>{d.l=0;d.g.A=!1;Ub(d)}})])),D("div[className=settings]",null,[D("button",{innerText:"Oberfl\u00e4chen:\n"+(e.ia?"Texturiert":"Einfarbig"),onclick:A(()=>a(k=>({ia:!k.ia})))}),D("label[innerText=Aufl\u00f6sung:]",null,[D("input[type=range][min=1][max=100][step=1]",
{value:101-e.$,onchange:A(k=>c({$:101-Number(k.target.value)}))})]),D("label[innerText=Blickwinkel:]",null,[D("input[type=range][min=1][max=180][step=1]",{value:e.wa,onchange:A(k=>c({wa:Number(k.target.value)}))})]),D("label[innerText=Sichtweite:]",null,[D("input[type=range][min=1][max=128][step=1]",{value:e.da,onchange:A(k=>c({da:Number(k.target.value)}))})]),D("label[innerText=Mausempfindlichkeit:]",null,[D("input[type=range][min=1][max=15][step=1]",{value:e.qa,onchange:A(k=>c({qa:Number(k.target.value)}))})])]),
A(D("center",null,[D("button[innerText=Welt verlassen]",{onclick:()=>{ba();c({La:-1});h(0);ha()}})]))]}const lc=({I:{ib:a,value:b}})=>(w(a?"div[className=minor]":"div",{innerText:b}),null);
function mc({o:a,V:b}){const c=A({history:null,input:null});w("div[className=menu overlay terminal]",{onclick:e=>{e.target!==c.input&&c.input.focus()}});z(e=>{e&&$a(()=>c.history.scrollTop=1E9,0)},[b.length&&b[b.length-1].id]);return[A(D("div[className=toolbar]",null,[D("button[innerText=\u274c]",{onclick:()=>{a.l=0;a.g.A=!1;Ub(a)}})])),D("div[className=history]",{R:A(e=>{c.history=e})},[oa(lc,b)]),A(D("input[enterkeyhint=send][mozactionhint=send][name=message][required]",{onkeydown:e=>{var d=e.keyCode;
e=e.target;if(13===d){var h=e.value;d=a.j;const f=a.g;if(h)if("/"===h.charAt(0)){h=h.substr(1).split(" ");const g=h.shift();switch(g){case "clear":a.V=[];break;case "clearinv":for(var k of d.H)k.content=null;Z(a,"inventory cleared",!0);break;case "gamemode":case "gm":h=O(h[0]);!isNaN(h)&&0<=h&&3>h&&0===h%1?(d.G=h,Z(a,`gamemode set to ${h}`,!0)):Z(a,"gamemode must be in 0..2");break;case "give":if(0===h.length){Z(a,"/give <id> [amount]\n"+gb.join(" "));break}k=gb.indexOf((h[0]||"").toLowerCase());
k=0<=k?k:O(h[0]);h=O(h[1]||1);!isNaN(k)&&0<k&&25>k&&0===k%1?!isNaN(h)&&0<h&&0===h%1?Z(a,kb(d.H,R(k,h))?"inventory full":`gave ${h} ${gb[k]}`,!0):Z(a,"amount must be at least 1"):Z(a,"invalid block type");break;case "help":Z(a,"commands: clear, clearinv, gamemode, give, help, load, me, save, spawn, teleport, version");break;case "load":xb(f,!0);a.B.T=!0;Z(a,"chunks loaded",!0);break;case "me":Z(a,d.name+" "+h.join(" "),!0);break;case "save":Lb(a.g,a.j);a.actions.Qa();Z(a,"world+config saved",!0);break;
case "smart":d.name="LFF5644";Z(a,"lff.smart: true",!0);break;case "spawn":f.ta=d.J;f.ua=d.K;f.va=d.L;Z(a,"spawn updated",!0);break;case "teleport":case "tp":0===h.length?(d.J=f.ta,d.K=f.ua,d.L=f.va,a.B.T=!0,Z(a,"teleported to spawn",!0)):3===h.length?(Z(a,`teleported to ${d.J=cc(d.J,h[0])} ${d.K=cc(d.K,h[1])} ${d.L=cc(d.L,h[2])}`,!0),a.B.T=!0):Z(a,"PITCH");d.aa=0;d.ba=0;d.ca=0;break;case "version":Z(a,"Minicraft 0.8.1");break;case "/exit":d.Ha=0;Z(a,"normal mouse mode",!0);break;case "/expand":a.j.la&&
a.j.ma?k=!0:(Z(a,"selection required"),k=!1);k&&("vert"===h[0]?(d.la[1]=0,d.ma[1]=63,Z(a,"selection expanded",!0)):Z(a,"only vert supported"));break;case "/pos1":case "/pos2":bc(a,[K(d.J),K(d.K),K(d.L)],"/pos2"===g);break;case "/regen":d=f.Y[f.Ca[f.na=0].ab];N.removeItem(Nb(f,d.ya,d.Ma,d.y));d.ha=!1;++d.ya;xb(f,!1);Z(a,"regenerate chunk",!0);a.B.T=!0;break;case "/show":Z(a,`first: ${d.la?d.la.join(" "):"none"}, second: ${d.ma?d.ma.join(" "):"none"}`);break;case "/wand":d.Ha=1;Z(a,"primary+secondary button for selection",
!0);break;default:Z(a,"unknown command: "+g)}}else Z(a,`<${d.name}> `+h);e.value=""}else 27===d&&(a.A=!1,a.l=0)},R:e=>{c.input=e;$a(()=>e.focus(),0)}}))]}const nc=[["pick",-2],["up",-14],["down",-15],["E",69],["T",84],["F1",112],["F3",114],["...",27]],oc=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]],pc=[["up",-16],["down",-17],["left",-18],["right",-19],["center",-3]];
function qc({o:a}){const b=a.U,c=([e,d])=>D("div",{D:{code:d},F:{button:!0,[e]:!0,active:b.has(d)}});w("div[className=touch]",A({ontouchstart:e=>{e.preventDefault();const d=Number(e.target.dataset.code);if(null!=d&&U(a,d,!0)){const h=e.changedTouches[0].identifier,k=f=>{f.changedTouches[0].identifier===h&&(removeEventListener("touchend",k),U(a,d,!1))};addEventListener("touchend",k)}}}));return[D("div[className=top]",null,nc.map(([e,d])=>D(`div[innerText=${e}]`,{D:{code:d},F:{button:!0,active:b.has(d)}}))),
D("div[className=move]",null,oc.map(c)),D("div[className=move sec]",null,pc.map(c))]}
function rc({actions:a,u:b,frame:c,Va:e,xa:d}){const h=va(),k=xa.pointerLockElement===c,f=ka(()=>e.o=Vb(a,c,b));z(()=>{const g=q=>{if(0!==f.l)return!0;f.pa=!1;xa.pointerLockElement===c?U(f,-1-q.button,"mousedown"===q.type):Ub(f);q.preventDefault();return!1},l=q=>{if(f.g.A)f.cb=q.clientX,f.eb=q.clientY;else{const t=f.u.qa*ya/M(f.Wa,f.Xa);mb(f.j,q.movementX*t,-q.movementY*t)}},m=q=>{f.pa=!1;if(0===f.l&&!f.g.A&&5<Math.abs(q.deltaY)){const t=0<q.deltaY?-5:-4;U(f,t,!0);U(f,t,!1);q.preventDefault()}},n=
q=>{f.pa=!0;0===f.l&&(f.g.A=!1,q.preventDefault())};c.addEventListener("mousedown",g);c.addEventListener("mouseup",g);c.addEventListener("mousemove",l);c.addEventListener("wheel",m);c.addEventListener("touchstart",n);return()=>{c.removeEventListener("mousedown",g);c.removeEventListener("mouseup",g);c.removeEventListener("mousemove",l);c.removeEventListener("wheel",m);c.removeEventListener("touchstart",n);cb(f.pb);Lb(f.g,f.j);cb(f.B.mb);e.o=null}});z(()=>{f.u=b;f.B&&(f.B.T=!0);const g=f.g;var l=Ga(La(f.u.da/
16*2+2));if(g.M!==l){var m=f.j;g.Y&&Lb(g,m);const n=1<<(g.M=l),q=g.Y=[];for(let t=0;t<n;++t)for(let x=0;x<n;++x)for(let u=0;4>u;++u)q.push({ha:!1,loaded:!1,x:t,y:u,z:x,ya:0,Ma:0});l=n<<l+12+2;null===g.X||g.X.length<l?g.Aa=new Ya((g.X=new Xa(l)).buffer):g.Aa.fill(0);Jb(g,m,!0)}},[b]);z((g,l,m)=>{f.Wa=M(1,g*m);f.Xa=M(1,l*m);l=f.u.$;g=M(1,Ha(f.Wa/l));l=M(1,Ha(f.Xa/l));if(g!==f.Ia||l!==f.Ja)f.Ia=g,f.Ja=l,f.B&&(f.B.T=!0,Rb(f.B))},[c.offsetWidth,c.offsetHeight,wa.devicePixelRatio||1,b.$]);z(()=>{k||f.g.A||
0!==f.l||(f.l=1);f.g.A=!k},[k]);z(g=>k&&g&&xa.exitPointerLock(),[f.g.A||0!==f.l]);z(()=>{if(f.g){if(f.Z&&!f.g.A){var g=f.j,l=L(5,.01*(h-f.Z));g.aa-=.1*g.aa*l;g.ba-=.1*g.ba*l;g.ca-=.1*g.ca*l;g.aa+=(Ia(g.O)*g.Na+Ja(g.O)*g.Oa)*l;g.ba+=g.Ya*l;g.ca+=(-Ja(g.O)*g.Na+Ia(g.O)*g.Oa)*l;mb(g,g.jb*l,g.kb*l);g.J+=g.aa*l;g.K+=g.ba*l;g.L+=g.ca*l}if(f.B){g=f.B;++g.Ta;l=g.Pa;var m=g.$a;const V=g.o,pa=V.u,Ra=V.oa,r=V.j,P=V.Ia,T=V.Ja,E=V.g;if(!E.A||g.T){g.T=!1;const ca=m.data,sc=pa.da;var n=r.O,q=r.ea;const tc=r.fa,
uc=r.ga;var t=r.J,x=r.K,u=r.L;const vc=Ra?r.W:-1,wc=E.X;var y=E.M;const xc=pa.ia&&null!==Ob;var v=1/P,J=1/T;const da=P>>1,ea=T>>1,yb=L(P,T),zb=32<yb,Ab=Ia(n);n=Ja(n);const Bb=Ia(-q);q=Ja(-q);var fa=pa.wa/45;const yc=v*(P<T?fa*P*J:fa);v=J*(T<P?fa*T*v:fa);t+=65536;x+=65536;u+=65536;J=t%1;fa=x%1;const zc=u%1;y=4+y;const Cb=(1<<y)-1;let Db=1===r.G?6:4,W=r.fa=r.ga=r.za=0;r.W=-1;for(let Ba=0;Ba<T;++Ba){var Ca=(ea-Ba)*v;const Eb=Ca*Bb-q;var Sa=Ca*q+Bb;Ca=Sa*n;Sa*=Ab;for(let Da=0;Da<P;++Da){var qa=(Da-da)*
yc;const Fb=Ca+Ab*qa;qa=Sa-n*qa;let ra=16757124,Ea=1,Gb=sc;for(let C=0;3>C;++C){let H=qa;0===C&&(H=Fb);1===C&&(H=Eb);var X=1/(0>H?-H:H);const Fa=Fb*X,Y=Eb*X;X*=qa;const Hb=Ka(Fa*Fa+Y*Y+X*X);var F=zc;0===C&&(F=J);1===C&&(F=fa);0<H&&(F=1-F);let sa=t+Fa*F-(0===C&0>H|0),ta=x+Y*F-(1===C&0>H|0),ua=u+X*F-(2===C&0>H|0);F*=Hb;for(let Ta,Ua,Va,I;F<Gb;sa+=Fa,ta+=Y,ua+=X,F+=Hb)if(65536>ta){if(0>Y)break}else if(65600<=ta){if(0<Y)break}else if(0!==(I=wc[((Ta=sa&Cb)<<y|(Va=ua&Cb))<<6|(Ua=ta&63)])){Ba===ea&&Da===
da&&F<=Db&&(r.fa=Ta,r.W=Ua,r.ga=Va,r.za=0>H|C<<1,Db=F);if(xc){--I;1===C?6===I?I=25:13===I?I=4:1===I&&0<Y&&(I=2):1===I&&(I=24);const Ib=Ob[I<<8|(16*(1===C?ua:ta)&15)<<4|16*(1===C?sa:(0<H?sa-ua:ua-sa)+65536)&15];if(0===Ib>>>24)continue;ra=Ib&16777215}else ra=hb[I];Gb=F;Ea=(0===C?.8:2===C?.6:0<H?.4:1)+(Ua!==vc||Ta!==tc||Va!==uc?0:.2);break}}ca[W]=(ra&255)*Ea;ca[++W]=(ra>>8&255)*Ea;ca[++W]=(ra>>16)*Ea;W+=2}}Ra&&!zb&&(ca[W=P*ea+da<<2]+=128,ca[++W]+=128,ca[++W]+=128);l.putImageData(m,0,0);Ra&&zb&&(m=Ga(.05*
yb),l.fillRect(da-m,ea-1,m<<1,2),l.fillRect(da-1,ea-m,2,m-1),l.fillRect(da-1,ea+1,2,m-1))}g.fb=V.Da?"Minicraft 0.8.1 "+K(g.gb).toString().padStart(2,"\u00a0")+" fps, T: "+K(24*E.Ka).toString().padStart(2,"0")+":"+K(24*E.Ka%1*60).toString().padStart(2,"0")+"; "+(E.A&&500>h%1E3?"":E.time)+"\nR: "+P+"x"+T+" (x"+pa.$+"), D: "+pa.da+", C: "+E.na+"/"+E.Ca.length+", M: "+(64*Q(1<<4+E.M)>>10)+"k\nE: 0/0 M: "+r.G+"\n\nPosition: "+r.J.toFixed(2)+" "+r.K.toFixed(2)+" "+r.L.toFixed(2)+"\nAngle: "+(r.O*Aa).toFixed(2)+
" "+(r.ea*Aa).toFixed(2)+"\nBlock: "+(0>r.W?0:r.fa+" "+r.W+" "+r.ga+" "+ib[r.za]+": "+tb(E,r.fa,r.W,r.ga))+"\nChunk abs: "+(K(r.J)>>4)+" "+(K(r.L)>>4)+" "+(K(r.K)>>4)+" rel: "+E.Ea+" "+E.Ga+" "+E.Fa:""}}f.Z=h},[h]);ma();return[D("canvas",{R:A(g=>{f.B=Sb(f,g)})}),f.oa&&2!==f.l&&B(jc,{V:f.V,ka:h}),f.B&&f.Da&&D("div[className=diagnostics]",{innerText:f.B.fb}),f.pa&&B(qc,{o:f,Ua:f.Ua}),f.oa&&3!==f.l&&2!==f.j.G&&B(fc,{j:f.j,ka:h}),3===f.l&&B(hc,{o:f,ka:h}),1===f.l&&B(kc,{actions:a,u:b,o:f,xa:d}),2===f.l&&
B(mc,{o:f,V:f.V})]}function Ac({I:a,qb:b,rb:c}){w("div",{F:{selected:a===b},onclick:()=>{c(a.id)}});return[D("span",{innerText:`${a.local?"":"\ud83c\udf10 "}${a.label}`,title:a.local?"":"Besitzer: "+a.account_name}),D("span",{innerText:a.local?"":eb(a.modified)})]}
function Bc({actions:a,xa:b}){w("div[className=menu]");const [c,e]=na(0),d=ja(()=>aa(function*(){const m=yield fetch("/api/minicraft/world?what=meta_all");return m.ok?yield m.json():null}()),[c],null),h=A({value:null}),k=ka(()=>{d&&(h.value=d);const m=[];h.value&&m.push(...h.value.map(n=>({account_name:n.account_name,id:-1-n.id,label:n.label,local:!1,modified:n.modified})));m.sort((n,q)=>q.modified-n.modified);m.unshift({account_name:"",id:0,label:"Lokale Welt",local:!0,modified:0});return m},[d]),
[f,g]=na(null),l=ka(m=>null!==m&&k.find(n=>n.id===m)||null,[f,k]);return[D("h1[innerText=Welten]"),D("div[className=worlds]",null,[oa(Ac,k,{qb:l,rb:g})]),D("center",null,[D("button[innerText=\u00d6ffnen]",{disabled:!l||!l.local,onclick:()=>{ba();a.Ra({La:l.id});b(1);ha()}}),D("button",{disabled:!d,innerText:"Aktualisieren",onclick:()=>{e(c+1)}})]),D("hr"),D("center",null,[D("button[innerText=Projektseite]",{onclick:()=>{open("//github.com/L3P3/minicraft")}})]),D("center",null,[D("small[innerText=Version 0.8.1 von L3P3]")])]}
function Cc({actions:a,u:b,Va:c}){const [e,d]=na(0),h=w("div[className=game]");return[0===e&&B(Bc,{actions:a,u:b,xa:d}),1===e&&B(rc,{actions:a,u:b,frame:h,Va:c,xa:d})]}
p.init(()=>{const [a,b]=la(fb),c=A({o:null});z(()=>{let d=!1;onbeforeunload=onunload=onpagehide=onblur=()=>{if(!d&&(d=!0,b.Qa(),c.o)){var h=c.o;Lb(h.g,h.j)}};onpageshow=onfocus=()=>{d=!1}});const e=A(d=>{if("INPUT"===d.target.tagName||!c.o)return!0;c.o.pa=!1;U(c.o,d.keyCode,"keydown"===d.type);d.preventDefault();return!1});return[{onkeydown:e,onkeyup:e,oncontextmenu:db,ondragstart:db},[B(Cc,{actions:b,u:a.u,Va:c})]]});
