function da(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function h(k){k.done?d(k.value):Promise.resolve(k.value).then(b,c).then(h,e)}h(a.next())})}
const r=lui,ea=r.defer,fa=r.defer_end,ha=r.dom_define,ia=r.hook_async,A=r.hook_dom,C=r.hook_effect,ma=r.hook_memo,na=r.hook_model,oa=r.hook_rerender,pa=r.hook_state,D=r.hook_static,E=r.node,G=r.node_dom,qa=r.node_map,ra=r.now,sa=window,ya=document,I=Math,za=I.PI,Aa=.5*za,Ba=180/za,K=I.floor,Ca=I.ceil,Da=I.round,N=I.min,Ea=I.max,Fa=I.cos,Ka=I.sin,La=I.sqrt,Ma=I.log2,Na=String.fromCharCode,Oa=Date,Pa=JSON,Qa=Pa.stringify,Ra=Pa.parse,O=localStorage,Sa=O.setItem.bind(O),Ta=O.removeItem.bind(O),Ua=Uint8Array,
Va=Uint32Array,Wa=Map,P=Number,Xa=Object,Ya=Xa.keys,cb=Xa.entries,db=setTimeout,eb=setInterval,fb=clearInterval,R=a=>a*a,gb=()=>!1,hb=a=>{var b=new Oa;a=new Oa(a);var c=b-a;if(59E3>c)return Da(c/1E3)+"s";if(3E6>c)return Da(c/6E4)+"m";c=a.getFullYear();const d=a.getMonth(),e=a.getDate();let h="";c<b.getFullYear()&&(h=c+"/");if(h||d<b.getMonth())h+=d+1+"/";if(h||e<b.getDate())h+=e+"/";b=h+a.getHours()+":";a=a.getMinutes();a=K(a).toString().padStart(2,"0");return b+a},ib={init:()=>{let a=!1;const b=
{ja:!0,sa:3,W:4,Aa:120,ea:64,Ca:0,N:[]};var c=O.getItem("minicraft.config");if(c){c=Ra(c);let d=c.flag_textures;null!=d&&(b.ja=d);null!=(d=c.mouse_sensitivity)&&(b.sa=d);b.W=c.resolution_scaling;b.Aa=c.view_angle;b.ea=c.view_distance;null!=(d=c.world_last)&&(b.Ca=d);null!=(d=c.worlds)?b.N=d:O.getItem("minicraft.world.0:meta")&&(b.N[0]={id:0,label:(prompt("Es wurde eine namenlose lokale Welt gefunden. Wie soll sie hei\u00dfen?","")||"Unbekannte Welt").substring(0,16),mod_l:Date.now(),mod_r:0},a=!0)}return a?
ib.Ua({g:b,Va:null}):{g:b,Va:b}},Ua:a=>{const b=a.g;if(b===a.Va)return a;Sa("minicraft.config",Qa({version:"0.9.3",flag_textures:b.ja,mouse_sensitivity:b.sa,resolution_scaling:b.W,view_angle:b.Aa,view_distance:b.ea,world_last:b.Ca,worlds:b.N}));return Object.assign({},a,{Va:b})},pb:(a,b)=>ib.Wa(a,b(a.g)),Wa:(a,b)=>Object.assign({},a,{g:Object.assign({},a.g,b)}),ab:(a,b)=>Object.assign({},a,{g:Object.assign({},a.g,{N:[...a.g.N,b]})}),nb:(a,b)=>Object.assign({},a,{g:Object.assign({},a.g,{N:a.g.N.filter(c=>
c.id!==b)})}),X:(a,b,c)=>Object.assign({},a,{g:Object.assign({},a.g,{N:a.g.N.map(d=>d.id===b?Object.assign({},d,c):d)})})},jb="air stone grass dirt cobble planks bedrock log leaves bricks wool sand gravel glass bookshelf obsidian stone_bricks sandstone lapis_block iron_block gold_block diamond_block emerald_block redstone_block quartz_block".split(" "),kb=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,1970708,8092539,9686227,9126695,
15198183,5567485,14541182,7920469,662956,14936813],lb="WEBTSN".split(""),S=(a,b=1,c=null)=>({amount:b,data:c,id:a}),mb=(a,b,c=a.content.amount)=>{if(b.content)a.content.id===b.content.id?(c=N(c,b.P-b.content.amount),a.content.amount-=c,b.content.amount+=c,0>=a.content.amount&&(a.content=null)):!(a.content.amount<=c&&a.content.amount<=b.P&&b.content.amount<=a.P)||a.filter&&!a.filter(b.content.id)||b.filter&&!b.filter(a.content.id)||([b.content,a.content]=[a.content,b.content]);else if(!b.filter||b.filter(a.content.id))a.content.amount<=
c&&a.content.amount<=b.P?[b.content,a.content]=[a.content,b.content]:(c=N(c,b.P),a.content.amount-=c,b.content=S(a.content.id,c),0>=a.content.amount&&(a.content=null))},nb=(a,b)=>{for(const c of a)if(c.content&&c.content.id===b.id){const d=N(b.amount,c.P-c.content.amount);c.content.amount+=d;if(0>=(b.amount-=d))return null}for(const c of a)if(!c.content&&(!c.filter||c.filter(b.id)))if(a=N(b.amount,c.P),a<=b.amount){if(c.content=S(b.id,a),0>=(b.amount-=a))return null}else return c.content=b,null;return b},
ob=a=>({Ra:0,bb:0,Sa:0,O:0,fa:0,Ea:0,ga:0,Y:-1,ha:0,na:null,oa:null,B:1,jb:20,G:Array(36).fill(null).map(()=>({content:null,filter:null,P:64})),Ma:0,name:"Gast",H:a.xa,J:a.ya,K:a.za,lb:0,mb:0,M:0,la:0,ba:0,ca:0,da:0}),pb=(a,b,c)=>{a.O=(a.O+b+100*za)%(2*za);a.fa=Ea(-Aa,N(Aa,a.fa+c))},qb=a=>{a+=32;33<a&&39>a?a++:38<a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Na(a)},rb=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),tb=()=>{var a=sb;const b=
a.length,c=new Wa,d=t=>{q=q<<1|t&1;15===++v&&(l+=qb(q),q=v=0)},e=()=>{for(let t=0;t<u;++t)d(0)},h=t=>{d(t);d(t>>1);d(t>>2);d(t>>3);d(t>>4);d(t>>5);d(t>>6);d(t>>7)},k=()=>{0===--n&&(n=1<<u++)},f=()=>{if(m)m=!1;else{let t=p.id;for(let z=0;z<u;z++)d(t>>z)}};let g=a[0],l="",q=0,v=2,u=2,n=2,w=2,p={id:w++,Ga:new Wa},m=!0;h(g);c.set(g,p);for(let t=1;t<b;++t){const z=p.Ga.get(g=a[t]);z?p=z:(f(),c.has(g)||(k(),e(),h(g),c.set(g,{id:w++,Ga:new Wa}),m=!0),p.Ga.set(g,{id:w++,Ga:new Wa}),p=c.get(g),k())}f();c.has(g)||
(k(),e(),h(g));k();d(1);--u;e();return l+=qb(q<<15-v)},ub=a=>{var b=sb;if(!a)return null;const c=a.length,d=()=>{v+=(w>>--p&1)<<u++;0===p&&(p=15,w=rb(a.charCodeAt(n++)))};let e=[0,1],h=1,k=3,f=2,g=null;var l=null;let q=0,v=0;l=2;let u=0,n=0,w=rb(a.charCodeAt(n++)),p=15;for(;u<l;)d();if(1===v)return null;for(v=u=0;8>u;)d();g=[v];e[2]=g;for(b[q++]=v;n<=c;){l=f;for(v=u=0;u<l;)d();if(0===v){for(v=u=0;8>u;)d();e[k]=[v];v=k++;0===--h&&(h=1<<f++)}else if(1===v)return b;l=v<e.length?e[v]:g.concat(g[0]);for(let m=
0;m<l.length;m++)b[q++]=l[m];e[k++]=g.concat(l[0]);g=l;0===--h&&(h=1<<f++)}return null},W=new Va(1024),sb=new Ua(W.buffer),vb=new Wa,wb=(a,b,c,d)=>0>c||63<c?0:a.Z[(b<<a.L+4|d)<<6|c],xb=(a,b,c,d)=>{const e=a.L;a.Z[(b<<e+4|d)<<6|c]=0;a.$[(b>>4<<e|d>>4)<<2|c>>4].ia=!0},yb=(a,b,c,d,e)=>{const h=a.L,k=(b<<h+4|d)<<6|c;if(0<a.Z[k])return!1;a.Z[k]=e;return a.$[(b>>4<<h|d>>4)<<2|c>>4].ia=!0},Bb=(a,b,c)=>{const d=Ea(N(b.J,63),0)>>4,e=K(b.H)>>4;b=K(b.K)>>4;if(c||a.Ka!==d||a.ta+a.Ja!==e||a.ua+a.La!==b)c=1<<a.L,
a.Ka=d,a.ta=e-(a.Ja=(65536+e)%c),a.ua=b-(a.La=(65536+b)%c),zb(a);Ab(a,!1)},zb=a=>{const b=a.Ja,c=a.Ka,d=a.La,e=a.L,h=`${e} ${b} ${d} ${c}`;let k=vb.get(h);if(null==k){const f=1<<e,g=R(.5*f);vb.set(h,k=a.$.map(({x:l,y:q,z:v},u)=>{let n=R(l-b),w=R(v-d),p=R(l-b-f),m=0,t=0;p<n&&(n=p,m=-f);(p=R(l-b+f))<n&&(n=p,m=f);(p=R(v-d-f))<w&&(w=p,t=-f);(p=R(v-d+f))<w&&(w=p,t=f);return{Xa:n+w+R(q-c),eb:u,ta:m,ua:t}}).filter(({Xa:l})=>l<=g).sort((l,q)=>l.Xa-q.Xa))}a.Ha=k;a.pa=0},Ob=(a,b)=>{for(var c of a.$)c.ia&&Cb(a,
c);for(c=b.G.map(({content:d})=>d&&[d.id,d.amount,d.data]);0<c.length&&null===c[c.length-1];)c.pop();Sa(`minicraft.world.${a.id}:meta`,Qa({p:{h:b.jb,i:c,m:b.B,p:[b.H,b.J,b.K,b.O,b.fa]},s:[a.xa,a.ya,a.za],v:1}))},Pb=(a,b)=>{const c=O.getItem(`minicraft.world.${a.id}:meta`);if(c){const {p:d,s:e,v:h}=Ra(c);null!=h&&(d.i.forEach((k,f)=>{k&&(b.G[f].content=S(k[0],k[1],k[2]))}),b.jb=d.h,b.B=d.m,b.H=d.p[0],b.J=d.p[1],b.K=d.p[2],b.O=d.p[3],b.fa=d.p[4],a.xa=e[0],a.ya=e[1],a.za=e[2])}},Qb=(a,b,c,d)=>`minicraft.world.${a.id}:${b}/${c}`+
(0<d?"/"+d:""),Cb=(a,b)=>{const c=a.Fa;var d=a.L;const e=b.y,h=(256<<d)-256;for(let k=0,f=-1,g=((b.x<<d+4|b.z)<<6|e)<<2;16>k;++k){for(d=0;16>d;++d)W[++f]=c[g],W[++f]=c[++g],W[++f]=c[++g],W[++f]=c[++g],g+=13;g+=h}Sa(Qb(a,b.Da,b.Qa,e),tb());b.ia=!1},Ab=(a,b)=>{const c=a.$,d=a.Ha,e=a.ta,h=a.ua,k=d.length;for(;a.pa<k;){var f=d[a.pa++],g=c[f.eb],l=g.loaded,q=g.x;const n=g.y;var v=g.z,u=e+f.ta+q;f=h+f.ua+v;if(!l||u!==g.Da||f!==g.Qa)if(g.ia&&Cb(a,g),g.loaded=!0,f=ub(O.getItem(Qb(a,g.Da=u,g.Qa=f,n))),l||
0===n||f){g=a.Fa;const w=a.L;u=(256<<w)-256;q=((q<<w+4|v)<<6|n)<<2;if(f)for(let p=0,m=-1;16>p;++p){for(l=0;16>l;++l)g[q]=W[++m],g[++q]=W[++m],g[++q]=W[++m],g[++q]=W[++m],q+=13;q+=u}else for(v=0;16>v;++v){for(f=0;16>f;++f)g[q]=0<n?0:50397446,g[++q]=0<n?0:131843,l?(g[++q]=0,g[++q]=0,q+=13):q+=15;q+=u}if(!b)break}}};let Rb=null,Sb=null,Tb=new Image;Tb.crossOrigin="anonymous";
Tb.onload=()=>{const a=ya.createElement("canvas");a.width=16;a.height=416;const b=a.getContext("2d");b.drawImage(Tb,0,0);ha("tile","div[className=bitmap]",{S:{backgroundImage:`url(${a.toDataURL()})`}});Rb=new Va(b.getImageData(0,0,16,416).data.buffer);Sb&&Sb();Tb=Sb=null};Tb.src=ASSETS+"blocks.webp";
const Vb=(a,b)=>{const c={ob:b,Ta:b.getContext("2d",{alpha:!1,desynchronized:!0}),cb:null,hb:"",T:!1,ib:0,Ya:0,qb:eb(()=>(c.ib=c.Ya,c.Ya=0),1E3),o:a};null===Rb&&(Sb=()=>c.T=!0);Ub(c);return c},Ub=a=>{const b=a.ob,c=a.o;(a.cb=a.Ta.createImageData(b.width=c.va,b.height=c.wa)).data.fill(255);const d=c.va*c.g.W/c.ka,e=c.wa*c.g.W/c.ka;b.style.width=d+"px";b.style.height=e+"px";b.style.left=Da((c.Na-d)/2)+"px";b.style.top=Da((c.Oa-e)/2)+"px";a.Ta.fillStyle="rgba(255,255,255,.5)"};let Wb=0;
const Yb=(a,b,c)=>{const d={Z:null,Fa:null,$:null,Ha:null,pa:0,u:!0,Ja:0,Ka:0,La:0,id:c.Ca,ta:0,ua:0,L:0,xa:.5,ya:8.5,za:.5,time:0,Pa:0},e=ob(d);Pb(d,e);a={actions:a,g:c,fb:0,gb:0,Ia:!1,qa:!0,ra:!1,rb:b,aa:0,U:new Set,Za:"",l:0,V:[],j:e,A:null,ka:1,Na:1,Oa:1,va:0,wa:0,tb:eb(()=>{d.u||(d.time=(d.time+1)%24E3,d.Pa=1/24E3*(d.Pa+6E3)%1,Bb(d,e,!1))},50),world:d};Xb(a);return a},Zb=a=>{Ob(a.world,a.j);a.actions.X(a.world.id,{mod_l:Date.now()})},Xb=a=>{da(function*(){try{yield a.rb.requestPointerLock()}catch(b){}}())},
$b=(a,b)=>a===b?0:.1-.2*a,ac=a=>{a.j.Ra=$b((a=a.U).has(-12)||a.has(65),a.has(-13)||a.has(68))},bc=a=>{a.j.bb=$b((a=a.U).has(-15)||a.has(16),a.has(-14)||a.has(32))},cc=a=>{a.j.Sa=$b((a=a.U).has(-11)||a.has(83),a.has(-10)||a.has(87))},dc=a=>{a.j.lb=$b(a.U.has(-18),a.U.has(-19))},ec=a=>{a.j.mb=$b(a.U.has(-17),a.U.has(-16))},X=(a,b,c)=>{if(!a.world)return!1;const d=a.U;var e=a.j;if(c){if(d.has(b))return!1;d.add(b);var h=e.ga,k=e.Y;c=e.ha;switch(b){case -18:case -19:dc(a);break;case -17:case -16:ec(a);
break;case -1:2!==e.B&&0<=k&&(0===e.Ma?0===e.B&&(b=wb(a.world,h,k,c),2===b?b=3:1===b&&(b=4),6===b||8!==b&&13!==b&&null!==nb(e.G,S(b,1)))||(xb(a.world,h,k,c),e.Y=-1):fc(a,[h,k,c],!1));break;case -2:case 71:if(0<=k){const f=wb(a.world,h,k,c);c=e.G.slice(0,9);k=c.findIndex(g=>null!==g.content&&g.content.id===f);0<=k?e.M=k:1===e.B&&(c[e.M].content&&(c=c.findIndex(g=>null===g.content),0<=c&&(e.M=c)),e.G[e.M].content=S(f));e.la=a.aa}break;case -3:if(2!==e.B&&0<=k)if(0===e.Ma){if(b=e.G[e.M],b.content){switch(e.Ea){case 0:--h;
break;case 1:++h;break;case 2:--k;break;case 3:++k;break;case 4:--c;break;default:++c}0<=k&&64>k&&yb(a.world,h&(1<<4+a.world.L)-1,k,c&(1<<4+a.world.L)-1,b.content.id)&&1!==e.B&&0>=--b.content.amount&&(b.content=null)}}else fc(a,[h,k,c],!0);break;case -4:e.M=(e.M+9-1)%9;e.la=a.aa;break;case -5:e.M=(e.M+1)%9;e.la=a.aa;break;case 27:0===a.l&&(a.world.u=!0,a.l=1);break;case -15:case -14:case 16:case 32:bc(a);break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:e.M=b-49;e.la=a.aa;
break;case -12:case -13:case 65:case 68:ac(a);break;case 69:if(2!==e.B&&0===a.l){a.l=3;for(const f of d)X(a,f,!1)}break;case 80:a.world&&(a.world.u=!a.world.u);break;case 81:e=e.G[e.M];if(d.has(17)||e.content&&0>=--e.content.amount)e.content=null;break;case -11:case -10:case 83:case 87:cc(a);break;case 84:if(0===a.l){a.l=2;for(const f of d)X(a,f,!1)}break;case 112:a.qa=!a.qa;break;case 114:a.Ia=!a.Ia;break;default:return!1}}else{if(!d.delete(b))return!1;switch(b){case -15:case -14:case 16:case 32:bc(a);
break;case -12:case -13:case 65:case 68:ac(a);break;case -11:case -10:case 83:case 87:cc(a);break;case -18:case -19:dc(a);break;case -17:case -16:ec(a)}}a.Za=[...d].join();return!0},gc=(a,b)=>(b=b.startsWith("~")?a+P(b.substr(1)):P(b),isNaN(b)?a:b),Z=(a,b,c=!1)=>{(a.V=a.V.slice(-49)).push({id:++Wb,kb:c,time:ra(),value:b})},fc=(a,b,c)=>{c?a.j.oa=b:a.j.na=b;Z(a,`${c?"second":"first"} position: ${b.join(" ")}`,!0)},hc=({id:a})=>(A("#tile",{S:{backgroundPositionY:`-${2*(a-1)}rem`}}),null);
function ic({amount:a,id:b}){A("div[className=stack]",{title:jb[b]});return[E(hc,{id:b}),1!==a&&G("div[className=amount]",{innerText:a})]}function jc({j:a,ma:b}){A("div[className=bar]",{ontouchstart:D(c=>{a.M=Number(c.target.closest("[data-slot]").dataset.slot);a.la=c.timeStamp}),S:{opacity:Ea(.5,N(1,1-5E-4*(b-a.la-5E3)))}});return Rb&&a.G.slice(0,9).map(({content:c},d)=>G("div",{D:{slot:d},F:{active:d===a.M}},[c&&E(ic,{amount:c.amount,data:c.data,id:c.id})]))}
function kc({sb:a}){A("div[className=grid]",{onclick:({target:b})=>{(b=b.closest("[data-id]"))&&mb({content:S(P(b.dataset.id)),filter:null,P:64},a)}});return jb.map((b,c)=>0<c&&G("div",{D:{id:c}},[E(ic,{id:c,amount:1,data:null})]))}
function lc({o:a}){const b=ma(()=>({content:null,filter:null,P:64}));A("div[className=menu overlay inventory]",ma(()=>({onclick:({target:c})=>{if("menu overlay inventory"===c.className)b.content?b.content=null:(a.l=0,a.world.u=!1,Xb(a));else if(c=c.closest("[data-slot]"))c=a.j.G[P(c.dataset.slot)],b.content?mb(b,c):c.content&&mb(c,b)},oncontextmenu:({target:c})=>{if("menu overlay inventory"===c.className)b.content?0>=--b.content.amount&&(b.content=null):(a.l=0,Xb(a));else if(c=c.closest("[data-slot]"))c=
a.j.G[P(c.dataset.slot)],b.content?mb(b,c,1):c.content&&mb(c,b,Ca(c.content.amount/2))}})));return Rb&&[G("div[className=window]",null,[G("div[innerText=Inventar]"),1===a.j.B&&E(kc,{sb:b}),G("div[className=grid]",null,a.j.G.map(({content:c},d)=>G("div",{D:{slot:d},F:{first:9>d}},[c&&E(ic,{id:c.id,amount:c.amount,data:c.data})])))]),b.content&&G("div[className=hand]",{S:{transform:`translate(${a.fb}px, ${a.gb}px)`}},[E(ic,{id:b.content.id,amount:b.content.amount,data:b.content.data})])]}
const mc=({I:{kb:a,time:b,value:c},ma:d})=>(A(a?"div[className=minor]":"div",{innerText:c,S:{opacity:N(1,1-.001*(d-b-4500))}}),null);function nc({V:a,ma:b}){A("div[className=messages]");const c=b-5E3;return[qa(mc,a.slice(-10).filter(d=>d.time>c),{ma:b})]}
function oc({actions:{pb:a,Wa:b},g:c,o:d,Ba:e}){C(()=>Zb(d));A("div[className=menu overlay]");return[G("h1[innerText=Einstellungen]"),D(G("center",null,[G("button[innerText=Zur\u00fcck zum Spiel]",{onclick:()=>{d.l=0;d.world.u=!1;Xb(d)}})])),G("div[className=settings]",null,[G("button",{innerText:"Oberfl\u00e4chen:\n"+(c.ja?"Texturiert":"Einfarbig"),onclick:D(()=>a(h=>({ja:!h.ja})))}),G("label[innerText=Aufl\u00f6sung:]",null,[G("input[type=range][min=1][max=100][step=1]",{value:101-c.W,onchange:D(h=>
b({W:101-Number(h.target.value)}))})]),G("label[innerText=Blickwinkel:]",null,[G("input[type=range][min=1][max=180][step=1]",{value:c.Aa,onchange:D(h=>b({Aa:Number(h.target.value)}))})]),G("label[innerText=Sichtweite:]",null,[G("input[type=range][min=1][max=128][step=1]",{value:c.ea,onchange:D(h=>b({ea:Number(h.target.value)}))})]),G("label[innerText=Mausempfindlichkeit:]",null,[G("input[type=range][min=1][max=15][step=1]",{value:c.sa,onchange:D(h=>b({sa:Number(h.target.value)}))})])]),D(G("center",
null,[G("button[innerText=Welt verlassen]",{onclick:()=>{e(0)}})]))]}const pc=({I:{kb:a,value:b}})=>(A(a?"div[className=minor]":"div",{innerText:b}),null);
function qc({o:a,V:b}){const c=D({history:null,input:null});A("div[className=menu overlay terminal]",{onclick:d=>{d.target!==c.input&&c.input.focus()}});C(d=>{d&&db(()=>c.history.scrollTop=1E9,0)},[b.length&&b[b.length-1].id]);return[D(G("div[className=toolbar]",null,[G("button[innerText=\u274c]",{onclick:()=>{a.l=0;a.world.u=!1;Xb(a)}})])),G("div[className=history]",{R:D(d=>{c.history=d})},[qa(pc,b)]),D(G("input[enterkeyhint=send][mozactionhint=send][name=message][required]",{onkeydown:d=>{var e=
d.keyCode;d=d.target;if(13===e){var h=d.value;e=a.j;const f=a.world;if(h)if("/"===h.charAt(0)){h=h.substr(1).split(" ");const g=h.shift();switch(g){case "clear":a.V=[];break;case "clearinv":for(var k of e.G)k.content=null;Z(a,"inventory cleared",!0);break;case "gamemode":case "gm":h=P(h[0]);!isNaN(h)&&0<=h&&3>h&&0===h%1?(e.B=h,Z(a,`gamemode set to ${h}`,!0)):Z(a,"gamemode must be in 0..2");break;case "give":if(0===h.length){Z(a,"/give <id> [amount]\n"+jb.join(" "));break}k=jb.indexOf((h[0]||"").toLowerCase());
k=0<=k?k:P(h[0]);h=P(h[1]||1);!isNaN(k)&&0<k&&25>k&&0===k%1?!isNaN(h)&&0<h&&0===h%1?Z(a,nb(e.G,S(k,h))?"inventory full":`gave ${h} ${jb[k]}`,!0):Z(a,"amount must be at least 1"):Z(a,"invalid block type");break;case "help":Z(a,"commands: clear, clearinv, gamemode, give, help, load, me, save, spawn, teleport, version");break;case "load":Ab(f,!0);a.A.T=!0;Z(a,"chunks loaded",!0);break;case "me":Z(a,e.name+" "+h.join(" "),!0);break;case "save":Zb(a);Z(a,"game saved",!0);break;case "smart":e.name="LFF5644";
Z(a,"lff.smart: true",!0);break;case "spawn":f.xa=e.H;f.ya=e.J;f.za=e.K;Z(a,"spawn updated",!0);break;case "teleport":case "tp":0===h.length?(e.H=f.xa,e.J=f.ya,e.K=f.za,a.A.T=!0,Z(a,"teleported to spawn",!0)):3===h.length?(Z(a,`teleported to ${e.H=gc(e.H,h[0])} ${e.J=gc(e.J,h[1])} ${e.K=gc(e.K,h[2])}`,!0),a.A.T=!0):Z(a,"PITCH");e.ba=0;e.ca=0;e.da=0;break;case "version":Z(a,"Minicraft 0.9.3");break;case "/exit":e.Ma=0;Z(a,"normal mouse mode",!0);break;case "/expand":a.j.na&&a.j.oa?k=!0:(Z(a,"selection required"),
k=!1);k&&("vert"===h[0]?(e.na[1]=0,e.oa[1]=63,Z(a,"selection expanded",!0)):Z(a,"only vert supported"));break;case "/pos1":case "/pos2":fc(a,[K(e.H),K(e.J),K(e.K)],"/pos2"===g);break;case "/regen":e=f.$[f.Ha[f.pa=0].eb];Ta(Qb(f,e.Da,e.Qa,e.y));e.ia=!1;++e.Da;Ab(f,!1);Z(a,"regenerate chunk",!0);a.A.T=!0;break;case "/show":Z(a,`first: ${e.na?e.na.join(" "):"none"}, second: ${e.oa?e.oa.join(" "):"none"}`);break;case "/wand":e.Ma=1;Z(a,"primary+secondary button for selection",!0);break;default:Z(a,"unknown command: "+
g)}}else Z(a,`<${e.name}> `+h);d.value=""}else 27===e&&(a.u=!1,a.l=0)},R:d=>{c.input=d;db(()=>d.focus(),0)}}))]}const rc=[["pick",-2],["up",-14],["down",-15],["E",69],["T",84],["F1",112],["F3",114],["...",27]],sc=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]],tc=[["up",-16],["down",-17],["left",-18],["right",-19],["center",-3]];
function uc({o:a}){const b=a.U,c=([d,e])=>G("div",{D:{code:e},F:{button:!0,[d]:!0,active:b.has(e)}});A("div[className=touch]",D({ontouchstart:d=>{d.preventDefault();const e=Number(d.target.dataset.code);if(null!=e&&X(a,e,!0)){const h=d.changedTouches[0].identifier,k=f=>{f.changedTouches[0].identifier===h&&(removeEventListener("touchend",k),X(a,e,!1))};addEventListener("touchend",k)}}}));return[G("div[className=top]",null,rc.map(([d,e])=>G(`div[innerText=${d}]`,{D:{code:e},F:{button:!0,active:b.has(e)}}))),
G("div[className=move]",null,sc.map(c)),G("div[className=move sec]",null,tc.map(c))]}
function vc({actions:a,g:b,frame:c,$a:d,Ba:e}){const h=ra(),k=ya.pointerLockElement===c,f=ma(()=>d.o=Yb(a,c,b));C(()=>{const g=u=>{if(0!==f.l)return!0;f.ra=!1;ya.pointerLockElement===c?X(f,-1-u.button,"mousedown"===u.type):Xb(f);u.preventDefault();return!1},l=u=>{if(f.world.u)f.fb=u.clientX,f.gb=u.clientY;else{const n=f.g.sa*za/(Ea(f.Na,f.Oa)*f.ka);pb(f.j,u.movementX*n,-u.movementY*n)}},q=u=>{f.ra=!1;if(0===f.l&&!f.world.u&&5<Math.abs(u.deltaY)){const n=0<u.deltaY?-5:-4;X(f,n,!0);X(f,n,!1);u.preventDefault()}},
v=u=>{f.ra=!0;0===f.l&&(f.world.u=!1,u.preventDefault())};c.addEventListener("mousedown",g);c.addEventListener("mouseup",g);c.addEventListener("mousemove",l);c.addEventListener("wheel",q);c.addEventListener("touchstart",v);return()=>{c.removeEventListener("mousedown",g);c.removeEventListener("mouseup",g);c.removeEventListener("mousemove",l);c.removeEventListener("wheel",q);c.removeEventListener("touchstart",v);fb(f.tb);Ob(f.world,f.j);fb(f.A.qb);d.o=null}});C(()=>{f.g=b;f.A&&(f.A.T=!0);const g=f.world;
var l=Ca(Ma(f.g.ea/16*2+2));if(g.L!==l){var q=f.j;g.$&&Ob(g,q);const v=1<<(g.L=l),u=g.$=[];for(let n=0;n<v;++n)for(let w=0;w<v;++w)for(let p=0;4>p;++p)u.push({ia:!1,loaded:!1,x:n,y:p,z:w,Da:0,Qa:0});l=v<<l+12+2;null===g.Z||g.Z.length<l?g.Fa=new Va((g.Z=new Ua(l)).buffer):g.Fa.fill(0);Bb(g,q,!0)}},[b]);C((g,l,q)=>{f.ka=q;f.Na=Ea(1,g);f.Oa=Ea(1,l);l=f.g.W;g=Ca(f.Na*f.ka/l);l=Ca(f.Oa*f.ka/l);if(g!==f.va||l!==f.wa)f.va=g,f.wa=l,f.A&&(f.A.T=!0,Ub(f.A))},[c.offsetWidth,c.offsetHeight,sa.devicePixelRatio||
1,b.W]);C(()=>{k||f.world.u||0!==f.l||(f.l=1);f.world.u=!k},[k]);C(g=>k&&g&&ya.exitPointerLock(),[f.world.u||0!==f.l]);C(()=>{if(f.world){if(f.aa&&!f.world.u){var g=f.j,l=N(5,.01*(h-f.aa));g.ba-=.1*g.ba*l;g.ca-=.1*g.ca*l;g.da-=.1*g.da*l;g.ba+=(Fa(g.O)*g.Ra+Ka(g.O)*g.Sa)*l;g.ca+=g.bb*l;g.da+=(-Ka(g.O)*g.Ra+Fa(g.O)*g.Sa)*l;pb(g,g.lb*l,g.mb*l);g.H+=g.ba*l;g.J+=g.ca*l;g.K+=g.da*l}if(f.A){g=f.A;++g.Ya;l=g.Ta;var q=g.cb;const aa=g.o,ta=aa.g,Za=aa.qa,x=aa.j,T=aa.va,Y=aa.wa,H=aa.world;if(!H.u||g.T){g.T=!1;
const ja=q.data,wc=ta.ea;var v=x.O,u=x.fa;const xc=x.ga,yc=x.ha;var n=x.H,w=x.J,p=x.K;const zc=Za?x.Y:-1,Ac=H.Z;var m=H.L;const Bc=ta.ja&&null!==Rb;var t=1/T,z=1/Y;const ka=T>>1,la=Y>>1,Db=N(T,Y),Eb=32<Db,Fb=Fa(v);v=Ka(v);const Gb=Fa(-u);u=Ka(-u);var B=ta.Aa/45;const Cc=t*(T<Y?B*T*z:B);t=z*(Y<T?B*Y*t:B);n+=65536;w+=65536;p+=65536;z=n%1;B=w%1;const Dc=p%1;m=4+m;const Hb=(1<<m)-1;let Ib=1===x.B?6:4,ba=x.ga=x.ha=x.Ea=0;x.Y=-1;for(let Ga=0;Ga<Y;++Ga){var y=(la-Ga)*t;const Jb=y*Gb-u;var U=y*u+Gb;y=U*v;
U*=Fb;for(let Ha=0;Ha<T;++Ha){var Q=(Ha-ka)*Cc;const Kb=y+Fb*Q;Q=U-v*Q;let ua=16757124,Ia=1,Lb=wc;for(let F=0;3>F;++F){let L=Q;0===F&&(L=Kb);1===F&&(L=Jb);var V=1/(0>L?-L:L);const Ja=Kb*V,ca=Jb*V;V*=Q;const Mb=La(Ja*Ja+ca*ca+V*V);var J=Dc;0===F&&(J=z);1===F&&(J=B);0<L&&(J=1-J);let va=n+Ja*J-(0===F&0>L|0),wa=w+ca*J-(1===F&0>L|0),xa=p+V*J-(2===F&0>L|0);J*=Mb;for(let $a,ab,bb,M;J<Lb;va+=Ja,wa+=ca,xa+=V,J+=Mb)if(65536>wa){if(0>ca)break}else if(65600<=wa){if(0<ca)break}else if(0!==(M=Ac[(($a=va&Hb)<<m|
(bb=xa&Hb))<<6|(ab=wa&63)])){Ga===la&&Ha===ka&&J<=Ib&&(x.ga=$a,x.Y=ab,x.ha=bb,x.Ea=0>L|F<<1,Ib=J);if(Bc){--M;1===F?6===M?M=25:13===M?M=4:1===M&&0<ca&&(M=2):1===M&&(M=24);const Nb=Rb[M<<8|(16*(1===F?xa:wa)&15)<<4|16*(1===F?va:(0<L?va-xa:xa-va)+65536)&15];if(0===Nb>>>24)continue;ua=Nb&16777215}else ua=kb[M];Lb=J;Ia=(0===F?.8:2===F?.6:0<L?.4:1)+(ab!==zc||$a!==xc||bb!==yc?0:.2);break}}ja[ba]=(ua&255)*Ia;ja[++ba]=(ua>>8&255)*Ia;ja[++ba]=(ua>>16)*Ia;ba+=2}}Za&&!Eb&&(ja[ba=T*la+ka<<2]+=128,ja[++ba]+=128,
ja[++ba]+=128);l.putImageData(q,0,0);Za&&Eb&&(q=Ca(.05*Db),l.fillRect(ka-q,la-1,q<<1,2),l.fillRect(ka-1,la-q,2,q-1),l.fillRect(ka-1,la+1,2,q-1))}g.hb=aa.Ia?"Minicraft 0.9.3 "+K(g.ib).toString().padStart(2,"\u00a0")+" fps, T: "+K(24*H.Pa).toString().padStart(2,"0")+":"+K(24*H.Pa%1*60).toString().padStart(2,"0")+"; "+(H.u&&500>h%1E3?"":H.time)+"\nR: "+T+"x"+Y+" (x"+ta.W+"), D: "+ta.ea+", C: "+H.pa+"/"+H.Ha.length+", M: "+(64*R(1<<4+H.L)>>10)+"k\nE: 0/0 M: "+x.B+"\n\nPosition: "+x.H.toFixed(2)+" "+x.J.toFixed(2)+
" "+x.K.toFixed(2)+"\nAngle: "+(x.O*Ba).toFixed(2)+" "+(x.fa*Ba).toFixed(2)+"\nBlock: "+(0>x.Y?0:x.ga+" "+x.Y+" "+x.ha+" "+lb[x.Ea]+": "+wb(H,x.ga,x.Y,x.ha))+"\nChunk abs: "+(K(x.H)>>4)+" "+(K(x.K)>>4)+" "+(K(x.J)>>4)+" rel: "+H.Ja+" "+H.La+" "+H.Ka:""}}f.aa=h},[h]);oa();return[G("canvas",{R:D(g=>{f.A=Vb(f,g)})}),f.qa&&2!==f.l&&E(nc,{V:f.V,ma:h}),f.A&&f.Ia&&G("div[className=diagnostics]",{innerText:f.A.hb}),f.ra&&E(uc,{o:f,Za:f.Za}),f.qa&&3!==f.l&&2!==f.j.B&&E(jc,{j:f.j,ma:h}),3===f.l&&E(lc,{o:f,
ma:h}),1===f.l&&E(oc,{actions:a,g:b,o:f,Ba:e}),2===f.l&&E(qc,{o:f,V:f.V})]}function Ec({I:a,ub:b,vb:c,wb:d}){A("div",{F:{selected:a===c},onclick:()=>{d(a.id)}});c=`${a.local?"L":"_"}${a.local&&a.remote?a.local>a.remote?">":a.local<a.remote?"<":"=":"_"}${a.remote?"R":"_"}`;b===a.id&&(c=`[${c}]`);return[G("span",{innerText:`${c} ${a.label}`,title:a.account_name?"Nutzer: "+a.account_name:"Nur lokale Welt"}),G("span",{innerText:hb(Math.max(a.local,a.remote))})]}
function Fc({actions:a,g:b,Ba:c}){A("div[className=menu]");const [d,e,h]=pa(0),k=D(()=>{e(h()+1)}),f=ia(()=>da(function*(){try{const p=yield fetch("/api/minicraft/world?what=meta_all");if(!p.ok)throw Error("Verbindungsfehler.");return yield p.json()}catch(p){return alert("Fehler beim Laden der Weltliste: "+p.message),[]}}()),[d],null),g=D({value:null}),l=ma(()=>{f&&(g.value=f);const p=[];g.value&&p.push(...g.value.map(m=>({account_name:m.account_name,hash:m.hash,id:m.id,label:m.label,local:0,remote:m.modified,
writable:m.writable})));for(const m of b.N){const t=p.find(z=>z.id===m.id);if(t){const z=t.local=m.mod_l,B=t.remote,y=m.mod_r;z>y&&B>y&&(confirm(`Konflikt! Die Welt "${m.label}" wurde sowohl hier als auch woanders ge\u00e4ndert.\nOK: Die vom Server \u00fcbernehmen (${hb(B)}) | Abbrechen: Die hier hochladen (${hb(z)})`)?a.X(m.id,{mod_l:t.local=y}):a.X(m.id,{mod_r:t.remote=y}))}else 1<m.mod_r&&f&&f.length&&(alert(`Die Welt "${m.label}" wurde auf dem Server nicht gefunden, ist also jetzt eine lokale!`),
a.X(m.id,{mod_r:0})),p.push({account_name:"",hash:0,id:m.id,label:m.label,local:m.mod_l,remote:1===m.mod_r?1:0,writable:!0})}return p.sort((m,t)=>Math.max(t.local,t.remote)-Math.max(m.local,m.remote))},[f,b.N]),[q,v,u]=pa(b.Ca),n=ma(()=>l.find(p=>p.id===q)||null,[q,l]),w=ma(()=>{let p,m;return null!=(m=null==l?void 0:null==(p=l.find(t=>0<t.local&&0<t.remote&&t.local!==t.remote))?void 0:p.id)?m:null},[l]);C(()=>{if(null!==w){var p=!1,m=l.find(z=>z.id===w),t=`minicraft.world.${w}:`;if(m.local<m.remote)fetch("/static/minicraft/worlds/"+
`${m.hash}.json`).then(z=>z.json()).then(z=>{if(!p){for(const [B,y]of cb(z))Sa(t+B,y);Sa("__margin",Array(4097).join("x"));Ta("__margin");a.X(w,{mod_l:m.remote,mod_r:m.remote})}}).catch(z=>{if(!p)if("QuotaExceededError"===z.name){alert("Der Speicherplatz reicht nicht!");for(const B of Ya(O))B.startsWith(t)&&Ta(B);a.nb(w)}else alert("Fehler beim Herunterladen der Welt: "+z.message)});else{if(!m.writable){a.X(w,{mod_l:b.N.find(y=>y.id===w).mod_r});return}const z=t.length;let B=w;(1===m.remote?fetch("/api/minicraft/world",
{method:"POST",headers:{"Content-Type":"application/json"},body:Qa({what:"meta",label:m.label})}).then(y=>{if(!y.ok)throw Error(403===y.status?"Keine Berechtigung. Angemeldet?":"Verbindungsfehler.");return y.json()}).then(y=>{B=y.id}):Promise.resolve()).then(()=>{if(p)throw null;const y={};for(const U of Ya(O))U.startsWith(t)&&(y[U.substr(z)]=O.getItem(U));return fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Qa({what:"data",world:B,data:y})})}).then(y=>
{if(!y.ok)throw Error(403===y.status?"Keine Berechtigung. Angemeldet?":"Verbindungsfehler.");return y.json()}).then(y=>{ea();if(B===w)a.X(w,{mod_l:y.modified,mod_r:y.modified});else{const U=`minicraft.world.${B}:`;for(const Q of Ya(O))if(Q.startsWith(t)){const V=O.getItem(Q);Ta(Q);Sa(U+Q.substr(z),V)}a.nb(w);a.ab({id:B,label:m.label,mod_l:y.modified,mod_r:y.modified});p||u()!==w||v(B)}p||k();fa()}).catch(y=>{p||(alert("Fehler beim Hochladen der Welt: "+y.message),ea(),a.X(w,{mod_r:0}),fa())})}return()=>
{p=!0}}},[w]);return[G("h1[innerText=Welten]"),G("div[className=worlds]",null,[qa(Ec,l,{xb:d,ub:w,vb:n,wb:v})]),G("center",null,[G("button[innerText=\u00d6ffnen]",{disabled:!n||!n.local||n.remote>n.local,onclick:()=>{ea();a.Wa({Ca:n.id});c(1);fa()},title:n?n.local?n.remote>n.local?"Die Welt wird noch geladen!":"Ausgew\u00e4hlte Welt betreten":"Die Welt ist noch nicht heruntergeladen!":"Keine Welt ausgew\u00e4hlt!"}),G("button",{disabled:!f||!n||0<n.local&&0<n.remote,innerText:n&&!n.local?"Herunterladen":
f&&n&&!n.remote?"Hochladen":"\u00dcbertragen",onclick:()=>{n.local?n.remote||a.X(n.id,{mod_r:1}):a.ab({id:n.id,label:n.label,mod_l:1,mod_r:n.remote})},title:f?n?n.local?n.remote?"Die Welt ist schon auf beiden Seiten vorhanden!":"Welt auf den Server hochladen":"Welt von Server herunterladen":"Keine Welt ausgew\u00e4hlt!":"Liste wird noch geladen!"}),G("button[innerText=Aktualisieren][title=Liste neu laden]",{disabled:!f,onclick:k})]),G("hr"),G("center",null,[G("button[innerText=Neue Welt]",{onclick:()=>
{const p=prompt("Name der neuen Welt:\n(max. 16 Zeichen)","Neue Welt");p&&(16<p.length?alert("Der Name ist zu lang!"):a.ab({id:Math.min(0,...b.N.map(m=>m.id))-1,label:p,mod_l:Date.now(),mod_r:0}))}}),G("button[innerText=Projektseite]",{onclick:()=>{open("//github.com/L3P3/minicraft")}})]),G("center",null,[G("small[innerText=Version 0.9.3 von L3P3]")])]}
function Gc({actions:a,g:b,$a:c}){const [d,e]=pa(0),h=A("div[className=game]");return[0===d&&E(Fc,{actions:a,g:b,Ba:e}),1===d&&E(vc,{actions:a,g:b,frame:h,$a:c,Ba:e})]}
r.init(()=>{const [a,b]=na(ib),c=D({o:null});C(()=>{let e=!1;onbeforeunload=onunload=onpagehide=onblur=()=>{e||(e=!0,c.o&&Zb(c.o),b.Ua())};onpageshow=onfocus=()=>{e=!1};setInterval(()=>{b.Ua()},500)});const d=D(e=>{if("INPUT"===e.target.tagName||!c.o)return!0;c.o.ra=!1;X(c.o,e.keyCode,"keydown"===e.type);e.preventDefault();return!1});return[{onkeydown:d,onkeyup:d,oncontextmenu:gb,ondragstart:gb},[E(Gc,{actions:b,g:a.g,$a:c})]]});
