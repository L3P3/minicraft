const t=lui,da=t.hook_callback,A=t.hook_dom,B=t.hook_effect,ea=t.hook_memo,fa=t.hook_reducer,ha=t.hook_rerender,G=t.hook_static,ia=t.node,I=t.node_dom,ja=t.node_map,ka=t.now,la=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813],ra=la.length,sa="WEBTSN".split(""),ta=[6,1,1,3,3,3,2],ua=ta.length,va=window,wa=document,J=Math,P=J.PI,xa=.5*P,Ca=180/P,W=J.floor,
Da=J.ceil,Ea=J.round,Fa=J.min,X=J.max,Ga=J.cos,Ha=J.sin,Ia=J.sqrt,Ja=String.fromCharCode,Ka=JSON,La=localStorage,Ma=Uint8Array,Na=Uint32Array,Y=Map,Oa=setTimeout,Pa=setInterval,Qa=clearInterval,Ra=()=>!1,Sa=[()=>{const a={M:!0,Z:3,K:10,aa:80,L:64};var e=La.getItem("minicraft.config");if(e){e=Ka.parse(e);let d=e.flag_textures;null!=d&&(a.M=d);null!=(d=e.mouse_sensitivity)&&(a.Z=d);a.K=e.resolution_scaling;a.aa=e.view_angle;a.L=e.view_distance}return{m:a}},a=>{const e=a.m;La.setItem("minicraft.config",
Ka.stringify({version:"0.4.9",flag_textures:e.M,mouse_sensitivity:e.Z,resolution_scaling:e.K,view_angle:e.aa,view_distance:e.L}));return a},(a,e)=>Object.assign({},a,{m:Object.assign({},a.m,e)})],Ta=a=>{a+=32;33<a&&39>a?a++:38<a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Ja(a)},Ua=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),Wa=()=>{var a=Va;const e=a.length,d=new Y,b=r=>{n=n<<1|r&1;15===++m&&(l+=Ta(n),n=m=0)},h=()=>{for(let r=0;r<q;++r)b(0)},
k=r=>{b(r);b(r>>1);b(r>>2);b(r>>3);b(r>>4);b(r>>5);b(r>>6);b(r>>7)},g=()=>{0===--u&&(u=1<<q++)},c=()=>{if(C)C=!1;else{let r=w.id;for(let F=0;F<q;F++)b(r>>F)}};let f=a[0],l="",n=0,m=2,q=2,u=2,x=2,w={id:x++,da:new Y},C=!0;k(f);d.set(f,w);for(let r=1;r<e;++r){const F=w.da.get(f=a[r]);F?w=F:(c(),d.has(f)||(g(),h(),k(f),d.set(f,{id:x++,da:new Y}),C=!0),w.da.set(f,{id:x++,da:new Y}),w=d.get(f),g())}c();d.has(f)||(g(),h(),k(f));g();b(1);--q;h();return l+=Ta(n<<15-m)},Xa=a=>{var e=Va;if(!a)return null;const d=
a.length,b=()=>{m+=(x>>--w&1)<<q++;0===w&&(w=15,x=Ua(a.charCodeAt(u++)))};let h=[0,1],k=1,g=3,c=2,f=null;var l=null;let n=0,m=0;l=2;let q=0,u=0,x=Ua(a.charCodeAt(u++)),w=15;for(;q<l;)b();if(1===m)return null;for(m=q=0;8>q;)b();f=[m];h[2]=f;for(e[n++]=m;u<=d;){l=c;for(m=q=0;q<l;)b();if(0===m){for(m=q=0;8>q;)b();h[g]=[m];m=g++;0===--k&&(k=1<<c++)}else if(1===m)return e;l=m<h.length?h[m]:f.concat(f[0]);for(let C=0;C<l.length;C++)e[n++]=l[C];h[g++]=f.concat(l[0]);f=l;0===--k&&(k=1<<c++)}return null},
Ya=new Na(4);for(let a=0;a<ua;++a)Ya[a>>2]|=ta[a]<<(a<<3);
const Za=new Na(1024),Va=new Ma(Za.buffer),kb=new Y,lb=(a,e,d,b,h)=>{const k=a.G[e>>4<<a.l|b>>4];a.W[(e<<a.l+4|b)<<4|d]=h;k.X=!0},mb=a=>{const e=a.ra,d=a.sa,b=a.l,h=`${b} ${e} ${d}`;let k=kb.get(h);if(null==k){const g=1<<b;kb.set(h,k=a.G.map(({x:c,z:f},l)=>{var n=c-e;n*=n;var m=f-d;m*=m;var q=c-e-g;let u=q*q,x=q=0;u<n&&(n=u,q=-g);c=c-e+g;(u=c*c)<n&&(n=u,q=g);c=f-d-g;(u=c*c)<m&&(m=u,x=-g);f=f-d+g;(u=f*f)<m&&(m=u,x=g);return{Ea:Ia(n+m),Ma:l,O:q,P:x}}).sort((c,f)=>c.Ea-f.Ea))}a.pa=k;a.ea=0},nb=(a,e)=>
{const d=a.ma,b=e.x<<4,h=e.z<<4;for(let k=0,g=0;16>k;++k){const c=(b+k<<a.l+4|h)<<2;Za.set(d.subarray(c,c+64),g);g+=64}La.setItem(`minicraft.world.${a.id}:${e.za}/${e.Aa}`,Wa());e.X=!1},ob=a=>{var e=a.G,d=a.pa,b=a.O,h=a.P;const k=d.length;for(;a.ea<k;){var g=d[a.ea++];const l=e[g.Ma];var c=l.x,f=l.z;const n=b+g.O+c;g=h+g.P+f;if(n!==l.za||g!==l.Aa){l.X&&nb(a,l);d=Xa(La.getItem(`minicraft.world.${a.id}:${l.za=n}/${l.Aa=g}`));e=a.ma;c<<=4;f<<=4;if(d)for(let m=0,q=0;16>m;++m)e.set(Za.subarray(q,q+=64),
(c+m<<a.l+4|f)<<2);else for(d=0;16>d;++d)for(b=(c+d<<a.l+4|f)<<2,h=0;16>h;++h)e.set(Ya,b),b+=4;break}}};let pb=null,Z=new Image;Z.crossOrigin="anonymous";Z.onload=()=>{var a=wa.createElement("canvas");a.width=256;a.height=26;a=a.getContext("2d");a.drawImage(Z,0,0);Z=null;pb=new Na(a.getImageData(0,0,256,26).data.buffer)};Z.src=ASSETS+"blocks.png";
const rb=(a,e)=>{const d={oa:e,na:null,Ca:null,Da:"",ga:!1,Fa:0,ta:0,Na:Pa(()=>(d.Fa=d.ta,d.ta=0),1E3),i:a};qb(d);return d},qb=a=>{var e=a.oa.width=a.i.ia,d=a.oa.height=a.i.ja;e=(a.Ca=(a.na=a.oa.getContext("2d")).createImageData(e,d)).data;a.na.fillStyle="rgba(255,255,255,.5)";a=e.length;for(d=3;d<a;d+=4)e[d]=255};let sb=0;
const tb=()=>{const a={W:null,ma:null,G:null,pa:null,ea:0,ra:0,sa:0,id:0,O:0,P:0,l:0,Ia:.5,Ja:ua+1.5,Ka:.5};return{m:null,fa:!1,h:!0,ha:!1,Ga:null,ua:0,Y:new Set,va:"",j:0,N:[],g:{ka:0,Ba:0,la:0,v:0,ba:0,ca:0,A:0,o:-1,B:0,Ha:9,H:a.Ia,$:a.Ja,J:a.Ka,T:0,U:0,V:0},u:null,wa:1,xa:1,ia:0,ja:0,La:null,time:0,ya:0,s:a}},ub=(a,e)=>{a.u=rb(a,e);a.La=Pa(()=>{if(!a.h){a.time=(a.time+1)%24E3;a.ya=1/24E3*(a.time+6E3)%1;var d=a.g,b=a.s,h=W(d.H)>>4;d=W(d.J)>>4;if(b.O+b.ra!==h||b.P+b.sa!==d){const k=1<<b.l;b.O=h-
(b.ra=(65536+h)%k);b.P=d-(b.sa=(65536+d)%k);mb(b)}ob(b)}},50)},vb=a=>{var e=a.g,d=(a=a.Y).has(-12)||a.has(65);a=a.has(-13)||a.has(68);e.ka=d===a?0:.1-.2*d},wb=a=>{var e=a.g,d=(a=a.Y).has(-15)||a.has(16);a=a.has(-14)||a.has(32);e.Ba=d===a?0:.1-.2*d},xb=a=>{var e=a.g,d=(a=a.Y).has(-11)||a.has(83);a=a.has(-10)||a.has(87);e.la=d===a?0:.1-.2*d},yb=(a,e,d)=>{const b=a.Y;if(d){if(b.has(e))return!1;b.add(e);d=!1;switch(e){case -1:0<=a.g.o&&lb(a.s,a.g.A,a.g.o,a.g.B,0);break;case -2:case 71:if(0<=a.g.o){var h=
a.s,k=a.g.o;a.g.Ha=0>k||16<=k?0:h.W[(a.g.A<<h.l+4|a.g.B)<<4|k]}break;case -3:if(0<=a.g.o){h=a.g.A;k=a.g.o;let g=a.g.B;switch(a.g.ca){case 0:--h;break;case 1:++h;break;case 2:--k;break;case 3:++k;break;case 4:--g;break;default:++g}0<=k&&16>k&&lb(a.s,h&(1<<4+a.s.l)-1,k,g&(1<<4+a.s.l)-1,a.g.Ha)}break;case 27:a.j?(a.h=!1,a.j=0):(a.h=!0,a.j=1);d=!0;break;case -15:case -14:case 16:case 32:wb(a);break;case -12:case -13:case 65:case 68:vb(a);break;case 80:a.h=!a.h;break;case 82:a.g.H=a.s.Ia;a.g.$=a.s.Ja;
a.g.J=a.s.Ka;break;case -11:case -10:case 83:case 87:xb(a);break;case 84:a.j||(a.j=2,d=!0);break;case 114:a.fa=!a.fa;break;default:return!1}d&&b.delete(e)}else{if(!b.delete(e))return!1;switch(e){case -15:case -14:case 16:case 32:wb(a);break;case -12:case -13:case 65:case 68:vb(a);break;case -11:case -10:case 83:case 87:xb(a)}}a.va=[...b].join();return!0},zb=(a,e)=>{a.N=[...a.N.slice(-30),{id:++sb,time:ka(),value:e}]};
function Ab({m:a,qa:e,i:d}){A("div[className=menu]");return[I("h1[innerText=Men\u00fc]"),I("div[className=settings]",null,[I("button",{innerText:"Oberfl\u00e4chen: "+(a.M?"Texturiert":"Einfarbig"),onclick:da(b=>{e(2,{M:!b})},[a.M])}),I("label[innerText=Aufl\u00f6sung:]",null,[I("input[type=range][min=1][max=100][step=1]",{value:101-a.K,onchange:G(b=>e(2,{K:101-Number(b.target.value)}))})]),I("label[innerText=Blickwinkel:]",null,[I("input[type=range][min=1][max=180][step=1]",{value:a.aa,onchange:G(b=>
e(2,{aa:Number(b.target.value)}))})]),I("label[innerText=Sichtweite:]",null,[I("input[type=range][min=1][max=128][step=1]",{value:a.L,onchange:G(b=>e(2,{L:Number(b.target.value)}))})]),I("label[innerText=Mausempfindlichkeit:]",null,[I("input[type=range][min=1][max=15][step=1]",{value:a.Z,onchange:G(b=>e(2,{Z:Number(b.target.value)}))})])]),I("center",null,[I("button[innerText=Zur\u00fcck]",{onclick:G(b=>(d.j=0,"mouse"===b.pointerType?d.Ga.requestPointerLock():d.h=!1))})])]}
const Bb=({I:{value:a}})=>(A("div",{innerText:a}),null);
function Cb({i:a,N:e}){A("div[className=menu terminal]");const d=G({history:null});B(b=>{b&&Oa(()=>d.history.scrollTop=1E9,0)},[e.length&&e[e.length-1].id]);return[I("div[className=history]",{R:G(b=>{d.history=b})},[ja(Bb,e)]),I("input[enterkeyhint=send][mozactionhint=send][name=message][required]",G({onkeydown:b=>{var h=b.keyCode;b=b.target;if(13===h){if(h=b.value)if("/"===h.charAt(0))switch(h=h.substr(1).split(" ").shift(),h){case "clear":a.N=[];break;case "exit":a.h=!1;a.j=0;break;case "help":zb(a,
"commands: clear, exit, help, version");break;case "version":zb(a,"Minicraft 0.4.9");break;default:zb(a,"unknown command: "+h)}else zb(a,"<me> "+h);b.value=""}else 27===h&&(a.h=!1,a.j=0)},R:b=>Oa(()=>b.focus(),0)}))]}const Db=[["place",-3],["pick",-2],["up",-14],["down",-15],["R",82],["T",84],["F3",114],["...",27]],Eb=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]];
function Fb({i:a}){const e=a.Y;A("div[className=touch]",G({ontouchstart:d=>{d.preventDefault();const b=Number(d.target.dataset.code);if(null!=b&&yb(a,b,!0)){const h=d.changedTouches[0].identifier,k=g=>{g.changedTouches[0].identifier===h&&(removeEventListener("touchend",k),yb(a,b,!1))};addEventListener("touchend",k)}}}));return[I("div[className=top]",null,Db.map(([d,b])=>I(`div[innerText=${d}]`,{D:{code:b},F:{button:!0,active:e.has(b)}}))),I("div[className=move]",null,Eb.map(([d,b])=>I("div",{D:{code:b},
F:{button:!0,[d]:!0,active:e.has(b)}})))]}
function Gb({m:a,qa:e,Oa:d}){const b=ea(tb),h=A("div[className=game]",ea(()=>{const g=c=>0!==b.j||(b.ha=!1,wa.pointerLockElement===h?b.h||yb(b,-1-c.button,"mousedown"===c.type):b.Ga.requestPointerLock(),c.preventDefault(),!1);return{onmousedown:g,onmousemove:c=>{if(!b.h&&!b.j){const f=b.m.Z*P/X(b.wa,b.xa);b.g.v=(b.g.v+c.movementX*f+100*P)%(2*P);b.g.ba=X(-xa,Fa(xa,b.g.ba-c.movementY*f))}},onmouseup:g,ontouchstart:c=>{b.ha=!0;b.j||(b.h=!1,c.preventDefault())}}})),k=wa.pointerLockElement===h;B(()=>(b.Ga=
h,d.i=b,()=>{Qa(b.La);Qa(b.u.Na);return d.i=null}));B(()=>{b.m=a;b.u&&(b.u.ga=!0);const g=b.s;var c=b.m.L;c=17>c?2:49>c?3:113>c?4:241>c?5:497>c?6:1009>c?7:2033>c?8:4081>c?9:8177>c?10:16369>c?11:32753>c?12:13;if(g.l!==c){if(g.G)for(var f of g.G)f.X&&nb(g,f);g.ma=new Na((g.W=new Ma(1<<12+(c<<1))).buffer);f=1<<(g.l=c);c=g.G=[];for(let l=0;l<f;++l)for(let n=0;n<f;++n)c.push({X:!1,x:l,z:n,za:g.O+l+1,Aa:g.P+n+1});mb(g);ob(g);for(f=1;f<ra;++f)lb(g,f%9,ua,W(f/9),f)}},[a]);B((g,c,f)=>{b.wa=X(1,g*f);b.xa=X(1,
c*f);c=b.m.K;g=X(1,Ea(b.wa/c));c=X(1,Ea(b.xa/c));if(g!==b.ia||c!==b.ja)b.ia=g,b.ja=c,b.u&&(b.u.ga=!0,qb(b.u))},[h.offsetWidth,h.offsetHeight,va.devicePixelRatio||1,a.K]);B(()=>{k||b.h||b.j||(b.j=1);b.h=!k},[k]);B(g=>k&&g&&wa.exitPointerLock(),[b.h||b.j]);B(g=>{if(b.ua&&!b.h){var c=b.g,f=Fa(5,.01*(g-b.ua));c.T-=.1*c.T*f;c.U-=.1*c.U*f;c.V-=.1*c.V*f;c.T+=(Ga(c.v)*c.ka+Ha(c.v)*c.la)*f;c.U+=c.Ba*f;c.V+=(-Ha(c.v)*c.ka+Ga(c.v)*c.la)*f;c.H+=c.T*f;c.$+=c.U*f;c.J+=c.V*f}if(b.u){c=b.u;++c.ta;var l=c.na,n=c.Ca;
f=c.i;const aa=f.m,p=f.g,H=f.ia,K=f.ja,L=f.s;if(!f.h||c.ga){c.ga=!1;const Q=n.data,Hb=aa.L;var m=p.v,q=p.ba;const Ib=p.A,Jb=p.o,Kb=p.B;var u=p.H,x=p.$,w=p.J;const Lb=L.W;var C=L.l;const Mb=aa.M&&null!==pb;var r=1/H,F=1/K,y=H>>1;const R=K>>1,$a=Fa(H,K),ab=32<$a,bb=Ga(m);m=Ha(m);const cb=Ga(-q);q=Ha(-q);var S=aa.aa/45;const Nb=r*(H<K?S*H*F:S);r=F*(K<H?S*K*r:S);u+=65536;x+=65536;w+=65536;F=u%1;S=x%1;const Ob=w%1;C=4+C;const db=(1<<C)-1;let eb=5,M=p.A=p.B=p.ca=0;p.o=-1;for(let ma=0;ma<K;++ma){var na=
(R-ma)*r;const fb=na*cb-q;var ya=na*q+cb;na=ya*m;ya*=bb;for(let oa=0;oa<H;++oa){var ba=(oa-y)*Nb;const gb=na+bb*ba;ba=ya-m*ba;let ca=16757124,pa=1,hb=Hb;for(let v=0;3>v;++v){let D=ba;0===v&&(D=gb);1===v&&(D=fb);var N=1/(0>D?-D:D);const qa=gb*N,O=fb*N;N*=ba;const ib=Ia(qa*qa+O*O+N*N);var z=Ob;0===v&&(z=F);1===v&&(z=S);0<D&&(z=1-z);let T=u+qa*z,U=x+O*z,V=w+N*z;z*=ib;0===v&&(T+=.5-(0>D|0));1===v&&(U+=.5-(0>D|0));2===v&&(V+=.5-(0>D|0));for(let za,Aa,Ba,E;z<hb;T+=qa,U+=O,V+=N,z+=ib)if(65536>U){if(0>O)break}else if(65552<=
U){if(0<O)break}else if(0!==(E=Lb[((za=T&db)<<C|(Ba=V&db))<<4|(Aa=U&15)])){ma===R&&oa===y&&z<=eb&&(p.A=za,p.o=Aa,p.B=Ba,p.ca=0>D|v<<1,eb=z);if(Mb){--E;1===v?6===E?E=25:13===E?E=4:1===E&&0<O&&(E=2):1===E&&(E=24);const jb=pb[E<<8|(16*(1===v?V:U)&15)<<4|16*(1===v?T:(0<D?T-V:V-T)+65536.5)&15];if(0===jb>>>24)continue;ca=jb&16777215}else ca=la[E];hb=z;pa=(0===v?.8:2===v?.6:0<D?.4:1)+(Aa!==Jb||za!==Ib||Ba!==Kb?0:.2);break}}Q[M]=(ca&255)*pa;Q[++M]=(ca>>8&255)*pa;Q[++M]=(ca>>16)*pa;M+=2}}ab||(Q[M=H*R+y<<2]+=
128,Q[++M]+=128,Q[++M]+=128);l.putImageData(n,0,0);ab&&(n=Da(.05*$a),l.fillRect(y-n,R-1,n<<1,2),l.fillRect(y-1,R-n,2,n-1),l.fillRect(y-1,R+1,2,n-1))}f.fa?(l=1<<4+L.l,0>p.o?y=0:(y=p.o,y=p.A+" "+p.o+" "+p.B+" "+sa[p.ca]+": "+(0>y||16<=y?0:L.W[(p.A<<L.l+4|p.B)<<4|y])),f="Minicraft 0.4.9 "+W(c.Fa).toString().padStart(2,"\u00a0")+" fps, T: "+W(24*f.ya).toString().padStart(2,"0")+":"+W(24*f.ya%1*60).toString().padStart(2,"0")+"; "+(f.h&&500>g%1E3?"":f.time)+"\nR: "+H+"x"+K+" (x"+aa.K+"), D: "+aa.L+", C: "+
L.ea+"/"+L.pa.length+", M: "+(l*l*16>>10)+"k\nE: 0/0\n\nPosition: "+p.H.toFixed(2)+" "+p.$.toFixed(2)+" "+p.J.toFixed(2)+"\nAngle: "+(p.v*Ca).toFixed(2)+" "+(p.ba*Ca).toFixed(2)+"\nBlock: "+y+"\nChunk: "+(W(p.H)>>4)+" "+(W(p.J)>>4)):f="";c.Da=f}b.ua=g},[ka()]);ha();return[I("canvas",{R:G(g=>ub(b,g))}),b.u&&b.fa&&I("div[className=diagnostics]",{innerText:b.u.Da}),b.ha&&ia(Fb,{i:b,va:b.va}),1===b.j&&ia(Ab,{m:a,qa:e,i:b}),2===b.j&&ia(Cb,{i:b,N:b.N})]}
t.init(()=>{const [a,e]=fa(Sa),d=G({i:null});B(()=>{onbeforeunload=()=>{e(1);if(d.i){var h=d.i.s;for(const k of h.G)k.X&&nb(h,k)}}});const b=G(h=>"INPUT"===h.target.tagName||!d.i||(h.preventDefault(),yb(d.i,h.keyCode,"keydown"===h.type),d.i.ha=!1));return[{onkeydown:b,onkeyup:b,oncontextmenu:Ra,ondragstart:Ra},[ia(Gb,{m:a.m,qa:e,Oa:d})]]});
