const m=lui,aa=m.defer,ea=m.dom_define,u=m.hook_dom,z=m.hook_effect,fa=m.hook_memo,ha=m.hook_model,ia=m.hook_rerender,B=m.hook_static,D=m.node,E=m.node_dom,ja=m.node_map,ka=m.now,la="air stone grass dirt cobble planks bedrock log leaves bricks wool sand gravel glass bookshelf obsidian stone_bricks sandstone lapis_block iron_block gold_block diamond_block emerald_block redstone_block quartz_block".split(" "),sa=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,
8092798,16447200,4151672,1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813],ta="WEBTSN".split(""),ua=window,va=document,J=Math,wa=J.PI,xa=.5*wa,Da=180/wa,K=J.floor,Ea=J.ceil,Fa=J.round,L=J.min,M=J.max,Ga=J.cos,Ha=J.sin,Ia=J.sqrt,Ja=J.log2,Ka=String.fromCharCode,La=JSON,Ra=La.stringify,Sa=La.parse,N=localStorage,Ta=N.setItem.bind(N),Ua=Uint8Array,Va=Uint32Array,Wa=Map,O=Number,Xa=setTimeout,Ya=setInterval,Za=clearTimeout,$a=clearInterval,Q=a=>a*a,ab=()=>!1,bb=({id:a})=>
(u("#tile",{S:{backgroundPositionY:`-${2*(a-1)}rem`}}),null);function cb({amount:a,id:b}){u("div[className=stack]",{title:la[b]});return[D(bb,{id:b}),1!==a&&E("div[className=amount]",{innerText:a})]}
const db=a=>{a+=32;33<a&&39>a?a++:38<a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Ka(a)},eb=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),gb=()=>{var a=fb;const b=a.length,d=new Wa,c=r=>{n=n<<1|r&1;15===++q&&(l+=db(n),n=q=0)},e=()=>{for(let r=0;r<v;++r)c(0)},h=r=>{c(r);c(r>>1);c(r>>2);c(r>>3);c(r>>4);c(r>>5);c(r>>6);c(r>>7)},k=()=>{0===--w&&(w=1<<v++)},f=()=>{if(x)x=!1;else{let r=t.id;for(let F=0;F<v;F++)c(r>>F)}};let g=a[0],l="",n=0,q=
2,v=2,w=2,y=2,t={id:y++,Ba:new Wa},x=!0;h(g);d.set(g,t);for(let r=1;r<b;++r){const F=t.Ba.get(g=a[r]);F?t=F:(f(),d.has(g)||(k(),e(),h(g),d.set(g,{id:y++,Ba:new Wa}),x=!0),t.Ba.set(g,{id:y++,Ba:new Wa}),t=d.get(g),k())}f();d.has(g)||(k(),e(),h(g));k();c(1);--v;e();return l+=db(n<<15-q)},hb=a=>{var b=fb;if(!a)return null;const d=a.length,c=()=>{q+=(y>>--t&1)<<v++;0===t&&(t=15,y=eb(a.charCodeAt(w++)))};let e=[0,1],h=1,k=3,f=2,g=null;var l=null;let n=0,q=0;l=2;let v=0,w=0,y=eb(a.charCodeAt(w++)),t=15;
for(;v<l;)c();if(1===q)return null;for(q=v=0;8>v;)c();g=[q];e[2]=g;for(b[n++]=q;w<=d;){l=f;for(q=v=0;v<l;)c();if(0===q){for(q=v=0;8>v;)c();e[k]=[q];q=k++;0===--h&&(h=1<<f++)}else if(1===q)return b;l=q<e.length?e[q]:g.concat(g[0]);for(let x=0;x<l.length;x++)b[n++]=l[x];e[k++]=g.concat(l[0]);g=l;0===--h&&(h=1<<f++)}return null},R=(a,b=1,d=null)=>({amount:b,data:d,id:a}),S=new Va(1024),fb=new Ua(S.buffer),ib=new Wa,jb=(a,b,d,c)=>0>d||63<d?0:a.X[(b<<a.M+4|c)<<6|d],kb=(a,b,d,c)=>{const e=a.M;a.X[(b<<e+
4|c)<<6|d]=0;a.Y[(b>>4<<e|c>>4)<<2|d>>4].ha=!0},lb=(a,b,d,c,e)=>{const h=a.M,k=(b<<h+4|c)<<6|d;if(0<a.X[k])return!1;a.X[k]=e;return a.Y[(b>>4<<h|c>>4)<<2|d>>4].ha=!0},ob=(a,b,d)=>{const c=M(L(b.K,63),0)>>4,e=K(b.J)>>4;b=K(b.L)>>4;if(d||a.Fa!==c||a.ra+a.Ea!==e||a.sa+a.Ga!==b)d=1<<a.M,a.Fa=c,a.ra=e-(a.Ea=(65536+e)%d),a.sa=b-(a.Ga=(65536+b)%d),mb(a);nb(a,!1)},mb=a=>{const b=a.Ea,d=a.Fa,c=a.Ga,e=a.M,h=`${e} ${b} ${c} ${d}`;let k=ib.get(h);if(null==k){const f=1<<e,g=Q(.5*f);ib.set(h,k=a.Y.map(({x:l,y:n,
z:q},v)=>{let w=Q(l-b),y=Q(q-c),t=Q(l-b-f),x=0,r=0;t<w&&(w=t,x=-f);(t=Q(l-b+f))<w&&(w=t,x=f);(t=Q(q-c-f))<y&&(y=t,r=-f);(t=Q(q-c+f))<y&&(y=t,r=f);return{Ra:w+y+Q(n-d),Za:v,ra:x,sa:r}}).filter(({Ra:l})=>l<=g).sort((l,n)=>l.Ra-n.Ra))}a.Ca=k;a.na=0},qb=(a,b)=>{for(var d of a.Y)d.ha&&pb(a,d);for(d=b.H.map(({content:c})=>c&&[c.id,c.amount,c.data]);0<d.length&&null===d[d.length-1];)d.pop();Ta(`minicraft.world.${a.id}:meta`,Ra({p:{h:b.gb,i:d,m:b.G,p:[b.J,b.K,b.L,b.O,b.ea]},s:[a.ta,a.ua,a.va],v:1}))},rb=
(a,b)=>{const d=N.getItem(`minicraft.world.${a.id}:meta`);if(d){const {p:c,s:e,v:h}=Sa(d);null!=h&&(c.i.forEach((k,f)=>{k&&(b.H[f].content=R(k[0],k[1],k[2]))}),b.gb=c.h,b.G=c.m,b.J=c.p[0],b.K=c.p[1],b.L=c.p[2],b.O=c.p[3],b.ea=c.p[4],a.ta=e[0],a.ua=e[1],a.va=e[2])}},sb=(a,b,d,c)=>`minicraft.world.${a.id}:${b}/${d}`+(0<c?"/"+c:""),pb=(a,b)=>{const d=a.Aa;var c=a.M;const e=b.y,h=(256<<c)-256;for(let k=0,f=-1,g=((b.x<<c+4|b.z)<<6|e)<<2;16>k;++k){for(c=0;16>c;++c)S[++f]=d[g],S[++f]=d[++g],S[++f]=d[++g],
S[++f]=d[++g],g+=13;g+=h}Ta(sb(a,b.ya,b.La,e),gb());b.ha=!1},nb=(a,b)=>{const d=a.Y,c=a.Ca,e=a.ra,h=a.sa,k=c.length;for(;a.na<k;){var f=c[a.na++],g=d[f.Za],l=g.loaded,n=g.x;const w=g.y;var q=g.z,v=e+f.ra+n;f=h+f.sa+q;if(!l||v!==g.ya||f!==g.La)if(g.ha&&pb(a,g),g.loaded=!0,f=hb(N.getItem(sb(a,g.ya=v,g.La=f,w))),l||0===w||f){g=a.Aa;const y=a.M;v=(256<<y)-256;n=((n<<y+4|q)<<6|w)<<2;if(f)for(let t=0,x=-1;16>t;++t){for(l=0;16>l;++l)g[n]=S[++x],g[++n]=S[++x],g[++n]=S[++x],g[++n]=S[++x],n+=13;n+=v}else for(q=
0;16>q;++q){for(f=0;16>f;++f)g[n]=0<w?0:50397446,g[++n]=0<w?0:131843,l?(g[++n]=0,g[++n]=0,n+=13):n+=15;n+=v}if(!b)break}}};let Eb=null,Fb=null,Gb=new Image;Gb.crossOrigin="anonymous";Gb.onload=()=>{const a=va.createElement("canvas");a.width=16;a.height=416;const b=a.getContext("2d");b.drawImage(Gb,0,0);ea("tile","div[className=bitmap]",{S:{backgroundImage:`url(${a.toDataURL()})`}});Eb=new Va(b.getImageData(0,0,16,416).data.buffer);Fb&&Fb();Gb=Fb=null};Gb.src=ASSETS+"blocks.webp";
const Ib=(a,b)=>{const d={Xa:b,Oa:b.getContext("2d",{alpha:!1,desynchronized:!0}),Ya:null,cb:"",T:!1,eb:0,Sa:0,mb:Ya(()=>(d.eb=d.Sa,d.Sa=0),1E3),o:a};null===Eb&&(Fb=()=>d.T=!0);Hb(d);return d},Hb=a=>{(a.Ya=a.Oa.createImageData(a.Xa.width=a.o.Ia,a.Xa.height=a.o.Ja)).data.fill(255);a.Oa.fillStyle="rgba(255,255,255,.5)"};
function Jb({j:a,ka:b}){u("div[className=bar]",{ontouchstart:B(d=>{a.N=Number(d.target.closest("[data-slot]").dataset.slot);a.ja=d.timeStamp}),S:{opacity:M(.5,L(1,1-5E-4*(b-a.ja-5E3)))}});return Eb&&a.H.slice(0,9).map(({content:d},c)=>E("div",{D:{slot:c},F:{active:c===a.N}},[d&&D(cb,{amount:d.amount,data:d.data,id:d.id})]))}
const Kb=(a,b,d=a.content.amount)=>{if(b.content)a.content.id===b.content.id?(d=L(d,b.P-b.content.amount),a.content.amount-=d,b.content.amount+=d,0>=a.content.amount&&(a.content=null)):!(a.content.amount<=d&&a.content.amount<=b.P&&b.content.amount<=a.P)||a.filter&&!a.filter(b.content.id)||b.filter&&!b.filter(a.content.id)||([b.content,a.content]=[a.content,b.content]);else if(!b.filter||b.filter(a.content.id))a.content.amount<=d&&a.content.amount<=b.P?[b.content,a.content]=[a.content,b.content]:(d=
L(d,b.P),a.content.amount-=d,b.content=R(a.content.id,d),0>=a.content.amount&&(a.content=null))},Lb=(a,b)=>{for(const d of a)if(d.content&&d.content.id===b.id){const c=L(b.amount,d.P-d.content.amount);d.content.amount+=c;if(0>=(b.amount-=c))return null}for(const d of a)if(!d.content&&(!d.filter||d.filter(b.id)))if(a=L(b.amount,d.P),a<=b.amount){if(d.content=R(b.id,a),0>=(b.amount-=a))return null}else return d.content=b,null;return b},Mb=a=>({Ma:0,Wa:0,Na:0,O:0,ea:0,za:0,fa:0,W:-1,ga:0,la:null,ma:null,
G:1,gb:20,H:Array(36).fill(null).map(()=>({content:null,filter:null,P:64})),Ha:0,name:"Gast",J:a.ta,K:a.ua,L:a.va,ib:0,jb:0,N:0,ja:0,aa:0,ba:0,ca:0}),Nb=(a,b,d)=>{a.O=(a.O+b+100*wa)%(2*wa);a.ea=M(-xa,L(xa,a.ea+d))};let Ob=0;
const Pb=()=>({actions:null,A:null,ab:0,bb:0,Da:!1,oa:!0,pa:!1,fb:null,Z:0,U:new Set,Ta:"",l:0,V:[],j:null,B:null,Ua:1,Va:1,Ia:0,Ja:0,kb:null,g:null}),Rb=a=>{const b={X:null,Aa:null,Y:null,Ca:null,na:0,u:!0,Ea:0,Fa:0,Ga:0,id:0,ra:0,sa:0,M:0,ta:.5,ua:8.5,va:.5,time:0,Ka:0},d=Mb(b);rb(b,d);a.g=b;a.j=d;Qb(a);a.kb=Ya(()=>{b.u||(b.time=(b.time+1)%24E3,b.Ka=1/24E3*(b.Ka+6E3)%1,ob(b,d,!1))},50)},Sb=a=>{$a(a.kb);qb(a.g,a.j);$a(a.B.mb);a.g=null;a.j=null;a.B=null},Qb=a=>{const b=a.g;var d=Ea(Ja(a.A.da/16*2+
2));if(b.M!==d){a=a.j;b.Y&&qb(b,a);const c=1<<(b.M=d),e=b.Y=[];for(let h=0;h<c;++h)for(let k=0;k<c;++k)for(let f=0;4>f;++f)e.push({ha:!1,loaded:!1,x:h,y:f,z:k,ya:0,La:0});d=c<<d+12+2;null===b.X||b.X.length<d?b.Aa=new Va((b.X=new Ua(d)).buffer):b.Aa.fill(0);ob(b,a,!0)}},Tb=(a,b)=>a===b?0:.1-.2*a,Ub=a=>{a.j.Ma=Tb((a=a.U).has(-12)||a.has(65),a.has(-13)||a.has(68))},Vb=a=>{a.j.Wa=Tb((a=a.U).has(-15)||a.has(16),a.has(-14)||a.has(32))},Wb=a=>{a.j.Na=Tb((a=a.U).has(-11)||a.has(83),a.has(-10)||a.has(87))},
Xb=a=>{a.j.ib=Tb(a.U.has(-18),a.U.has(-19))},Yb=a=>{a.j.jb=Tb(a.U.has(-17),a.U.has(-16))},U=(a,b,d)=>{if(!a.g)return!1;const c=a.U;var e=a.j;if(d){if(c.has(b))return!1;c.add(b);var h=e.fa,k=e.W;d=e.ga;switch(b){case -18:case -19:Xb(a);break;case -17:case -16:Yb(a);break;case -1:2!==e.G&&0<=k&&(0===e.Ha?0===e.G&&(b=jb(a.g,h,k,d),2===b?b=3:1===b&&(b=4),6===b||8!==b&&13!==b&&null!==Lb(e.H,R(b,1)))||(kb(a.g,h,k,d),e.W=-1):Zb(a,[h,k,d],!1));break;case -2:case 71:if(0<=k){const f=jb(a.g,h,k,d);d=e.H.slice(0,
9);k=d.findIndex(g=>null!==g.content&&g.content.id===f);0<=k?e.N=k:1===e.G&&(d[e.N].content&&(d=d.findIndex(g=>null===g.content),0<=d&&(e.N=d)),e.H[e.N].content=R(f));e.ja=a.Z}break;case -3:if(2!==e.G&&0<=k)if(0===e.Ha){if(b=e.H[e.N],b.content){switch(e.za){case 0:--h;break;case 1:++h;break;case 2:--k;break;case 3:++k;break;case 4:--d;break;default:++d}0<=k&&64>k&&lb(a.g,h&(1<<4+a.g.M)-1,k,d&(1<<4+a.g.M)-1,b.content.id)&&1!==e.G&&0>=--b.content.amount&&(b.content=null)}}else Zb(a,[h,k,d],!0);break;
case -4:e.N=(e.N+9-1)%9;e.ja=a.Z;break;case -5:e.N=(e.N+1)%9;e.ja=a.Z;break;case 27:a.l?(a.g.u=!1,a.l=0):(a.g.u=!0,a.l=1);break;case -15:case -14:case 16:case 32:Vb(a);break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:e.N=b-49;e.ja=a.Z;break;case -12:case -13:case 65:case 68:Ub(a);break;case 69:if(2!==e.G&&!a.l){a.l=3;for(const f of c)U(a,f,!1)}break;case 80:a.g&&(a.g.u=!a.g.u);break;case 81:e=e.H[e.N];if(c.has(17)||e.content&&0>=--e.content.amount)e.content=null;break;
case -11:case -10:case 83:case 87:Wb(a);break;case 84:if(!a.l){a.l=2;for(const f of c)U(a,f,!1)}break;case 112:a.oa=!a.oa;break;case 114:a.Da=!a.Da;break;default:return!1}}else{if(!c.delete(b))return!1;switch(b){case -15:case -14:case 16:case 32:Vb(a);break;case -12:case -13:case 65:case 68:Ub(a);break;case -11:case -10:case 83:case 87:Wb(a);break;case -18:case -19:Xb(a);break;case -17:case -16:Yb(a)}}a.Ta=[...c].join();return!0},$b=(a,b)=>(b=b.startsWith("~")?a+O(b.substr(1)):O(b),isNaN(b)?a:b),
Z=(a,b,d=!1)=>{(a.V=a.V.slice(-49)).push({id:++Ob,hb:d,time:ka(),value:b})},Zb=(a,b,d)=>{d?a.j.ma=b:a.j.la=b;Z(a,`${d?"second":"first"} position: ${b.join(" ")}`,!0)};function ac({ob:a}){u("div[className=grid]",{onclick:({target:b})=>{(b=b.closest("[data-id]"))&&Kb({content:R(O(b.dataset.id)),filter:null,P:64},a)}});return la.map((b,d)=>0<d&&E("div",{D:{id:d}},[D(cb,{id:d,amount:1,data:null})]))}
function bc({o:a}){const b=fa(()=>({content:null,filter:null,P:64}));u("div[className=menu overlay inventory]",fa(()=>({onclick:({target:d})=>{if("menu overlay inventory"===d.className)b.content?b.content=null:(a.l=0,a.g.u=!1,a.fb.requestPointerLock());else if(d=d.closest("[data-slot]"))d=a.j.H[O(d.dataset.slot)],b.content?Kb(b,d):d.content&&Kb(d,b)},oncontextmenu:({target:d})=>{if("menu overlay inventory"===d.className)b.content?0>=--b.content.amount&&(b.content=null):(a.l=0,a.fb.requestPointerLock());
else if(d=d.closest("[data-slot]"))d=a.j.H[O(d.dataset.slot)],b.content?Kb(b,d,1):d.content&&Kb(d,b,Ea(d.content.amount/2))}})));return Eb&&[E("div[className=window]",null,[E("div[innerText=Inventory]"),1===a.j.G&&D(ac,{ob:b}),E("div[className=grid]",null,a.j.H.map(({content:d},c)=>E("div",{D:{slot:c},F:{first:9>c}},[d&&D(cb,{id:d.id,amount:d.amount,data:d.data})])))]),b.content&&E("div[className=hand]",{S:{transform:`translate(${a.ab}px, ${a.bb}px)`}},[D(cb,{id:b.content.id,amount:b.content.amount,
data:b.content.data})])]}const cc=({I:{hb:a,time:b,value:d},ka:c})=>(u(a?"div[className=minor]":"div",{innerText:d,S:{opacity:L(1,1-.001*(c-b-4500))}}),null);function dc({V:a,ka:b}){u("div[className=messages]");const d=b-5E3;return[ja(cc,a.slice(-10).filter(c=>c.time>d),{ka:b})]}
function ec({actions:a,o:b}){u("div[className=menu]");return[E("h1[innerText=Minicraft]"),E("center",null,[E("button[innerText=Welt betreten]",{onclick:()=>{aa();a.Qa({xa:0});Rb(b);b.g.u=!1;b.fb.requestPointerLock()}})]),E("center",null,[E("button[innerText=Weltenverzeichnis]",{onclick:()=>{location.href="/svr/minicraft/store.html"}})]),E("center",null,[E("button[innerText=Projektseite]",{onclick:()=>{open("//github.com/L3P3/minicraft")}})]),E("center",null,[E("small[innerText=Version 0.7.0 von L3P3]")])]}
function fc({actions:{lb:a,Pa:b,Qa:d},A:c,o:e}){z(()=>{e.g&&qb(e.g,e.j);return b});z(()=>{const h=Xa(b,1E3);return()=>Za(h)},[c]);u("div[className=menu overlay]");return[E("h1[innerText=Einstellungen]"),E("center",null,[E("button[innerText=Zur\u00fcck zum Spiel]",{onclick:B(()=>(e.l=0,e.g.u=!1,e.fb.requestPointerLock()))})]),E("div[className=settings]",null,[E("button",{innerText:"Oberfl\u00e4chen: "+(c.ia?"Texturiert":"Einfarbig"),onclick:B(()=>a(h=>({ia:!h.ia})))}),E("label[innerText=Aufl\u00f6sung:]",
null,[E("input[type=range][min=1][max=100][step=1]",{value:101-c.$,onchange:B(h=>d({$:101-Number(h.target.value)}))})]),E("label[innerText=Blickwinkel:]",null,[E("input[type=range][min=1][max=180][step=1]",{value:c.wa,onchange:B(h=>d({wa:Number(h.target.value)}))})]),E("label[innerText=Sichtweite:]",null,[E("input[type=range][min=1][max=128][step=1]",{value:c.da,onchange:B(h=>d({da:Number(h.target.value)}))})]),E("label[innerText=Mausempfindlichkeit:]",null,[E("input[type=range][min=1][max=15][step=1]",
{value:c.qa,onchange:B(h=>d({qa:Number(h.target.value)}))})])]),E("center",null,[E("button[innerText=Welt verlassen]",{onclick:B(()=>(e.l=0,Sb(e),d({xa:-1})))})])]}const gc=({I:{hb:a,value:b}})=>(u(a?"div[className=minor]":"div",{innerText:b}),null);
function hc({o:a,V:b}){u("div[className=menu overlay terminal]");const d=B({history:null});z(c=>{c&&Xa(()=>d.history.scrollTop=1E9,0)},[b.length&&b[b.length-1].id]);return[E("div[className=history]",{R:B(c=>{d.history=c})},[ja(gc,b)]),E("input[enterkeyhint=send][mozactionhint=send][name=message][required]",B({onkeydown:c=>{var e=c.keyCode;c=c.target;if(13===e){var h=c.value;e=a.j;const f=a.g;if(h)if("/"===h.charAt(0)){h=h.substr(1).split(" ");const g=h.shift();switch(g){case "clear":a.V=[];break;
case "clearinv":for(var k of e.H)k.content=null;Z(a,"inventory cleared",!0);break;case "exit":f.u=!1;a.l=0;break;case "gamemode":case "gm":h=O(h[0]);!isNaN(h)&&0<=h&&3>h&&0===h%1?(e.G=h,Z(a,`gamemode set to ${h}`,!0)):Z(a,"gamemode must be in 0..2");break;case "give":if(0===h.length){Z(a,"/give <id> [amount]\n"+la.join(" "));break}k=la.indexOf((h[0]||"").toLowerCase());k=0<=k?k:O(h[0]);h=O(h[1]||1);!isNaN(k)&&0<k&&25>k&&0===k%1?!isNaN(h)&&0<h&&0===h%1?Z(a,Lb(e.H,R(k,h))?"inventory full":`gave ${h} ${la[k]}`,
!0):Z(a,"amount must be at least 1"):Z(a,"invalid block type");break;case "help":Z(a,"commands: clear, clearinv, exit, gamemode, give, help, load, me, save, spawn, teleport, version");break;case "load":nb(f,!0);a.B.T=!0;Z(a,"chunks loaded",!0);break;case "me":Z(a,e.name+" "+h.join(" "),!0);break;case "save":a.g&&qb(a.g,a.j);a.actions.Pa();Z(a,"world+config saved",!0);break;case "smart":e.name="LFF5644";Z(a,"lff.smart: true",!0);break;case "spawn":f.ta=e.J;f.ua=e.K;f.va=e.L;Z(a,"spawn updated",!0);
break;case "teleport":case "tp":0===h.length?(e.J=f.ta,e.K=f.ua,e.L=f.va,a.B.T=!0,Z(a,"teleported to spawn",!0)):3===h.length?(Z(a,`teleported to ${e.J=$b(e.J,h[0])} ${e.K=$b(e.K,h[1])} ${e.L=$b(e.L,h[2])}`,!0),a.B.T=!0):Z(a,"PITCH");e.aa=0;e.ba=0;e.ca=0;break;case "version":Z(a,"Minicraft 0.7.0");break;case "/exit":e.Ha=0;Z(a,"normal mouse mode",!0);break;case "/expand":a.j.la&&a.j.ma?k=!0:(Z(a,"selection required"),k=!1);k&&("vert"===h[0]?(e.la[1]=0,e.ma[1]=63,Z(a,"selection expanded",!0)):Z(a,
"only vert supported"));break;case "/pos1":case "/pos2":Zb(a,[K(e.J),K(e.K),K(e.L)],"/pos2"===g);break;case "/regen":e=f.Y[f.Ca[f.na=0].Za];N.removeItem(sb(f,e.ya,e.La,e.y));e.ha=!1;++e.ya;nb(f,!1);Z(a,"regenerate chunk",!0);a.B.T=!0;break;case "/show":Z(a,`first: ${e.la?e.la.join(" "):"none"}, second: ${e.ma?e.ma.join(" "):"none"}`);break;case "/wand":e.Ha=1;Z(a,"primary+secondary button for selection",!0);break;default:Z(a,"unknown command: "+g)}}else Z(a,`<${e.name}> `+h);c.value=""}else 27===
e&&(a.u=!1,a.l=0)},R:c=>Xa(()=>c.focus(),0)}))]}const ic=[["pick",-2],["up",-14],["down",-15],["E",69],["T",84],["F1",112],["F3",114],["...",27]],jc=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]],kc=[["up",-16],["down",-17],["left",-18],["right",-19],["center",-3]];
function lc({o:a}){const b=a.U,d=([c,e])=>E("div",{D:{code:e},F:{button:!0,[c]:!0,active:b.has(e)}});u("div[className=touch]",B({ontouchstart:c=>{c.preventDefault();const e=Number(c.target.dataset.code);if(null!=e&&U(a,e,!0)){const h=c.changedTouches[0].identifier,k=f=>{f.changedTouches[0].identifier===h&&(removeEventListener("touchend",k),U(a,e,!1))};addEventListener("touchend",k)}}}));return[E("div[className=top]",null,ic.map(([c,e])=>E(`div[innerText=${c}]`,{D:{code:e},F:{button:!0,active:b.has(e)}}))),
E("div[className=move]",null,jc.map(d)),E("div[className=move sec]",null,kc.map(d))]}
function mc({actions:a,A:b,nb:d}){const c=fa(Pb),e=ka(),h=u("div[className=game]",fa(()=>{const f=g=>!c.g||0!==c.l||(c.pa=!1,va.pointerLockElement===h?c.g.u||U(c,-1-g.button,"mousedown"===g.type):c.fb.requestPointerLock(),g.preventDefault(),!1);return{onmousedown:f,onmousemove:g=>{if(!c.g||c.g.u||c.l)c.ab=g.clientX,c.bb=g.clientY;else{const l=c.A.qa*wa/M(c.Ua,c.Va);Nb(c.j,g.movementX*l,-g.movementY*l)}},onmouseup:f,ontouchstart:g=>{c.pa=!0;c.g&&!c.l&&(c.g.u=!1,g.preventDefault())},onwheel:g=>{c.pa=
!1;if(c.g&&!c.l&&!c.g.u&&5<Math.abs(g.deltaY)){const l=0<g.deltaY?-5:-4;U(c,l,!0);U(c,l,!1);g.preventDefault()}}}})),k=va.pointerLockElement===h;z(()=>(c.actions=a,c.A=b,c.fb=h,d.o=c,-1!==b.xa&&Rb(c),()=>(c.g&&Sb(c),d.o=null)));z(()=>(c.A=b,c.B&&(c.B.T=!0),c.g&&Qb(c)),[b]);z((f,g,l)=>{c.Ua=M(1,f*l);c.Va=M(1,g*l);g=c.A.$;f=M(1,Fa(c.Ua/g));g=M(1,Fa(c.Va/g));if(f!==c.Ia||g!==c.Ja)c.Ia=f,c.Ja=g,c.B&&(c.B.T=!0,Hb(c.B))},[h.offsetWidth,h.offsetHeight,ua.devicePixelRatio||1,b.$]);z(()=>{c.g&&(k||c.g.u||
c.l||(c.l=1),c.g.u=!k)},[k]);z(f=>k&&f&&va.exitPointerLock(),[c.g&&(c.g.u||0!==c.l)]);z(()=>{if(c.g){if(c.Z&&!c.g.u){var f=c.j,g=L(5,.01*(e-c.Z));f.aa-=.1*f.aa*g;f.ba-=.1*f.ba*g;f.ca-=.1*f.ca*g;f.aa+=(Ga(f.O)*f.Ma+Ha(f.O)*f.Na)*g;f.ba+=f.Wa*g;f.ca+=(-Ha(f.O)*f.Ma+Ga(f.O)*f.Na)*g;Nb(f,f.ib*g,f.jb*g);f.J+=f.aa*g;f.K+=f.ba*g;f.L+=f.ca*g}if(c.B){f=c.B;++f.Sa;g=f.Oa;var l=f.Ya;const V=f.o,ma=V.A,Ma=V.oa,p=V.j,P=V.Ia,T=V.Ja,C=V.g;if(!C.u||f.T){f.T=!1;const ba=l.data,oc=ma.da;var n=p.O,q=p.ea;const pc=p.fa,
qc=p.ga;var v=p.J,w=p.K,y=p.L;const rc=Ma?p.W:-1,sc=C.X;var t=C.M;const tc=ma.ia&&null!==Eb;var x=1/P,r=1/T;const ca=P>>1,da=T>>1,tb=L(P,T),ub=32<tb,vb=Ga(n);n=Ha(n);const wb=Ga(-q);q=Ha(-q);var F=ma.wa/45;const uc=x*(P<T?F*P*r:F);x=r*(T<P?F*T*x:F);v+=65536;w+=65536;y+=65536;r=v%1;F=w%1;const vc=y%1;t=4+t;const xb=(1<<t)-1;let yb=1===p.G?6:4,W=p.fa=p.ga=p.za=0;p.W=-1;for(let ya=0;ya<T;++ya){var za=(da-ya)*x;const zb=za*wb-q;var Na=za*q+wb;za=Na*n;Na*=vb;for(let Aa=0;Aa<P;++Aa){var na=(Aa-ca)*uc;const Ab=
za+vb*na;na=Na-n*na;let oa=16757124,Ba=1,Bb=oc;for(let A=0;3>A;++A){let H=na;0===A&&(H=Ab);1===A&&(H=zb);var X=1/(0>H?-H:H);const Ca=Ab*X,Y=zb*X;X*=na;const Cb=Ia(Ca*Ca+Y*Y+X*X);var G=vc;0===A&&(G=r);1===A&&(G=F);0<H&&(G=1-G);let pa=v+Ca*G-(0===A&0>H|0),qa=w+Y*G-(1===A&0>H|0),ra=y+X*G-(2===A&0>H|0);G*=Cb;for(let Oa,Pa,Qa,I;G<Bb;pa+=Ca,qa+=Y,ra+=X,G+=Cb)if(65536>qa){if(0>Y)break}else if(65600<=qa){if(0<Y)break}else if(0!==(I=sc[((Oa=pa&xb)<<t|(Qa=ra&xb))<<6|(Pa=qa&63)])){ya===da&&Aa===ca&&G<=yb&&(p.fa=
Oa,p.W=Pa,p.ga=Qa,p.za=0>H|A<<1,yb=G);if(tc){--I;1===A?6===I?I=25:13===I?I=4:1===I&&0<Y&&(I=2):1===I&&(I=24);const Db=Eb[I<<8|(16*(1===A?ra:qa)&15)<<4|16*(1===A?pa:(0<H?pa-ra:ra-pa)+65536)&15];if(0===Db>>>24)continue;oa=Db&16777215}else oa=sa[I];Bb=G;Ba=(0===A?.8:2===A?.6:0<H?.4:1)+(Pa!==rc||Oa!==pc||Qa!==qc?0:.2);break}}ba[W]=(oa&255)*Ba;ba[++W]=(oa>>8&255)*Ba;ba[++W]=(oa>>16)*Ba;W+=2}}Ma&&!ub&&(ba[W=P*da+ca<<2]+=128,ba[++W]+=128,ba[++W]+=128);g.putImageData(l,0,0);Ma&&ub&&(l=Ea(.05*tb),g.fillRect(ca-
l,da-1,l<<1,2),g.fillRect(ca-1,da-l,2,l-1),g.fillRect(ca-1,da+1,2,l-1))}f.cb=V.Da?"Minicraft 0.7.0 "+K(f.eb).toString().padStart(2,"\u00a0")+" fps, T: "+K(24*C.Ka).toString().padStart(2,"0")+":"+K(24*C.Ka%1*60).toString().padStart(2,"0")+"; "+(C.u&&500>e%1E3?"":C.time)+"\nR: "+P+"x"+T+" (x"+ma.$+"), D: "+ma.da+", C: "+C.na+"/"+C.Ca.length+", M: "+(64*Q(1<<4+C.M)>>10)+"k\nE: 0/0 M: "+p.G+"\n\nPosition: "+p.J.toFixed(2)+" "+p.K.toFixed(2)+" "+p.L.toFixed(2)+"\nAngle: "+(p.O*Da).toFixed(2)+" "+(p.ea*
Da).toFixed(2)+"\nBlock: "+(0>p.W?0:p.fa+" "+p.W+" "+p.ga+" "+ta[p.za]+": "+jb(C,p.fa,p.W,p.ga))+"\nChunk abs: "+(K(p.J)>>4)+" "+(K(p.L)>>4)+" "+(K(p.K)>>4)+" rel: "+C.Ea+" "+C.Ga+" "+C.Fa:""}}c.Z=e},[e]);ia();return[c.g&&E("canvas",{R:B(f=>{c.B=Ib(c,f)})}),!c.g&&0===c.l&&D(ec,{actions:a,o:c}),c.g&&c.oa&&2!==c.l&&D(dc,{V:c.V,ka:e}),c.g&&c.B&&c.Da&&E("div[className=diagnostics]",{innerText:c.B.cb}),c.g&&c.pa&&D(lc,{o:c,Ta:c.Ta}),c.g&&c.oa&&3!==c.l&&2!==c.j.G&&D(Jb,{j:c.j,ka:e}),3===c.l&&D(bc,{o:c,
ka:e}),1===c.l&&D(fc,{actions:a,A:b,o:c}),2===c.l&&D(hc,{o:c,V:c.V})]}
const nc={init:()=>{const a={ia:!0,qa:3,$:4,wa:120,da:64,xa:0};var b=N.getItem("minicraft.config");if(b){b=Sa(b);let d=b.flag_textures;null!=d&&(a.ia=d);null!=(d=b.mouse_sensitivity)&&(a.qa=d);a.$=b.resolution_scaling;a.wa=b.view_angle;a.da=b.view_distance;null!=(d=b.world_last)&&(a.xa=d)}return{A:a,$a:a}},Pa:a=>{const b=a.A;if(b===a.$a)return a;Ta("minicraft.config",Ra({version:"0.7.0",flag_textures:b.ia,mouse_sensitivity:b.qa,resolution_scaling:b.$,view_angle:b.wa,view_distance:b.da,world_last:b.xa}));
return Object.assign({},a,{$a:b})},lb:(a,b)=>nc.Qa(a,b(a.A)),Qa:(a,b)=>Object.assign({},a,{A:Object.assign({},a.A,b)})};
m.init(()=>{const [a,b]=ha(nc),d=B({o:null});z(()=>{let e=!1;onbeforeunload=onunload=onpagehide=onblur=()=>{if(!e&&(e=!0,b.Pa(),d.o)){var h=d.o;h.g&&qb(h.g,h.j)}};onpageshow=onfocus=()=>{e=!1}});const c=B(e=>"INPUT"===e.target.tagName||!d.o||(e.preventDefault(),U(d.o,e.keyCode,"keydown"===e.type),d.o.pa=!1));return[{onkeydown:c,onkeyup:c,oncontextmenu:ab,ondragstart:ab},[D(mc,{actions:b,A:a.A,nb:d})]]});
