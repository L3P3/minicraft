function n(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function k(l){l.done?d(l.value):Promise.resolve(l.value).then(b,c).then(k,e)}k(a.next())})}
const B=lui,ba=B.defer,ca=B.defer_end,da=B.dom_define,ea=B.hook_async,D=B.hook_dom,E=B.hook_effect,ha=B.hook_memo,ia=B.hook_model,ma=B.hook_rerender,na=B.hook_state,H=B.hook_static,I=B.node,J=B.node_dom,oa=B.node_map,pa=B.now,qa=window,ua=document,K=Math,va=K.PI,wa=.5*va,xa=180/va,M=K.floor,ya=K.ceil,za=K.round,P=K.min,Aa=K.max,Ba=K.cos,Ca=K.sin,Ia=K.sqrt,Ja=K.log2,Ka=String.fromCharCode,La=Date,Ma=JSON,Na=Promise,Oa=Ma.stringify,Pa=Ma.parse,S=localStorage,Ua=S.setItem.bind(S),Va=S.removeItem.bind(S),
Wa=qa.indexedDB,Xa=Uint8Array,Ya=Uint32Array,Za=Map,T=Number,$a=Object,ab=$a.keys,bb=$a.entries,cb=setTimeout,db=setInterval,ib=clearTimeout,jb=clearInterval,U=a=>a*a,kb=()=>!1,lb=(a,b)=>{const c=new La;a=new La(a);var d=c-a;if(59E3>d)return za(d/1E3)+"s";if(3E6>d)return za(d/6E4)+"m";d=a.getFullYear();const e=a.getMonth(),k=a.getDate();let l="";d<c.getFullYear()&&(l=d+"/");if(l||e<c.getMonth())l+=e+1+"/";if(l||k<c.getDate())l+=k;if(b)return l||"\u0441\u0435\u0433\u043e\u0434\u043d\u044f";l&&(l+=
"/");b=l+a.getHours()+":";a=a.getMinutes();a=M(a).toString().padStart(2,"0");return b+a};let W=S.getItem("minicraft.config");if((W=W&&Pa(W))&&W.worlds&&W.version.startsWith("0.9.")){const a=new Set(W.worlds.map(b=>"minicraft.world."+b.id));for(const b of ab(S))b.startsWith("minicraft.world.")&&!a.has(b.split(":")[0])&&Va(b)}
const mb={init:()=>{let a=!1;var b={ia:!0,ra:3,W:4,za:120,da:64,Ba:0,worlds:[]};if(W){let c=W.flag_textures;null!=c&&(b.ia=c);null!=(c=W.mouse_sensitivity)&&(b.ra=c);b.W=W.resolution_scaling;b.za=W.view_angle;b.da=W.view_distance;null!=(c=W.world_last)&&(b.Ba=c);null!=(c=W.worlds)?b.worlds=c:S.getItem("minicraft.world.0:meta")&&(b.worlds[0]={id:0,label:(prompt("\u0411\u044b\u043b \u043d\u0430\u0439\u0434\u0435\u043d \u0431\u0435\u0437 \u0438\u043c\u0435\u043d\u0438 \u043b\u043e\u043a\u0430\u043b\u043d\u044b\u0439 \u043c\u0438\u0440. \u041a\u0430\u043a \u0435\u0433\u043e \u043d\u0430\u0437\u0430\u0432\u0451\u0448\u044c? ",
"")||"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439 \u043c\u0438\u0440").substring(0,16),mod_l:Date.now(),mod_r:0},a=!0);W=null}b={account:{label:"",rank:0},g:b,Ua:b};return a?(b.Ua=null,mb.Ta(b)):b},Ta:a=>{const b=a.g;if(b===a.Ua)return a;Ua("minicraft.config",Oa({version:"0.9.9",flag_textures:b.ia,mouse_sensitivity:b.ra,resolution_scaling:b.W,view_angle:b.za,view_distance:b.da,world_last:b.Ba,worlds:b.worlds}));return Object.assign({},a,{Ua:b})},ob:(a,b)=>Object.assign({},a,
{account:b}),qb:(a,b)=>mb.Va(a,b(a.g)),Va:(a,b)=>Object.assign({},a,{g:Object.assign({},a.g,b)}),ab:(a,b)=>Object.assign({},a,{g:Object.assign({},a.g,{worlds:[...a.g.worlds,b]})}),bb:(a,b)=>Object.assign({},a,{g:Object.assign({},a.g,{worlds:a.g.worlds.filter(c=>c.id!==b)})}),P:(a,b,c)=>Object.assign({},a,{g:Object.assign({},a.g,{worlds:a.g.worlds.map(d=>d.id===b?Object.assign({},d,c):d)})})},nb="air stone grass dirt cobble planks bedrock log leaves bricks wool sand gravel glass bookshelf obsidian stone_bricks sandstone lapis_block iron_block gold_block diamond_block emerald_block redstone_block quartz_block".split(" "),
ob="\u0412\u043e\u0437\u0434\u0443\u0445;\u041a\u0430\u043c\u0435\u043d\u044c;\u0411\u043b\u043e\u043a \u0442\u0440\u0430\u0432\u044b;\u0417\u0435\u043c\u043b\u044f;\u0411\u0443\u043b\u044b\u0436\u043d\u0438\u043a;\u0414\u043e\u0441\u043a\u0430;\u0411\u0435\u0434\u0440\u043e\u043a;\u0411\u0440\u0435\u0432\u043d\u043e;\u041b\u0438\u0441\u0442\u044c\u044f;\u041a\u0438\u0440\u043f\u0438\u0447\u0438;\u0428\u0435\u0440\u0441\u0442;\u041f\u0435\u0441\u043e\u043a;\u0413\u0440\u0430\u0432\u0438\u0439;\u0421\u0442\u0435\u043a\u043b\u043e;\u041a\u043d\u0438\u0436\u043d\u044f \u043f\u043e\u043b\u043a\u0430;\u041e\u0431\u0441\u0438\u0434\u0438\u0430\u043d;\u041a\u0430\u043c\u0435\u043d\u044b\u0435 \u043a\u0438\u0440\u043f\u0438\u0447\u0438;\u041f\u0435\u0449\u044f\u043d\u0438\u043a;\u0411\u043b\u043e\u043a \u043b\u0430\u0437\u0443\u0440\u0438\u0442\u0430;\u0411\u043b\u043e\u043a \u0436\u0435\u043b\u0435\u0437\u0430;\u0411\u043b\u043e\u043a \u0437\u043e\u043b\u043e\u0442\u0430;\u0411\u043b\u043e\u043a \u0430\u043b\u043c\u0430\u0437\u0430;\u0411\u043b\u043e\u043a \u0438\u0437\u0443\u043c\u0440\u0443\u0434\u0430;\u0411\u043b\u043e\u043a \u0440\u0435\u0434\u0441\u0442\u043e\u0443\u043d\u0430;\u0411\u043b\u043e\u043a \u043a\u0432\u0430\u0440\u0446\u0430".split(";"),
pb=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813],qb="WEBTSN".split(""),rb=(a,b=1,c=null)=>({amount:b,data:c,id:a}),sb=(a,b,c=a.content.amount)=>{if(b.content)a.content.id===b.content.id?(c=P(c,b.T-b.content.amount),a.content.amount-=c,b.content.amount+=c,0>=a.content.amount&&(a.content=null)):!(a.content.amount<=c&&a.content.amount<=b.T&&b.content.amount<=
a.T)||a.filter&&!a.filter(b.content.id)||b.filter&&!b.filter(a.content.id)||([b.content,a.content]=[a.content,b.content]);else if(!b.filter||b.filter(a.content.id))a.content.amount<=c&&a.content.amount<=b.T?[b.content,a.content]=[a.content,b.content]:(c=P(c,b.T),a.content.amount-=c,b.content=rb(a.content.id,c),0>=a.content.amount&&(a.content=null))},tb=(a,b)=>{for(const c of a)if(c.content&&c.content.id===b.id){const d=P(b.amount,c.T-c.content.amount);c.content.amount+=d;if(0>=(b.amount-=d))return null}for(const c of a)if(!c.content&&
(!c.filter||c.filter(b.id)))if(a=P(b.amount,c.T),a<=b.amount){if(c.content=rb(b.id,a),0>=(b.amount-=a))return null}else return c.content=b,null;return b},ub=(a,b)=>({Qa:0,cb:0,Ra:0,O:0,ea:0,Da:0,fa:0,X:-1,ga:0,ma:null,na:null,u:1,kb:20,G:Array(36).fill(null).map(()=>({content:null,filter:null,T:64})),La:0,name:b.label||"\u0418\u0433\u0440\u043e\u043a",H:a.wa,J:a.xa,K:a.ya,mb:0,nb:0,M:0,ka:0,aa:0,ba:0,ca:0}),vb=(a,b,c)=>{a.O=(a.O+b+100*va)%(2*va);a.ea=Aa(-wa,P(wa,a.ea+c))},wb=a=>{a+=32;33<a&&39>a?
a++:38<a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Ka(a)},xb=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),zb=()=>{var a=yb;const b=a.length,c=new Za,d=x=>{m=m<<1|x&1;15===++u&&(g+=wb(m),m=u=0)},e=()=>{for(let x=0;x<w;++x)d(0)},k=x=>{d(x);d(x>>1);d(x>>2);d(x>>3);d(x>>4);d(x>>5);d(x>>6);d(x>>7)},l=()=>{0===--v&&(v=1<<w++)},p=()=>{if(C)C=!1;else{let x=t.id;for(let G=0;G<w;G++)d(x>>G)}};let f=a[0],g="",m=0,u=2,w=2,v=2,h=2,t={id:h++,Fa:new Za},
C=!0;k(f);c.set(f,t);for(let x=1;x<b;++x){const G=t.Fa.get(f=a[x]);G?t=G:(p(),c.has(f)||(l(),e(),k(f),c.set(f,{id:h++,Fa:new Za}),C=!0),t.Fa.set(f,{id:h++,Fa:new Za}),t=c.get(f),l())}p();c.has(f)||(l(),e(),k(f));l();d(1);--w;e();return g+=wb(m<<15-u)},Ab=a=>{var b=yb;if(!a)return null;const c=a.length,d=()=>{u+=(h>>--t&1)<<w++;0===t&&(t=15,h=xb(a.charCodeAt(v++)))};let e=[0,1],k=1,l=3,p=2,f=null;var g=null;let m=0,u=0;g=2;let w=0,v=0,h=xb(a.charCodeAt(v++)),t=15;for(;w<g;)d();if(1===u)return null;
for(u=w=0;8>w;)d();f=[u];e[2]=f;for(b[m++]=u;v<=c;){g=p;for(u=w=0;w<g;)d();if(0===u){for(u=w=0;8>w;)d();e[l]=[u];u=l++;0===--k&&(k=1<<p++)}else if(1===u)return b;g=u<e.length?e[u]:f.concat(f[0]);for(let C=0;C<g.length;C++)b[m++]=g[C];e[l++]=f.concat(g[0]);f=g;0===--k&&(k=1<<p++)}return null};let X=null;
if(Wa){let a,b;null==(a=navigator.storage)||null==(b=a.persist)||b.call(a);const c=Wa.open("minicraft",1);c.onupgradeneeded=d=>{d=d.target.result.createObjectStore("chunks",{keyPath:["world","coords"]});for(const e of ab(S))if(e.startsWith("minicraft.world.")){const [k,l]=e.substr(16).split(":");"meta"!==l&&(d.add({world:T(k),coords:l,data:S.getItem(e)}),Va(e))}};c.onsuccess=d=>{X=d.target.result}}
const Bb=(a,b)=>n(function*(){if(!X)return S.getItem(`minicraft.world.${a}:${b}`);const c=X.transaction("chunks","readonly").objectStore("chunks").get([a,b]);return new Na(d=>{c.onsuccess=()=>{let e;d(null==(e=c.result)?void 0:e.data)}})}()),Cb=(a,b)=>{var c=zb();return n(function*(){if(!X)return Ua(`minicraft.world.${a}:${b}`,c);const d=X.transaction("chunks","readwrite").objectStore("chunks").put({world:a,coords:b,data:c});return new Na((e,k)=>{d.onsuccess=()=>{e()};d.onerror=()=>{k(d.error)}})}())},
Db=(a,b)=>n(function*(){if(!X)return Va(`minicraft.world.${a}:${b}`);const c=X.transaction("chunks","readwrite").objectStore("chunks").delete([a,b]);return new Na(d=>{c.onsuccess=()=>{d()}})}()),Eb=a=>n(function*(){const b=`minicraft.world.${a}:`;if(!X){const e={},k=b.length;for(const l of ab(S))l.startsWith(b)&&(e[l.substr(k)]=S.getItem(l));return e}const c=X.transaction("chunks","readonly").objectStore("chunks").openCursor(),d={meta:S.getItem(b+"meta")};return new Na(e=>{c.onsuccess=()=>{const k=
c.result;k?(k.value.world===a&&(d[k.value.coords]=k.value.data),k.continue()):e(d)}})}()),Fb=(a,b)=>n(function*(){if(X){var c=X.transaction("chunks","readwrite"),d=c.objectStore("chunks");for(const [e,k]of bb(b))"meta"!==e?d.put({world:a,coords:e,data:k}):Ua(`minicraft.world.${a}:meta`,k);return new Na((e,k)=>{c.oncomplete=()=>{e()};c.onerror=()=>{k(c.error)}})}for(const [e,k]of bb(b))Ua(`minicraft.world.${a}:${e}`,k);Ua("__margin",Array(257).join("x"));Va("__margin")}()),Gb=a=>{if(X){Va(`minicraft.world.${a}:meta`);
var b=X.transaction("chunks","readwrite").objectStore("chunks").openCursor();b.onsuccess=()=>{const c=b.result;c&&(c.value.world===a&&c.delete(),c.continue())}}else{const c=`minicraft.world.${a}:`;for(const d of ab(S))d.startsWith(c)&&Va(d)}},Hb=(a,b)=>{if(X){Ua(`minicraft.world.${b}:meta`,S.getItem(`minicraft.world.${a}:meta`));Va(`minicraft.world.${a}:meta`);var c=X.transaction("chunks","readwrite").objectStore("chunks"),d=c.openCursor();d.onsuccess=()=>{const e=d.result;e&&(e.value.world===a&&
(e.value.world=b,c.put(e.value)),e.continue())}}else{const e=`minicraft.world.${a}:`,k=e.length,l=`minicraft.world.${b}:`;for(const p of ab(S))if(p.startsWith(e)){const f=S.getItem(p);Va(p);Ua(l+p.substr(k),f)}}},Y=new Ya(1024),yb=new Xa(Y.buffer),Ib=new Za,Jb=(a,b,c,d)=>0>c||63<c?0:a.Y[(b<<a.L+4|d)<<6|c],Kb=(a,b,c,d)=>{const e=a.L;a.Y[(b<<e+4|d)<<6|c]=0;a.Z[(b>>4<<e|d>>4)<<2|c>>4].ha=!0},Lb=(a,b,c,d,e)=>{const k=a.L,l=(b<<k+4|d)<<6|c;if(0<a.Y[l])return!1;a.Y[l]=e;return a.Z[(b>>4<<k|d>>4)<<2|c>>
4].ha=!0},Zb=(a,b,c)=>{const d=Aa(P(b.J,63),0)>>4,e=M(b.H)>>4;b=M(b.K)>>4;if(c||a.Ja!==d||a.sa+a.Ia!==e||a.ta+a.Ka!==b)c=1<<a.L,a.Ja=d,a.sa=e-(a.Ia=(65536+e)%c),a.ta=b-(a.Ka=(65536+b)%c),Mb(a);a.busy||Yb(a,!1)},Mb=a=>{const b=a.Ia,c=a.Ja,d=a.Ka,e=a.L,k=`${e} ${b} ${d} ${c}`;let l=Ib.get(k);if(null==l){const p=1<<e,f=U(.5*p);Ib.set(k,l=a.Z.map(({x:g,y:m,z:u},w)=>{let v=U(g-b),h=U(u-d),t=U(g-b-p),C=0,x=0;t<v&&(v=t,C=-p);(t=U(g-b+p))<v&&(v=t,C=p);(t=U(u-d-p))<h&&(h=t,x=-p);(t=U(u-d+p))<h&&(h=t,x=p);
return{Wa:v+h+U(m-c),fb:w,sa:C,ta:x}}).filter(({Wa:g})=>g<=f).sort((g,m)=>g.Wa-m.Wa))}a.Ga=l;a.oa=0},ac=(a,b)=>{const c=b.G.map(({content:d})=>d&&[d.id,d.amount,d.data]);for(;0<c.length&&null===c[c.length-1];)c.pop();Ua(`minicraft.world.${a.id}:meta`,Oa({p:{h:b.kb,i:c,m:b.u,p:[b.H,b.J,b.K,b.O,b.ea]},s:[a.wa,a.xa,a.ya],v:1}));Na.all(a.Z.filter(d=>d.ha).map(d=>$b(a,d)))},bc=(a,b)=>{const c=S.getItem(`minicraft.world.${a.id}:meta`);if(c){const {p:d,s:e,v:k}=Pa(c);null!=k&&(d.i.forEach((l,p)=>{l&&(b.G[p].content=
rb(l[0],l[1],l[2]))}),b.kb=d.h,b.u=d.m,b.H=d.p[0],b.J=d.p[1],b.K=d.p[2],b.O=d.p[3],b.ea=d.p[4],a.wa=e[0],a.xa=e[1],a.ya=e[2])}},cc=a=>n(function*(){const b=a.Z[a.Ga[a.oa=0].fb];var c=b.y;yield Db(a.id,`${b.Ca}/${b.Pa}`+(0<c?"/"+c:""));b.ha=!1;++b.Ca;return Yb(a,!1)}()),$b=(a,b)=>{const c=a.Ea;var d=a.L;const e=b.y,k=(256<<d)-256;for(let l=0,p=-1,f=((b.x<<d+4|b.z)<<6|e)<<2;16>l;++l){for(d=0;16>d;++d)Y[++p]=c[f],Y[++p]=c[++f],Y[++p]=c[++f],Y[++p]=c[++f],f+=13;f+=k}b.ha=!1;return Cb(a.id,`${b.Ca}/${b.Pa}`+
(0<e?"/"+e:""))},Yb=(a,b)=>n(function*(){const c=a.Z,d=a.Ga,e=a.sa,k=a.ta,l=d.length;for(;a.oa<l;){var p=d[a.oa++],f=c[p.fb],g=f.loaded,m=f.x;const h=f.y;var u=f.z,w=e+p.sa+m;const t=k+p.ta+u;if(!g||w!==f.Ca||t!==f.Pa){f.loaded=a.busy=!0;p=f.ha&&$b(a,f);var v=a.id;w=f.Ca=w;f=f.Pa=t;f=Ab(yield Bb(v,`${w}/${f}`+(0<h?"/"+h:"")));yield p;a.busy=!1;if(g||0===h||f){p=a.Ea;w=a.L;v=(256<<w)-256;m=((m<<w+4|u)<<6|h)<<2;if(f)for(let C=0,x=-1;16>C;++C){for(g=0;16>g;++g)p[m]=Y[++x],p[++m]=Y[++x],p[++m]=Y[++x],
p[++m]=Y[++x],m+=13;m+=v}else for(u=0;16>u;++u){for(f=0;16>f;++f)p[m]=0<h?0:50397446,p[++m]=0<h?0:131843,g?(p[++m]=0,p[++m]=0,m+=13):m+=15;m+=v}if(!b)break}}}}());let dc=null,ec=null,fc=new Image;fc.crossOrigin="anonymous";fc.onload=()=>{const a=ua.createElement("canvas");a.width=16;a.height=416;const b=a.getContext("2d");b.drawImage(fc,0,0);da("tile","div[className=bitmap]",{S:{backgroundImage:`url(${a.toDataURL()})`}});dc=new Ya(b.getImageData(0,0,16,416).data.buffer);ec&&ec();fc=ec=null};
fc.src=ASSETS+"blocks.webp";const hc=(a,b)=>{const c={pb:b,Sa:b.getContext("2d",{alpha:!1,desynchronized:!0}),eb:null,ib:"",U:!1,jb:0,Xa:0,rb:db(()=>(c.jb=c.Xa,c.Xa=0),1E3),o:a};null===dc&&(ec=()=>c.U=!0);gc(c);return c},gc=a=>{const b=a.pb,c=a.o;(a.eb=a.Sa.createImageData(b.width=c.ua,b.height=c.va)).data.fill(255);const d=c.ua*c.g.W/c.ja,e=c.va*c.g.W/c.ja;b.style.width=d+"px";b.style.height=e+"px";b.style.left=za((c.Ma-d)/2)+"px";b.style.top=za((c.Na-e)/2)+"px";a.Sa.fillStyle="rgba(255,255,255,.5)"};
let ic=0;
const lc=(a,b,c,d)=>{const e={Y:null,Ea:null,busy:!1,Z:null,Ga:null,oa:0,A:!0,Ia:0,Ja:0,Ka:0,id:c.Ba,sa:0,ta:0,L:0,wa:.5,xa:8.5,ya:.5,time:0,Oa:0},k=ub(e,d);bc(e,k);a={actions:a,g:c,gb:0,hb:0,Ha:!1,pa:!0,qa:!1,sb:b,$:0,V:new Set,Ya:"",l:0,N:[],j:k,Za:null,B:null,ja:1,Ma:1,Na:1,ua:0,va:0,ub:db(()=>{e.A||(e.time=(e.time+1)%24E3,e.Oa=1/24E3*(e.Oa+6E3)%1,Zb(e,k,!1))},50),world:e};jc(a,null);kc(a);return a},mc=a=>{ac(a.world,a.j);a.actions.P(a.world.id,{mod_l:Date.now()})},kc=a=>{n(function*(){try{yield a.sb.requestPointerLock()}catch(b){}}())},nc=
(a,b)=>a===b?0:.1-.2*a,oc=a=>{a.j.Qa=nc((a=a.V).has(-12)||a.has(65),a.has(-13)||a.has(68))},pc=a=>{a.j.cb=nc((a=a.V).has(-15)||a.has(16),a.has(-14)||a.has(32))},qc=a=>{a.j.Ra=nc((a=a.V).has(-11)||a.has(83),a.has(-10)||a.has(87))},rc=a=>{a.j.mb=nc(a.V.has(-18),a.V.has(-19))},sc=a=>{a.j.nb=nc(a.V.has(-17),a.V.has(-16))},uc=(a,b,c)=>{if(!a.world)return!1;const d=a.V;var e=a.j;if(c){if(d.has(b))return!1;d.add(b);var k=e.fa,l=e.X;c=e.ga;switch(b){case -18:case -19:rc(a);break;case -17:case -16:sc(a);break;
case -1:2!==e.u&&0<=l&&(0===e.La?0===e.u&&(b=Jb(a.world,k,l,c),2===b?b=3:1===b&&(b=4),6===b||8!==b&&13!==b&&null!==tb(e.G,rb(b,1)))||(Kb(a.world,k,l,c),e.X=-1):tc(a,[k,l,c],!1));break;case -2:case 71:if(0<=l){const p=Jb(a.world,k,l,c);c=e.G.slice(0,9);l=c.findIndex(f=>null!==f.content&&f.content.id===p);0<=l?e.M=l:1===e.u&&(c[e.M].content&&(c=c.findIndex(f=>null===f.content),0<=c&&(e.M=c)),e.G[e.M].content=rb(p));e.ka=a.$}break;case -3:if(2!==e.u&&0<=l)if(0===e.La){if(b=e.G[e.M],b.content){switch(e.Da){case 0:--k;
break;case 1:++k;break;case 2:--l;break;case 3:++l;break;case 4:--c;break;default:++c}0<=l&&64>l&&Lb(a.world,k&(1<<4+a.world.L)-1,l,c&(1<<4+a.world.L)-1,b.content.id)&&1!==e.u&&0>=--b.content.amount&&(b.content=null)}}else tc(a,[k,l,c],!0);break;case -4:e.M=(e.M+9-1)%9;e.ka=a.$;break;case -5:e.M=(e.M+1)%9;e.ka=a.$;break;case 27:0===a.l&&(a.world.A=!0,a.l=1);break;case -15:case -14:case 16:case 32:pc(a);break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:e.M=b-49;e.ka=a.$;
break;case -12:case -13:case 65:case 68:oc(a);break;case 69:if(0===a.l){a.l=3;for(const p of d)uc(a,p,!1)}break;case 80:a.world&&(a.world.A=!a.world.A);break;case 81:e=e.G[e.M];if(d.has(17)||e.content&&0>=--e.content.amount)e.content=null;break;case -11:case -10:case 83:case 87:qc(a);break;case 84:if(0===a.l){a.l=2;for(const p of d)uc(a,p,!1)}break;case 112:a.pa=!a.pa;break;case 114:a.Ha=!a.Ha;break;default:return!1}}else{if(!d.delete(b))return!1;switch(b){case -15:case -14:case 16:case 32:pc(a);
break;case -12:case -13:case 65:case 68:oc(a);break;case -11:case -10:case 83:case 87:qc(a);break;case -18:case -19:rc(a);break;case -17:case -16:sc(a)}}a.Ya=[...d].join();return!0},vc=(a,b)=>(b=b.startsWith("~")?a+T(b.substr(1)):T(b),isNaN(b)?a:b),xc=(a,b)=>{const c=a.j;var d=a.world;if(b)if("/"===b.charAt(0)){b=b.substr(1).split(" ");const e=b.shift();switch(e){case "clear":a.N=[];break;case "clearinv":for(const k of c.G)k.content=null;Z(a,"\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440 \u043f\u0443\u0441\u0442",
!0);break;case "gamemode":case "gm":b=T(b[0]);!isNaN(b)&&0<=b&&3>b&&0===b%1?(c.u=b,Z(a,"\u0418\u0433\u0440\u043e\u0432\u043e\u0439 \u0440\u0435\u0436\u0438\u043c \u0441\u043c\u0435\u043d\u0451\u043d \u043d\u0430: "+b,!0)):Z(a,"\u0418\u0433\u0440\u043e\u0432\u043e\u0439 \u0440\u0435\u0436\u0438\u043c \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442 0..2!");break;case "give":if(0===b.length){Z(a,"/give <id> [\u0427\u0438\u0441\u043b\u043e]\n"+nb.join(" "));break}d=nb.indexOf((b[0]||"").toLowerCase());
d=0<=d?d:T(b[0]);b=T(b[1]||1);!isNaN(d)&&0<d&&25>d&&0===d%1?!isNaN(b)&&0<b&&0===b%1?Z(a,tb(c.G,rb(d,b))?"\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440 \u043f\u043e\u043b\u043d\u044b\u0439!":`${"\u0412\u0435\u0449\u0438 \u0434\u0430\u043d\u044b"} ${b} ${ob[d]}`,!0):Z(a,"\u0427\u0438\u0441\u043b\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442 \u043c\u0438\u043d\u0438\u043c\u0443\u043c 1!"):Z(a,"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0442\u0438\u043f \u0431\u043b\u043e\u043a\u0430!");
break;case "help":Z(a,"\u041a\u043e\u043c\u0430\u043d\u0434\u0430: clear, clearinv, gamemode, give, help, load, me, save, spawn, teleport, version");break;case "load":Yb(d,!0).then(()=>{a.B.U=!0;Z(a,"\u0427\u0430\u043d\u043a\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f.",!0)});break;case "me":Z(a,c.name+" "+b.join(" "),!0);break;case "save":mc(a);Z(a,"\u0418\u0433\u0440\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430.",!0);break;case "smart":c.name="LFF5644";
Z(a,"lff.smart: true",!0);break;case "spawn":d.wa=c.H;d.xa=c.J;d.ya=c.K;Z(a,"\u041d\u0430\u0447\u0430\u043b\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430",!0);break;case "teleport":case "tp":0===b.length?(c.H=d.wa,c.J=d.xa,c.K=d.ya,a.B.U=!0,Z(a,"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u0441\u044f \u043a \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0439 \u0442\u043e\u0447\u043a\u0438",!0)):3===b.length?(Z(a,"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u0441\u044f \u043a"+
` ${c.H=vc(c.H,b[0])} ${c.J=vc(c.J,b[1])} ${c.K=vc(c.K,b[2])}`,!0),a.B.U=!0):Z(a,"\u041d\u0435\u043f\u043e\u0432\u0435\u0437\u043b\u043e!");c.aa=0;c.ba=0;c.ca=0;break;case "version":Z(a,"Minicraft 0.9.9");break;case "/exit":c.La=0;Z(a,"\u041a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0440\u0435\u0436\u0438\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u043c\u044b\u0448\u043a\u0438.",!0);break;case "/expand":a.j.ma&&a.j.na?d=!0:(Z(a,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043d\u0430\u0447\u044f\u043b\u043e!"),
d=!1);d&&("vert"===b[0]?(c.ma[1]=0,c.na[1]=63,Z(a,"\u0412\u044b\u0431\u043e\u0440\u044c \u0443\u0432\u0435\u043b\u0438\u0447\u0435\u043d.",!0)):Z(a,'\u0422\u043e\u043b\u043a\u043e "vert" \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f!'));break;case "/pos1":case "/pos2":tc(a,[M(c.H),M(c.J),M(c.K)],"/pos2"===e);break;case "/regen":cc(d).then(()=>{a.B.U=!0;Z(a,"\u0427\u0430\u043d\u043a\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f ",
!0)});break;case "/show":Z(a,`${"\u041f\u0435\u0440\u0432\u044b\u0439"}: ${c.ma?c.ma.join(" "):"\u043d\u0438\u0447\u0435\u0433\u043e"}, ${"\u0412\u0442\u043e\u0440\u043e\u0439"}: ${c.na?c.na.join(" "):"\u043d\u0438\u0447\u0435\u0433\u043e"}`);break;case "/wand":c.La=1;Z(a,"\u0412\u044b\u0431\u043e\u0440\u044c \u0441 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u043c\u044b\u0448\u043a\u0438.",!0);break;default:Z(a,"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u043d\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430: "+
e)}}else{const e=Z(a,`<${c.name}> `+b);jc(a,b).then(k=>{k&&wc(a,e)})}},Z=(a,b,c=!1)=>{const d=++ic;(a.N=a.N.slice(-49)).push({id:d,lb:c,time:pa(),value:b});return d},wc=(a,b)=>{const c=a.N.findIndex(d=>d.id===b);0<=c&&a.N.splice(c,1)},tc=(a,b,c)=>{c?a.j.na=b:a.j.ma=b;Z(a,`${c?"\u0412\u0442\u043e\u0440\u0430\u044f \u0432\u044b\u0431\u0440\u0430\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430":"\u041f\u0435\u0440\u0432\u0430\u044f \u0432\u044b\u0431\u0440\u0430\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430"}: ${b.join(" ")}`,
!0)},jc=(a,b)=>(ib(a.Za),(b?fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({msg:b})}):fetch("/api/chat")).then(c=>{if(c.ok)return c.text()}).then(c=>{if(c){c=c.split("\n").filter(Boolean);for(const d of c)d.startsWith("<")&&Z(a,d);return 0<c.length}return!1}).catch(()=>!1).then(c=>{a.Za=cb(()=>{jc(a,null)},5E3);return c})),yc=({id:a})=>(D("#tile",{S:{backgroundPositionY:`-${2*(a-1)}rem`}}),null);
function zc({amount:a,u:b,id:c}){D("div[className=stack]",{title:ob[c]+(1===b?` (${nb[c]}, ${c})`:"")});return[I(yc,{id:c}),1!==a&&J("div[className=amount]",{innerText:a})]}
function Ac({j:a,la:b}){D("div[className=bar]",{ontouchstart:H(d=>{a.M=Number(d.target.closest("[data-slot]").dataset.slot);a.ka=d.timeStamp}),S:{opacity:Aa(.5,P(1,1-5E-4*(b-a.ka-5E3)))}});const c=a.u;return dc&&a.G.slice(0,9).map(({content:d},e)=>J("div",{D:{slot:e},F:{active:e===a.M}},[d&&I(zc,{amount:d.amount,data:d.data,u:c,id:d.id})]))}
function Bc({tb:a}){D("div[className=grid]",{onclick:({target:b})=>{(b=b.closest("[data-id]"))&&sb({content:rb(T(b.dataset.id)),filter:null,T:64},a)}});return nb.map((b,c)=>0<c&&J("div",{D:{id:c}},[I(zc,{amount:1,data:null,u:1,id:c})]))}
function Cc({o:a}){const b=ha(()=>({content:null,filter:null,T:64})),c=a.j.u;D("div[className=menu overlay inventory]",ha(()=>({onclick:({target:d})=>{if("menu overlay inventory"===d.className)b.content?b.content=null:(a.l=0,a.world.A=!1,kc(a));else if(d=d.closest("[data-slot]"))d=a.j.G[T(d.dataset.slot)],b.content?sb(b,d):d.content&&sb(d,b)},oncontextmenu:({target:d})=>{if("menu overlay inventory"===d.className)b.content?0>=--b.content.amount&&(b.content=null):(a.l=0,kc(a));else if(d=d.closest("[data-slot]"))d=
a.j.G[T(d.dataset.slot)],b.content?sb(b,d,1):d.content&&sb(d,b,ya(d.content.amount/2))}})));return dc&&[J("div[className=window]",null,[J("h2[innerText=\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440]"),1===c&&I(Bc,{tb:b}),J("div[className=grid]",null,a.j.G.map(({content:d},e)=>J("div",{D:{slot:e},F:{first:9>e}},[d&&I(zc,{amount:d.amount,data:d.data,u:c,id:d.id})])))]),b.content&&J("div[className=hand]",{S:{transform:`translate(${a.gb}px, ${a.hb}px)`}},[I(zc,{amount:b.content.amount,data:b.content.data,
u:0,id:b.content.id})])]}const Dc=({I:{lb:a,time:b,value:c},la:d})=>(D(a?"div[className=minor]":"div",{innerText:c,S:{opacity:P(1,1-.001*(d-b-4500))}}),null);function Ec({N:a,la:b}){D("div[className=messages]");const c=b-5E3;return[oa(Dc,a.slice(-10).filter(d=>d.time>c),{la:b})]}
function Fc({actions:{qb:a,Va:b},g:c,o:d,Aa:e}){E(()=>mc(d));D("div[className=menu overlay]");return[J("h1[innerText=\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438]"),H(J("center",null,[J("button[innerText=\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u0432 \u0438\u0433\u0440\u0443]",{onclick:()=>{d.l=0;d.world.A=!1;kc(d)}})])),J("div[className=settings]",null,[J("button",{innerText:"\u041f\u043e\u0432\u0435\u0440\u0445\u043d\u043e\u0441\u0442\u044c:\n"+(c.ia?"\u0421 \u0442\u0435\u043a\u0441\u0442\u0443\u0440\u0430\u043c\u0438":
"\u041e\u0434\u043d\u043e\u0446\u0432\u0435\u0442\u043d\u044b\u0439"),onclick:H(()=>a(k=>({ia:!k.ia})))}),J("label[innerText=\u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e:]",null,[J("input[type=range][min=1][max=100][step=1]",{value:101-c.W,onchange:H(k=>b({W:101-Number(k.target.value)}))})]),J("label[innerText=\u0420\u0430\u0434\u0438\u0443\u0441 \u0437\u0440\u0435\u043d\u0438\u044f:]",null,[J("input[type=range][min=1][max=180][step=1]",{value:c.za,onchange:H(k=>b({za:Number(k.target.value)}))})]),
J("label[innerText=\u0414\u0430\u043b\u043d\u043e\u0441\u0442\u044c \u0437\u0440\u0435\u043d\u0438\u044f:]",null,[J("input[type=range][min=1][max=128][step=1]",{value:c.da,onchange:H(k=>b({da:Number(k.target.value)}))})]),J("label[innerText=\u0427\u0443\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u043c\u044b\u0448\u043a\u0438.:]",null,[J("input[type=range][min=1][max=15][step=1]",{value:c.ra,
onchange:H(k=>b({ra:Number(k.target.value)}))})])]),H(J("center",null,[J("button[innerText=\u041f\u043e\u043a\u0438\u043d\u0443\u0442 \u043c\u0438\u0440]",{onclick:()=>{e(0)}})]))]}const Gc=({I:{lb:a,value:b}})=>(D(a?"div[className=minor]":"div",{innerText:b}),null);
function Hc({o:a,N:b}){const c=H({history:null,input:null});D("div[className=menu overlay terminal]",{onclick:d=>{d.target!==c.input&&c.input.focus()}});E(d=>{d&&cb(()=>c.history.scrollTop=1E9,0)},[b.length&&b[b.length-1].id]);return[H(J("div[className=toolbar]",null,[J("button[innerText=\u274c]",{onclick:()=>{a.l=0;a.world.A=!1;kc(a)}})])),J("div[className=history]",{R:H(d=>{c.history=d})},[oa(Gc,b)]),H(J("input[enterkeyhint=send][mozactionhint=send][name=message][required]",{onkeydown:d=>{const e=
d.keyCode;d=d.target;13===e?(xc(a,d.value),d.value=""):27===e&&(a.A=!1,a.l=0)},R:d=>{c.input=d;cb(()=>d.focus(),0)}}))]}const Ic=[["pick",-2],["up",-14],["down",-15],["E",69],["T",84],["F1",112],["F3",114],["...",27]],Jc=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]],Kc=[["up",-16],["down",-17],["left",-18],["right",-19],["center",-3]];
function Lc({o:a}){const b=a.V,c=([d,e])=>J("div",{D:{code:e},F:{button:!0,[d]:!0,active:b.has(e)}});D("div[className=touch]",H({ontouchstart:d=>{d.preventDefault();const e=Number(d.target.dataset.code);if(null!=e&&uc(a,e,!0)){const k=d.changedTouches[0].identifier,l=p=>{p.changedTouches[0].identifier===k&&(removeEventListener("touchend",l),uc(a,e,!1))};addEventListener("touchend",l)}}}));return[J("div[className=top]",null,Ic.map(([d,e])=>J(`div[innerText=${d}]`,{D:{code:e},F:{button:!0,active:b.has(e)}}))),
J("div[className=move]",null,Jc.map(c)),J("div[className=move sec]",null,Kc.map(c))]}
function Mc({account:a,actions:b,g:c,frame:d,$a:e,Aa:k}){const l=pa(),p=ua.pointerLockElement===d,f=ha(()=>e.o=lc(b,d,c,a));E(()=>{const g=v=>{if(0!==f.l)return!0;f.qa=!1;ua.pointerLockElement===d?uc(f,-1-v.button,"mousedown"===v.type):kc(f);v.preventDefault();return!1},m=v=>{if(f.world.A)f.gb=v.clientX,f.hb=v.clientY;else{const h=f.g.ra*va/(Aa(f.Ma,f.Na)*f.ja);vb(f.j,v.movementX*h,-v.movementY*h)}},u=v=>{f.qa=!1;if(0===f.l&&!f.world.A&&5<Math.abs(v.deltaY)){const h=0<v.deltaY?-5:-4;uc(f,h,!0);uc(f,
h,!1);v.preventDefault()}},w=v=>{f.qa=!0;0===f.l&&(f.world.A=!1,v.preventDefault())};d.addEventListener("mousedown",g);d.addEventListener("mouseup",g);d.addEventListener("mousemove",m);d.addEventListener("wheel",u);d.addEventListener("touchstart",w);return()=>{d.removeEventListener("mousedown",g);d.removeEventListener("mouseup",g);d.removeEventListener("mousemove",m);d.removeEventListener("wheel",u);d.removeEventListener("touchstart",w);ib(f.Za);jb(f.ub);ac(f.world,f.j);jb(f.B.rb);e.o=null}});E(()=>
{f.g=c;f.B&&(f.B.U=!0);const g=f.world;var m=ya(Ja(f.g.da/16*2+2));if(g.L!==m){var u=f.j;g.Z&&ac(g,u);const w=1<<(g.L=m),v=g.Z=[];for(let h=0;h<w;++h)for(let t=0;t<w;++t)for(let C=0;4>C;++C)v.push({ha:!1,loaded:!1,x:h,y:C,z:t,Ca:0,Pa:0});m=w<<m+12+2;null===g.Y||g.Y.length<m?g.Ea=new Ya((g.Y=new Xa(m)).buffer):g.Ea.fill(0);Zb(g,u,!0)}},[c]);E((g,m,u)=>{f.ja=u;f.Ma=Aa(1,g);f.Na=Aa(1,m);m=f.g.W;g=ya(f.Ma*f.ja/m);m=ya(f.Na*f.ja/m);if(g!==f.ua||m!==f.va)f.ua=g,f.va=m,f.B&&(f.B.U=!0,gc(f.B))},[d.offsetWidth,
d.offsetHeight,qa.devicePixelRatio||1,c.W]);E(()=>{p||f.world.A||0!==f.l||(f.l=1);f.world.A=!p},[p]);E(g=>p&&g&&ua.exitPointerLock(),[f.world.A||0!==f.l]);E(()=>{if(f.world){if(f.$&&!f.world.A){var g=f.j,m=P(5,.01*(l-f.$));g.aa-=.1*g.aa*m;g.ba-=.1*g.ba*m;g.ca-=.1*g.ca*m;g.aa+=(Ba(g.O)*g.Qa+Ca(g.O)*g.Ra)*m;g.ba+=g.cb*m;g.ca+=(-Ca(g.O)*g.Qa+Ba(g.O)*g.Ra)*m;vb(g,g.mb*m,g.nb*m);g.H+=g.aa*m;g.J+=g.ba*m;g.K+=g.ca*m}if(f.B){g=f.B;++g.Xa;m=g.Sa;var u=g.eb;const ja=g.o,Da=ja.g,eb=ja.pa,z=ja.j,aa=ja.ua,fa=
ja.va,N=ja.world;if(!N.A||g.U){g.U=!1;const ra=u.data,Nc=Da.da;var w=z.O,v=z.ea;const Oc=z.fa,Pc=z.ga;var h=z.H,t=z.J,C=z.K;const Qc=eb?z.X:-1,Rc=N.Y;var x=N.L;const Sc=Da.ia&&null!==dc;var G=1/aa,O=1/fa;const sa=aa>>1,ta=fa>>1,Nb=P(aa,fa),Ob=32<Nb,Pb=Ba(w);w=Ca(w);const Qb=Ba(-v);v=Ca(-v);var q=Da.za/45;const Tc=G*(aa<fa?q*aa*O:q);G=O*(fa<aa?q*fa*G:q);h+=65536;t+=65536;C+=65536;O=h%1;q=t%1;const Uc=C%1;x=4+x;const Rb=(1<<x)-1;let Sb=1===z.u?6:4,ka=z.fa=z.ga=z.Da=0;z.X=-1;for(let Qa=0;Qa<fa;++Qa){var r=
(ta-Qa)*G;const Tb=r*Qb-v;var y=r*v+Qb;r=y*w;y*=Pb;for(let Ra=0;Ra<aa;++Ra){var A=(Ra-sa)*Tc;const Ub=r+Pb*A;A=y-w*A;let Ea=16757124,Sa=1,Vb=Nc;for(let L=0;3>L;++L){let Q=A;0===L&&(Q=Ub);1===L&&(Q=Tb);var V=1/(0>Q?-Q:Q);const Ta=Ub*V,la=Tb*V;V*=A;const Wb=Ia(Ta*Ta+la*la+V*V);var F=Uc;0===L&&(F=O);1===L&&(F=q);0<Q&&(F=1-F);let Fa=h+Ta*F-(0===L&0>Q|0),Ga=t+la*F-(1===L&0>Q|0),Ha=C+V*F-(2===L&0>Q|0);F*=Wb;for(let fb,gb,hb,R;F<Vb;Fa+=Ta,Ga+=la,Ha+=V,F+=Wb)if(65536>Ga){if(0>la)break}else if(65600<=Ga){if(0<
la)break}else if(0!==(R=Rc[((fb=Fa&Rb)<<x|(hb=Ha&Rb))<<6|(gb=Ga&63)])){Qa===ta&&Ra===sa&&F<=Sb&&(z.fa=fb,z.X=gb,z.ga=hb,z.Da=0>Q|L<<1,Sb=F);if(Sc){--R;1===L?6===R?R=25:13===R?R=4:1===R&&0<la&&(R=2):1===R&&(R=24);const Xb=dc[R<<8|(16*(1===L?Ha:Ga)&15)<<4|16*(1===L?Fa:(0<Q?Fa-Ha:Ha-Fa)+65536)&15];if(0===Xb>>>24)continue;Ea=Xb&16777215}else Ea=pb[R];Vb=F;Sa=(0===L?.8:2===L?.6:0<Q?.4:1)+(gb!==Qc||fb!==Oc||hb!==Pc?0:.2);break}}ra[ka]=(Ea&255)*Sa;ra[++ka]=(Ea>>8&255)*Sa;ra[++ka]=(Ea>>16)*Sa;ka+=2}}eb&&
!Ob&&(ra[ka=aa*ta+sa<<2]+=128,ra[++ka]+=128,ra[++ka]+=128);m.putImageData(u,0,0);eb&&Ob&&(u=ya(.05*Nb),m.fillRect(sa-u,ta-1,u<<1,2),m.fillRect(sa-1,ta-u,2,u-1),m.fillRect(sa-1,ta+1,2,u-1))}g.ib=ja.Ha?"Minicraft 0.9.9 "+M(g.jb).toString().padStart(2,"\u00a0")+" fps, T: "+M(24*N.Oa).toString().padStart(2,"0")+":"+M(24*N.Oa%1*60).toString().padStart(2,"0")+"; "+(N.A&&500>l%1E3?"":N.time)+"\nR: "+aa+"x"+fa+" (x"+Da.W+"), D: "+Da.da+", C: "+N.oa+"/"+N.Ga.length+", M: "+(64*U(1<<4+N.L)>>10)+"k\nE: 0/0 M: "+
z.u+"\n\nPosition: "+z.H.toFixed(2)+" "+z.J.toFixed(2)+" "+z.K.toFixed(2)+"\nAngle: "+(z.O*xa).toFixed(2)+" "+(z.ea*xa).toFixed(2)+"\nBlock: "+(0>z.X?0:z.fa+" "+z.X+" "+z.ga+" "+qb[z.Da]+": "+Jb(N,z.fa,z.X,z.ga))+"\nChunk abs: "+(M(z.H)>>4)+" "+(M(z.K)>>4)+" "+(M(z.J)>>4)+" rel: "+N.Ia+" "+N.Ka+" "+N.Ja:""}}f.$=l},[l]);ma();return[J("canvas",{R:H(g=>{f.B=hc(f,g)})}),f.pa&&2!==f.l&&I(Ec,{N:f.N,la:l}),f.B&&f.Ha&&J("div[className=diagnostics]",{innerText:f.B.ib}),f.qa&&I(Lc,{o:f,Ya:f.Ya}),f.pa&&3!==
f.l&&2!==f.j.u&&I(Ac,{j:f.j,la:l}),3===f.l&&I(Cc,{o:f,la:l}),1===f.l&&I(Fc,{actions:b,g:c,o:f,Aa:k}),2===f.l&&I(Hc,{o:f,N:f.N})]}
function Vc({I:a,vb:b,wb:c,xb:d}){D("div",{F:{selected:a===c},onclick:()=>{d(a.id)}});c=`${a.local?"L":"_"}${a.local&&a.remote?a.local>a.remote?">":a.local<a.remote?"<":"=":"_"}${a.remote?a.public?"R":"r":"_"}`;b===a.id&&(c=`[${c}]`);return[J("span",{innerText:`${c} ${a.label}`,title:a.account_name?"\u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446: "+a.account_name:"\u0422\u043e\u043b\u043a\u043e \u043b\u043e\u043a\u0430\u043b\u043d\u044b\u0439 \u043c\u0438\u0440"}),J("span",{innerText:lb(Math.max(a.local,
a.remote),!0)})]}
function Wc({account:a,actions:b,g:c,Aa:d}){D("div[className=menu]");const [e,k,l]=na(0),p=H(()=>{k(l()+1)}),f=H({value:null}),g=ea(()=>n(function*(){try{const q=!f.value&&!e,r=yield fetch("/api/minicraft/"+`world?what=${q?"initial":"meta_all"}`);if(!r.ok)throw Error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");const y=yield r.json();if(!q)return y;if("0.9.9"!==y.version_latest)return location.reload(),null;ba();b.ob(y.account);return y.worlds}catch(q){return alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0441\u043f\u0438\u0441\u043a\u0430 \u043c\u0438\u0440\u043e\u0432: "+
q.message),[]}}()),[e],null),m=ha(()=>{g&&(f.value=g);const q=[];f.value&&q.push(...f.value.map(r=>({account_name:r.account_name,hash:r.hash,id:r.id,label:r.label,local:0,public:r.public,remote:r.modified,writable:r.writable})));for(const r of c.worlds){const y=q.find(A=>A.id===r.id);if(y){const A=y.local=r.mod_l,V=y.remote,F=r.mod_r;A>F&&V>F&&(confirm('\u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442! \u041c\u0438\u0440. "'+r.label+'" \u0431\u044b\u043b\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e \u043a\u0430\u043a \u0437\u0434\u0435\u0441\u044c, \u0442\u0430\u043a \u0438 \u0432 \u0434\u0440\u0443\u0433\u0438\u0445 \u043c\u0435\u0441\u0442\u0430\u0445.\n\u041e\u041a: \u043f\u0440\u0438\u043d\u044f\u0442\u044c \u0442\u043e, \u0447\u0442\u043e \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 ('+
lb(V,!1)+") | \u041e\u0442\u043c\u0435\u043d\u0438\u0442: \u0412\u043e\u0442 \u044d\u0442\u043e \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c ("+lb(A,!1)+")")?b.P(r.id,{mod_l:y.local=F}):b.P(r.id,{mod_r:y.remote=F}))}else 1<r.mod_r&&g&&g.length&&(alert('\u041c\u0438\u0440 "'+r.label+'" \u0431\u044b\u043b \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044c, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043e\u043d \u0442\u0435\u043f\u0435\u0440\u044c \u043b\u043e\u043a\u0430\u043b\u043d\u044b\u0439!'),
b.P(r.id,{mod_r:0})),q.push({account_name:"",hash:0,id:r.id,label:r.label,local:r.mod_l,public:!1,remote:1===r.mod_r?1:0,writable:!0})}return q.sort((r,y)=>Math.max(y.local,y.remote)-Math.max(r.local,r.remote))},[g,c.worlds]),[u,w,v]=na(c.Ba),h=ha(()=>m.find(q=>q.id===u)||null,[u,m]),t=ha(()=>{let q,r;return null!=(r=null==m?void 0:null==(q=m.find(y=>0<y.local&&0<y.remote&&y.local!==y.remote))?void 0:q.id)?r:null},[m]);E(()=>{if(null!==t){var q=!1,r=m.find(y=>y.id===t);if(r.local<r.remote)fetch("/static/minicraft/worlds/"+
`${r.hash}.json`).then(y=>y.json()).then(y=>{if(!q)return Fb(t,y).then(()=>{b.P(t,{mod_l:r.remote,mod_r:r.remote})})}).catch(y=>{q||("QuotaExceededError"===y.name?(alert("\u041d\u0435\u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u043f\u0430\u043c\u044f\u0442\u0438!"),b.bb(t),Gb(t)):alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u043c\u0438\u0440\u0430: "+y.message))});else{if(!r.writable){b.P(t,{mod_l:c.worlds.find(A=>A.id===t).mod_r});
return}let y=t;(1===r.remote?fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({what:"meta",label:r.label})}).then(A=>{if(!A.ok)throw Error(403===A.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");return A.json()}).then(A=>
{y=A.id}):Na.resolve()).then(()=>{if(q)throw null;return Eb(t)}).then(A=>{if(q)throw null;return fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({what:"data",world:y,data:A})})}).then(A=>{if(!A.ok)throw Error(403===A.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");
return A.json()}).then(A=>{ba();y===t?b.P(t,{mod_l:A.modified,mod_r:A.modified}):(Hb(t,y),b.bb(t),b.ab({id:y,label:r.label,mod_l:A.modified,mod_r:A.modified}),q||v()!==t||w(y));q||p();ca()}).catch(A=>{q||(alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0441\u043a\u0435 \u043c\u0438\u0440\u0430: "+A.message),ba(),b.P(t,{mod_r:0}),ca())})}return()=>{q=!0}}},[t]);const [C,x]=na(!1);h||x(!1);const [G,O]=na(!1);return[J("h1[innerText=\u041c\u0438\u0440\u044b]"),
J("button[innerText=\u041e\u0431\u043d\u043e\u0432\u0438\u0442][style=position:absolute;left:0;top:0;height:2rem][title=\u041e\u0431\u043d\u043e\u0432\u0438\u0442 \u0441\u043f\u0438\u0441\u043e\u043a]",{disabled:!g,onclick:p}),J("button[style=position:absolute;right:0;top:0;height:2rem]",{disabled:0<a.rank,innerText:a.rank?a.label:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f ",onclick:()=>{location.href="/account?redir=minicraft"}}),
J("div[className=worlds]",null,[oa(Vc,m,{yb:e,vb:t,wb:h,xb:w})]),J("center",null,[J("button[innerText=\u041e\u0442\u043a\u0440\u044b\u0442]",{disabled:!h||!h.local||h.remote>h.local,onclick:()=>{ba();b.Va({Ba:h.id});d(1);ca()},title:h?h.local?h.remote>h.local?"\u041c\u0438\u0440 \u0435\u0449\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u0430!":"\u0417\u0430\u0439\u0442\u0438 \u043d\u0430 \u0432\u044b\u0431\u0440\u0430\u043d\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440":"\u041c\u0438\u0440 \u0435\u0449\u0435 \u043d\u0435 \u0441\u043a\u0430\u0447\u0435\u043d!":
"\u041c\u0438\u0440 \u0431\u044b\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u044c!"}),J("button[innerText=\u041c\u0438\u0440...]",{disabled:!h||C,onclick:()=>{x(!0)},title:h?"\u0410\u043a\u0446\u0438\u0438/\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043c\u0438\u0440\u0430":"\u041c\u0438\u0440 \u0431\u044b\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u044c!"})]),J("hr"),J("center",null,[J("button[innerText=\u041d\u043e\u0432\u044b\u0439 \u043c\u0438\u0440]",
{onclick:()=>{const q=prompt("\u0418\u043c\u044f \u043d\u043e\u0432\u043e\u0433\u043e \u041c\u0438\u0440\u0430:\n(\u043c\u0430\u043a\u0441. 16 \u0441\u0438\u043c\u0431\u043e\u043b\u043e\u0432)","\u041d\u043e\u0432\u044b\u0439 \u043c\u0438\u0440");q&&(16<q.length?alert("\u0418\u043c\u044f \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043e\u043b\u0433\u043e\u0435!"):b.ab({id:Math.min(0,...c.worlds.map(r=>r.id))-1,label:q,mod_l:Date.now(),mod_r:0}))}}),J("button[innerText=\u0421\u0430\u0439\u0442 \u043f\u0440\u043e\u0435\u043a\u0442\u0430]",
{onclick:()=>{open("//github.com/L3P3/minicraft")}})]),J("center",null,[J("small[innerText=\u0412\u0435\u0440\u0441\u0438\u044f 0.9.9 \u043e\u0442 L3P3]")]),C&&h&&J("div",{F:{"menu overlay advanced":!0,busy:G},onclick:q=>{"menu overlay advanced"===q.target.className&&x(!1)}},[J("div[className=window]",null,[J("h2",{innerText:'"'+h.label+'"',title:h.id}),J("table",null,[!!h.account_name&&J("tr",null,[J("td[innerText=\u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446:]"),J("td",{innerText:h.account_name})]),
J("tr",null,[J("td[innerText=\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f:]"),J("td",{innerText:lb(Math.max(h.local,h.remote),!1)})])]),J("center",null,[J("button[innerText=\u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c]",{disabled:G||!h.writable,onclick:()=>{const q=prompt("\u041d\u043e\u0432\u043e\u0435 \u0438\u043c\u044f \u043c\u0438\u0440\u0430:\n(\u043c\u0430\u043a\u0441. 16 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)",h.label);!q||q===h.label||
16<q.length||(h.local&&b.P(h.id,{label:q}),h.remote&&(O(!0),fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({what:"meta",world:h.id,label:q})}).then(r=>{if(!r.ok)throw Error(403===r.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");
return r.json()}).catch(r=>{alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u043c\u0438\u0440\u0430: "+r.message)}).then(()=>{O(!1)})))},title:h.writable?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442 \u0438\u043c\u044f \u043c\u0438\u0440\u0443":"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438!"}),J("button",{disabled:G||!h.local&&!h.writable,innerText:h.local?"\u0423\u0434\u0430\u043b\u0438\u0442\u044c (\u043b\u043e\u043a\u0430\u043b)":
"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",onclick:()=>{confirm('\u041c\u0438\u0440 "'+h.label+'" \u0442\u043e\u0447\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c?')&&(h.local?(b.bb(h.id),Gb(h.id)):(O(!0),fetch("/api/minicraft/world",{method:"DELETE",headers:{"Content-Type":"application/json"},body:Oa({what:"world",world:h.id})}).then(q=>{if(!q.ok)throw Error(403===q.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":
"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");ba();w(null);x(!1);p();O(!1);ca();return q.json()}).catch(q=>{alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0438 \u043c\u0438\u0440\u0430: "+q.message);O(!1)})))},title:h.local||h.writable?"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043c\u0438\u0440":"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438!"})]),
J("center",null,[J("button",{disabled:G||!h.remote||!h.writable,innerText:`${"\u041f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0439"}: ${h.public?"\u0414\u0430":"\u041d\u0435\u0442"}`,onclick:()=>{O(!0);fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({what:"meta",world:h.id,public:!h.public})}).then(q=>{if(!q.ok)throw Error(403===q.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":
"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");ba();p();O(!1);ca();return q.json()}).catch(q=>{alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u043c\u0438\u0440\u0430: "+q.message);O(!1)})},title:h.remote?h.writable?h.public?"\u041f\u0440\u0438\u0432\u0430\u0442\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u0440":"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442 \u043c\u0438\u0440":
"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438!":"\u041c\u0438\u0440 \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d!"}),J("button",{disabled:G||!g||0<h.local&&0<h.remote||!h.remote&&!a.rank,innerText:h.local?g&&h&&!h.remote?"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442":"\u041f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438":"\u0421\u043a\u0430\u0447\u0430\u0442\u044c",onclick:()=>{h.local?h.remote||b.P(h.id,{mod_r:1}):b.ab({id:h.id,label:h.label,
mod_l:1,mod_r:h.remote})},title:g?h.local?h.remote?"\u041c\u0438\u0440 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u043d\u0430 \u0434\u0432\u0443\u0445 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430\u0445!":a.rank?"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442 \u043c\u0438\u0440 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440":"\u041d\u0435 \u0437\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d!":"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442 \u043c\u0438\u0440 \u0438\u0437 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 ":
"\u0421\u043f\u0438\u0441\u043e\u043a \u0435\u0449\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f!"})])])])]}function Xc({account:a,actions:b,g:c,$a:d}){const [e,k]=na(0),l=D("div[className=game]");return[0===e&&I(Wc,{account:a,actions:b,g:c,Aa:k}),1===e&&I(Mc,{account:a,actions:b,g:c,frame:l,$a:d,Aa:k})]}
B.init(()=>{const [a,b]=ia(mb),c=H({o:null});E(()=>{let e=!1;onbeforeunload=onunload=onpagehide=onblur=()=>{e||(e=!0,c.o&&mc(c.o),b.Ta())};onpageshow=onfocus=()=>{e=!1};setInterval(()=>{b.Ta()},500)});const d=H(e=>{if("INPUT"===e.target.tagName||!c.o)return!0;c.o.qa=!1;uc(c.o,e.keyCode,"keydown"===e.type);e.preventDefault();return!1});return[{onkeydown:d,onkeyup:d,oncontextmenu:kb,ondragstart:kb},[I(Xc,{account:a.account,actions:b,g:a.g,$a:c})]]});
