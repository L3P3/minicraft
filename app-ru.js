function p(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function h(l){l.done?d(l.value):Promise.resolve(l.value).then(b,c).then(h,e)}h(a.next())})}
const B=lui,ba=B.defer,ca=B.defer_end,da=B.dom_define,ea=B.hook_async,D=B.hook_dom,E=B.hook_effect,ha=B.hook_memo,ia=B.hook_model,ma=B.hook_rerender,na=B.hook_state,H=B.hook_static,I=B.node,J=B.node_dom,oa=B.node_map,pa=B.now,ta=window,ua=document,K=Math,va=K.PI,wa=.5*va,xa=180/va,M=K.floor,ya=K.ceil,za=K.round,P=K.min,Aa=K.max,Ba=K.cos,Ca=K.sin,Da=K.sqrt,Ea=K.log2,Ka=String.fromCharCode,La=Date,Ma=JSON,Na=Promise,Oa=Ma.stringify,Pa=Ma.parse,S=localStorage,Qa=S.setItem.bind(S),Ra=S.removeItem.bind(S),
Sa=ta.indexedDB,Xa=Uint8Array,Ya=Uint32Array,Za=Map,T=Number,$a=Object,ab=$a.keys,bb=$a.entries,cb=setTimeout,db=setInterval,eb=clearTimeout,fb=clearInterval,gb=addEventListener,lb=removeEventListener,U=a=>a*a,mb=()=>!1,nb=(a,b)=>{const c=new La;a=new La(a);var d=c-a;if(59E3>d)return za(d/1E3)+"s";if(3E6>d)return za(d/6E4)+"m";d=a.getFullYear();const e=a.getMonth(),h=a.getDate();let l="";d<c.getFullYear()&&(l=d+"/");if(l||e<c.getMonth())l+=e+1+"/";if(l||h<c.getDate())l+=h;if(b)return l||"\u0441\u0435\u0433\u043e\u0434\u043d\u044f";
l&&(l+="/");b=l+a.getHours()+":";a=a.getMinutes();a=M(a).toString().padStart(2,"0");return b+a};let V=S.getItem("minicraft.config");if((V=V&&Pa(V))&&V.worlds&&V.version.startsWith("0.9.")){const a=new Set(V.worlds.map(b=>"minicraft.world."+b.id));for(const b of ab(S))b.startsWith("minicraft.world.")&&!a.has(b.split(":")[0])&&Ra(b)}
const ob={init:()=>{let a=!1;var b={ha:!0,ia:!1,qa:3,V:4,ya:120,ca:64,Aa:0,worlds:[]};if(V){let c=V.flag_textures;null!=c&&(b.ha=c);null!=(c=V.mouse_sensitivity)&&(b.qa=c);b.V=V.resolution_scaling;b.ya=V.view_angle;b.ca=V.view_distance;null!=(c=V.world_last)&&(b.Aa=c);null!=(c=V.worlds)?b.worlds=c:S.getItem("minicraft.world.0:meta")&&(b.worlds[0]={id:0,label:(prompt("\u0411\u044b\u043b \u043d\u0430\u0439\u0434\u0435\u043d \u0431\u0435\u0437 \u0438\u043c\u0435\u043d\u0438 \u043b\u043e\u043a\u0430\u043b\u043d\u044b\u0439 \u043c\u0438\u0440. \u041a\u0430\u043a \u0435\u0433\u043e \u043d\u0430\u0437\u0430\u0432\u0451\u0448\u044c? ",
"")||"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439 \u043c\u0438\u0440").substring(0,16),mod_l:Date.now(),mod_r:0},a=!0);V=null}b={account:{label:"",rank:0},config:b,Va:b};return a?(b.Va=null,ob.Ua(b)):b},Ua:a=>{const b=a.config;if(b===a.Va)return a;Qa("minicraft.config",Oa({version:"0.9.10",flag_textures:b.ha,mouse_sensitivity:b.qa,resolution_scaling:b.V,view_angle:b.ya,view_distance:b.ca,world_last:b.Aa,worlds:b.worlds}));return Object.assign({},a,{Va:b})},pb:(a,b)=>Object.assign({},
a,{account:b}),rb:(a,b)=>ob.Ga(a,b(a.config)),Ga:(a,b)=>Object.assign({},a,{config:Object.assign({},a.config,b)}),Ha:(a,b)=>a.config.ia===b?a:ob.Ga(a,{ia:b}),ab:(a,b)=>Object.assign({},a,{config:Object.assign({},a.config,{worlds:[...a.config.worlds,b]})}),bb:(a,b)=>Object.assign({},a,{config:Object.assign({},a.config,{worlds:a.config.worlds.filter(c=>c.id!==b)})}),O:(a,b,c)=>Object.assign({},a,{config:Object.assign({},a.config,{worlds:a.config.worlds.map(d=>d.id===b?Object.assign({},d,c):d)})})},
pb="air stone grass dirt cobble planks bedrock log leaves bricks wool sand gravel glass bookshelf obsidian stone_bricks sandstone lapis_block iron_block gold_block diamond_block emerald_block redstone_block quartz_block".split(" "),qb="\u0412\u043e\u0437\u0434\u0443\u0445;\u041a\u0430\u043c\u0435\u043d\u044c;\u0411\u043b\u043e\u043a \u0442\u0440\u0430\u0432\u044b;\u0417\u0435\u043c\u043b\u044f;\u0411\u0443\u043b\u044b\u0436\u043d\u0438\u043a;\u0414\u043e\u0441\u043a\u0430;\u0411\u0435\u0434\u0440\u043e\u043a;\u0411\u0440\u0435\u0432\u043d\u043e;\u041b\u0438\u0441\u0442\u044c\u044f;\u041a\u0438\u0440\u043f\u0438\u0447\u0438;\u0428\u0435\u0440\u0441\u0442;\u041f\u0435\u0441\u043e\u043a;\u0413\u0440\u0430\u0432\u0438\u0439;\u0421\u0442\u0435\u043a\u043b\u043e;\u041a\u043d\u0438\u0436\u043d\u044f \u043f\u043e\u043b\u043a\u0430;\u041e\u0431\u0441\u0438\u0434\u0438\u0430\u043d;\u041a\u0430\u043c\u0435\u043d\u044b\u0435 \u043a\u0438\u0440\u043f\u0438\u0447\u0438;\u041f\u0435\u0449\u044f\u043d\u0438\u043a;\u0411\u043b\u043e\u043a \u043b\u0430\u0437\u0443\u0440\u0438\u0442\u0430;\u0411\u043b\u043e\u043a \u0436\u0435\u043b\u0435\u0437\u0430;\u0411\u043b\u043e\u043a \u0437\u043e\u043b\u043e\u0442\u0430;\u0411\u043b\u043e\u043a \u0430\u043b\u043c\u0430\u0437\u0430;\u0411\u043b\u043e\u043a \u0438\u0437\u0443\u043c\u0440\u0443\u0434\u0430;\u0411\u043b\u043e\u043a \u0440\u0435\u0434\u0441\u0442\u043e\u0443\u043d\u0430;\u0411\u043b\u043e\u043a \u043a\u0432\u0430\u0440\u0446\u0430".split(";"),
rb=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813],sb="WEBTSN".split(""),tb=(a,b=1,c=null)=>({amount:b,data:c,id:a}),ub=(a,b,c=a.content.amount)=>{if(b.content)a.content.id===b.content.id?(c=P(c,b.P-b.content.amount),a.content.amount-=c,b.content.amount+=c,0>=a.content.amount&&(a.content=null)):!(a.content.amount<=c&&a.content.amount<=b.P&&b.content.amount<=
a.P)||a.filter&&!a.filter(b.content.id)||b.filter&&!b.filter(a.content.id)||([b.content,a.content]=[a.content,b.content]);else if(!b.filter||b.filter(a.content.id))a.content.amount<=c&&a.content.amount<=b.P?[b.content,a.content]=[a.content,b.content]:(c=P(c,b.P),a.content.amount-=c,b.content=tb(a.content.id,c),0>=a.content.amount&&(a.content=null))},vb=(a,b)=>{for(const c of a)if(c.content&&c.content.id===b.id){const d=P(b.amount,c.P-c.content.amount);c.content.amount+=d;if(0>=(b.amount-=d))return null}for(const c of a)if(!c.content&&
(!c.filter||c.filter(b.id)))if(a=P(b.amount,c.P),a<=b.amount){if(c.content=tb(b.id,a),0>=(b.amount-=a))return null}else return c.content=b,null;return b},wb=(a,b)=>({Ra:0,cb:0,Sa:0,N:0,da:0,Ca:0,ea:0,W:-1,fa:0,ma:null,na:null,l:1,kb:20,A:Array(36).fill(null).map(()=>({content:null,filter:null,P:64})),Ma:0,name:b.label||"\u0418\u0433\u0440\u043e\u043a",B:a.va,G:a.wa,H:a.xa,nb:0,ob:0,K:0,ka:0,$:0,aa:0,ba:0}),xb=(a,b,c)=>{a.N=(a.N+b+100*va)%(2*va);a.da=Aa(-wa,P(wa,a.da+c))},yb=a=>{a+=32;33<a&&39>a?a++:
38<a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Ka(a)},zb=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),Bb=()=>{var a=Ab;const b=a.length,c=new Za,d=w=>{m=m<<1|w&1;15===++v&&(g+=yb(m),m=v=0)},e=()=>{for(let w=0;w<t;++w)d(0)},h=w=>{d(w);d(w>>1);d(w>>2);d(w>>3);d(w>>4);d(w>>5);d(w>>6);d(w>>7)},l=()=>{0===--A&&(A=1<<t++)},n=()=>{if(C)C=!1;else{let w=u.id;for(let G=0;G<t;G++)d(w>>G)}};let f=a[0],g="",m=0,v=2,t=2,A=2,k=2,u={id:k++,Ea:new Za},
C=!0;h(f);c.set(f,u);for(let w=1;w<b;++w){const G=u.Ea.get(f=a[w]);G?u=G:(n(),c.has(f)||(l(),e(),h(f),c.set(f,{id:k++,Ea:new Za}),C=!0),u.Ea.set(f,{id:k++,Ea:new Za}),u=c.get(f),l())}n();c.has(f)||(l(),e(),h(f));l();d(1);--t;e();return g+=yb(m<<15-v)},Cb=a=>{var b=Ab;if(!a)return null;const c=a.length,d=()=>{v+=(k>>--u&1)<<t++;0===u&&(u=15,k=zb(a.charCodeAt(A++)))};let e=[0,1],h=1,l=3,n=2,f=null;var g=null;let m=0,v=0;g=2;let t=0,A=0,k=zb(a.charCodeAt(A++)),u=15;for(;t<g;)d();if(1===v)return null;
for(v=t=0;8>t;)d();f=[v];e[2]=f;for(b[m++]=v;A<=c;){g=n;for(v=t=0;t<g;)d();if(0===v){for(v=t=0;8>t;)d();e[l]=[v];v=l++;0===--h&&(h=1<<n++)}else if(1===v)return b;g=v<e.length?e[v]:f.concat(f[0]);for(let C=0;C<g.length;C++)b[m++]=g[C];e[l++]=f.concat(g[0]);f=g;0===--h&&(h=1<<n++)}return null};let X=null;
if(Sa){let a,b;null==(a=navigator.storage)||null==(b=a.persist)||b.call(a);const c=Sa.open("minicraft",1);c.onupgradeneeded=d=>{d=d.target.result.createObjectStore("chunks",{keyPath:["world","coords"]});for(const e of ab(S))if(e.startsWith("minicraft.world.")){const [h,l]=e.substr(16).split(":");"meta"!==l&&(d.add({world:T(h),coords:l,data:S.getItem(e)}),Ra(e))}};c.onsuccess=d=>{X=d.target.result}}
const Db=(a,b)=>p(function*(){if(!X)return S.getItem(`minicraft.world.${a}:${b}`);const c=X.transaction("chunks","readonly").objectStore("chunks").get([a,b]);return new Na(d=>{c.onsuccess=()=>{let e;d(null==(e=c.result)?void 0:e.data)}})}()),Eb=(a,b)=>{var c=Bb();return p(function*(){if(!X)return Qa(`minicraft.world.${a}:${b}`,c);const d=X.transaction("chunks","readwrite").objectStore("chunks").put({world:a,coords:b,data:c});return new Na((e,h)=>{d.onsuccess=()=>{e()};d.onerror=()=>{h(d.error)}})}())},
Fb=(a,b)=>p(function*(){if(!X)return Ra(`minicraft.world.${a}:${b}`);const c=X.transaction("chunks","readwrite").objectStore("chunks").delete([a,b]);return new Na(d=>{c.onsuccess=()=>{d()}})}()),Gb=a=>p(function*(){const b=`minicraft.world.${a}:`;if(!X){const e={},h=b.length;for(const l of ab(S))l.startsWith(b)&&(e[l.substr(h)]=S.getItem(l));return e}const c=X.transaction("chunks","readonly").objectStore("chunks").openCursor(),d={meta:S.getItem(b+"meta")};return new Na(e=>{c.onsuccess=()=>{const h=
c.result;h?(h.value.world===a&&(d[h.value.coords]=h.value.data),h.continue()):e(d)}})}()),Hb=(a,b)=>p(function*(){if(X){var c=X.transaction("chunks","readwrite"),d=c.objectStore("chunks");for(const [e,h]of bb(b))"meta"!==e?d.put({world:a,coords:e,data:h}):Qa(`minicraft.world.${a}:meta`,h);return new Na((e,h)=>{c.oncomplete=()=>{e()};c.onerror=()=>{h(c.error)}})}for(const [e,h]of bb(b))Qa(`minicraft.world.${a}:${e}`,h);Qa("__margin",Array(257).join("x"));Ra("__margin")}()),Ib=a=>{if(X){Ra(`minicraft.world.${a}:meta`);
var b=X.transaction("chunks","readwrite").objectStore("chunks").openCursor();b.onsuccess=()=>{const c=b.result;c&&(c.value.world===a&&c.delete(),c.continue())}}else{const c=`minicraft.world.${a}:`;for(const d of ab(S))d.startsWith(c)&&Ra(d)}},Jb=(a,b)=>{if(X){Qa(`minicraft.world.${b}:meta`,S.getItem(`minicraft.world.${a}:meta`));Ra(`minicraft.world.${a}:meta`);var c=X.transaction("chunks","readwrite").objectStore("chunks"),d=c.openCursor();d.onsuccess=()=>{const e=d.result;e&&(e.value.world===a&&
(e.value.world=b,c.put(e.value)),e.continue())}}else{const e=`minicraft.world.${a}:`,h=e.length,l=`minicraft.world.${b}:`;for(const n of ab(S))if(n.startsWith(e)){const f=S.getItem(n);Ra(n);Qa(l+n.substr(h),f)}}},Y=new Ya(1024),Ab=new Xa(Y.buffer),Kb=new Za,Lb=(a,b,c,d)=>0>c||63<c?0:a.X[(b<<a.J+4|d)<<6|c],Mb=(a,b,c,d)=>{const e=a.J;a.X[(b<<e+4|d)<<6|c]=0;a.Y[(b>>4<<e|d>>4)<<2|c>>4].ga=!0},Nb=(a,b,c,d,e)=>{const h=a.J,l=(b<<h+4|d)<<6|c;if(0<a.X[l])return!1;a.X[l]=e;return a.Y[(b>>4<<h|d>>4)<<2|c>>
4].ga=!0},ac=(a,b,c)=>{const d=Aa(P(b.G,63),0)>>4,e=M(b.B)>>4;b=M(b.H)>>4;if(c||a.Ka!==d||a.ra+a.Ja!==e||a.sa+a.La!==b)c=1<<a.J,a.Ka=d,a.ra=e-(a.Ja=(65536+e)%c),a.sa=b-(a.La=(65536+b)%c),Ob(a);a.busy||Pb(a,!1)},Ob=a=>{const b=a.Ja,c=a.Ka,d=a.La,e=a.J,h=`${e} ${b} ${d} ${c}`;let l=Kb.get(h);if(null==l){const n=1<<e,f=U(.5*n);Kb.set(h,l=a.Y.map(({x:g,y:m,z:v},t)=>{let A=U(g-b),k=U(v-d),u=U(g-b-n),C=0,w=0;u<A&&(A=u,C=-n);(u=U(g-b+n))<A&&(A=u,C=n);(u=U(v-d-n))<k&&(k=u,w=-n);(u=U(v-d+n))<k&&(k=u,w=n);
return{Wa:A+k+U(m-c),fb:t,ra:C,sa:w}}).filter(({Wa:g})=>g<=f).sort((g,m)=>g.Wa-m.Wa))}a.Fa=l;a.oa=0},cc=(a,b)=>{const c=b.A.map(({content:d})=>d&&[d.id,d.amount,d.data]);for(;0<c.length&&null===c[c.length-1];)c.pop();Qa(`minicraft.world.${a.id}:meta`,Oa({p:{h:b.kb,i:c,m:b.l,p:[b.B,b.G,b.H,b.N,b.da]},s:[a.va,a.wa,a.xa],v:1}));Na.all(a.Y.filter(d=>d.ga).map(d=>bc(a,d)))},dc=(a,b)=>{const c=S.getItem(`minicraft.world.${a.id}:meta`);if(c){const {p:d,s:e,v:h}=Pa(c);null!=h&&(d.i.forEach((l,n)=>{l&&(b.A[n].content=
tb(l[0],l[1],l[2]))}),b.kb=d.h,b.l=d.m,b.B=d.p[0],b.G=d.p[1],b.H=d.p[2],b.N=d.p[3],b.da=d.p[4],a.va=e[0],a.wa=e[1],a.xa=e[2])}},ec=a=>p(function*(){const b=a.Y[a.Fa[a.oa=0].fb];var c=b.y;yield Fb(a.id,`${b.Ba}/${b.Qa}`+(0<c?"/"+c:""));b.ga=!1;++b.Ba;return Pb(a,!1)}()),bc=(a,b)=>{const c=a.Da;var d=a.J;const e=b.y,h=(256<<d)-256;for(let l=0,n=-1,f=((b.x<<d+4|b.z)<<6|e)<<2;16>l;++l){for(d=0;16>d;++d)Y[++n]=c[f],Y[++n]=c[++f],Y[++n]=c[++f],Y[++n]=c[++f],f+=13;f+=h}b.ga=!1;return Eb(a.id,`${b.Ba}/${b.Qa}`+
(0<e?"/"+e:""))},Pb=(a,b)=>p(function*(){const c=a.Y,d=a.Fa,e=a.ra,h=a.sa,l=d.length;for(;a.oa<l;){var n=d[a.oa++],f=c[n.fb],g=f.loaded,m=f.x;const k=f.y;var v=f.z,t=e+n.ra+m;const u=h+n.sa+v;if(!g||t!==f.Ba||u!==f.Qa){f.loaded=a.busy=!0;n=f.ga&&bc(a,f);var A=a.id;t=f.Ba=t;f=f.Qa=u;f=Cb(yield Db(A,`${t}/${f}`+(0<k?"/"+k:"")));yield n;a.busy=!1;if(g||0===k||f){n=a.Da;t=a.J;A=(256<<t)-256;m=((m<<t+4|v)<<6|k)<<2;if(f)for(let C=0,w=-1;16>C;++C){for(g=0;16>g;++g)n[m]=Y[++w],n[++m]=Y[++w],n[++m]=Y[++w],
n[++m]=Y[++w],m+=13;m+=A}else for(v=0;16>v;++v){for(f=0;16>f;++f)n[m]=0<k?0:50397446,n[++m]=0<k?0:131843,g?(n[++m]=0,n[++m]=0,m+=13):m+=15;m+=A}if(!b)break}}}}());let fc=null,gc=null,hc=new Image;hc.crossOrigin="anonymous";hc.onload=()=>{const a=ua.createElement("canvas");a.width=16;a.height=416;const b=a.getContext("2d");b.drawImage(hc,0,0);da("tile","div[className=bitmap]",{S:{backgroundImage:`url(${a.toDataURL()})`}});fc=new Ya(b.getImageData(0,0,16,416).data.buffer);gc&&gc();hc=gc=null};
hc.src=ASSETS+"blocks.webp";const jc=(a,b)=>{const c={qb:b,Ta:b.getContext("2d",{alpha:!1,desynchronized:!0}),eb:null,ib:"",T:!1,jb:0,Xa:0,sb:db(()=>(c.jb=c.Xa,c.Xa=0),1E3),o:a};null===fc&&(gc=()=>c.T=!0);ic(c);return c},ic=a=>{const b=a.qb,c=a.o;(a.eb=a.Ta.createImageData(b.width=c.ta,b.height=c.ua)).data.fill(255);const d=c.ta*c.config.V/c.ja,e=c.ua*c.config.V/c.ja;b.style.width=d+"px";b.style.height=e+"px";b.style.left=za((c.Na-d)/2)+"px";b.style.top=za((c.Oa-e)/2)+"px";a.Ta.fillStyle="rgba(255,255,255,.5)"};
let kc=0;
const nc=(a,b,c,d)=>{const e={X:null,Da:null,busy:!1,Y:null,Fa:null,oa:0,L:!0,Ja:0,Ka:0,La:0,id:c.Aa,ra:0,sa:0,J:0,va:.5,wa:8.5,xa:.5,time:0,Pa:0},h=wb(e,d);dc(e,h);a={actions:a,config:c,gb:0,hb:0,Ia:!1,pa:!0,tb:b,Z:0,U:new Set,Ya:"",j:0,M:[],g:h,Za:null,u:null,ja:1,Na:1,Oa:1,ta:0,ua:0,vb:db(()=>{e.L||(e.time=(e.time+1)%24E3,e.Pa=1/24E3*(e.Pa+6E3)%1,ac(e,h,!1))},50),world:e};lc(a,null);mc(a);return a},oc=a=>{cc(a.world,a.g);a.actions.O(a.world.id,{mod_l:Date.now()})},pc=a=>{a.j=0;a.world.L=!1;mc(a)},
mc=a=>{p(function*(){if(!a.config.ia)try{yield a.tb.requestPointerLock()}catch(b){}}())},qc=(a,b)=>a===b?0:.1-.2*a,rc=a=>{a.g.Ra=qc((a=a.U).has(-12)||a.has(65),a.has(-13)||a.has(68))},sc=a=>{a.g.cb=qc((a=a.U).has(-15)||a.has(16),a.has(-14)||a.has(32))},tc=a=>{a.g.Sa=qc((a=a.U).has(-11)||a.has(83),a.has(-10)||a.has(87))},uc=a=>{a.g.nb=qc(a.U.has(-18),a.U.has(-19))},vc=a=>{a.g.ob=qc(a.U.has(-17),a.U.has(-16))},xc=(a,b,c)=>{if(!a.world)return!1;const d=a.U;var e=a.g;if(c){if(d.has(b))return!1;d.add(b);
var h=e.ea,l=e.W;c=e.fa;switch(b){case -18:case -19:uc(a);break;case -17:case -16:vc(a);break;case -1:2!==e.l&&0<=l&&(0===e.Ma?0===e.l&&(b=Lb(a.world,h,l,c),2===b?b=3:1===b&&(b=4),6===b||8!==b&&13!==b&&null!==vb(e.A,tb(b,1)))||(Mb(a.world,h,l,c),e.W=-1):wc(a,[h,l,c],!1));break;case -2:case 71:if(0<=l){const n=Lb(a.world,h,l,c);c=e.A.slice(0,9);l=c.findIndex(f=>null!==f.content&&f.content.id===n);0<=l?e.K=l:1===e.l&&(c[e.K].content&&(c=c.findIndex(f=>null===f.content),0<=c&&(e.K=c)),e.A[e.K].content=
tb(n));e.ka=a.Z}break;case -3:if(2!==e.l&&0<=l)if(0===e.Ma){if(b=e.A[e.K],b.content){switch(e.Ca){case 0:--h;break;case 1:++h;break;case 2:--l;break;case 3:++l;break;case 4:--c;break;default:++c}0<=l&&64>l&&Nb(a.world,h&(1<<4+a.world.J)-1,l,c&(1<<4+a.world.J)-1,b.content.id)&&1!==e.l&&0>=--b.content.amount&&(b.content=null)}}else wc(a,[h,l,c],!0);break;case -4:e.K=(e.K+9-1)%9;e.ka=a.Z;break;case -5:e.K=(e.K+1)%9;e.ka=a.Z;break;case 27:0===a.j&&(a.world.L=!0,a.j=1);break;case -15:case -14:case 16:case 32:sc(a);
break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:e.K=b-49;e.ka=a.Z;break;case -12:case -13:case 65:case 68:rc(a);break;case 69:if(0===a.j){a.j=3;for(const n of d)xc(a,n,!1)}break;case 80:a.world&&(a.world.L=!0);break;case 81:e=e.A[e.K];if(d.has(17)||e.content&&0>=--e.content.amount)e.content=null;break;case -11:case -10:case 83:case 87:tc(a);break;case 84:if(0===a.j){a.j=2;for(const n of d)xc(a,n,!1)}break;case 112:a.pa=!a.pa;break;case 114:a.Ia=!a.Ia;case 116:case 122:case 123:break;
default:return!1}}else{if(!d.delete(b))return!1;switch(b){case -15:case -14:case 16:case 32:sc(a);break;case -12:case -13:case 65:case 68:rc(a);break;case -11:case -10:case 83:case 87:tc(a);break;case -18:case -19:uc(a);break;case -17:case -16:vc(a)}}a.Ya=[...d].join();return!0},yc=(a,b)=>(b=b.startsWith("~")?a+T(b.substr(1)):T(b),isNaN(b)?a:b),Ac=(a,b)=>{const c=a.g;var d=a.world;if(b)if("/"===b.charAt(0)){b=b.substr(1).split(" ");const e=b.shift();switch(e){case "clear":a.M=[];break;case "clearinv":for(const h of c.A)h.content=
null;Z(a,"\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440 \u043f\u0443\u0441\u0442",!0);break;case "gamemode":case "gm":b=T(b[0]);!isNaN(b)&&0<=b&&3>b&&0===b%1?(c.l=b,Z(a,"\u0418\u0433\u0440\u043e\u0432\u043e\u0439 \u0440\u0435\u0436\u0438\u043c \u0441\u043c\u0435\u043d\u0451\u043d \u043d\u0430: "+b,!0)):Z(a,"\u0418\u0433\u0440\u043e\u0432\u043e\u0439 \u0440\u0435\u0436\u0438\u043c \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442 0..2!");break;case "give":if(0===b.length){Z(a,"/give <id> [\u0427\u0438\u0441\u043b\u043e]\n"+
pb.join(" "));break}d=pb.indexOf((b[0]||"").toLowerCase());d=0<=d?d:T(b[0]);b=T(b[1]||1);!isNaN(d)&&0<d&&25>d&&0===d%1?!isNaN(b)&&0<b&&0===b%1?Z(a,vb(c.A,tb(d,b))?"\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440 \u043f\u043e\u043b\u043d\u044b\u0439!":`${"\u0412\u0435\u0449\u0438 \u0434\u0430\u043d\u044b"} ${b} ${qb[d]}`,!0):Z(a,"\u0427\u0438\u0441\u043b\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442 \u043c\u0438\u043d\u0438\u043c\u0443\u043c 1!"):Z(a,"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0442\u0438\u043f \u0431\u043b\u043e\u043a\u0430!");
break;case "help":Z(a,"\u041a\u043e\u043c\u0430\u043d\u0434\u0430: clear, clearinv, gamemode, give, help, load, me, save, spawn, teleport, version");break;case "load":Pb(d,!0).then(()=>{a.u.T=!0;Z(a,"\u0427\u0430\u043d\u043a\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f.",!0)});break;case "me":Z(a,c.name+" "+b.join(" "),!0);break;case "save":oc(a);Z(a,"\u0418\u0433\u0440\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430.",!0);break;case "smart":c.name="LFF5644";
Z(a,"lff.smart: true",!0);break;case "spawn":d.va=c.B;d.wa=c.G;d.xa=c.H;Z(a,"\u041d\u0430\u0447\u0430\u043b\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430",!0);break;case "teleport":case "tp":0===b.length?(c.B=d.va,c.G=d.wa,c.H=d.xa,a.u.T=!0,Z(a,"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u0441\u044f \u043a \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0439 \u0442\u043e\u0447\u043a\u0438",!0)):3===b.length?(Z(a,"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u0441\u044f \u043a"+
` ${c.B=yc(c.B,b[0])} ${c.G=yc(c.G,b[1])} ${c.H=yc(c.H,b[2])}`,!0),a.u.T=!0):Z(a,"\u041d\u0435\u043f\u043e\u0432\u0435\u0437\u043b\u043e!");c.$=0;c.aa=0;c.ba=0;break;case "version":Z(a,"Minicraft 0.9.10");break;case "/exit":c.Ma=0;Z(a,"\u041a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0440\u0435\u0436\u0438\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u043c\u044b\u0448\u043a\u0438.",!0);break;case "/expand":a.g.ma&&a.g.na?d=!0:(Z(a,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043d\u0430\u0447\u044f\u043b\u043e!"),
d=!1);d&&("vert"===b[0]?(c.ma[1]=0,c.na[1]=63,Z(a,"\u0412\u044b\u0431\u043e\u0440\u044c \u0443\u0432\u0435\u043b\u0438\u0447\u0435\u043d.",!0)):Z(a,'\u0422\u043e\u043b\u043a\u043e "vert" \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f!'));break;case "/pos1":case "/pos2":wc(a,[M(c.B),M(c.G),M(c.H)],"/pos2"===e);break;case "/regen":ec(d).then(()=>{a.u.T=!0;Z(a,"\u0427\u0430\u043d\u043a\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f ",
!0)});break;case "/show":Z(a,`${"\u041f\u0435\u0440\u0432\u044b\u0439"}: ${c.ma?c.ma.join(" "):"\u043d\u0438\u0447\u0435\u0433\u043e"}, ${"\u0412\u0442\u043e\u0440\u043e\u0439"}: ${c.na?c.na.join(" "):"\u043d\u0438\u0447\u0435\u0433\u043e"}`);break;case "/wand":c.Ma=1;Z(a,"\u0412\u044b\u0431\u043e\u0440\u044c \u0441 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u043c\u044b\u0448\u043a\u0438.",!0);break;default:Z(a,"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u043d\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430: "+
e)}}else{const e=Z(a,`<${c.name}> `+b);lc(a,b).then(h=>{h&&zc(a,e)})}},Z=(a,b,c=!1)=>{const d=++kc;(a.M=a.M.slice(-49)).push({id:d,mb:c,time:pa(),value:b});return d},zc=(a,b)=>{const c=a.M.findIndex(d=>d.id===b);0<=c&&a.M.splice(c,1)},wc=(a,b,c)=>{c?a.g.na=b:a.g.ma=b;Z(a,`${c?"\u0412\u0442\u043e\u0440\u0430\u044f \u0432\u044b\u0431\u0440\u0430\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430":"\u041f\u0435\u0440\u0432\u0430\u044f \u0432\u044b\u0431\u0440\u0430\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430"}: ${b.join(" ")}`,
!0)},lc=(a,b)=>(eb(a.Za),(b?fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({msg:b})}):fetch("/api/chat")).then(c=>{if(c.ok)return c.text()}).then(c=>{if(c){c=c.split("\n").filter(Boolean);for(const d of c)d.startsWith("<")&&Z(a,d);return 0<c.length}return!1}).catch(()=>!1).then(c=>{a.Za=cb(()=>{lc(a,null)},5E3);return c})),Bc=({id:a})=>(D("#tile",{S:{backgroundPositionY:`-${2*(a-1)}rem`}}),null);
function Cc({amount:a,l:b,id:c}){D("div[className=stack]",{title:qb[c]+(1===b?` (${pb[c]}, ${c})`:"")});return[I(Bc,{id:c}),1!==a&&J("div[className=amount]",{innerText:a})]}
function Dc({g:a,la:b}){D("div[className=bar]",{ontouchstart:H(d=>{a.K=Number(d.target.closest("[data-slot]").dataset.slot);a.ka=d.timeStamp}),S:{opacity:Aa(.5,P(1,1-5E-4*(b-a.ka-5E3)))}});const c=a.l;return fc&&a.A.slice(0,9).map(({content:d},e)=>J("div",{D:{slot:e},F:{active:e===a.K}},[d&&I(Cc,{amount:d.amount,data:d.data,l:c,id:d.id})]))}
function Ec({ub:a}){D("div[className=grid]",{onclick:({target:b})=>{(b=b.closest("[data-id]"))&&ub({content:tb(T(b.dataset.id)),filter:null,P:64},a)}});return pb.map((b,c)=>0<c&&J("div",{D:{id:c}},[I(Cc,{amount:1,data:null,l:1,id:c})]))}
function Fc({o:a}){const b=ha(()=>({content:null,filter:null,P:64})),c=a.g.l;D("div[className=menu overlay inventory]",ha(()=>({onclick:({target:d})=>{if("menu overlay inventory"===d.className)b.content?b.content=null:pc(a);else if(d=d.closest("[data-slot]"))d=a.g.A[T(d.dataset.slot)],b.content?ub(b,d):d.content&&ub(d,b)},oncontextmenu:({target:d})=>{if("menu overlay inventory"===d.className)b.content?0>=--b.content.amount&&(b.content=null):pc(a);else if(d=d.closest("[data-slot]"))d=a.g.A[T(d.dataset.slot)],
b.content?ub(b,d,1):d.content&&ub(d,b,ya(d.content.amount/2))}})));return fc&&[J("div[className=window]",null,[J("h2[innerText=\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440]"),1===c&&I(Ec,{ub:b}),J("div[className=grid]",null,a.g.A.map(({content:d},e)=>J("div",{D:{slot:e},F:{first:9>e}},[d&&I(Cc,{amount:d.amount,data:d.data,l:c,id:d.id})])))]),b.content&&J("div[className=hand]",{S:{transform:`translate(${a.gb}px, ${a.hb}px)`}},[I(Cc,{amount:b.content.amount,data:b.content.data,l:0,id:b.content.id})])]}
const Gc=({I:{mb:a,time:b,value:c},la:d})=>(D(a?"div[className=minor]":"div",{innerText:c,S:{opacity:P(1,1-.001*(d-b-4500))}}),null);function Hc({M:a,la:b}){D("div[className=messages]");const c=b-5E3;return[oa(Gc,a.slice(-10).filter(d=>d.time>c),{la:b})]}
function Ic({actions:{rb:a,Ga:b},config:c,o:d,za:e}){E(()=>oc(d));D("div[className=menu overlay]");return[J("h1[innerText=\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438]"),H(J("center",null,[J("button[innerText=\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u0432 \u0438\u0433\u0440\u0443]",{onclick:()=>{pc(d)}})])),J("div[className=settings]",null,[J("button",{innerText:"\u041f\u043e\u0432\u0435\u0440\u0445\u043d\u043e\u0441\u0442\u044c:\n"+(c.ha?"\u0421 \u0442\u0435\u043a\u0441\u0442\u0443\u0440\u0430\u043c\u0438":
"\u041e\u0434\u043d\u043e\u0446\u0432\u0435\u0442\u043d\u044b\u0439"),onclick:H(()=>a(h=>({ha:!h.ha})))}),J("label[innerText=\u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e:]",null,[J("input[type=range][min=1][max=100][step=1]",{value:101-c.V,onchange:H(h=>b({V:101-Number(h.target.value)}))})]),J("label[innerText=\u0420\u0430\u0434\u0438\u0443\u0441 \u0437\u0440\u0435\u043d\u0438\u044f:]",null,[J("input[type=range][min=1][max=180][step=1]",{value:c.ya,onchange:H(h=>b({ya:Number(h.target.value)}))})]),
J("label[innerText=\u0414\u0430\u043b\u043d\u043e\u0441\u0442\u044c \u0437\u0440\u0435\u043d\u0438\u044f:]",null,[J("input[type=range][min=1][max=128][step=1]",{value:c.ca,onchange:H(h=>b({ca:Number(h.target.value)}))})]),J("label[innerText=\u0427\u0443\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u043c\u044b\u0448\u043a\u0438.:]",null,[J("input[type=range][min=1][max=15][step=1]",{value:c.qa,
onchange:H(h=>b({qa:Number(h.target.value)}))})])]),H(J("center",null,[J("button[innerText=\u041f\u043e\u043a\u0438\u043d\u0443\u0442 \u043c\u0438\u0440]",{onclick:()=>{e(0)}})]))]}const Jc=({I:{mb:a,value:b}})=>(D(a?"div[className=minor]":"div",{innerText:b}),null);
function Kc({o:a,M:b}){const c=H({history:null,input:null});D("div[className=menu overlay terminal]",{onclick:d=>{d.target!==c.input&&c.input.focus()}});E(d=>{d&&cb(()=>c.history.scrollTop=1E9,0)},[b.length&&b[b.length-1].id]);return[H(J("div[className=toolbar]",null,[J("button[innerText=\u274c]",{onclick:()=>{pc(a)}})])),J("div[className=history]",{R:H(d=>{c.history=d})},[oa(Jc,b)]),H(J("input[enterkeyhint=send][mozactionhint=send][name=message][required]",{onkeydown:d=>{const e=d.keyCode;d=d.target;
13===e?(Ac(a,d.value),d.value=""):27===e&&pc(a)},R:d=>{c.input=d;cb(()=>d.focus(),0)}}))]}const Lc=[["pick",-2],["up",-14],["down",-15],["E",69],["T",84],["F1",112],["F3",114],["...",27]],Mc=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]],Nc=[["up",-16],["down",-17],["left",-18],["right",-19],["center",-3]];
function Oc({o:a}){const b=a.U,c=([d,e])=>J("div",{D:{code:e},F:{button:!0,[d]:!0,active:b.has(e)}});D("div[className=touch]",H({ontouchstart:d=>{let {code:e}=d.target.dataset;if(null!=e&&xc(a,e=T(e),!0)){const h=d.changedTouches[0].identifier,l=n=>{n.changedTouches[0].identifier===h&&(lb("touchend",l),xc(a,e,!1))};gb("touchend",l)}return!1}}));return[J("div[className=top]",null,Lc.map(([d,e])=>J(`div[innerText=${d}]`,{D:{code:e},F:{button:!0,active:b.has(e)}}))),J("div[className=move]",null,Mc.map(c)),
J("div[className=move sec]",null,Nc.map(c))]}
function Pc({account:a,actions:b,config:c,frame:d,$a:e,za:h}){const l=pa(),n=ua.pointerLockElement===d,f=ha(()=>e.o=nc(b,d,c,a));E(()=>{const g=t=>{if(0!==f.j)return!0;ua.pointerLockElement===d?xc(f,-1-t.button,"mousedown"===t.type):mc(f);return!1},m=t=>{if(0!==f.j||ua.pointerLockElement===d)if(f.world.L)f.gb=t.clientX,f.hb=t.clientY;else{const A=f.config.qa*va/(Aa(f.Na,f.Oa)*f.ja);xb(f.g,t.movementX*A,-t.movementY*A)}},v=t=>{b.Ha(!1);if(0===f.j&&!f.world.L&&5<Math.abs(t.deltaY))return t=0<t.deltaY?
-5:-4,xc(f,t,!0),xc(f,t,!1),!1};d.addEventListener("mousedown",g);d.addEventListener("mouseup",g);d.addEventListener("mousemove",m);d.addEventListener("wheel",v);return()=>{d.removeEventListener("mousedown",g);d.removeEventListener("mouseup",g);d.removeEventListener("mousemove",m);d.removeEventListener("wheel",v);eb(f.Za);fb(f.vb);cc(f.world,f.g);fb(f.u.sb);e.o=null}});E(()=>{f.config=c;f.u&&(f.u.T=!0);const g=f.world;var m=ya(Ea(f.config.ca/16*2+2));if(g.J!==m){var v=f.g;g.Y&&cc(g,v);const t=1<<
(g.J=m),A=g.Y=[];for(let k=0;k<t;++k)for(let u=0;u<t;++u)for(let C=0;4>C;++C)A.push({ga:!1,loaded:!1,x:k,y:C,z:u,Ba:0,Qa:0});m=t<<m+12+2;null===g.X||g.X.length<m?g.Da=new Ya((g.X=new Xa(m)).buffer):g.Da.fill(0);ac(g,v,!0)}},[c]);E((g,m,v)=>{f.ja=v;f.Na=Aa(1,g);f.Oa=Aa(1,m);m=f.config.V;g=ya(f.Na*f.ja/m);m=ya(f.Oa*f.ja/m);if(g!==f.ta||m!==f.ua)f.ta=g,f.ua=m,f.u&&(f.u.T=!0,ic(f.u))},[d.offsetWidth,d.offsetHeight,ta.devicePixelRatio||1,c.V]);E(g=>{g||f.world.L||0!==f.j||(f.j=1);f.world.L=!g},[c.ia&&
0===f.j||n]);E(g=>n&&g&&ua.exitPointerLock(),[f.world.L||0!==f.j]);E(()=>{if(f.world){if(f.Z&&!f.world.L){var g=f.g,m=P(5,.01*(l-f.Z));g.$-=.1*g.$*m;g.aa-=.1*g.aa*m;g.ba-=.1*g.ba*m;g.$+=(Ba(g.N)*g.Ra+Ca(g.N)*g.Sa)*m;g.aa+=g.cb*m;g.ba+=(-Ca(g.N)*g.Ra+Ba(g.N)*g.Sa)*m;xb(g,g.nb*m*1.5,g.ob*m*1.5);g.B+=g.$*m;g.G+=g.aa*m;g.H+=g.ba*m}if(f.u){g=f.u;++g.Xa;m=g.Ta;var v=g.eb;const ja=g.o,Fa=ja.config,hb=ja.pa,y=ja.g,aa=ja.ta,fa=ja.ua,N=ja.world;if(!N.L||g.T){g.T=!1;const qa=v.data,Qc=Fa.ca;var t=y.N,A=y.da;
const Rc=y.ea,Sc=y.fa;var k=y.B,u=y.G,C=y.H;const Tc=hb?y.W:-1,Uc=N.X;var w=N.J;const Vc=Fa.ha&&null!==fc;var G=1/aa,O=1/fa;const ra=aa>>1,sa=fa>>1,Qb=P(aa,fa),Rb=32<Qb,Sb=Ba(t);t=Ca(t);const Tb=Ba(-A);A=Ca(-A);var q=Fa.ya/45;const Wc=G*(aa<fa?q*aa*O:q);G=O*(fa<aa?q*fa*G:q);k+=65536;u+=65536;C+=65536;O=k%1;q=u%1;const Xc=C%1;w=4+w;const Ub=(1<<w)-1;let Vb=1===y.l?6:4,ka=y.ea=y.fa=y.Ca=0;y.W=-1;for(let Ta=0;Ta<fa;++Ta){var r=(sa-Ta)*G;const Wb=r*Tb-A;var x=r*A+Tb;r=x*t;x*=Sb;for(let Ua=0;Ua<aa;++Ua){var z=
(Ua-ra)*Wc;const Xb=r+Sb*z;z=x-t*z;let Ga=16757124,Va=1,Yb=Qc;for(let L=0;3>L;++L){let Q=z;0===L&&(Q=Xb);1===L&&(Q=Wb);var W=1/(0>Q?-Q:Q);const Wa=Xb*W,la=Wb*W;W*=z;const Zb=Da(Wa*Wa+la*la+W*W);var F=Xc;0===L&&(F=O);1===L&&(F=q);0<Q&&(F=1-F);let Ha=k+Wa*F-(0===L&0>Q|0),Ia=u+la*F-(1===L&0>Q|0),Ja=C+W*F-(2===L&0>Q|0);F*=Zb;for(let ib,jb,kb,R;F<Yb;Ha+=Wa,Ia+=la,Ja+=W,F+=Zb)if(65536>Ia){if(0>la)break}else if(65600<=Ia){if(0<la)break}else if(0!==(R=Uc[((ib=Ha&Ub)<<w|(kb=Ja&Ub))<<6|(jb=Ia&63)])){Ta===sa&&
Ua===ra&&F<=Vb&&(y.ea=ib,y.W=jb,y.fa=kb,y.Ca=0>Q|L<<1,Vb=F);if(Vc){--R;1===L?6===R?R=25:13===R?R=4:1===R&&0<la&&(R=2):1===R&&(R=24);const $b=fc[R<<8|(16*(1===L?Ja:Ia)&15)<<4|16*(1===L?Ha:(0<Q?Ha-Ja:Ja-Ha)+65536)&15];if(0===$b>>>24)continue;Ga=$b&16777215}else Ga=rb[R];Yb=F;Va=(0===L?.8:2===L?.6:0<Q?.4:1)+(jb!==Tc||ib!==Rc||kb!==Sc?0:.2);break}}qa[ka]=(Ga&255)*Va;qa[++ka]=(Ga>>8&255)*Va;qa[++ka]=(Ga>>16)*Va;ka+=2}}hb&&!Rb&&(qa[ka=aa*sa+ra<<2]+=128,qa[++ka]+=128,qa[++ka]+=128);m.putImageData(v,0,0);
hb&&Rb&&(v=P(ya(.05*Qb),8),m.fillRect(ra-v,sa-1,v<<1,2),m.fillRect(ra-1,sa-v,2,v-1),m.fillRect(ra-1,sa+1,2,v-1))}g.ib=ja.Ia?"Minicraft 0.9.10 "+M(g.jb).toString().padStart(2,"\u00a0")+" fps, T: "+M(24*N.Pa).toString().padStart(2,"0")+":"+M(24*N.Pa%1*60).toString().padStart(2,"0")+"; "+(N.L&&500>l%1E3?"":N.time)+"\nR: "+aa+"x"+fa+" (x"+Fa.V+"), D: "+Fa.ca+", C: "+N.oa+"/"+N.Fa.length+", M: "+(64*U(1<<4+N.J)>>10)+"k\nE: 0/0 M: "+y.l+"\n\nPosition: "+y.B.toFixed(2)+" "+y.G.toFixed(2)+" "+y.H.toFixed(2)+
"\nAngle: "+(y.N*xa).toFixed(2)+" "+(y.da*xa).toFixed(2)+"\nBlock: "+(0>y.W?0:y.ea+" "+y.W+" "+y.fa+" "+sb[y.Ca]+": "+Lb(N,y.ea,y.W,y.fa))+"\nChunk abs: "+(M(y.B)>>4)+" "+(M(y.H)>>4)+" "+(M(y.G)>>4)+" rel: "+N.Ja+" "+N.La+" "+N.Ka:""}}f.Z=l},[l]);ma();return[J("canvas",{R:H(g=>{f.u=jc(f,g)})}),f.pa&&2!==f.j&&I(Hc,{M:f.M,la:l}),f.u&&f.Ia&&J("div[className=diagnostics]",{innerText:f.u.ib}),c.ia&&I(Oc,{o:f,Ya:f.Ya}),f.pa&&3!==f.j&&2!==f.g.l&&I(Dc,{g:f.g,la:l}),3===f.j&&I(Fc,{o:f,la:l}),1===f.j&&I(Ic,
{actions:b,config:c,o:f,za:h}),2===f.j&&I(Kc,{o:f,M:f.M})]}
function Yc({I:a,wb:b,xb:c,yb:d}){D("div",{F:{selected:a===c},onclick:()=>{d(a.id)}});c=`${a.local?"L":"_"}${a.local&&a.remote?a.local>a.remote?">":a.local<a.remote?"<":"=":"_"}${a.remote?a.public?"R":"r":"_"}`;b===a.id&&(c=`[${c}]`);return[J("span",{innerText:`${c} ${a.label}`,title:a.account_name?"\u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446: "+a.account_name:"\u0422\u043e\u043b\u043a\u043e \u043b\u043e\u043a\u0430\u043b\u043d\u044b\u0439 \u043c\u0438\u0440"}),J("span",{innerText:nb(Math.max(a.local,
a.remote),!0)})]}
function Zc({account:a,actions:b,config:c,za:d}){D("div[className=menu]");const [e,h,l]=na(0),n=H(()=>{h(l()+1)}),f=H({value:null}),g=ea(()=>p(function*(){try{const q=!f.value&&!e,r=yield fetch("/api/minicraft/"+`world?what=${q?"initial":"meta_all"}`);if(!r.ok)throw Error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");const x=yield r.json();if(!q)return x;if("0.9.10"!==x.version_latest)return location.reload(!0),null;ba();b.pb(x.account);return x.worlds}catch(q){return alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0441\u043f\u0438\u0441\u043a\u0430 \u043c\u0438\u0440\u043e\u0432: "+
q.message),[]}}()),[e],null),m=ha(()=>{g&&(f.value=g);const q=[];f.value&&q.push(...f.value.map(r=>({account_name:r.account_name,hash:r.hash,id:r.id,label:r.label,local:0,public:r.public,remote:r.modified,writable:r.writable})));for(const r of c.worlds){const x=q.find(z=>z.id===r.id);if(x){const z=x.local=r.mod_l,W=x.remote,F=r.mod_r;z>F&&W>F&&(confirm('\u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442! \u041c\u0438\u0440. "'+r.label+'" \u0431\u044b\u043b\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e \u043a\u0430\u043a \u0437\u0434\u0435\u0441\u044c, \u0442\u0430\u043a \u0438 \u0432 \u0434\u0440\u0443\u0433\u0438\u0445 \u043c\u0435\u0441\u0442\u0430\u0445.\n\u041e\u041a: \u043f\u0440\u0438\u043d\u044f\u0442\u044c \u0442\u043e, \u0447\u0442\u043e \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 ('+
nb(W,!1)+") | \u041e\u0442\u043c\u0435\u043d\u0438\u0442: \u0412\u043e\u0442 \u044d\u0442\u043e \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c ("+nb(z,!1)+")")?b.O(r.id,{mod_l:x.local=F}):b.O(r.id,{mod_r:x.remote=F}))}else 1<r.mod_r&&g&&g.length&&(alert('\u041c\u0438\u0440 "'+r.label+'" \u0431\u044b\u043b \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044c, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043e\u043d \u0442\u0435\u043f\u0435\u0440\u044c \u043b\u043e\u043a\u0430\u043b\u043d\u044b\u0439!'),
b.O(r.id,{mod_r:0})),q.push({account_name:"",hash:0,id:r.id,label:r.label,local:r.mod_l,public:!1,remote:1===r.mod_r?1:0,writable:!0})}return q.sort((r,x)=>Math.max(x.local,x.remote)-Math.max(r.local,r.remote))},[g,c.worlds]),[v,t,A]=na(c.Aa),k=ha(()=>m.find(q=>q.id===v)||null,[v,m]),u=ha(()=>{let q,r;return null!=(r=null==m?void 0:null==(q=m.find(x=>0<x.local&&0<x.remote&&x.local!==x.remote))?void 0:q.id)?r:null},[m]);E(()=>{if(null!==u){var q=!1,r=m.find(x=>x.id===u);if(r.local<r.remote)fetch("/static/minicraft/worlds/"+
`${r.hash}.json`).then(x=>x.json()).then(x=>{if(!q)return Hb(u,x).then(()=>{b.O(u,{mod_l:r.remote,mod_r:r.remote})})}).catch(x=>{q||("QuotaExceededError"===x.name?(alert("\u041d\u0435\u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u043f\u0430\u043c\u044f\u0442\u0438!"),b.bb(u),Ib(u)):alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u043c\u0438\u0440\u0430: "+x.message))});else{if(!r.writable){b.O(u,{mod_l:c.worlds.find(z=>z.id===u).mod_r});
return}let x=u;(1===r.remote?fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({what:"meta",label:r.label})}).then(z=>{if(!z.ok)throw Error(403===z.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");return z.json()}).then(z=>
{x=z.id}):Na.resolve()).then(()=>{if(q)throw null;return Gb(u)}).then(z=>{if(q)throw null;return fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({what:"data",world:x,data:z})})}).then(z=>{if(!z.ok)throw Error(403===z.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");
return z.json()}).then(z=>{ba();x===u?b.O(u,{mod_l:z.modified,mod_r:z.modified}):(Jb(u,x),b.bb(u),b.ab({id:x,label:r.label,mod_l:z.modified,mod_r:z.modified}),q||A()!==u||t(x));q||n();ca()}).catch(z=>{q||(alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0441\u043a\u0435 \u043c\u0438\u0440\u0430: "+z.message),ba(),b.O(u,{mod_r:0}),ca())})}return()=>{q=!0}}},[u]);const [C,w]=na(!1);k||w(!1);const [G,O]=na(!1);return[J("h1[innerText=\u041c\u0438\u0440\u044b]"),
J("button[innerText=\u041e\u0431\u043d\u043e\u0432\u0438\u0442][style=position:absolute;left:0;top:0;height:2rem][title=\u041e\u0431\u043d\u043e\u0432\u0438\u0442 \u0441\u043f\u0438\u0441\u043e\u043a]",{disabled:!g,onclick:n}),J("button[style=position:absolute;right:0;top:0;height:2rem]",{disabled:0<a.rank,innerText:a.rank?a.label:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f ",onclick:()=>{location.href="/account?redir=minicraft"}}),
J("div[className=worlds]",null,[oa(Yc,m,{zb:e,wb:u,xb:k,yb:t})]),J("center",null,[J("button[innerText=\u041e\u0442\u043a\u0440\u044b\u0442]",{disabled:!k||!k.local||k.remote>k.local,onclick:()=>{ba();b.Ga({Aa:k.id});d(1);ca()},title:k?k.local?k.remote>k.local?"\u041c\u0438\u0440 \u0435\u0449\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u0430!":"\u0417\u0430\u0439\u0442\u0438 \u043d\u0430 \u0432\u044b\u0431\u0440\u0430\u043d\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440":"\u041c\u0438\u0440 \u0435\u0449\u0435 \u043d\u0435 \u0441\u043a\u0430\u0447\u0435\u043d!":
"\u041c\u0438\u0440 \u0431\u044b\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u044c!"}),J("button[innerText=\u041c\u0438\u0440...]",{disabled:!k||C,onclick:()=>{w(!0)},title:k?"\u0410\u043a\u0446\u0438\u0438/\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043c\u0438\u0440\u0430":"\u041c\u0438\u0440 \u0431\u044b\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u044c!"})]),J("hr"),J("center",null,[J("button[innerText=\u041d\u043e\u0432\u044b\u0439 \u043c\u0438\u0440]",
{onclick:()=>{const q=prompt("\u0418\u043c\u044f \u043d\u043e\u0432\u043e\u0433\u043e \u041c\u0438\u0440\u0430:\n(\u043c\u0430\u043a\u0441. 16 \u0441\u0438\u043c\u0431\u043e\u043b\u043e\u0432)","\u041d\u043e\u0432\u044b\u0439 \u043c\u0438\u0440");q&&(16<q.length?alert("\u0418\u043c\u044f \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043e\u043b\u0433\u043e\u0435!"):b.ab({id:Math.min(0,...c.worlds.map(r=>r.id))-1,label:q,mod_l:Date.now(),mod_r:0}))}}),J("button[innerText=\u0421\u0430\u0439\u0442 \u043f\u0440\u043e\u0435\u043a\u0442\u0430]",
{onclick:()=>{open("//github.com/L3P3/minicraft")}})]),J("center",null,[J("small[innerText=\u0412\u0435\u0440\u0441\u0438\u044f 0.9.10 \u043e\u0442 L3P3]")]),C&&k&&J("div",{F:{"menu overlay advanced":!0,busy:G},onclick:q=>{"menu overlay advanced"===q.target.className&&w(!1)}},[J("div[className=window]",null,[J("h2",{innerText:'"'+k.label+'"',title:k.id}),J("table",null,[!!k.account_name&&J("tr",null,[J("td[innerText=\u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446:]"),J("td",{innerText:k.account_name})]),
J("tr",null,[J("td[innerText=\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f:]"),J("td",{innerText:nb(Math.max(k.local,k.remote),!1)})])]),J("center",null,[J("button[innerText=\u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c]",{disabled:G||!k.writable,onclick:()=>{const q=prompt("\u041d\u043e\u0432\u043e\u0435 \u0438\u043c\u044f \u043c\u0438\u0440\u0430:\n(\u043c\u0430\u043a\u0441. 16 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)",k.label);!q||q===k.label||
16<q.length||(k.local&&b.O(k.id,{label:q}),k.remote&&(O(!0),fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({what:"meta",world:k.id,label:q})}).then(r=>{if(!r.ok)throw Error(403===r.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");
return r.json()}).catch(r=>{alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u043c\u0438\u0440\u0430: "+r.message)}).then(()=>{O(!1)})))},title:k.writable?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442 \u0438\u043c\u044f \u043c\u0438\u0440\u0443":"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438!"}),J("button",{disabled:G||!k.local&&!k.writable,innerText:k.local?"\u0423\u0434\u0430\u043b\u0438\u0442\u044c (\u043b\u043e\u043a\u0430\u043b)":
"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",onclick:()=>{confirm('\u041c\u0438\u0440 "'+k.label+'" \u0442\u043e\u0447\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c?')&&(k.local?(b.bb(k.id),Ib(k.id)):(O(!0),fetch("/api/minicraft/world",{method:"DELETE",headers:{"Content-Type":"application/json"},body:Oa({what:"world",world:k.id})}).then(q=>{if(!q.ok)throw Error(403===q.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":
"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");ba();t(null);w(!1);n();O(!1);ca();return q.json()}).catch(q=>{alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0438 \u043c\u0438\u0440\u0430: "+q.message);O(!1)})))},title:k.local||k.writable?"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043c\u0438\u0440":"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438!"})]),
J("center",null,[J("button",{disabled:G||!k.remote||!k.writable,innerText:`${"\u041f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0439"}: ${k.public?"\u0414\u0430":"\u041d\u0435\u0442"}`,onclick:()=>{O(!0);fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Oa({what:"meta",world:k.id,public:!k.public})}).then(q=>{if(!q.ok)throw Error(403===q.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":
"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");ba();n();O(!1);ca();return q.json()}).catch(q=>{alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u043c\u0438\u0440\u0430: "+q.message);O(!1)})},title:k.remote?k.writable?k.public?"\u041f\u0440\u0438\u0432\u0430\u0442\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u0440":"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442 \u043c\u0438\u0440":
"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438!":"\u041c\u0438\u0440 \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d!"}),J("button",{disabled:G||!g||0<k.local&&0<k.remote||!k.remote&&!a.rank,innerText:k.local?g&&k&&!k.remote?"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442":"\u041f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438":"\u0421\u043a\u0430\u0447\u0430\u0442\u044c",onclick:()=>{k.local?k.remote||b.O(k.id,{mod_r:1}):b.ab({id:k.id,label:k.label,
mod_l:1,mod_r:k.remote})},title:g?k.local?k.remote?"\u041c\u0438\u0440 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u043d\u0430 \u0434\u0432\u0443\u0445 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430\u0445!":a.rank?"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442 \u043c\u0438\u0440 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440":"\u041d\u0435 \u0437\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d!":"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442 \u043c\u0438\u0440 \u0438\u0437 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 ":
"\u0421\u043f\u0438\u0441\u043e\u043a \u0435\u0449\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f!"})])])])]}function $c({account:a,actions:b,config:c,$a:d}){const [e,h]=na(0),l=D("div[className=game]");return[0===e&&I(Zc,{account:a,actions:b,config:c,za:h}),1===e&&I(Pc,{account:a,actions:b,config:c,frame:l,$a:d,za:h})]}
B.init(()=>{const [a,b]=ia(ob),c=H({o:null,lb:0});E(()=>{let n=!1;onbeforeunload=onunload=onpagehide=onblur=()=>{n||(n=!0,c.o&&oc(c.o),b.Ua())};onpageshow=onfocus=()=>{n=!1};setInterval(b.Ua,500);gb("touchend",f=>{c.lb=f.timeStamp},!0)});const d=H(n=>{if("INPUT"===n.target.tagName||!c.o)return!0;b.Ha(!1);xc(c.o,n.keyCode,"keydown"===n.type);return!1}),e=H(()=>{b.Ha(!0)}),h=H(n=>{999<n.timeStamp-c.lb&&b.Ha(!1)}),l=a.config.ia;E(()=>{l?(gb("mousedown",h,!0),gb("mouseup",h,!0),lb("touchstart",e,!0)):
(lb("mousedown",h,!0),lb("mouseup",h,!0),gb("touchstart",e,!0))},[l]);return[{onkeydown:d,onkeyup:d,oncontextmenu:mb,ondragstart:mb},[I($c,{account:a.account,actions:b,config:a.config,$a:c})]]});
