function ca(a){function b(d){return a.next(d)}function c(d){return a.throw(d)}return new Promise(function(d,e){function k(l){l.done?d(l.value):Promise.resolve(l.value).then(b,c).then(k,e)}k(a.next())})}
const p=lui,da=p.defer,ea=p.defer_end,fa=p.dom_define,ja=p.hook_async,B=p.hook_dom,D=p.hook_effect,ka=p.hook_memo,la=p.hook_model,ra=p.hook_rerender,sa=p.hook_state,F=p.hook_static,ta=p.init,H=p.node,I=p.node_dom,wa=p.node_map,xa=p.now,ya=window,Ba=document,Ca=navigator,J=Math,Da=J.PI,Ea=.5*Da,Fa=180/Da,K=J.floor,Ga=J.ceil,Ha=J.round,L=J.min,M=J.max,Ia=J.cos,Ja=J.sin,Ka=J.sqrt,La=J.log2,Ma=String.fromCharCode,Na=BroadcastChannel,Oa=Date,Ta=JSON,Ua=Promise,Va=Ta.stringify,Wa=Ta.parse,R=localStorage,
Xa=R.setItem.bind(R),Ya=R.removeItem.bind(R),Za=ya.indexedDB,$a=Uint8Array,ab=Uint32Array,bb=Map,S=Number,eb=Object,fb=eb.keys,gb=eb.entries,hb=setTimeout,ib=setInterval,jb=clearTimeout,kb=clearInterval,lb=addEventListener,mb=removeEventListener,nb=Ca.userAgent.includes("WebKit"),ob=a=>a*a,pb=()=>!1,qb=(a,b)=>{const c=new Oa;a=new Oa(a);var d=c-a;if(59E3>d)return Ha(d/1E3)+"s";if(3E6>d)return Ha(d/6E4)+"m";d=a.getFullYear();const e=a.getMonth(),k=a.getDate();let l="";d<c.getFullYear()&&(l=d+"/");
if(l||e<c.getMonth())l+=e+1+"/";if(l||k<c.getDate())l+=k;if(b)return l||"\u0441\u0435\u0433\u043e\u0434\u043d\u044f";l&&(l+="/");b=l+a.getHours()+":";a=a.getMinutes();a=K(a).toString().padStart(2,"0");return b+a};let W=R.getItem("minicraft.config");if((W=W&&Wa(W))&&W.worlds&&W.version.startsWith("0.9.")){const a=new Set(W.worlds.map(b=>"minicraft.world."+b.id));for(const b of fb(R))b.startsWith("minicraft.world.")&&!a.has(b.split(":")[0])&&Ya(b)}
const xb={init:()=>{let a=!1;var b={ha:!0,ia:!1,ta:1,qa:3,V:4,Ba:120,ca:64,Da:0,worlds:[]};if(W){let c=W.flag_textures;null!=c&&(b.ha=c);null!=(c=W.pixel_grouping)&&(b.ta=c);null!=(c=W.mouse_sensitivity)&&(b.qa=c);b.V=W.resolution_scaling;b.Ba=W.view_angle;b.ca=W.view_distance;null!=(c=W.world_last)&&(b.Da=c);null!=(c=W.worlds)?b.worlds=c:R.getItem("minicraft.world.0:meta")&&(b.worlds[0]={id:0,label:(prompt("\u0411\u044b\u043b \u043d\u0430\u0439\u0434\u0435\u043d \u0431\u0435\u0437 \u0438\u043c\u0435\u043d\u0438 \u043b\u043e\u043a\u0430\u043b\u043d\u044b\u0439 \u043c\u0438\u0440. \u041a\u0430\u043a \u0435\u0433\u043e \u043d\u0430\u0437\u0430\u0432\u0451\u0448\u044c? ",
"")||"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u044b\u0439 \u043c\u0438\u0440").substring(0,16),mod_l:Oa.now(),mod_r:0},a=!0);W=null}b={account:{label:"",rank:0},config:b,Ya:b};return a?(b.Ya=null,xb.Xa(b)):b},Xa:a=>{const b=a.config;if(b===a.Ya)return a;Xa("minicraft.config",Va({version:"0.10.6",flag_textures:b.ha,pixel_grouping:b.ta,mouse_sensitivity:b.qa,resolution_scaling:b.V,view_angle:b.Ba,view_distance:b.ca,world_last:b.Da,worlds:b.worlds}));return Object.assign({},a,{Ya:b})},
ub:(a,b)=>Object.assign({},a,{account:b}),wb:(a,b)=>xb.Ja(a,b(a.config)),Ja:(a,b)=>Object.assign({},a,{config:Object.assign({},a.config,b)}),Ka:(a,b)=>a.config.ia===b?a:xb.Ja(a,{ia:b}),eb:(a,b)=>Object.assign({},a,{config:Object.assign({},a.config,{worlds:[...a.config.worlds,b]})}),fb:(a,b)=>Object.assign({},a,{config:Object.assign({},a.config,{worlds:a.config.worlds.filter(c=>c.id!==b)})}),P:(a,b,c)=>Object.assign({},a,{config:Object.assign({},a.config,{worlds:a.config.worlds.map(d=>d.id===b?Object.assign({},
d,c):d)})})},yb="air stone grass dirt cobble planks bedrock log leaves bricks wool sand gravel glass bookshelf obsidian stone_bricks sandstone lapis_block iron_block gold_block diamond_block emerald_block redstone_block quartz_block".split(" "),zb="\u0412\u043e\u0437\u0434\u0443\u0445;\u041a\u0430\u043c\u0435\u043d\u044c;\u0411\u043b\u043e\u043a \u0442\u0440\u0430\u0432\u044b;\u0417\u0435\u043c\u043b\u044f;\u0411\u0443\u043b\u044b\u0436\u043d\u0438\u043a;\u0414\u043e\u0441\u043a\u0430;\u0411\u0435\u0434\u0440\u043e\u043a;\u0411\u0440\u0435\u0432\u043d\u043e;\u041b\u0438\u0441\u0442\u044c\u044f;\u041a\u0438\u0440\u043f\u0438\u0447\u0438;\u0428\u0435\u0440\u0441\u0442;\u041f\u0435\u0441\u043e\u043a;\u0413\u0440\u0430\u0432\u0438\u0439;\u0421\u0442\u0435\u043a\u043b\u043e;\u041a\u043d\u0438\u0436\u043d\u044f \u043f\u043e\u043b\u043a\u0430;\u041e\u0431\u0441\u0438\u0434\u0438\u0430\u043d;\u041a\u0430\u043c\u0435\u043d\u044b\u0435 \u043a\u0438\u0440\u043f\u0438\u0447\u0438;\u041f\u0435\u0449\u044f\u043d\u0438\u043a;\u0411\u043b\u043e\u043a \u043b\u0430\u0437\u0443\u0440\u0438\u0442\u0430;\u0411\u043b\u043e\u043a \u0436\u0435\u043b\u0435\u0437\u0430;\u0411\u043b\u043e\u043a \u0437\u043e\u043b\u043e\u0442\u0430;\u0411\u043b\u043e\u043a \u0430\u043b\u043c\u0430\u0437\u0430;\u0411\u043b\u043e\u043a \u0438\u0437\u0443\u043c\u0440\u0443\u0434\u0430;\u0411\u043b\u043e\u043a \u0440\u0435\u0434\u0441\u0442\u043e\u0443\u043d\u0430;\u0411\u043b\u043e\u043a \u043a\u0432\u0430\u0440\u0446\u0430".split(";"),
Ab=[0,8487297,4305266,4349313,8092539,5342114,7039851,3561583,4172910,6384533,15526888,10671324,8092798,16447200,4151672,1970708,8092539,9686227,9126695,15198183,5567485,14541182,7920469,662956,14936813],Bb="WEBTSN".split(""),Cb=(a,b=1,c=null)=>({amount:b,data:c,id:a}),Db=(a,b,c=a.c.amount)=>{if(b.c)a.c.id===b.c.id?(c=L(c,b.T-b.c.amount),a.c.amount-=c,b.c.amount+=c,0>=a.c.amount&&(a.c=null)):!(a.c.amount<=c&&a.c.amount<=b.T&&b.c.amount<=a.T)||a.filter&&!a.filter(b.c.id)||b.filter&&!b.filter(a.c.id)||
([b.c,a.c]=[a.c,b.c]);else if(!b.filter||b.filter(a.c.id))a.c.amount<=c&&a.c.amount<=b.T?[b.c,a.c]=[a.c,b.c]:(c=L(c,b.T),a.c.amount-=c,b.c=Cb(a.c.id,c),0>=a.c.amount&&(a.c=null))},Eb=(a,b)=>{for(const c of a)if(c.c&&c.c.id===b.id){const d=L(b.amount,c.T-c.c.amount);c.c.amount+=d;if(0>=(b.amount-=d))return null}for(const c of a)if(!c.c&&(!c.filter||c.filter(b.id)))if(a=L(b.amount,c.T),a<=b.amount){if(c.c=Cb(b.id,a),0>=(b.amount-=a))return null}else return c.c=b,null;return b},Fb=(a,b)=>({Ua:0,gb:0,
Va:0,N:0,da:0,Fa:0,ea:0,W:-1,fa:0,ma:null,na:null,j:1,ob:20,A:Array(36).fill(null).map(()=>({c:null,filter:null,T:64})),Pa:0,name:b.label||"\u0418\u0433\u0440\u043e\u043a",B:a.ya,G:a.za,H:a.Aa,sb:0,tb:0,K:0,ka:0,$:0,aa:0,ba:0}),Gb=(a,b,c)=>{a.N=(a.N+b+100*Da)%(2*Da);a.da=M(-Ea,L(Ea,a.da+c))},Hb=a=>{a+=32;33<a&&39>a?a++:38<a&&44>a?a+=2:43<a&&127>a?a+=3:126<a&&55258>a?a+=37:55295<a&&(a+=8485);return Ma(a)},Ib=a=>a-(63743<a?8517:159<a?69:46<a&&130>a?35:40<a&&46>a?34:34<a&&40>a?33:32),Kb=()=>{var a=Jb;
const b=a.length,c=new bb,d=y=>{m=m<<1|y&1;15===++v&&(g+=Hb(m),m=v=0)},e=()=>{for(let y=0;y<t;++y)d(0)},k=y=>{d(y);d(y>>1);d(y>>2);d(y>>3);d(y>>4);d(y>>5);d(y>>6);d(y>>7)},l=()=>{0===--w&&(w=1<<t++)},n=()=>{if(C)C=!1;else{let y=u.id;for(let G=0;G<t;G++)d(y>>G)}};let f=a[0],g="",m=0,v=2,t=2,w=2,h=2,u={id:h++,Ha:new bb},C=!0;k(f);c.set(f,u);for(let y=1;y<b;++y){const G=u.Ha.get(f=a[y]);G?u=G:(n(),c.has(f)||(l(),e(),k(f),c.set(f,{id:h++,Ha:new bb}),C=!0),u.Ha.set(f,{id:h++,Ha:new bb}),u=c.get(f),l())}n();
c.has(f)||(l(),e(),k(f));l();d(1);--t;e();return g+=Hb(m<<15-v)},Lb=a=>{var b=Jb;if(!a)return null;const c=a.length,d=()=>{v+=(h>>--u&1)<<t++;0===u&&(u=15,h=Ib(a.charCodeAt(w++)))};let e=[0,1],k=1,l=3,n=2,f=null;var g=null;let m=0,v=0;g=2;let t=0,w=0,h=Ib(a.charCodeAt(w++)),u=15;for(;t<g;)d();if(1===v)return null;for(v=t=0;8>t;)d();f=[v];e[2]=f;for(b[m++]=v;w<=c;){g=n;for(v=t=0;t<g;)d();if(0===v){for(v=t=0;8>t;)d();e[l]=[v];v=l++;0===--k&&(k=1<<n++)}else if(1===v)return b;g=v<e.length?e[v]:f.concat(f[0]);
for(let C=0;C<g.length;C++)b[m++]=g[C];e[l++]=f.concat(g[0]);f=g;0===--k&&(k=1<<n++)}return null};let X=null;if(Za){let a,b;null==(a=Ca.storage)||null==(b=a.persist)||b.call(a);const c=Za.open("minicraft",1);c.onupgradeneeded=d=>{d=d.target.result.createObjectStore("chunks",{keyPath:["world","coords"]});for(const e of fb(R))if(e.startsWith("minicraft.world.")){const [k,l]=e.substr(16).split(":");"meta"!==l&&(d.add({world:S(k),coords:l,data:R.getItem(e)}),Ya(e))}};c.onsuccess=d=>{X=d.target.result}}
const Mb=(a,b)=>ca(function*(){if(!X)return R.getItem(`minicraft.world.${a}:${b}`);const c=X.transaction("chunks","readonly").objectStore("chunks").get([a,b]);return new Ua(d=>{c.onsuccess=()=>{let e;d(null==(e=c.result)?void 0:e.data)}})}()),Nb=(a,b)=>{var c=Kb();return ca(function*(){if(!X)return Xa(`minicraft.world.${a}:${b}`,c);const d=X.transaction("chunks","readwrite").objectStore("chunks").put({world:a,coords:b,data:c});return new Ua((e,k)=>{d.onsuccess=()=>{e()};d.onerror=()=>{k(d.error)}})}())},
Ob=(a,b)=>ca(function*(){if(!X)return Ya(`minicraft.world.${a}:${b}`);const c=X.transaction("chunks","readwrite").objectStore("chunks").delete([a,b]);return new Ua(d=>{c.onsuccess=()=>{d()}})}()),Pb=a=>ca(function*(){const b=`minicraft.world.${a}:`;if(!X){const e={},k=b.length;for(const l of fb(R))l.startsWith(b)&&(e[l.substr(k)]=R.getItem(l));return e}const c=X.transaction("chunks","readonly").objectStore("chunks").openCursor(),d={meta:R.getItem(b+"meta")};return new Ua(e=>{c.onsuccess=()=>{const k=
c.result;k?(k.value.world===a&&(d[k.value.coords]=k.value.data),k.continue()):e(d)}})}()),Qb=(a,b)=>ca(function*(){if(X){var c=X.transaction("chunks","readwrite"),d=c.objectStore("chunks");for(const [e,k]of gb(b))"meta"!==e?d.put({world:a,coords:e,data:k}):Xa(`minicraft.world.${a}:meta`,k);return new Ua((e,k)=>{c.oncomplete=()=>{e()};c.onerror=()=>{k(c.error)}})}for(const [e,k]of gb(b))Xa(`minicraft.world.${a}:${e}`,k);Xa("__margin",Array(257).join("x"));Ya("__margin")}()),Rb=a=>{if(X){Ya(`minicraft.world.${a}:meta`);
var b=X.transaction("chunks","readwrite").objectStore("chunks").openCursor();b.onsuccess=()=>{const c=b.result;c&&(c.value.world===a&&c.delete(),c.continue())}}else{const c=`minicraft.world.${a}:`;for(const d of fb(R))d.startsWith(c)&&Ya(d)}},Sb=(a,b)=>{if(X){Xa(`minicraft.world.${b}:meta`,R.getItem(`minicraft.world.${a}:meta`));Ya(`minicraft.world.${a}:meta`);var c=X.transaction("chunks","readwrite").objectStore("chunks"),d=c.openCursor();d.onsuccess=()=>{const e=d.result;e&&(e.value.world===a&&
(e.value.world=b,c.put(e.value)),e.continue())}}else{const e=`minicraft.world.${a}:`,k=e.length,l=`minicraft.world.${b}:`;for(const n of fb(R))if(n.startsWith(e)){const f=R.getItem(n);Ya(n);Xa(l+n.substr(k),f)}}},Tb=new ab(1024),Jb=new $a(Tb.buffer),Ub=new bb,Vb=(a,b,c,d)=>0>c||63<c?0:a.X[(b<<a.J+4|d)<<6|c],Wb=(a,b,c,d)=>{const e=a.J;a.X[(b<<e+4|d)<<6|c]=0;a.Y[(b>>4<<e|d>>4)<<2|c>>4].ga=!0},Xb=(a,b,c,d,e)=>{const k=a.J,l=(b<<k+4|d)<<6|c;if(0<a.X[l])return!1;a.X[l]=e;return a.Y[(b>>4<<k|d>>4)<<2|c>>
4].ga=!0},$b=(a,b,c)=>{const d=M(L(b.G,63),0)>>4,e=K(b.B)>>4;b=K(b.H)>>4;if(c||a.Na!==d||a.ra+a.Ma!==e||a.sa+a.Oa!==b)c=1<<a.J,a.Na=d,a.ra=e-(a.Ma=(65536+e)%c),a.sa=b-(a.Oa=(65536+b)%c),Yb(a);a.busy||Zb(a,!1)},Yb=a=>{const b=a.Ma,c=a.Na,d=a.Oa,e=a.J,k=`${e} ${b} ${d} ${c}`;let l=Ub.get(k);if(null==l){const n=1<<e,f=ob(.5*n);Ub.set(k,l=a.Y.map(({x:g,y:m,z:v},t)=>{let w=ob(g-b),h=ob(v-d),u=ob(g-b-n),C=0,y=0;u<w&&(w=u,C=-n);(u=ob(g-b+n))<w&&(w=u,C=n);(u=ob(v-d-n))<h&&(h=u,y=-n);(u=ob(v-d+n))<h&&(h=u,
y=n);return{Za:w+h+ob(m-c),jb:t,ra:C,sa:y}}).filter(({Za:g})=>g<=f).sort((g,m)=>g.Za-m.Za))}a.Ia=l;a.oa=0},nc=(a,b)=>{const c=b.A.map(({c:d})=>d&&[d.id,d.amount,d.data]);for(;0<c.length&&null===c[c.length-1];)c.pop();Xa(`minicraft.world.${a.id}:meta`,Va({p:{h:b.ob,i:c,m:b.j,p:[b.B,b.G,b.H,b.N,b.da]},s:[a.ya,a.za,a.Aa],v:1}));Ua.all(a.Y.filter(d=>d.ga).map(d=>mc(a,d)))},oc=(a,b)=>{const c=R.getItem(`minicraft.world.${a.id}:meta`);if(c){const {p:d,s:e,v:k}=Wa(c);null!=k&&(d.i.forEach((l,n)=>{l&&(b.A[n].c=
Cb(l[0],l[1],l[2]))}),b.ob=d.h,b.j=d.m,b.B=d.p[0],b.G=d.p[1],b.H=d.p[2],b.N=d.p[3],b.da=d.p[4],a.ya=e[0],a.za=e[1],a.Aa=e[2])}},pc=a=>ca(function*(){const b=a.Y[a.Ia[a.oa=0].jb];var c=b.y;yield Ob(a.id,`${b.Ea}/${b.Ta}`+(0<c?"/"+c:""));b.ga=!1;++b.Ea;return Zb(a,!1)}()),mc=(a,b)=>{const c=a.Ga;var d=a.J;const e=b.y,k=(256<<d)-256;for(let l=0,n=-1,f=((b.x<<d+4|b.z)<<6|e)<<2;16>l;++l){for(d=0;16>d;++d)Tb[++n]=c[f],Tb[++n]=c[++f],Tb[++n]=c[++f],Tb[++n]=c[++f],f+=13;f+=k}b.ga=!1;return Nb(a.id,`${b.Ea}/${b.Ta}`+
(0<e?"/"+e:""))},Zb=(a,b)=>ca(function*(){const c=a.Y,d=a.Ia,e=a.ra,k=a.sa,l=d.length;for(;a.oa<l;){var n=d[a.oa++],f=c[n.jb],g=f.l,m=f.x;const h=f.y;var v=f.z,t=e+n.ra+m;const u=k+n.sa+v;if(!g||t!==f.Ea||u!==f.Ta){f.l=a.busy=!0;n=f.ga&&mc(a,f);var w=a.id;t=f.Ea=t;f=f.Ta=u;f=Lb(yield Mb(w,`${t}/${f}`+(0<h?"/"+h:"")));yield n;a.busy=!1;if(g||0===h||f){n=a.Ga;t=a.J;w=(256<<t)-256;m=((m<<t+4|v)<<6|h)<<2;if(f)for(let C=0,y=-1;16>C;++C){for(g=0;16>g;++g)n[m]=Tb[++y],n[++m]=Tb[++y],n[++m]=Tb[++y],n[++m]=
Tb[++y],m+=13;m+=w}else for(v=0;16>v;++v){for(f=0;16>f;++f)n[m]=0<h?0:50397446,n[++m]=0<h?0:131843,g?(n[++m]=0,n[++m]=0,m+=13):m+=15;m+=w}if(!b)break}}}}());let qc=null,rc=null,sc=new Image;sc.crossOrigin="anonymous";sc.onload=()=>{const a=Ba.createElement("canvas");a.width=16;a.height=416;const b=a.getContext("2d");b.drawImage(sc,0,0);fa("tile","div[className=bitmap]",{S:{backgroundImage:`url(${a.toDataURL()})`}});qc=new ab(b.getImageData(0,0,16,416).data.buffer);rc&&rc();sc=rc=null};
sc.src=ASSETS+"blocks.webp";
const uc=(a,b)=>{const c={vb:b,Wa:b.getContext("2d",{alpha:!1,desynchronized:!0}),hb:null,ib:null,mb:"",O:!1,nb:0,$a:0,xb:ib(()=>(c.nb=c.$a,c.$a=0),1E3),o:a};qc||(rc=()=>c.O=!0);tc(c);return c},tc=a=>{const b=a.vb,c=a.o;a.ib=new ab((a.hb=a.Wa.createImageData(b.width=c.ua,b.height=c.va)).data.buffer);const d=c.ua*c.config.V/c.ja,e=c.va*c.config.V/c.ja;b.style.width=d+"px";b.style.height=e+"px";b.style.left=Ha((c.Qa-d)/2)+"px";b.style.top=Ha((c.Ra-e)/2)+"px";a.Wa.fillStyle="rgba(255,255,255,.5)"};
let vc=0;
const yc=(a,b,c,d)=>{const e={X:null,Ga:null,busy:!1,Y:null,Ia:null,oa:0,L:!0,Ma:0,Na:0,Oa:0,id:c.Da,ra:0,sa:0,J:0,ya:.5,za:8.5,Aa:.5,time:0,Sa:0},k=Fb(e,d);oc(e,k);a={a,config:c,kb:0,lb:0,La:!1,pa:!0,yb:b,Z:0,U:new Set,ab:"",l:0,M:[],g:k,bb:null,u:null,ja:1,Qa:1,Ra:1,ua:0,va:0,wa:0,rb:0,xa:0,Ab:ib(()=>{e.L||(e.time=(e.time+1)%24E3,e.Sa=1/24E3*(e.Sa+6E3)%1,$b(e,k,!1))},50),world:e};wc(a,null);xc(a);return a},zc=a=>{nc(a.world,a.g);a.a.P(a.world.id,{mod_l:Oa.now()})},Ac=a=>{a.l=0;a.world.L=!1;xc(a)},
xc=a=>{ca(function*(){if(!a.config.ia)try{yield a.yb.requestPointerLock()}catch(b){}}())},Bc=(a,b)=>a===b?0:.1-.2*a,Cc=a=>{a.g.Ua=Bc((a=a.U).has(-12)||a.has(65),a.has(-13)||a.has(68))},Dc=a=>{a.g.gb=Bc((a=a.U).has(-15)||a.has(16),a.has(-14)||a.has(32))},Ec=a=>{a.g.Va=Bc((a=a.U).has(-11)||a.has(83),a.has(-10)||a.has(87))},Fc=a=>{a.g.sb=Bc(a.U.has(-18),a.U.has(-19))},Gc=a=>{a.g.tb=Bc(a.U.has(-17),a.U.has(-16))},Ic=(a,b,c)=>{if(!a.world)return!1;const d=a.U;var e=a.g;if(c){if(d.has(b))return!1;d.add(b);
var k=e.ea,l=e.W;c=e.fa;switch(b){case -18:case -19:Fc(a);break;case -17:case -16:Gc(a);break;case -1:2!==e.j&&0<=l&&(0===e.Pa?0===e.j&&(b=Vb(a.world,k,l,c),2===b?b=3:1===b&&(b=4),6===b||8!==b&&13!==b&&null!==Eb(e.A,Cb(b,1)))||(Wb(a.world,k,l,c),e.W=-1):Hc(a,[k,l,c],!1));break;case -2:case 71:if(0<=l){const n=Vb(a.world,k,l,c);c=e.A.slice(0,9);l=c.findIndex(f=>null!==f.c&&f.c.id===n);0<=l?e.K=l:1===e.j&&(c[e.K].c&&(c=c.findIndex(f=>null===f.c),0<=c&&(e.K=c)),e.A[e.K].c=Cb(n));e.ka=a.Z}break;case -3:if(2!==
e.j&&0<=l)if(0===e.Pa){if(b=e.A[e.K],b.c){switch(e.Fa){case 0:--k;break;case 1:++k;break;case 2:--l;break;case 3:++l;break;case 4:--c;break;default:++c}0<=l&&64>l&&Xb(a.world,k&(1<<4+a.world.J)-1,l,c&(1<<4+a.world.J)-1,b.c.id)&&1!==e.j&&0>=--b.c.amount&&(b.c=null)}}else Hc(a,[k,l,c],!0);break;case -4:e.K=(e.K+9-1)%9;e.ka=a.Z;break;case -5:e.K=(e.K+1)%9;e.ka=a.Z;break;case 27:0===a.l&&(a.world.L=!0,a.l=1);break;case -15:case -14:case 16:case 32:Dc(a);break;case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:e.K=
b-49;e.ka=a.Z;break;case -12:case -13:case 65:case 68:Cc(a);break;case 69:if(0===a.l){a.l=3;for(const n of d)Ic(a,n,!1)}break;case 80:a.world&&(a.world.L=!0);break;case 81:e=e.A[e.K];if(d.has(17)||e.c&&0>=--e.c.amount)e.c=null;break;case -11:case -10:case 83:case 87:Ec(a);break;case 84:if(0===a.l){a.l=2;for(const n of d)Ic(a,n,!1)}break;case 112:a.pa=!a.pa;break;case 114:a.La=!a.La;case 116:case 122:case 123:break;default:return!1}}else{if(!d.delete(b))return!1;switch(b){case -15:case -14:case 16:case 32:Dc(a);
break;case -12:case -13:case 65:case 68:Cc(a);break;case -11:case -10:case 83:case 87:Ec(a);break;case -18:case -19:Fc(a);break;case -17:case -16:Gc(a)}}a.ab=[...d].join();return!0},Jc=(a,b)=>(b=b.startsWith("~")?a+S(b.substr(1)):S(b),isNaN(b)?a:b),Lc=(a,b)=>{const c=a.g;var d=a.world;if(b)if("/"===b.charAt(0)){b=b.substr(1).split(" ");const e=b.shift();switch(e){case "clear":a.M=[];break;case "clearinv":for(const k of c.A)k.c=null;Y(a,"\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440 \u043f\u0443\u0441\u0442",
!0);break;case "gamemode":case "gm":b=S(b[0]);!isNaN(b)&&0<=b&&3>b&&0===b%1?(c.j=b,Y(a,"\u0418\u0433\u0440\u043e\u0432\u043e\u0439 \u0440\u0435\u0436\u0438\u043c \u0441\u043c\u0435\u043d\u0451\u043d \u043d\u0430: "+b,!0)):Y(a,"\u0418\u0433\u0440\u043e\u0432\u043e\u0439 \u0440\u0435\u0436\u0438\u043c \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442 0..2!");break;case "give":if(0===b.length){Y(a,"/give <id> [\u0427\u0438\u0441\u043b\u043e]\n"+yb.join(" "));break}d=yb.indexOf((b[0]||"").toLowerCase());
d=0<=d?d:S(b[0]);b=S(b[1]||1);!isNaN(d)&&0<d&&25>d&&0===d%1?!isNaN(b)&&0<b&&0===b%1?Y(a,Eb(c.A,Cb(d,b))?"\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440 \u043f\u043e\u043b\u043d\u044b\u0439!":`${"\u0412\u0435\u0449\u0438 \u0434\u0430\u043d\u044b"} ${b} ${zb[d]}`,!0):Y(a,"\u0427\u0438\u0441\u043b\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442 \u043c\u0438\u043d\u0438\u043c\u0443\u043c 1!"):Y(a,"\u041d\u0435\u0432\u0435\u0440\u043d\u044b\u0439 \u0442\u0438\u043f \u0431\u043b\u043e\u043a\u0430!");
break;case "help":Y(a,"\u041a\u043e\u043c\u0430\u043d\u0434\u0430: clear, clearinv, gamemode, give, help, load, me, save, spawn, teleport, version");break;case "load":Zb(d,!0).then(()=>{a.u.O=!0;Y(a,"\u0427\u0430\u043d\u043a\u0438 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f.",!0)});break;case "me":Y(a,c.name+" "+b.join(" "),!0);break;case "save":zc(a);Y(a,"\u0418\u0433\u0440\u0430 \u0441\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u0430.",!0);break;case "spawn":d.ya=c.B;d.za=
c.G;d.Aa=c.H;Y(a,"\u041d\u0430\u0447\u0430\u043b\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0430",!0);break;case "teleport":case "tp":0===b.length?(c.B=d.ya,c.G=d.za,c.H=d.Aa,a.u.O=!0,Y(a,"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u0441\u044f \u043a \u0441\u0442\u0430\u0440\u0442\u043e\u0432\u043e\u0439 \u0442\u043e\u0447\u043a\u0438",!0)):3===b.length?(Y(a,"\u041f\u0435\u0440\u0435\u043c\u0435\u0441\u0442\u0438\u0442\u0441\u044f \u043a"+
` ${c.B=Jc(c.B,b[0])} ${c.G=Jc(c.G,b[1])} ${c.H=Jc(c.H,b[2])}`,!0),a.u.O=!0):Y(a,"\u041d\u0435\u043f\u043e\u0432\u0435\u0437\u043b\u043e!");c.$=0;c.aa=0;c.ba=0;break;case "version":Y(a,"Minicraft 0.10.6");break;case "/exit":c.Pa=0;Y(a,"\u041a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0440\u0435\u0436\u0438\u043c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u043c\u044b\u0448\u043a\u0438.",!0);break;case "/expand":a.g.ma&&a.g.na?d=!0:(Y(a,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043d\u0430\u0447\u044f\u043b\u043e!"),
d=!1);d&&("vert"===b[0]?(c.ma[1]=0,c.na[1]=63,Y(a,"\u0412\u044b\u0431\u043e\u0440\u044c \u0443\u0432\u0435\u043b\u0438\u0447\u0435\u043d.",!0)):Y(a,'\u0422\u043e\u043b\u043a\u043e "vert" \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f!'));break;case "/pos1":case "/pos2":Hc(a,[K(c.B),K(c.G),K(c.H)],"/pos2"===e);break;case "/regen":pc(d).then(()=>{a.u.O=!0;Y(a,"\u0427\u0430\u043d\u043a\u0438 \u043f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f ",
!0)});break;case "/show":Y(a,`${"\u041f\u0435\u0440\u0432\u044b\u0439"}: ${c.ma?c.ma.join(" "):"\u043d\u0438\u0447\u0435\u0433\u043e"}, ${"\u0412\u0442\u043e\u0440\u043e\u0439"}: ${c.na?c.na.join(" "):"\u043d\u0438\u0447\u0435\u0433\u043e"}`);break;case "/wand":c.Pa=1;Y(a,"\u0412\u044b\u0431\u043e\u0440\u044c \u0441 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u043c\u044b\u0448\u043a\u0438.",!0);break;default:Y(a,"\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u043d\u0430\u044f \u043a\u043e\u043c\u0430\u043d\u0434\u0430: "+
e)}}else{const e=Y(a,`<${c.name}> `+b);wc(a,b).then(k=>{k&&Kc(a,e)})}},Y=(a,b,c=!1)=>{const d=++vc;(a.M=a.M.slice(-49)).push({id:d,qb:c,time:xa(),value:b});return d},Kc=(a,b)=>{const c=a.M.findIndex(d=>d.id===b);0<=c&&a.M.splice(c,1)},Hc=(a,b,c)=>{c?a.g.na=b:a.g.ma=b;Y(a,`${c?"\u0412\u0442\u043e\u0440\u0430\u044f \u0432\u044b\u0431\u0440\u0430\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430":"\u041f\u0435\u0440\u0432\u0430\u044f \u0432\u044b\u0431\u0440\u0430\u043d\u0430\u044f \u0442\u043e\u0447\u043a\u0430"}: ${b.join(" ")}`,
!0)},wc=(a,b)=>(jb(a.bb),(b?fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:Va({msg:b})}):fetch("/api/chat")).then(c=>{if(c.ok)return c.text()}).then(c=>{if(c){c=c.split("\n").filter(Boolean);for(const d of c)d.startsWith("<")&&Y(a,d);return 0<c.length}return!1}).catch(()=>!1).then(c=>{a.bb=hb(()=>{wc(a,null)},5E3);return c})),Mc=({id:a})=>(B("#tile",{S:{backgroundPositionY:`-${2*(a-1)}rem`}}),null);
function Nc({amount:a,j:b,id:c}){B("div[className=stack]",{title:zb[c]+(1===b?` (${yb[c]}, ${c})`:"")});return[H(Mc,{id:c}),1!==a&&I("div[className=amount]",{innerText:a})]}
function Oc({g:a,la:b}){B("div[className=bar]",{ontouchstart:F(d=>{a.K=Number(d.target.closest("[data-slot]").dataset.slot);a.ka=d.timeStamp}),S:{opacity:M(.5,L(1,1-5E-4*(b-a.ka-5E3)))}});const c=a.j;return qc&&a.A.slice(0,9).map(({c:d},e)=>I("div",{D:{slot:e},F:{active:e===a.K}},[d&&H(Nc,{amount:d.amount,data:d.data,j:c,id:d.id})]))}
function Pc({zb:a}){B("div[className=grid]",{onclick:({target:b})=>{(b=b.closest("[data-id]"))&&Db({c:Cb(S(b.dataset.id)),filter:null,T:64},a)}});return yb.map((b,c)=>0<c&&I("div",{D:{id:c}},[H(Nc,{amount:1,data:null,j:1,id:c})]))}
function Qc({o:a}){const b=ka(()=>({c:null,filter:null,T:64})),c=a.g.j;B("div[className=menu overlay inventory]",ka(()=>({onclick:({target:d})=>{if("menu overlay inventory"===d.className)b.c?b.c=null:Ac(a);else if(d=d.closest("[data-slot]"))d=a.g.A[S(d.dataset.slot)],b.c?Db(b,d):d.c&&Db(d,b)},oncontextmenu:({target:d})=>{if("menu overlay inventory"===d.className)b.c?0>=--b.c.amount&&(b.c=null):Ac(a);else if(d=d.closest("[data-slot]"))d=a.g.A[S(d.dataset.slot)],b.c?Db(b,d,1):d.c&&Db(d,b,Ga(d.c.amount/
2))}})));return qc&&[I("div[className=window]",null,[I("h2[innerText=\u0418\u043d\u0432\u0435\u043d\u0442\u0430\u0440]"),1===c&&H(Pc,{zb:b}),I("div[className=grid]",null,a.g.A.map(({c:d},e)=>I("div",{D:{slot:e},F:{first:9>e}},[d&&H(Nc,{amount:d.amount,data:d.data,j:c,id:d.id})])))]),b.c&&I("div[className=hand]",{S:{transform:`translate(${a.kb}px, ${a.lb}px)`}},[H(Nc,{amount:b.c.amount,data:b.c.data,j:0,id:b.c.id})])]}
const Rc=({I:{qb:a,time:b,value:c},la:d})=>(B(a?"div[className=minor]":"div",{innerText:c,S:{opacity:L(1,1-.001*(d-b-4500))}}),null);function Sc({M:a,la:b}){B("div[className=messages]");const c=b-5E3;return[wa(Rc,a.slice(-10).filter(d=>d.time>c),{la:b})]}
function Tc({a:{wb:a,Ja:b},config:c,o:d,Ca:e}){D(()=>zc(d));B("div[className=menu overlay]");return[I("h1[innerText=\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438]"),F(I("center",null,[I("button[innerText=\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u0432 \u0438\u0433\u0440\u0443]",{onclick:()=>{Ac(d)}})])),I("div[className=settings]",null,[I("button",{innerText:"\u041f\u043e\u0432\u0435\u0440\u0445\u043d\u043e\u0441\u0442\u044c:\n"+(c.ha?"\u0421 \u0442\u0435\u043a\u0441\u0442\u0443\u0440\u0430\u043c\u0438":
"\u041e\u0434\u043d\u043e\u0446\u0432\u0435\u0442\u043d\u044b\u0439"),onclick:F(()=>a(k=>({ha:!k.ha})))}),I("label[innerText=\u041a\u0430\u0447\u0435\u0441\u0442\u0432\u043e:]",null,[I("input[type=range][min=1][max=100][step=1]",{value:101-c.V,onchange:F(k=>b({V:101-Number(k.target.value)}))})]),I("label[innerText=\u0420\u0430\u0434\u0438\u0443\u0441 \u0437\u0440\u0435\u043d\u0438\u044f:]",null,[I("input[type=range][min=1][max=180][step=1]",{value:c.Ba,onchange:F(k=>b({Ba:Number(k.target.value)}))})]),
I("label[innerText=\u0414\u0430\u043b\u043d\u043e\u0441\u0442\u044c \u0437\u0440\u0435\u043d\u0438\u044f:]",null,[I("input[type=range][min=1][max=128][step=1]",{value:c.ca,onchange:F(k=>b({ca:Number(k.target.value)}))})]),I("label[innerText=\u0413\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0430 \u043f\u0438\u043a\u0441\u0435\u043b\u0435\u0439:]",null,[I("input[type=range][min=1][max=6][step=1]",{value:c.ta,onchange:F(k=>b({ta:Number(k.target.value)}))})]),I("label[innerText=\u0427\u0443\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u043d\u043e\u0439 \u043c\u044b\u0448\u043a\u0438.:]",
null,[I("input[type=range][min=1][max=15][step=1]",{value:c.qa,onchange:F(k=>b({qa:Number(k.target.value)}))})])]),F(I("center",null,[I("button[innerText=\u041f\u043e\u043a\u0438\u043d\u0443\u0442 \u043c\u0438\u0440]",{onclick:()=>{e(0)}})]))]}const Uc=({I:{qb:a,value:b}})=>(B(a?"div[className=minor]":"div",{innerText:b}),null);
function Vc({o:a,M:b}){const c=F({history:null,input:null});B("div[className=menu overlay terminal]",{onclick:d=>{d.target!==c.input&&c.input.focus()}});D(d=>{d&&hb(()=>c.history.scrollTop=1E9,0)},[b.length&&b[b.length-1].id]);return[F(I("div[className=toolbar]",null,[I("button[innerText=\u274c]",{onclick:()=>{Ac(a)}})])),I("div[className=history]",{R:F(d=>{c.history=d})},[wa(Uc,b)]),F(I("input[enterkeyhint=send][mozactionhint=send][name=message][required]",{onkeydown:d=>{const e=d.keyCode;d=d.target;
13===e?(Lc(a,d.value),d.value=""):27===e&&Ac(a)},R:d=>{c.input=d;hb(()=>d.focus(),0)}}))]}const Wc=[["pick",-2],["up",-14],["down",-15],["E",69],["T",84],["F1",112],["F3",114],["...",27]],Xc=[["up",-10],["down",-11],["left",-12],["right",-13],["center",-1]],Yc=[["up",-16],["down",-17],["left",-18],["right",-19],["center",-3]];
function Zc({o:a}){const b=a.U,c=([d,e])=>I("div",{D:{code:e},F:{button:!0,[d]:!0,active:b.has(e)}});B("div[className=touch]",F({ontouchstart:d=>{let {code:e}=d.target.dataset;if(null!=e&&Ic(a,e=S(e),!0)){const k=d.changedTouches[0].identifier,l=n=>{n.changedTouches[0].identifier===k&&(mb("touchend",l),Ic(a,e,!1))};lb("touchend",l)}return!1}}));return[I("div[className=top]",null,Wc.map(([d,e])=>I(`div[innerText=${d}]`,{D:{code:e},F:{button:!0,active:b.has(e)}}))),I("div[className=move]",null,Xc.map(c)),
I("div[className=move sec]",null,Yc.map(c))]}
function $c({account:a,a:b,config:c,frame:d,cb:e,Ca:k}){const l=xa(),n=Ba.pointerLockElement===d,f=ka(()=>e.o=yc(b,d,c,a));D(()=>{const g=w=>{if(0!==f.l)return!0;Ba.pointerLockElement===d?Ic(f,-1-w.button,"mousedown"===w.type):xc(f);return!1},m=w=>{if(Ba.pointerLockElement===d){const h=f.config.qa*Da/(M(f.Qa,f.Ra)*f.ja);nb&&(f.rb=w.timeStamp);Gb(f.g,f.wa=w.movementX*h,f.xa=-w.movementY*h)}else f.kb=w.clientX,f.lb=w.clientY},v=w=>{b.Ka(!1);if(0===f.l&&!f.world.L&&5<Math.abs(w.deltaY))return w=0<w.deltaY?
-5:-4,Ic(f,w,!0),Ic(f,w,!1),!1},t={passive:!0};d.addEventListener("mousedown",g);d.addEventListener("mouseup",g);d.addEventListener("mousemove",m,t);d.addEventListener("wheel",v,t);return()=>{d.removeEventListener("mousedown",g);d.removeEventListener("mouseup",g);d.removeEventListener("mousemove",m,t);d.removeEventListener("wheel",v,t);jb(f.bb);kb(f.Ab);nc(f.world,f.g);kb(f.u.xb);e.o=null}});D(()=>{f.config=c;f.u&&(f.u.O=!0);const g=f.world;var m=Ga(La(f.config.ca/16*2+2));if(g.J!==m){var v=f.g;g.Y&&
nc(g,v);const t=1<<(g.J=m),w=g.Y=[];for(let h=0;h<t;++h)for(let u=0;u<t;++u)for(let C=0;4>C;++C)w.push({ga:!1,l:!1,x:h,y:C,z:u,Ea:0,Ta:0});m=t<<m+12+2;null===g.X||g.X.length<m?g.Ga=new ab((g.X=new $a(m)).buffer):g.Ga.fill(0);$b(g,v,!0)}},[c]);D((g,m,v)=>{f.ja=v;f.Qa=M(1,g);f.Ra=M(1,m);m=f.config.V;g=Ga(f.Qa*f.ja/m);m=Ga(f.Ra*f.ja/m);if(g!==f.ua||m!==f.va)f.ua=g,f.va=m,f.u&&(f.u.O=!0,tc(f.u))},[d.offsetWidth,d.offsetHeight,ya.devicePixelRatio||1,c.V]);D(g=>{g||f.world.L||0!==f.l||(f.l=1,nb&&f.wa|f.xa&&
f.rb>l-100&&(Y(f,`move back ${Math.round(100*f.wa)}% ${Math.round(100*f.xa)}%`),Gb(f.g,-f.wa,-f.xa),f.wa=f.xa=0,f.u.O=!0));f.world.L=!g},[c.ia&&0===f.l||n]);D(g=>n&&g&&Ba.exitPointerLock(),[f.world.L||0!==f.l]);D(()=>{if(f.world){if(f.Z&&!f.world.L){var g=f.g,m=L(5,.01*(l-f.Z));g.$-=.1*g.$*m;g.aa-=.1*g.aa*m;g.ba-=.1*g.ba*m;g.$+=(Ia(g.N)*g.Ua+Ja(g.N)*g.Va)*m;g.aa+=g.gb*m;g.ba+=(-Ja(g.N)*g.Ua+Ia(g.N)*g.Va)*m;Gb(g,g.sb*m*1.5,g.tb*m*1.5);g.B+=g.$*m;g.G+=g.aa*m;g.H+=g.ba*m}if(f.u){g=f.u;++g.$a;m=g.Wa;
var v=g.hb;const ha=g.ib,ua=g.o,za=ua.config,rb=ua.pa,z=ua.g,N=ua.ua,ma=ua.va,O=ua.world;if(!O.L||g.O){g.O=!1;var t=za.ta;const cd=za.ca;var w=z.N,h=z.da;const dd=z.ea,ed=z.fa;var u=z.B,C=z.G,y=z.H;const fd=rb?z.W:-1,gd=O.X;var G=O.J;const hd=za.ha&&null!==qc;var P=1/N,r=1/ma;const ia=N>>1,na=ma>>1,ac=L(N,ma),bc=32<ac,cc=Ia(w);w=Ja(w);const dc=Ia(-h);h=Ja(-h);var q=za.Ba/45;const id=P*(N<ma?q*N*r:q);P=r*(ma<N?q*ma*P:q);u+=65536;C+=65536;y+=65536;r=u%1;q=C%1;const jd=y%1;G=4+G;const ec=(1<<G)-1;t=
t<N?t:1;const kd=N-t;let fc=1===z.j?6:4,sb=z.ea=z.fa=z.Fa=0,gc=0;z.W=-1;for(let Pa=0;Pa<ma;++Pa){var x=(na-Pa)*P;const hc=x*dc-h;var A=x*h+dc;x=A*w;A*=cc;let oa=0,Aa=!1;var pa=!1;a:for(let Z=0;Z<N;Z+=t)for(let aa=pa?1:0;aa<t;++aa){if(2>t)var E=Z;else if(0===Z)E=0===aa?0:1===aa?t:aa-1,Aa=1===aa;else if(Z<kd)E=(Aa=1===aa)?Z+t:Z+aa-1;else{if((E=0===aa?Z-1:Z+aa)>=N)break a;Aa=!1}var T=(E-ia)*id;pa=x+cc*T;const ic=A-w*T,ld=gc;T=16757124;let cb=1,jc=cd;for(let tb=0;3>tb;++tb){const U=(ld+tb)%3;let ba=ic;
var Q=jd;0===U&&(ba=pa,Q=r);1===U&&(ba=hc,Q=q);var qa=-1/ba;0<ba&&(Q=1-Q,qa*=-1);const db=pa*qa,va=hc*qa;qa*=ic;const kc=Ka(db*db+va*va+qa*qa);let Qa=u+db*Q-(0===U&0>ba|0),Ra=C+va*Q-(1===U&0>ba|0),Sa=y+qa*Q-(2===U&0>ba|0);Q*=kc;for(let ub,vb,wb,V;Q<jc;Qa+=db,Ra+=va,Sa+=qa,Q+=kc)if(65536>Ra){if(0>va)break}else if(65600<=Ra){if(0<va)break}else if(0!==(V=gd[((ub=Qa&ec)<<G|(wb=Sa&ec))<<6|(vb=Ra&63)])){Pa===na&&E===ia&&Q<=fc&&(z.ea=ub,z.W=vb,z.fa=wb,z.Fa=0>ba|U<<1,fc=Q);if(hd){--V;1===U?6===V?V=25:13===
V?V=4:1===V&&0<va&&(V=2):1===V&&(V=24);const lc=qc[V<<8|(16*(1===U?Sa:Ra)&15)<<4|16*(1===U?Qa:(0<ba?Qa-Sa:Sa-Qa)+65536)&15];if(0===lc>>>24)continue;T=lc&16777215}else T=Ab[V];jc=Q;cb=(0===U?.8:2===U?.6:0<ba?.4:1)+(vb!==fd||ub!==dd||wb!==ed?0:.2);gc=U;break}}T=4278190080|L((T>>16)*cb,255)<<16|L((T>>8&255)*cb,255)<<8|L((T&255)*cb,255);if(pa=(Aa=Aa&&(Pa!==na||E<ia||E>ia+t))&&oa===T){E=sb+Z+1;ha[E]=oa;ha[++E]=oa;if(3>t)break;ha[++E]=oa;if(4>t)break;ha[++E]=oa;if(5>t)break;ha[++E]=oa;if(6>t)break;ha[++E]=
oa;break}if(Aa||0===E)oa=T;ha[sb+E]=T}sb+=N}rb&&!bc&&(ha[N*na+ia]^=16777215);m.putImageData(v,0,0);rb&&bc&&(v=L(Ga(.05*ac),8),m.fillRect(ia-v,na-1,v<<1,2),m.fillRect(ia-1,na-v,2,v-1),m.fillRect(ia-1,na+1,2,v-1))}g.mb=ua.La?"Minicraft 0.10.6 "+K(g.nb).toString().padStart(2,"\u00a0")+" fps, T: "+K(24*O.Sa).toString().padStart(2,"0")+":"+K(24*O.Sa%1*60).toString().padStart(2,"0")+"; "+(O.L&&500>l%1E3?"":O.time)+"\nR: "+N+"x"+ma+" (x"+za.V+"), D: "+za.ca+", C: "+O.oa+"/"+O.Ia.length+", M: "+(64*ob(1<<
4+O.J)>>10)+"k\nE: 0/0 M: "+z.j+"\n\nPosition: "+z.B.toFixed(2)+" "+z.G.toFixed(2)+" "+z.H.toFixed(2)+"\nAngle: "+(z.N*Fa).toFixed(2)+" "+(z.da*Fa).toFixed(2)+"\nBlock: "+(0>z.W?0:z.ea+" "+z.W+" "+z.fa+" "+Bb[z.Fa]+": "+Vb(O,z.ea,z.W,z.fa))+"\nChunk abs: "+(K(z.B)>>4)+" "+(K(z.H)>>4)+" "+(K(z.G)>>4)+" rel: "+O.Ma+" "+O.Oa+" "+O.Na:""}}f.Z=l},[l]);ra();return[I("canvas",{R:F(g=>{f.u=uc(f,g)})}),f.pa&&2!==f.l&&H(Sc,{M:f.M,la:l}),f.u&&f.La&&I("div[className=diagnostics]",{innerText:f.u.mb}),c.ia&&H(Zc,
{o:f,ab:f.ab}),f.pa&&3!==f.l&&2!==f.g.j&&H(Oc,{g:f.g,la:l}),3===f.l&&H(Qc,{o:f,la:l}),1===f.l&&H(Tc,{a:b,config:c,o:f,Ca:k}),2===f.l&&H(Vc,{o:f,M:f.M})]}
function ad({I:a,Bb:b,Cb:c,Db:d}){B("div",{F:{selected:a===c},onclick:()=>{d(a.id)}});c=`${a.local?"L":"_"}${a.local&&a.remote?a.local>a.remote?">":a.local<a.remote?"<":"=":"_"}${a.remote?a.public?"R":"r":"_"}`;b===a.id&&(c=`[${c}]`);return[I("span",{innerText:`${c} ${a.label}`,title:a.account_name?"\u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446: "+a.account_name:"\u0422\u043e\u043b\u043a\u043e \u043b\u043e\u043a\u0430\u043b\u043d\u044b\u0439 \u043c\u0438\u0440"}),I("span",{innerText:qb(M(a.local,
a.remote),!0)})]}
function bd({account:a,a:b,config:c,Ca:d}){B("div[className=menu]");const [e,k,l]=sa(0),n=F(()=>{k(l()+1)}),f=F({value:null}),g=ja(()=>ca(function*(){try{const r=!f.value&&!e,q=yield fetch("/api/minicraft/"+`world?what=${r?"initial":"meta_all"}`);if(!q.ok)throw Error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");const x=yield q.json();if(!r)return x;if("0.10.6"!==x.version_latest)return location.reload(!0),null;da();b.ub(x.account);return x.worlds}catch(r){return alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0438 \u0441\u043f\u0438\u0441\u043a\u0430 \u043c\u0438\u0440\u043e\u0432: "+
r.message),[]}}()),[e],null),m=ka(()=>{g&&(f.value=g);const r=[];f.value&&r.push(...f.value.map(q=>({account_name:q.account_name,hash:q.hash,id:q.id,label:q.label,local:0,public:q.public,remote:q.modified,writable:q.writable})));for(const q of c.worlds){const x=r.find(A=>A.id===q.id);if(x){const A=x.local=q.mod_l,pa=x.remote,E=q.mod_r;A>E&&pa>E&&(confirm('\u041a\u043e\u043d\u0444\u043b\u0438\u043a\u0442! \u041c\u0438\u0440. "'+q.label+'" \u0431\u044b\u043b\u043e \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u043e \u043a\u0430\u043a \u0437\u0434\u0435\u0441\u044c, \u0442\u0430\u043a \u0438 \u0432 \u0434\u0440\u0443\u0433\u0438\u0445 \u043c\u0435\u0441\u0442\u0430\u0445.\n\u041e\u041a: \u043f\u0440\u0438\u043d\u044f\u0442\u044c \u0442\u043e, \u0447\u0442\u043e \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 ('+
qb(pa,!1)+") | \u041e\u0442\u043c\u0435\u043d\u0438\u0442: \u0412\u043e\u0442 \u044d\u0442\u043e \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c ("+qb(A,!1)+")")?b.P(q.id,{mod_l:x.local=E}):b.P(q.id,{mod_r:x.remote=E}))}else 1<q.mod_r&&g&&g.length&&(alert('\u041c\u0438\u0440 "'+q.label+'" \u0431\u044b\u043b \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0435 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044c, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u043e\u043d \u0442\u0435\u043f\u0435\u0440\u044c \u043b\u043e\u043a\u0430\u043b\u043d\u044b\u0439!'),
b.P(q.id,{mod_r:0})),r.push({account_name:"",hash:0,id:q.id,label:q.label,local:q.mod_l,public:!1,remote:1===q.mod_r?1:0,writable:!0})}return r.sort((q,x)=>M(x.local,x.remote)-M(q.local,q.remote))},[g,c.worlds]),[v,t,w]=sa(c.Da),h=ka(()=>m.find(r=>r.id===v)||null,[v,m]),u=ka(()=>{let r,q;return null!=(q=null==m?void 0:null==(r=m.find(x=>0<x.local&&0<x.remote&&x.local!==x.remote))?void 0:r.id)?q:null},[m]);D(()=>{if(null!==u){var r=!1,q=m.find(x=>x.id===u);if(q.local<q.remote)fetch("/static/minicraft/worlds/"+
`${q.hash}.json`).then(x=>x.json()).then(x=>{if(!r)return Qb(u,x).then(()=>{b.P(u,{mod_l:q.remote,mod_r:q.remote})})}).catch(x=>{r||("QuotaExceededError"===x.name?(alert("\u041d\u0435\u0445\u0432\u0430\u0442\u0430\u0435\u0442 \u043f\u0430\u043c\u044f\u0442\u0438!"),b.fb(u),Rb(u)):alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u043c\u0438\u0440\u0430: "+x.message))});else{if(!q.writable){b.P(u,{mod_l:c.worlds.find(A=>A.id===u).mod_r});
return}let x=u;(1===q.remote?fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Va({what:"meta",label:q.label})}).then(A=>{if(!A.ok)throw Error(403===A.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");return A.json()}).then(A=>
{x=A.id}):Ua.resolve()).then(()=>{if(r)throw null;return Pb(u)}).then(A=>{if(r)throw null;return fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Va({what:"data",world:x,data:A})})}).then(A=>{if(!A.ok)throw Error(403===A.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");
return A.json()}).then(A=>{da();x===u?b.P(u,{mod_l:A.modified,mod_r:A.modified}):(Sb(u,x),b.fb(u),b.eb({id:x,label:q.label,mod_l:A.modified,mod_r:A.modified}),r||w()!==u||t(x));r||n();ea()}).catch(A=>{r||(alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0441\u043a\u0435 \u043c\u0438\u0440\u0430: "+A.message),da(),b.P(u,{mod_r:0}),ea())})}return()=>{r=!0}}},[u]);const [C,y]=sa(!1);h||y(!1);const [G,P]=sa(!1);return[I("h1[innerText=\u041c\u0438\u0440\u044b]"),
I("button[innerText=\u041e\u0431\u043d\u043e\u0432\u0438\u0442][style=position:absolute;left:0;top:0;height:2rem][title=\u041e\u0431\u043d\u043e\u0432\u0438\u0442 \u0441\u043f\u0438\u0441\u043e\u043a]",{disabled:!g,onclick:n}),I("button[style=position:absolute;right:0;top:0;height:2rem]",{disabled:0<a.rank,innerText:a.rank?a.label:"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c\u0441\u044f ",onclick:()=>{location.href="/account?redir=minicraft"}}),
I("div[className=worlds]",null,[wa(ad,m,{Eb:e,Bb:u,Cb:h,Db:t})]),I("center",null,[I("button[innerText=\u041e\u0442\u043a\u0440\u044b\u0442]",{disabled:!h||!h.local||h.remote>h.local,onclick:()=>{da();b.Ja({Da:h.id});d(1);ea()},title:h?h.local?h.remote>h.local?"\u041c\u0438\u0440 \u0435\u0449\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u0430!":"\u0417\u0430\u0439\u0442\u0438 \u043d\u0430 \u0432\u044b\u0431\u0440\u0430\u043d\u044b\u0439 \u0441\u0435\u0440\u0432\u0435\u0440":"\u041c\u0438\u0440 \u0435\u0449\u0435 \u043d\u0435 \u0441\u043a\u0430\u0447\u0435\u043d!":
"\u041c\u0438\u0440 \u0431\u044b\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u044c!"}),I("button[innerText=\u041c\u0438\u0440...]",{disabled:!h||C,onclick:()=>{y(!0)},title:h?"\u0410\u043a\u0446\u0438\u0438/\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043c\u0438\u0440\u0430":"\u041c\u0438\u0440 \u0431\u044b\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u044c!"})]),I("hr"),I("center",null,[I("button[innerText=\u041d\u043e\u0432\u044b\u0439 \u043c\u0438\u0440]",
{onclick:()=>{const r=prompt("\u0418\u043c\u044f \u043d\u043e\u0432\u043e\u0433\u043e \u041c\u0438\u0440\u0430:\n(\u043c\u0430\u043a\u0441. 16 \u0441\u0438\u043c\u0431\u043e\u043b\u043e\u0432)","\u041d\u043e\u0432\u044b\u0439 \u043c\u0438\u0440");r&&(16<r.length?alert("\u0418\u043c\u044f \u0441\u043b\u0438\u0448\u043a\u043e\u043c \u0434\u043e\u043b\u0433\u043e\u0435!"):b.eb({id:L(0,...c.worlds.map(q=>q.id))-1,label:r,mod_l:Oa.now(),mod_r:0}))}}),I("button[innerText=\u0421\u0430\u0439\u0442 \u043f\u0440\u043e\u0435\u043a\u0442\u0430]",
{onclick:()=>{open("//github.com/L3P3/minicraft")}})]),I("center",null,[I("small[innerText=\u0412\u0435\u0440\u0441\u0438\u044f 0.10.6 \u043e\u0442 L3P3]")]),C&&h&&I("div",{F:{"menu overlay advanced":!0,busy:G},onclick:r=>{"menu overlay advanced"===r.target.className&&y(!1)}},[I("div[className=window]",null,[I("h2",{innerText:`"${h.label}"`,title:h.id}),I("table",null,[!!h.account_name&&I("tr",null,[I("td[innerText=\u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446:]"),I("td",{innerText:h.account_name})]),
I("tr",null,[I("td[innerText=\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f:]"),I("td",{innerText:qb(M(h.local,h.remote),!1)})])]),I("center",null,[I("button[innerText=\u041f\u0435\u0440\u0435\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u0442\u044c]",{disabled:G||!h.writable,onclick:()=>{const r=prompt("\u041d\u043e\u0432\u043e\u0435 \u0438\u043c\u044f \u043c\u0438\u0440\u0430:\n(\u043c\u0430\u043a\u0441. 16 \u0441\u0438\u043c\u0432\u043e\u043b\u043e\u0432)",h.label);!r||r===h.label||16<r.length||
(h.local&&b.P(h.id,{label:r}),h.remote&&(P(!0),fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Va({what:"meta",world:h.id,label:r})}).then(q=>{if(!q.ok)throw Error(403===q.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");
return q.json()}).catch(q=>{alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u043c\u0438\u0440\u0430: "+q.message)}).then(()=>{P(!1)})))},title:h.writable?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442 \u0438\u043c\u044f \u043c\u0438\u0440\u0443":"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438!"}),I("button",{disabled:G||!h.local&&!h.writable,innerText:h.local?"\u0423\u0434\u0430\u043b\u0438\u0442\u044c (\u043b\u043e\u043a\u0430\u043b)":
"\u0423\u0434\u0430\u043b\u0438\u0442\u044c",onclick:()=>{confirm('\u041c\u0438\u0440 "'+h.label+'" \u0442\u043e\u0447\u043d\u043e \u0443\u0434\u0430\u043b\u0438\u0442\u044c?')&&(h.local?(b.fb(h.id),Rb(h.id)):(P(!0),fetch("/api/minicraft/world",{method:"DELETE",headers:{"Content-Type":"application/json"},body:Va({what:"world",world:h.id})}).then(r=>{if(!r.ok)throw Error(403===r.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":
"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");da();t(null);y(!1);n();P(!1);ea();return r.json()}).catch(r=>{alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u0438 \u043c\u0438\u0440\u0430: "+r.message);P(!1)})))},title:h.local||h.writable?"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043c\u0438\u0440":"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438!"})]),
I("center",null,[I("button",{disabled:G||!h.remote||!h.writable,innerText:`${"\u041f\u0443\u0431\u043b\u0438\u0447\u043d\u044b\u0439"}: ${h.public?"\u0414\u0430":"\u041d\u0435\u0442"}`,onclick:()=>{P(!0);fetch("/api/minicraft/world",{method:"POST",headers:{"Content-Type":"application/json"},body:Va({what:"meta",world:h.id,public:!h.public})}).then(r=>{if(!r.ok)throw Error(403===r.status?"\u041d\u0435\u0442\u0443 \u0440\u0430\u0437\u0440\u0435\u0448\u0435\u043d\u0438\u044f. \u0417\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d?":
"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f.");da();n();P(!1);ea();return r.json()}).catch(r=>{alert("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0438 \u043c\u0438\u0440\u0430: "+r.message);P(!1)})},title:h.remote?h.writable?h.public?"\u041f\u0440\u0438\u0432\u0430\u0442\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043c\u0438\u0440":"\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442 \u043c\u0438\u0440":
"\u041d\u0435\u0442 \u0430\u0432\u0442\u043e\u0440\u0438\u0437\u0430\u0446\u0438\u0438!":"\u041c\u0438\u0440 \u043d\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d!"}),I("button",{disabled:G||!g||0<h.local&&0<h.remote||!h.remote&&!a.rank,innerText:h.local?g&&h&&!h.remote?"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442":"\u041f\u0435\u0440\u0435\u043d\u0435\u0441\u0442\u0438":"\u0421\u043a\u0430\u0447\u0430\u0442\u044c",onclick:()=>{h.local?h.remote||b.P(h.id,{mod_r:1}):b.eb({id:h.id,label:h.label,
mod_l:1,mod_r:h.remote})},title:g?h.local?h.remote?"\u041c\u0438\u0440 \u0443\u0436\u0435 \u0435\u0441\u0442\u044c \u043d\u0430 \u0434\u0432\u0443\u0445 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0430\u0445!":a.rank?"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442 \u043c\u0438\u0440 \u043d\u0430 \u0441\u0435\u0440\u0432\u0435\u0440":"\u041d\u0435 \u0437\u0430\u0440\u0435\u0433\u0435\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d!":"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442 \u043c\u0438\u0440 \u0438\u0437 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 ":
"\u0421\u043f\u0438\u0441\u043e\u043a \u0435\u0449\u0435 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u0442\u0441\u044f!"})])])])]}function md({account:a,a:b,config:c,cb:d}){const [e,k]=sa(0),l=B("div[className=game]");return[0===e&&H(bd,{account:a,a:b,config:c,Ca:k}),1===e&&H($c,{account:a,a:b,config:c,frame:l,cb:d,Ca:k})]}
function nd(){const [a,b]=la(xb),c=F({o:null,pb:0});D(()=>{let n=!1;onbeforeunload=onunload=onpagehide=onblur=()=>{n||(n=!0,c.o&&zc(c.o),b.Xa())};onpageshow=onfocus=()=>{n=!1};setInterval(()=>(b.Xa(),!Na&&Xa("minicraft.lock",Oa.now())),500);lb("touchend",f=>{c.pb=f.timeStamp},!0)});const d=F(n=>{if("INPUT"===n.target.tagName||!c.o)return!0;b.Ka(!1);Ic(c.o,n.keyCode,"keydown"===n.type);return!1}),e=F(()=>{b.Ka(!0)}),k=F(n=>{999<n.timeStamp-c.pb&&b.Ka(!1)}),l=a.config.ia;D(()=>{l?(lb("mousedown",k,
!0),lb("mouseup",k,!0),mb("touchstart",e,!0)):(mb("mousedown",k,!0),mb("mouseup",k,!0),lb("touchstart",e,!0))},[l]);B("",{onkeydown:d,onkeyup:d,oncontextmenu:pb,ondragstart:pb});return[H(md,{account:a.account,a:b,config:a.config,cb:c})]}function od(){close();return[I("h1[innerText=\u043c\u0438\u043d\u0438\u043a\u0440\u0430\u0444\u0442 \u0443\u0436\u0435 \u0437\u0430\u043f\u0443\u0449\u0435\u043d!]")]}
if(window.SSR)ta(nd);else if(Na){const a=new Na("minicraft.lock"),b=hb(()=>{ta(nd)},100);a.addEventListener("message",c=>{"yes"===c.data?(jb(b),a.close(),ta(od)):(a.postMessage("yes"),focus())});a.postMessage("anyone there?")}else{const a=S(R.getItem("minicraft.lock")),b=Oa.now()-1E3;a<b?ta(nd):hb(()=>{ta(S(R.getItem("minicraft.lock"))===a?nd:od)},a-b)};
